/*! For license information please see 9v0res.882.13d0c848.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[882],{66973:function(W,i,L){"use strict";var h=L(11138),l=L(21668),t=L(9603);L.g.__TYPEDARRAY_POOL||(L.g.__TYPEDARRAY_POOL={UINT8:l([32,0]),UINT16:l([32,0]),UINT32:l([32,0]),INT8:l([32,0]),INT16:l([32,0]),INT32:l([32,0]),FLOAT:l([32,0]),DOUBLE:l([32,0]),DATA:l([32,0]),UINT8C:l([32,0]),BUFFER:l([32,0])});var p="undefined"!==typeof Uint8ClampedArray,x=L.g.__TYPEDARRAY_POOL;x.UINT8C||(x.UINT8C=l([32,0])),x.BUFFER||(x.BUFFER=l([32,0]));var R=x.DATA,z=x.BUFFER;function r(W){if(W){var i=W.length||W.byteLength,L=h.log2(i);R[L].push(W)}}function N(W){W=h.nextPow2(W);var i=h.log2(W),L=R[i];return L.length>0?L.pop():new ArrayBuffer(W)}function I(W){return new Uint8Array(N(W),0,W)}function s(W){return new Uint16Array(N(2*W),0,W)}function o(W){return new Uint32Array(N(4*W),0,W)}function D(W){return new Int8Array(N(W),0,W)}function S(W){return new Int16Array(N(2*W),0,W)}function C(W){return new Int32Array(N(4*W),0,W)}function e(W){return new Float32Array(N(4*W),0,W)}function V(W){return new Float64Array(N(8*W),0,W)}function c(W){return p?new Uint8ClampedArray(N(W),0,W):I(W)}function f(W){return new DataView(N(W),0,W)}i.free=function(W){if(t(W))z[h.log2(W.length)].push(W);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(W)&&(W=W.buffer),!W)return;var i=W.length||W.byteLength,L=0|h.log2(i);R[L].push(W)}},i.freeUint8=i.freeUint16=i.freeUint32=i.freeInt8=i.freeInt16=i.freeInt32=i.freeFloat32=i.freeFloat=i.freeFloat64=i.freeDouble=i.freeUint8Clamped=i.freeDataView=function(W){r(W.buffer)},i.freeArrayBuffer=r,i.freeBuffer=function(W){z[h.log2(W.length)].push(W)},i.malloc=function(W,i){if(void 0===i||"arraybuffer"===i)return N(W);switch(i){case"uint8":return I(W);case"uint16":return s(W);case"uint32":return o(W);case"int8":return D(W);case"int16":return S(W);case"int32":return C(W);case"float":case"float32":return e(W);case"double":case"float64":return V(W);case"uint8_clamped":return c(W);case"buffer":throw"Buffer not supported";case"data":case"dataview":return f(W);default:return null}return null},i.mallocArrayBuffer=N,i.mallocUint8=I,i.mallocUint16=s,i.mallocUint32=o,i.mallocInt8=D,i.mallocInt16=S,i.mallocInt32=C,i.mallocFloat32=i.mallocFloat=e,i.mallocFloat64=i.mallocDouble=V,i.mallocUint8Clamped=c,i.mallocDataView=f,i.clearCache=function(){for(var W=0;W<32;++W)x.UINT8[W].length=0,x.UINT16[W].length=0,x.UINT32[W].length=0,x.INT8[W].length=0,x.INT16[W].length=0,x.INT32[W].length=0,x.FLOAT[W].length=0,x.DOUBLE[W].length=0,x.UINT8C[W].length=0,R[W].length=0,z[W].length=0}},97887:function(W,i,L){W.exports=l;var h=L(59344);function l(W,i){if(!(this instanceof l))return new l(W,i);var L=h.create();h.add(L,W,i),this.base=h.min(h.create(),W,L),this.vec=h.clone(i),this.max=h.max(h.create(),W,L),this.mag=h.length(this.vec)}var t=l.prototype;t.width=function(){return this.vec[0]},t.height=function(){return this.vec[1]},t.depth=function(){return this.vec[2]},t.x0=function(){return this.base[0]},t.y0=function(){return this.base[1]},t.z0=function(){return this.base[2]},t.x1=function(){return this.max[0]},t.y1=function(){return this.max[1]},t.z1=function(){return this.max[2]},t.translate=function(W){return h.add(this.max,this.max,W),h.add(this.base,this.base,W),this},t.setPosition=function(W){return h.add(this.max,W,this.vec),h.copy(this.base,W),this},t.expand=function(W){var i=h.create(),L=h.create();return h.max(i,W.max,this.max),h.min(L,W.base,this.base),h.subtract(i,i,L),new l(L,i)},t.intersects=function(W){return!(W.base[0]>this.max[0])&&(!(W.base[1]>this.max[1])&&(!(W.base[2]>this.max[2])&&(!(W.max[0]<this.base[0])&&(!(W.max[1]<this.base[1])&&!(W.max[2]<this.base[2])))))},t.touches=function(W){var i=this.union(W);return null!==i&&(0==i.width()||0==i.height()||0==i.depth())},t.union=function(W){if(!this.intersects(W))return null;var i=Math.max(W.base[0],this.base[0]),L=Math.max(W.base[1],this.base[1]),h=Math.max(W.base[2],this.base[2]);return new l([i,L,h],[Math.min(W.max[0],this.max[0])-i,Math.min(W.max[1],this.max[1])-L,Math.min(W.max[2],this.max[2])-h])}},11138:function(W,i){"use strict";function L(W){var i=32;return(W&=-W)&&i--,65535&W&&(i-=16),16711935&W&&(i-=8),252645135&W&&(i-=4),858993459&W&&(i-=2),1431655765&W&&(i-=1),i}i.INT_BITS=32,i.INT_MAX=2147483647,i.INT_MIN=-1<<31,i.sign=function(W){return(W>0)-(W<0)},i.abs=function(W){var i=W>>31;return(W^i)-i},i.min=function(W,i){return i^(W^i)&-(W<i)},i.max=function(W,i){return W^(W^i)&-(W<i)},i.isPow2=function(W){return!(W&W-1)&&!!W},i.log2=function(W){var i,L;return i=(W>65535)<<4,i|=L=((W>>>=i)>255)<<3,i|=L=((W>>>=L)>15)<<2,(i|=L=((W>>>=L)>3)<<1)|(W>>>=L)>>1},i.log10=function(W){return W>=1e9?9:W>=1e8?8:W>=1e7?7:W>=1e6?6:W>=1e5?5:W>=1e4?4:W>=1e3?3:W>=100?2:W>=10?1:0},i.popCount=function(W){return 16843009*((W=(858993459&(W-=W>>>1&1431655765))+(W>>>2&858993459))+(W>>>4)&252645135)>>>24},i.countTrailingZeros=L,i.nextPow2=function(W){return W+=0===W,--W,W|=W>>>1,W|=W>>>2,W|=W>>>4,W|=W>>>8,(W|=W>>>16)+1},i.prevPow2=function(W){return W|=W>>>1,W|=W>>>2,W|=W>>>4,W|=W>>>8,(W|=W>>>16)-(W>>>1)},i.parity=function(W){return W^=W>>>16,W^=W>>>8,W^=W>>>4,27030>>>(W&=15)&1};var h=new Array(256);!function(W){for(var i=0;i<256;++i){var L=i,h=i,l=7;for(L>>>=1;L;L>>>=1)h<<=1,h|=1&L,--l;W[i]=h<<l&255}}(h),i.reverse=function(W){return h[255&W]<<24|h[W>>>8&255]<<16|h[W>>>16&255]<<8|h[W>>>24&255]},i.interleave2=function(W,i){return(W=1431655765&((W=858993459&((W=252645135&((W=16711935&((W&=65535)|W<<8))|W<<4))|W<<2))|W<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))<<1},i.deinterleave2=function(W,i){return(W=65535&((W=16711935&((W=252645135&((W=858993459&((W=W>>>i&1431655765)|W>>>1))|W>>>2))|W>>>4))|W>>>16))<<16>>16},i.interleave3=function(W,i,L){return W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2),(W|=(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<1)|(L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2))<<2},i.deinterleave3=function(W,i){return(W=1023&((W=4278190335&((W=251719695&((W=3272356035&((W=W>>>i&1227133513)|W>>>2))|W>>>4))|W>>>8))|W>>>16))<<22>>22},i.nextCombination=function(W){var i=W|W-1;return i+1|(~i&-~i)-1>>>L(W)+1}},49172:function(W,i,L){"use strict";W.exports=function(W,i,L){switch(arguments.length){case 1:return N(W);case 2:return"function"===typeof i?z(W,W,i,!0):I(W,i);case 3:return z(W,i,L,!1);default:throw new Error("box-intersect: Invalid arguments")}};var h,l=L(66973),t=L(63222),p=L(5841);function x(W,i){for(var L=0;L<W;++L)if(!(i[L]<=i[L+W]))return!0;return!1}function R(W,i,L,h){for(var l=0,t=0,p=0,R=W.length;p<R;++p){var z=W[p];if(!x(i,z)){for(var r=0;r<2*i;++r)L[l++]=z[r];h[t++]=p}}return t}function z(W,i,L,h){var x=W.length,z=i.length;if(!(x<=0||z<=0)){var r=W[0].length>>>1;if(!(r<=0)){var N,I=l.mallocDouble(2*r*x),s=l.mallocInt32(x);if((x=R(W,r,I,s))>0){if(1===r&&h)t.init(x),N=t.sweepComplete(r,L,0,x,I,s,0,x,I,s);else{var o=l.mallocDouble(2*r*z),D=l.mallocInt32(z);(z=R(i,r,o,D))>0&&(t.init(x+z),N=1===r?t.sweepBipartite(r,L,0,x,I,s,0,z,o,D):p(r,L,h,x,I,s,z,o,D),l.free(o),l.free(D))}l.free(I),l.free(s)}return N}}}function r(W,i){h.push([W,i])}function N(W){return h=[],z(W,W,r,!0),h}function I(W,i){return h=[],z(W,i,r,!1),h}},51801:function(W,i){"use strict";var L="d",h="ax",l="fp",t="es",p="rs",x="re",R="rb",z="bs",r="be",N="bb",I=[L,h,"vv",p,x,R,"ri",z,r,N,"bi"];function s(W){var i="bruteForce"+(W?"Full":"Partial"),h=[],p=I.slice();W||p.splice(3,0,l);var x=["function "+i+"("+p.join()+"){"];function R(i,l){var p=function(W,i,h){var l="bruteForce"+(W?"Red":"Blue")+(i?"Flip":"")+(h?"Full":""),p=["function ",l,"(",I.join(),"){","var ",t,"=2*",L,";"],x="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",R="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(h?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return W?p.push(x,"Q",":",R):p.push(R,"Q",":",x),h?p.push("if(y1<x0||x1<y0)continue;"):i?p.push("if(y0<=x0||x1<y0)continue;"):p.push("if(y0<x0||x1<y0)continue;"),p.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),i?p.push("yi,xi"):p.push("xi,yi"),p.push(");if(rv!==void 0)return rv;}}}"),{name:l,code:p.join("")}}(i,l,W);h.push(p.code),x.push("return "+p.name+"("+I.join()+");")}x.push("if(re-rs>be-bs){"),W?(R(!0,!1),x.push("}else{"),R(!1,!1)):(x.push("if(fp){"),R(!0,!0),x.push("}else{"),R(!0,!1),x.push("}}else{if(fp){"),R(!1,!0),x.push("}else{"),R(!1,!1),x.push("}")),x.push("}}return "+i);var z=h.join("")+x.join("");return new Function(z)()}i.partial=s(!1),i.full=s(!0)},5841:function(W,i,L){"use strict";W.exports=function(W,i,L,t,r,a,P,y,M){!function(W,i){var L=8*l.log2(i+1)*(W+1)|0,t=l.nextPow2(6*L);C.length<t&&(h.free(C),C=h.mallocInt32(t));var p=l.nextPow2(2*L);e.length<p&&(h.free(e),e=h.mallocDouble(p))}(W,t+P);var b,j=0,Z=2*W;V(j++,0,0,t,0,P,L?16:0,-1/0,1/0),L||V(j++,0,0,P,0,t,1,-1/0,1/0);for(;j>0;){var X=6*(j-=1),T=C[X],F=C[X+1],q=C[X+2],H=C[X+3],k=C[X+4],U=C[X+5],d=2*j,B=e[d],w=e[d+1],g=1&U,n=!!(16&U),m=r,E=a,K=y,G=M;if(g&&(m=y,E=M,K=r,G=a),!(2&U&&(q=s(W,T,F,q,m,E,w),F>=q))&&!(4&U&&(F=o(W,T,F,q,m,E,B))>=q)){var u=q-F,J=k-H;if(n){if(W*u*(u+J)<4194304){if(void 0!==(b=R.scanComplete(W,T,i,F,q,m,E,H,k,K,G)))return b;continue}}else{if(W*Math.min(u,J)<128){if(void 0!==(b=p(W,T,i,g,F,q,m,E,H,k,K,G)))return b;continue}if(W*u*J<4194304){if(void 0!==(b=R.scanBipartite(W,T,i,g,F,q,m,E,H,k,K,G)))return b;continue}}var A=N(W,T,F,q,m,E,B,w);if(F<A)if(W*(A-F)<128){if(void 0!==(b=x(W,T+1,i,F,A,m,E,H,k,K,G)))return b}else if(T===W-2){if(void 0!==(b=g?R.sweepBipartite(W,i,H,k,K,G,F,A,m,E):R.sweepBipartite(W,i,F,A,m,E,H,k,K,G)))return b}else V(j++,T+1,F,A,H,k,g,-1/0,1/0),V(j++,T+1,H,k,F,A,1^g,-1/0,1/0);if(A<q){var v=z(W,T,H,k,K,G),Q=K[Z*v+T],O=I(W,T,v,k,K,G,Q);if(O<k&&V(j++,T,A,q,O,k,(4|g)+(n?16:0),Q,w),H<v&&V(j++,T,A,q,H,v,(2|g)+(n?16:0),B,Q),v+1===O){if(void 0!==(b=n?f(W,T,i,A,q,m,E,v,K,G[v]):c(W,T,i,g,A,q,m,E,v,K,G[v])))return b}else if(v<O){var Y;if(n){if(Y=D(W,T,A,q,m,E,Q),A<Y){var WW=I(W,T,A,Y,m,E,Q);if(T===W-2){if(A<WW&&void 0!==(b=R.sweepComplete(W,i,A,WW,m,E,v,O,K,G)))return b;if(WW<Y&&void 0!==(b=R.sweepBipartite(W,i,WW,Y,m,E,v,O,K,G)))return b}else A<WW&&V(j++,T+1,A,WW,v,O,16,-1/0,1/0),WW<Y&&(V(j++,T+1,WW,Y,v,O,0,-1/0,1/0),V(j++,T+1,v,O,WW,Y,1,-1/0,1/0))}}else Y=g?S(W,T,A,q,m,E,Q):D(W,T,A,q,m,E,Q),A<Y&&(T===W-2?b=g?R.sweepBipartite(W,i,v,O,K,G,A,Y,m,E):R.sweepBipartite(W,i,A,Y,m,E,v,O,K,G):(V(j++,T+1,A,Y,v,O,g,-1/0,1/0),V(j++,T+1,v,O,A,Y,1^g,-1/0,1/0)))}}}}};var h=L(66973),l=L(11138),t=L(51801),p=t.partial,x=t.full,R=L(63222),z=L(62299),r=L(21424),N=r("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),I=r("lo===p0",["p0"]),s=r("lo<p0",["p0"]),o=r("hi<=p0",["p0"]),D=r("lo<=p0&&p0<=hi",["p0"]),S=r("lo<p0&&p0<=hi",["p0"]),C=h.mallocInt32(1024),e=h.mallocDouble(1024);function V(W,i,L,h,l,t,p,x,R){var z=6*W;C[z]=i,C[z+1]=L,C[z+2]=h,C[z+3]=l,C[z+4]=t,C[z+5]=p;var r=2*W;e[r]=x,e[r+1]=R}function c(W,i,L,h,l,t,p,x,R,z,r){var N=2*W,I=R*N,s=z[I+i];W:for(var o=l,D=l*N;o<t;++o,D+=N){var S=p[D+i],C=p[D+i+W];if(!(s<S||C<s)&&(!h||s!==S)){for(var e,V=x[o],c=i+1;c<W;++c){S=p[D+c],C=p[D+c+W];var f=z[I+c],a=z[I+c+W];if(C<f||a<S)continue W}if(void 0!==(e=h?L(r,V):L(V,r)))return e}}}function f(W,i,L,h,l,t,p,x,R,z){var r=2*W,N=x*r,I=R[N+i];W:for(var s=h,o=h*r;s<l;++s,o+=r){var D=p[s];if(D!==z){var S=t[o+i],C=t[o+i+W];if(!(I<S||C<I)){for(var e=i+1;e<W;++e){S=t[o+e],C=t[o+e+W];var V=R[N+e],c=R[N+e+W];if(C<V||c<S)continue W}var f=L(D,z);if(void 0!==f)return f}}}}},62299:function(W,i,L){"use strict";W.exports=function(W,i,L,t,p,x){if(t<=L+1)return L;var R=L,z=t,r=t+L>>>1,N=2*W,I=r,s=p[N*r+i];for(;R<z;){if(z-R<8){l(W,i,R,z,p,x),s=p[N*r+i];break}var o=z-R,D=Math.random()*o+R|0,S=p[N*D+i],C=Math.random()*o+R|0,e=p[N*C+i],V=Math.random()*o+R|0,c=p[N*V+i];S<=e?c>=e?(I=C,s=e):S>=c?(I=D,s=S):(I=V,s=c):e>=c?(I=C,s=e):c>=S?(I=D,s=S):(I=V,s=c);for(var f=N*(z-1),a=N*I,P=0;P<N;++P,++f,++a){var y=p[f];p[f]=p[a],p[a]=y}var M=x[z-1];x[z-1]=x[I],x[I]=M,I=h(W,i,R,z-1,p,x,s);for(f=N*(z-1),a=N*I,P=0;P<N;++P,++f,++a){y=p[f];p[f]=p[a],p[a]=y}M=x[z-1];if(x[z-1]=x[I],x[I]=M,r<I){for(z=I-1;R<z&&p[N*(z-1)+i]===s;)z-=1;z+=1}else{if(!(I<r))break;for(R=I+1;R<z&&p[N*R+i]===s;)R+=1}}return h(W,i,L,r,p,x,p[N*r+i])};var h=L(21424)("lo<p0",["p0"]);function l(W,i,L,h,l,t){for(var p=2*W,x=p*(L+1)+i,R=L+1;R<h;++R,x+=p)for(var z=l[x],r=R,N=p*(R-1);r>L&&l[N+i]>z;--r,N-=p){for(var I=N,s=N+p,o=0;o<p;++o,++I,++s){var D=l[I];l[I]=l[s],l[s]=D}var S=t[r];t[r]=t[r-1],t[r-1]=S}}},21424:function(W){"use strict";W.exports=function(W,i){var L="abcdef".split("").concat(i),h=[];W.indexOf("lo")>=0&&h.push("lo=e[k+n]");W.indexOf("hi")>=0&&h.push("hi=e[k+o]");return L.push("for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m".replace("_",h.join()).replace("$",W)),Function.apply(void 0,L)}},42693:function(W){"use strict";W.exports=function(W,L){L<=128?i(0,L-1,W):R(0,L-1,W)};function i(W,i,L){for(var h=2*(W+1),l=W+1;l<=i;++l){for(var t=L[h++],p=L[h++],x=l,R=h-2;x-- >W;){var z=L[R-2],r=L[R-1];if(z<t)break;if(z===t&&r<p)break;L[R]=z,L[R+1]=r,R-=2}L[R]=t,L[R+1]=p}}function L(W,i,L){i*=2;var h=L[W*=2],l=L[W+1];L[W]=L[i],L[W+1]=L[i+1],L[i]=h,L[i+1]=l}function h(W,i,L){i*=2,L[W*=2]=L[i],L[W+1]=L[i+1]}function l(W,i,L,h){i*=2,L*=2;var l=h[W*=2],t=h[W+1];h[W]=h[i],h[W+1]=h[i+1],h[i]=h[L],h[i+1]=h[L+1],h[L]=l,h[L+1]=t}function t(W,i,L,h,l){i*=2,l[W*=2]=l[i],l[i]=L,l[W+1]=l[i+1],l[i+1]=h}function p(W,i,L){i*=2;var h=L[W*=2],l=L[i];return!(h<l)&&(h!==l||L[W+1]>L[i+1])}function x(W,i,L,h){var l=h[W*=2];return l<i||l===i&&h[W+1]<L}function R(W,z,r){var N=(z-W+1)/6|0,I=W+N,s=z-N,o=W+z>>1,D=o-N,S=o+N,C=I,e=D,V=o,c=S,f=s,a=W+1,P=z-1,y=0;p(C,e,r)&&(y=C,C=e,e=y),p(c,f,r)&&(y=c,c=f,f=y),p(C,V,r)&&(y=C,C=V,V=y),p(e,V,r)&&(y=e,e=V,V=y),p(C,c,r)&&(y=C,C=c,c=y),p(V,c,r)&&(y=V,V=c,c=y),p(e,f,r)&&(y=e,e=f,f=y),p(e,V,r)&&(y=e,e=V,V=y),p(c,f,r)&&(y=c,c=f,f=y);for(var M=r[2*e],b=r[2*e+1],j=r[2*c],Z=r[2*c+1],X=2*C,T=2*V,F=2*f,q=2*I,H=2*o,k=2*s,U=0;U<2;++U){var d=r[X+U],B=r[T+U],w=r[F+U];r[q+U]=d,r[H+U]=B,r[k+U]=w}h(D,W,r),h(S,z,r);for(var g=a;g<=P;++g)if(x(g,M,b,r))g!==a&&L(g,a,r),++a;else if(!x(g,j,Z,r))for(;;){if(x(P,j,Z,r)){x(P,M,b,r)?(l(g,a,P,r),++a,--P):(L(g,P,r),--P);break}if(--P<g)break}t(W,a-1,M,b,r),t(z,P+1,j,Z,r),a-2-W<=32?i(W,a-2,r):R(W,a-2,r),z-(P+2)<=32?i(P+2,z,r):R(P+2,z,r),P-a<=32?i(a,P,r):R(a,P,r)}},63222:function(W,i,L){"use strict";W.exports={init:function(W){var i=l.nextPow2(W);R.length<i&&(h.free(R),R=h.mallocInt32(i));z.length<i&&(h.free(z),z=h.mallocInt32(i));r.length<i&&(h.free(r),r=h.mallocInt32(i));N.length<i&&(h.free(N),N=h.mallocInt32(i));I.length<i&&(h.free(I),I=h.mallocInt32(i));s.length<i&&(h.free(s),s=h.mallocInt32(i));var L=8*i;o.length<L&&(h.free(o),o=h.mallocDouble(L))},sweepBipartite:function(W,i,L,h,l,x,I,s,C,e){for(var V=0,c=2*W,f=W-1,a=c-1,P=L;P<h;++P){var y=x[P],M=c*P;o[V++]=l[M+f],o[V++]=-(y+1),o[V++]=l[M+a],o[V++]=y}for(P=I;P<s;++P){y=e[P]+p;var b=c*P;o[V++]=C[b+f],o[V++]=-y,o[V++]=C[b+a],o[V++]=y}var j=V>>>1;t(o,j);var Z=0,X=0;for(P=0;P<j;++P){var T=0|o[2*P+1];if(T>=p)D(r,N,X--,T=T-p|0);else if(T>=0)D(R,z,Z--,T);else if(T<=-268435456){T=-T-p|0;for(var F=0;F<Z;++F){if(void 0!==(q=i(R[F],T)))return q}S(r,N,X++,T)}else{T=-T-1|0;for(F=0;F<X;++F){var q;if(void 0!==(q=i(T,r[F])))return q}S(R,z,Z++,T)}}},sweepComplete:function(W,i,L,h,l,p,x,C,e,V){for(var c=0,f=2*W,a=W-1,P=f-1,y=L;y<h;++y){var M=p[y]+1<<1,b=f*y;o[c++]=l[b+a],o[c++]=-M,o[c++]=l[b+P],o[c++]=M}for(y=x;y<C;++y){M=V[y]+1<<1;var j=f*y;o[c++]=e[j+a],o[c++]=1|-M,o[c++]=e[j+P],o[c++]=1|M}var Z=c>>>1;t(o,Z);var X=0,T=0,F=0;for(y=0;y<Z;++y){var q=0|o[2*y+1],H=1&q;if(y<Z-1&&q>>1===o[2*y+3]>>1&&(H=2,y+=1),q<0){for(var k=-(q>>1)-1,U=0;U<F;++U){if(void 0!==(d=i(I[U],k)))return d}if(0!==H)for(U=0;U<X;++U){if(void 0!==(d=i(R[U],k)))return d}if(1!==H)for(U=0;U<T;++U){var d;if(void 0!==(d=i(r[U],k)))return d}0===H?S(R,z,X++,k):1===H?S(r,N,T++,k):2===H&&S(I,s,F++,k)}else{k=(q>>1)-1;0===H?D(R,z,X--,k):1===H?D(r,N,T--,k):2===H&&D(I,s,F--,k)}}},scanBipartite:function(W,i,L,h,l,x,r,N,I,s,C,e){var V=0,c=2*W,f=i,a=i+W,P=1,y=1;h?y=p:P=p;for(var M=l;M<x;++M){var b=M+P,j=c*M;o[V++]=r[j+f],o[V++]=-b,o[V++]=r[j+a],o[V++]=b}for(M=I;M<s;++M){b=M+y;var Z=c*M;o[V++]=C[Z+f],o[V++]=-b}var X=V>>>1;t(o,X);var T=0;for(M=0;M<X;++M){var F=0|o[2*M+1];if(F<0){var q=!1;if((b=-F)>=p?(q=!h,b-=p):(q=!!h,b-=1),q)S(R,z,T++,b);else{var H=e[b],k=c*b,U=C[k+i+1],d=C[k+i+1+W];W:for(var B=0;B<T;++B){var w=R[B],g=c*w;if(!(d<r[g+i+1]||r[g+i+1+W]<U)){for(var n=i+2;n<W;++n)if(C[k+n+W]<r[g+n]||r[g+n+W]<C[k+n])continue W;var m,E=N[w];if(void 0!==(m=h?L(H,E):L(E,H)))return m}}}}else D(R,z,T--,F-P)}},scanComplete:function(W,i,L,h,l,x,z,r,N,I,s){for(var D=0,S=2*W,C=i,e=i+W,V=h;V<l;++V){var c=V+p,f=S*V;o[D++]=x[f+C],o[D++]=-c,o[D++]=x[f+e],o[D++]=c}for(V=r;V<N;++V){c=V+1;var a=S*V;o[D++]=I[a+C],o[D++]=-c}var P=D>>>1;t(o,P);var y=0;for(V=0;V<P;++V){var M=0|o[2*V+1];if(M<0){if((c=-M)>=p)R[y++]=c-p;else{var b=s[c-=1],j=S*c,Z=I[j+i+1],X=I[j+i+1+W];W:for(var T=0;T<y;++T){var F=R[T],q=z[F];if(q===b)break;var H=S*F;if(!(X<x[H+i+1]||x[H+i+1+W]<Z)){for(var k=i+2;k<W;++k)if(I[j+k+W]<x[H+k]||x[H+k+W]<I[j+k])continue W;var U=L(q,b);if(void 0!==U)return U}}}}else{for(c=M-p,T=y-1;T>=0;--T)if(R[T]===c){for(k=T+1;k<y;++k)R[k-1]=R[k];break}--y}}}};var h=L(66973),l=L(11138),t=L(42693),p=1<<28,x=1024,R=h.mallocInt32(x),z=h.mallocInt32(x),r=h.mallocInt32(x),N=h.mallocInt32(x),I=h.mallocInt32(x),s=h.mallocInt32(x),o=h.mallocDouble(8192);function D(W,i,L,h){var l=i[h],t=W[L-1];W[l]=t,i[t]=l}function S(W,i,L,h){W[L]=h,i[h]=L}},21668:function(W){"use strict";function i(W,L,h){var l=0|W[h];if(l<=0)return[];var t,p=new Array(l);if(h===W.length-1)for(t=0;t<l;++t)p[t]=L;else for(t=0;t<l;++t)p[t]=i(W,L,h+1);return p}W.exports=function(W,L){switch("undefined"===typeof L&&(L=0),typeof W){case"number":if(W>0)return function(W,i){var L,h;for(L=new Array(W),h=0;h<W;++h)L[h]=i;return L}(0|W,L);break;case"object":if("number"===typeof W.length)return i(W,L,0)}return[]}},65532:function(W,i,L){W.exports=function(){var W=this;this.components={},this.comps=this.components;var i=this.components,L=1,l={},t=[],p=[],x={timeout:!1,removals:[],multiComps:[]};function R(W,L){var h=i[L],t=l[L],p=t.hash[W];p&&(t.remove(W),h.onRemove&&(h.multi?(p.forEach((function(i){i&&h.onRemove(W,i)})),p.length=0):h.onRemove(W,p)),x.removals.push(t),z())}function z(){x.timeout||(x.timeout=!0,setTimeout(r,1))}function r(){x.timeout=!1,N()}function N(){x.multiComps.length&&function(W){for(var i=0;i<W.length;i++){var L=W[i],h=L.entID,l=L.data,t=l.hash[h];if(t){for(var p=0;p<t.length;p++)t[p]||(t.splice(p,1),p--);0===t.length&&(l.remove(h),x.removals.push(l))}}W.length=0}(x.multiComps),x.removals.length&&function(W){for(var i=0;i<W.length;i++){W[i].flush()}W.length=0}(x.removals)}this._storage=l,this._systems=t,this._renderSystems=p,this.createEntity=function(i){var h=L++;return Array.isArray(i)&&i.forEach((function(i){return W.addComponent(h,i)})),h},this.deleteEntity=function(i){return Object.keys(l).forEach((function(W){l[W].hash[i]&&R(i,W)})),W},this.createComponent=function(W){if(!W)throw new Error("Missing component definition");var L=W.name;if(!L)throw new Error("Component definition must have a name property.");if("string"!==typeof L)throw new Error("Component name must be a string.");if(""===L)throw new Error("Component name must be a non-empty string.");if(l[L])throw new Error("Component ".concat(L," already exists."));var x={};return x.name=L,x.multi=!!W.multi,x.order=isNaN(W.order)?99:W.order,x.stateConstructor=W.stateConstructor||null,x.state=W.state||{},x.onAdd=W.onAdd||null,x.onRemove=W.onRemove||null,x.system=W.system||null,x.renderSystem=W.renderSystem||null,i[L]=x,l[L]=new h,l[L]._pendingMultiCleanup=!1,l[L]._multiCleanupIDs=x.multi?[]:null,x.system&&(t.push(L),t.sort((function(W,L){return i[W].order-i[L].order}))),x.renderSystem&&(p.push(L),p.sort((function(W,L){return i[W].order-i[L].order}))),L},this.overwriteComponent=function(W,L){var h=i[W];if(!h)throw new Error("Unknown component: ".concat(W));if(!L)throw new Error("Missing component definition");if(h.name!==L.name)throw new Error("Overwriting component must use the same name property.");var x={};x.name=W,x.multi=!!L.multi,x.order=isNaN(L.order)?99:L.order,x.state=L.state||{},x.onAdd=L.onAdd||null,x.onRemove=L.onRemove||null,x.system=L.system||null,x.renderSystem=L.renderSystem||null,i[W]=x,l[W]._pendingMultiCleanup=!1,l[W]._multiCleanupIDs=x.multi?[]:null;var R=t.indexOf(W);x.system&&R<0&&t.push(W),!x.system&&R>=0&&t.splice(R,1),t.sort((function(W,L){return i[W].order-i[L].order}));var z=p.indexOf(W);x.renderSystem&&z<0&&p.push(W),!x.renderSystem&&z>=0&&p.splice(z,1),p.sort((function(W,L){return i[W].order-i[L].order}));var r=x.state;return this.getStatesList(W).forEach((function(W){for(var i in r)i in W||(W[i]=r[i]);x.onAdd&&x.onAdd(W.__id,W)})),W},this.deleteComponent=function(L){var h=l[L];if(!h)throw new Error("Unknown component: ".concat(L));h.flush(),h.list.forEach((function(W){W&&R(W.__id||W[0].__id,L)}));var x=t.indexOf(L),z=p.indexOf(L);return x>-1&&t.splice(x,1),z>-1&&p.splice(z,1),l[L].dispose(),delete l[L],delete i[L],W},this.addComponent=function(W,L,h){var t,p=i[L],x=l[L];if(!x)throw new Error("Unknown component: ".concat(L,"."));if(x.hash[W]&&!p.multi)throw new Error("Entity ".concat(W," already has component: ").concat(L,"."));if(p.stateConstructor){if(!(t=new p.stateConstructor).hasOwnProperty("__id"))throw new Error("Component ".concat(p.name," stateConstructor type does not have property __id"))}else t=Object.assign({},{__id:W},p.state,h);if(t.__id=W,p.multi){var R=x.hash[W];R||(R=[],x.add(W,R)),R.push(t)}else x.add(W,t);return p.onAdd&&p.onAdd(W,t),this},this.hasComponent=function(W,i){var L=l[i];if(!L)throw new Error("Unknown component: ".concat(i,"."));return!!L.hash[W]},this.removeComponent=function(i,L){if(!l[L])throw new Error("Unknown component: ".concat(L,"."));return R(i,L),W},this.getState=function(W,i){var L=l[i];if(!L)throw new Error("Unknown component: ".concat(i,"."));return L.hash[W]},this.getStatesList=function(W){var i=l[W];if(!i)throw new Error("Unknown component: ".concat(W,"."));return N(),i.list},this.getStateAccessor=function(W){if(!l[W])throw new Error("Unknown component: ".concat(W,"."));var i=l[W].hash;return function(W){return i[W]}},this.getComponentAccessor=function(W){if(!l[W])throw new Error("Unknown component: ".concat(W,"."));var i=l[W].hash;return function(W){return!!i[W]}},this.tick=function(L){N();for(var h=0;h<t.length;h++){var p=t[h],x=i[p],R=l[p];x.system(L,R.list),N()}return W},this.render=function(L){N();for(var h=0;h<p.length;h++){var t=p[h],x=i[t],R=l[t];x.renderSystem(L,R.list),N()}return W},this.removeMultiComponent=function(L,h,t){var p=i[h],R=l[h];if(!R)throw new Error("Unknown component: ".concat(h,"."));if(!p.multi)throw new Error("removeMultiComponent called on non-multi component");return function(W,i,L,h){var l=L.hash[W];if(l){var t=l[h];t&&(l[h]=null,i.onRemove&&i.onRemove(W,t),x.multiComps.push({entID:W,data:L}),z())}}(L,p,R,t),W}};var h=L(56707)},56707:function(W,i,L){var h=L(56690).default,l=L(89728).default;function t(W,i){var L=W._map[i];if(delete W.hash[i],delete W._map[i],L===W.list.length-1)W.list.pop();else{var h=W.list.pop();if(W.list[L]=h,null===h||null===h[0]){var l=W.list.length;for(var t in W._map)if(W._map[t]===l)return void(W._map[t]=L)}else{var p=h.__id||h[0].__id;W._map[p]=L}}}W.exports=function(){"use strict";function W(){h(this,W),this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}return l(W,[{key:"add",value:function(W,i){if("number"===typeof this._map[W]){var L=this._map[W];this.hash[W]=i,this.list[L]=i}else this._map[W]=this.list.length,this.hash[W]=i,this.list.push(i)}},{key:"remove",value:function(W){var i=this._map[W];this.hash[W]=null,this.list[i]=null,this._pendingRemovals.push(W)}},{key:"dispose",value:function(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}},{key:"flush",value:function(){for(var W=0;W<this._pendingRemovals.length;W++){var i=this._pendingRemovals[W];null===this.hash[i]&&t(this,i)}this._pendingRemovals.length=0}}]),W}()},91330:function(W){"use strict";var i,L="object"===typeof Reflect?Reflect:null,h=L&&"function"===typeof L.apply?L.apply:function(W,i,L){return Function.prototype.apply.call(W,i,L)};i=L&&"function"===typeof L.ownKeys?L.ownKeys:Object.getOwnPropertySymbols?function(W){return Object.getOwnPropertyNames(W).concat(Object.getOwnPropertySymbols(W))}:function(W){return Object.getOwnPropertyNames(W)};var l=Number.isNaN||function(W){return W!==W};function t(){t.init.call(this)}W.exports=t,W.exports.once=function(W,i){return new Promise((function(L,h){function l(L){W.removeListener(i,t),h(L)}function t(){"function"===typeof W.removeListener&&W.removeListener("error",l),L([].slice.call(arguments))}D(W,i,t,{once:!0}),"error"!==i&&function(W,i,L){"function"===typeof W.on&&D(W,"error",i,L)}(W,l,{once:!0})}))},t.EventEmitter=t,t.prototype._events=void 0,t.prototype._eventsCount=0,t.prototype._maxListeners=void 0;var p=10;function x(W){if("function"!==typeof W)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof W)}function R(W){return void 0===W._maxListeners?t.defaultMaxListeners:W._maxListeners}function z(W,i,L,h){var l,t,p,z;if(x(L),void 0===(t=W._events)?(t=W._events=Object.create(null),W._eventsCount=0):(void 0!==t.newListener&&(W.emit("newListener",i,L.listener?L.listener:L),t=W._events),p=t[i]),void 0===p)p=t[i]=L,++W._eventsCount;else if("function"===typeof p?p=t[i]=h?[L,p]:[p,L]:h?p.unshift(L):p.push(L),(l=R(W))>0&&p.length>l&&!p.warned){p.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=W,r.type=i,r.count=p.length,z=r,console&&console.warn&&console.warn(z)}return W}function r(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function N(W,i,L){var h={fired:!1,wrapFn:void 0,target:W,type:i,listener:L},l=r.bind(h);return l.listener=L,h.wrapFn=l,l}function I(W,i,L){var h=W._events;if(void 0===h)return[];var l=h[i];return void 0===l?[]:"function"===typeof l?L?[l.listener||l]:[l]:L?function(W){for(var i=new Array(W.length),L=0;L<i.length;++L)i[L]=W[L].listener||W[L];return i}(l):o(l,l.length)}function s(W){var i=this._events;if(void 0!==i){var L=i[W];if("function"===typeof L)return 1;if(void 0!==L)return L.length}return 0}function o(W,i){for(var L=new Array(i),h=0;h<i;++h)L[h]=W[h];return L}function D(W,i,L,h){if("function"===typeof W.on)h.once?W.once(i,L):W.on(i,L);else{if("function"!==typeof W.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof W);W.addEventListener(i,(function l(t){h.once&&W.removeEventListener(i,l),L(t)}))}}Object.defineProperty(t,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(W){if("number"!==typeof W||W<0||l(W))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+W+".");p=W}}),t.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(W){if("number"!==typeof W||W<0||l(W))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+W+".");return this._maxListeners=W,this},t.prototype.getMaxListeners=function(){return R(this)},t.prototype.emit=function(W){for(var i=[],L=1;L<arguments.length;L++)i.push(arguments[L]);var l="error"===W,t=this._events;if(void 0!==t)l=l&&void 0===t.error;else if(!l)return!1;if(l){var p;if(i.length>0&&(p=i[0]),p instanceof Error)throw p;var x=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw x.context=p,x}var R=t[W];if(void 0===R)return!1;if("function"===typeof R)h(R,this,i);else{var z=R.length,r=o(R,z);for(L=0;L<z;++L)h(r[L],this,i)}return!0},t.prototype.addListener=function(W,i){return z(this,W,i,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(W,i){return z(this,W,i,!0)},t.prototype.once=function(W,i){return x(i),this.on(W,N(this,W,i)),this},t.prototype.prependOnceListener=function(W,i){return x(i),this.prependListener(W,N(this,W,i)),this},t.prototype.removeListener=function(W,i){var L,h,l,t,p;if(x(i),void 0===(h=this._events))return this;if(void 0===(L=h[W]))return this;if(L===i||L.listener===i)0===--this._eventsCount?this._events=Object.create(null):(delete h[W],h.removeListener&&this.emit("removeListener",W,L.listener||i));else if("function"!==typeof L){for(l=-1,t=L.length-1;t>=0;t--)if(L[t]===i||L[t].listener===i){p=L[t].listener,l=t;break}if(l<0)return this;0===l?L.shift():function(W,i){for(;i+1<W.length;i++)W[i]=W[i+1];W.pop()}(L,l),1===L.length&&(h[W]=L[0]),void 0!==h.removeListener&&this.emit("removeListener",W,p||i)}return this},t.prototype.off=t.prototype.removeListener,t.prototype.removeAllListeners=function(W){var i,L,h;if(void 0===(L=this._events))return this;if(void 0===L.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==L[W]&&(0===--this._eventsCount?this._events=Object.create(null):delete L[W]),this;if(0===arguments.length){var l,t=Object.keys(L);for(h=0;h<t.length;++h)"removeListener"!==(l=t[h])&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(i=L[W]))this.removeListener(W,i);else if(void 0!==i)for(h=i.length-1;h>=0;h--)this.removeListener(W,i[h]);return this},t.prototype.listeners=function(W){return I(this,W,!0)},t.prototype.rawListeners=function(W){return I(this,W,!1)},t.listenerCount=function(W,i){return"function"===typeof W.listenerCount?W.listenerCount(i):s.call(W,i)},t.prototype.listenerCount=s,t.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},30109:function(W){"use strict";W.exports=function(W,i,L,h,l,t){var p=+i[0],x=+i[1],R=+i[2],z=+L[0],r=+L[1],N=+L[2],I=Math.sqrt(z*z+r*r+N*N);if(0===I)throw new Error("Can't raycast along a zero vector");return function(W,i,L,h,l,t,p,x,R,z){for(var r=0,N=Math.floor,I=0|N(i),s=0|N(L),o=0|N(h),D=l>0?1:-1,S=t>0?1:-1,C=p>0?1:-1,e=Math.abs(1/l),V=Math.abs(1/t),c=Math.abs(1/p),f=e<1/0?e*(D>0?I+1-i:i-I):1/0,a=V<1/0?V*(S>0?s+1-L:L-s):1/0,P=c<1/0?c*(C>0?o+1-h:h-o):1/0,y=-1;r<=x;){var M=W(I,s,o);if(M)return R&&(R[0]=i+r*l,R[1]=L+r*t,R[2]=h+r*p),z&&(z[0]=z[1]=z[2]=0,0===y&&(z[0]=-D),1===y&&(z[1]=-S),2===y&&(z[2]=-C)),M;f<a?f<P?(I+=D,r=f,f+=e,y=0):(o+=C,r=P,P+=c,y=2):a<P?(s+=S,r=a,a+=V,y=1):(o+=C,r=P,P+=c,y=2)}return R&&(R[0]=i+r*l,R[1]=L+r*t,R[2]=h+r*p),z&&(z[0]=z[1]=z[2]=0),0}(W,p,x,R,z/=I,r/=I,N/=I,h="undefined"===typeof h?64:+h,l,t)}},71870:function(W,i,L){"use strict";L.d(i,{e:function(){return x}});var h=L(15671),l=L(43144),t=L(91330);function p(){this.preventDefaults=!1,this.stopPropagation=!1,this.allowContextMenu=!1,this.disabled=!1}console.log("Here");var x=function(){function W(i,L){var l=this;(0,h.c)(this,W),this.version="0.7.0";var x=Object.assign({},new p,L||{});this.element=i||document,this.preventDefaults=!!x.preventDefaults,this.stopPropagation=!!x.stopPropagation,this.allowContextMenu=!!x.allowContextMenu,this.disabled=!!x.disabled,this.filterEvents=function(W,i){return!0},this.down=new t.EventEmitter,this.up=new t.EventEmitter,this.state={},this.pointerState={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?z(this):document.addEventListener("DOMContentLoaded",(function(W){z(l)}),{once:!0})}return(0,l.d)(W,[{key:"bind",value:function(W){for(var i=this,L=arguments.length,h=new Array(L>1?L-1:0),l=1;l<L;l++)h[l-1]=arguments[l];h.forEach((function(L){var h=i._keyBindmap[L]||[];h.includes(W)||(h.push(W),i._keyBindmap[L]=h)})),this.state[W]=!!this.state[W],this.pressCount[W]=this.pressCount[W]||0,this.releaseCount[W]=this.releaseCount[W]||0}},{key:"unbind",value:function(W){for(var i in this._keyBindmap){var L=this._keyBindmap[i],h=L.indexOf(W);h>-1&&L.splice(h,1)}}},{key:"getBindings",value:function(){var W={};for(var i in this._keyBindmap){this._keyBindmap[i].forEach((function(L){W[L]=W[L]||[],W[L].push(i)}))}return W}},{key:"tick",value:function(){R(this.pointerState),R(this.pressCount),R(this.releaseCount)}}]),W}();function R(W){for(var i in W)W[i]=0}function z(W){window.addEventListener("keydown",S.bind(null,W,!0),!1),window.addEventListener("keyup",S.bind(null,W,!1),!1);var i={passive:!0};W.element.addEventListener("touchstart",s.bind(void 0,W),{passive:!1}),W.element.addEventListener("touchend",D.bind(void 0,W),i),W.element.addEventListener("mousedown",C.bind(null,W,!0),i),window.document.addEventListener("mouseup",C.bind(null,W,!1),i),W.element.addEventListener("touchmove",e.bind(null,W),i),W.element.addEventListener("mousemove",e.bind(null,W),i),window.PointerEvent,W.element.addEventListener("wheel",V.bind(null,W),i),W.element.addEventListener("contextmenu",c.bind(null,W),!1),window.addEventListener("blur",f.bind(null,W),!1)}var r=0,N=0,I=null;function s(W,i){i.preventDefault(),o(i)}function o(W){for(var i=!1,L=0;L<W.touches.length;++L)if(W.touches[L].identifier===I){i=!0;break}if(!i){var h=W.changedTouches[0];r=h.clientX,N=h.clientY,I=h.identifier}}function D(W,i){for(var L=i.changedTouches,h=0;h<L.length;++h)L[h].identifier===I&&(I=null)}function S(W,i,L){a(L.code,i,W,L)}function C(W,i,L){if("pointerId"in L)if(i){if(null!==W._touches.currID)return;W._touches.currID=L.pointerId}else{if(W._touches.currID!==L.pointerId)return;W._touches.currID=null}return a("Mouse"+("button"in L?L.button+1:1),i,W,L),!1}function e(W,i){var L=i.movementX||i.mozMovementX||0,h=i.movementY||i.mozMovementY||0;if(i.touches&&0===(L|h)){var l=function(W){o(W);for(var i=0;i<W.changedTouches.length;++i)if(W.changedTouches[i].identifier==I){var L=W.changedTouches[i],h=[L.clientX-r,L.clientY-N];return r=L.clientX,N=L.clientY,h}return console.error("Did not find touch id ".concat(I)),[0,0]}(i);L=l[0],h=l[1]}W.pointerState.dx+=L,W.pointerState.dy+=h}function V(W,i){var L=1;switch(i.deltaMode){case 0:L=1;break;case 1:L=12;break;case 2:L=W.element.clientHeight||window.innerHeight}W.pointerState.scrollx+=(i.deltaX||0)*L,W.pointerState.scrolly+=(i.deltaY||0)*L,W.pointerState.scrollz+=(i.deltaZ||0)*L}function c(W,i){if(!W.allowContextMenu)return i.preventDefault(),!1}function f(W){for(var i in W._keyStates)W._keyStates[i]&&(/^Mouse\d/.test(i)||a(i,!1,W,{code:i,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:function(){},stopPropagation:function(){}}))}function a(W,i,L,h){var l=L._keyBindmap[W];l&&(P(L._keyStates[W],i)&&(L._keyStates[W]=i,l.forEach((function(W){(!L.filterEvents||L.filterEvents(h,W))&&function(W,i,L,h){var l=i?L.pressCount:L.releaseCount;l[W]=(l[W]||0)+1;var t=L._bindPressCount[W]||0;(t+=i?1:-1)<0&&(t=0);if(L._bindPressCount[W]=t,P(L.state[W],t)){L.state[W]=t>0;var p=i?L.down:L.up;L.disabled||p.emit(W,h)}}(W,i,L,h)}))),"button"in h||(L.preventDefaults&&!h.defaultPrevented&&h.preventDefault(),L.stopPropagation&&h.stopPropagation()))}function P(W,i){return W?!i:i}},43128:function(W){W.exports=function(W,i,L){return W[0]=i[0]+L[0],W[1]=i[1]+L[1],W[2]=i[2]+L[2],W}},65122:function(W,i,L){W.exports=function(W,i){var L=h(W[0],W[1],W[2]),p=h(i[0],i[1],i[2]);l(L,L),l(p,p);var x=t(L,p);return x>1?0:Math.acos(x)};var h=L(9990),l=L(21363),t=L(37570)},78739:function(W){W.exports=function(W,i){return W[0]=Math.ceil(i[0]),W[1]=Math.ceil(i[1]),W[2]=Math.ceil(i[2]),W}},24232:function(W){W.exports=function(W){var i=new Float32Array(3);return i[0]=W[0],i[1]=W[1],i[2]=W[2],i}},11940:function(W){W.exports=function(W,i){return W[0]=i[0],W[1]=i[1],W[2]=i[2],W}},26313:function(W){W.exports=function(){var W=new Float32Array(3);return W[0]=0,W[1]=0,W[2]=0,W}},39747:function(W){W.exports=function(W,i,L){var h=i[0],l=i[1],t=i[2],p=L[0],x=L[1],R=L[2];return W[0]=l*R-t*x,W[1]=t*p-h*R,W[2]=h*x-l*p,W}},46223:function(W,i,L){W.exports=L(92e3)},92e3:function(W){W.exports=function(W,i){var L=i[0]-W[0],h=i[1]-W[1],l=i[2]-W[2];return Math.sqrt(L*L+h*h+l*l)}},24553:function(W,i,L){W.exports=L(24889)},24889:function(W){W.exports=function(W,i,L){return W[0]=i[0]/L[0],W[1]=i[1]/L[1],W[2]=i[2]/L[2],W}},37570:function(W){W.exports=function(W,i){return W[0]*i[0]+W[1]*i[1]+W[2]*i[2]}},78294:function(W){W.exports=1e-6},46485:function(W,i,L){W.exports=function(W,i){var L=W[0],l=W[1],t=W[2],p=i[0],x=i[1],R=i[2];return Math.abs(L-p)<=h*Math.max(1,Math.abs(L),Math.abs(p))&&Math.abs(l-x)<=h*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(t-R)<=h*Math.max(1,Math.abs(t),Math.abs(R))};var h=L(78294)},95388:function(W){W.exports=function(W,i){return W[0]===i[0]&&W[1]===i[1]&&W[2]===i[2]}},37598:function(W){W.exports=function(W,i){return W[0]=Math.floor(i[0]),W[1]=Math.floor(i[1]),W[2]=Math.floor(i[2]),W}},45880:function(W,i,L){W.exports=function(W,i,L,l,t,p){var x,R;i||(i=3);L||(L=0);R=l?Math.min(l*i+L,W.length):W.length;for(x=L;x<R;x+=i)h[0]=W[x],h[1]=W[x+1],h[2]=W[x+2],t(h,h,p),W[x]=h[0],W[x+1]=h[1],W[x+2]=h[2];return W};var h=L(26313)()},9990:function(W){W.exports=function(W,i,L){var h=new Float32Array(3);return h[0]=W,h[1]=i,h[2]=L,h}},59344:function(W,i,L){W.exports={EPSILON:L(78294),create:L(26313),clone:L(24232),angle:L(65122),fromValues:L(9990),copy:L(11940),set:L(47329),equals:L(46485),exactEquals:L(95388),add:L(43128),subtract:L(90143),sub:L(88314),multiply:L(88572),mul:L(18104),divide:L(24889),div:L(24553),min:L(62544),max:L(82453),floor:L(37598),ceil:L(78739),round:L(12742),scale:L(1442),scaleAndAdd:L(78268),distance:L(92e3),dist:L(46223),squaredDistance:L(94584),sqrDist:L(84140),length:L(45978),len:L(6763),squaredLength:L(82258),sqrLen:L(79926),negate:L(232),inverse:L(54933),normalize:L(21363),dot:L(37570),cross:L(39747),lerp:L(243),random:L(27926),transformMat4:L(95101),transformMat3:L(9512),transformQuat:L(70552),rotateX:L(8400),rotateY:L(75140),rotateZ:L(72444),forEach:L(45880)}},54933:function(W){W.exports=function(W,i){return W[0]=1/i[0],W[1]=1/i[1],W[2]=1/i[2],W}},6763:function(W,i,L){W.exports=L(45978)},45978:function(W){W.exports=function(W){var i=W[0],L=W[1],h=W[2];return Math.sqrt(i*i+L*L+h*h)}},243:function(W){W.exports=function(W,i,L,h){var l=i[0],t=i[1],p=i[2];return W[0]=l+h*(L[0]-l),W[1]=t+h*(L[1]-t),W[2]=p+h*(L[2]-p),W}},82453:function(W){W.exports=function(W,i,L){return W[0]=Math.max(i[0],L[0]),W[1]=Math.max(i[1],L[1]),W[2]=Math.max(i[2],L[2]),W}},62544:function(W){W.exports=function(W,i,L){return W[0]=Math.min(i[0],L[0]),W[1]=Math.min(i[1],L[1]),W[2]=Math.min(i[2],L[2]),W}},18104:function(W,i,L){W.exports=L(88572)},88572:function(W){W.exports=function(W,i,L){return W[0]=i[0]*L[0],W[1]=i[1]*L[1],W[2]=i[2]*L[2],W}},232:function(W){W.exports=function(W,i){return W[0]=-i[0],W[1]=-i[1],W[2]=-i[2],W}},21363:function(W){W.exports=function(W,i){var L=i[0],h=i[1],l=i[2],t=L*L+h*h+l*l;t>0&&(t=1/Math.sqrt(t),W[0]=i[0]*t,W[1]=i[1]*t,W[2]=i[2]*t);return W}},27926:function(W){W.exports=function(W,i){i=i||1;var L=2*Math.random()*Math.PI,h=2*Math.random()-1,l=Math.sqrt(1-h*h)*i;return W[0]=Math.cos(L)*l,W[1]=Math.sin(L)*l,W[2]=h*i,W}},8400:function(W){W.exports=function(W,i,L,h){var l=L[1],t=L[2],p=i[1]-l,x=i[2]-t,R=Math.sin(h),z=Math.cos(h);return W[0]=i[0],W[1]=l+p*z-x*R,W[2]=t+p*R+x*z,W}},75140:function(W){W.exports=function(W,i,L,h){var l=L[0],t=L[2],p=i[0]-l,x=i[2]-t,R=Math.sin(h),z=Math.cos(h);return W[0]=l+x*R+p*z,W[1]=i[1],W[2]=t+x*z-p*R,W}},72444:function(W){W.exports=function(W,i,L,h){var l=L[0],t=L[1],p=i[0]-l,x=i[1]-t,R=Math.sin(h),z=Math.cos(h);return W[0]=l+p*z-x*R,W[1]=t+p*R+x*z,W[2]=i[2],W}},12742:function(W){W.exports=function(W,i){return W[0]=Math.round(i[0]),W[1]=Math.round(i[1]),W[2]=Math.round(i[2]),W}},1442:function(W){W.exports=function(W,i,L){return W[0]=i[0]*L,W[1]=i[1]*L,W[2]=i[2]*L,W}},78268:function(W){W.exports=function(W,i,L,h){return W[0]=i[0]+L[0]*h,W[1]=i[1]+L[1]*h,W[2]=i[2]+L[2]*h,W}},47329:function(W){W.exports=function(W,i,L,h){return W[0]=i,W[1]=L,W[2]=h,W}},84140:function(W,i,L){W.exports=L(94584)},79926:function(W,i,L){W.exports=L(82258)},94584:function(W){W.exports=function(W,i){var L=i[0]-W[0],h=i[1]-W[1],l=i[2]-W[2];return L*L+h*h+l*l}},82258:function(W){W.exports=function(W){var i=W[0],L=W[1],h=W[2];return i*i+L*L+h*h}},88314:function(W,i,L){W.exports=L(90143)},90143:function(W){W.exports=function(W,i,L){return W[0]=i[0]-L[0],W[1]=i[1]-L[1],W[2]=i[2]-L[2],W}},9512:function(W){W.exports=function(W,i,L){var h=i[0],l=i[1],t=i[2];return W[0]=h*L[0]+l*L[3]+t*L[6],W[1]=h*L[1]+l*L[4]+t*L[7],W[2]=h*L[2]+l*L[5]+t*L[8],W}},95101:function(W){W.exports=function(W,i,L){var h=i[0],l=i[1],t=i[2],p=L[3]*h+L[7]*l+L[11]*t+L[15];return p=p||1,W[0]=(L[0]*h+L[4]*l+L[8]*t+L[12])/p,W[1]=(L[1]*h+L[5]*l+L[9]*t+L[13])/p,W[2]=(L[2]*h+L[6]*l+L[10]*t+L[14])/p,W}},70552:function(W){W.exports=function(W,i,L){var h=i[0],l=i[1],t=i[2],p=L[0],x=L[1],R=L[2],z=L[3],r=z*h+x*t-R*l,N=z*l+R*h-p*t,I=z*t+p*l-x*h,s=-p*h-x*l-R*t;return W[0]=r*z+s*-p+N*-R-I*-x,W[1]=N*z+s*-x+I*-p-r*-R,W[2]=I*z+s*-R+r*-x-N*-p,W}},41844:function(W){"use strict";W.exports=function(W){for(var i=new Array(W),L=0;L<W;++L)i[L]=L;return i}},9603:function(W){W.exports=function(W){return null!=W&&null!=W.constructor&&"function"===typeof W.constructor.isBuffer&&W.constructor.isBuffer(W)}},22110:function(W,i,L){"use strict";L.d(i,{e:function(){return t}});var h=L(43144),l=L(15671),t=(0,h.d)((function W(i){var L=this,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,l.c)(this,W),this.stickyPointerLock=!1,this.stickyFullscreen=!1,this.tickRate=30,this.maxRenderRate=0,this.pointerLock=!1,this.fullscreen=!1,this.onTick=function(W){},this.onRender=function(){},this.onInit=function(){},this.onResize=function(){},this.onPointerLockChanged=function(W){},this.onFullscreenChanged=function(W){},N((function(){p(L,h),z(L,i),L.onInit()}))}));function p(W,i){W._nowObject=performance||Date,W._lastTick=0,W._renderAccum=0,W._rt=0,W._frameCB=R.bind(null,W),requestAnimationFrame(W._frameCB),i>0&&(W._intervalCB=x.bind(null,W),W._interval=setInterval(W._intervalCB,Math.max(i,1e3/W.tickRate/2)))}function x(W){for(var i=1e3/W.tickRate,L=W._nowObject.now()+20,h=0;W._nowObject.now()>=W._lastTick+i&&W._nowObject.now()<L&&++h<=3;)W.onTick(i),W._lastTick+=i;var l=5*(i+5),t=W._nowObject.now();if(t-W._lastTick>l)for(;t>=W._lastTick+i;)W._lastTick+=i}function R(W){requestAnimationFrame(W._frameCB),x(W);var i=W._nowObject.now(),L=i-W._rt;if(W._rt=i,W.maxRenderRate>0){W._renderAccum+=L;var h=1e3/W.maxRenderRate;if(W._renderAccum<h)return;W._renderAccum=Math.min(W._renderAccum-h,h)}var l=1e3/W.tickRate,t=(i-W._lastTick)/l;W.onRender(L,t,l)}function z(W,i){if(i){var L=!1,h=!1;document.addEventListener("pointerlockchange",(function(h){L=document.pointerLockElement===i,W.onPointerLockChanged(L)})),document.addEventListener("fullscreenchange",(function(L){h=document.fullscreenElement===i,W.onFullscreenChanged(h)})),Object.defineProperty(W,"pointerLock",{get:function(){return L},set:function(W){W&&!L?r(i):L&&!W&&function(W){W.exitPointerLock&&W.exitPointerLock()}(document)}}),Object.defineProperty(W,"fullscreen",{get:function(){return h},set:function(W){W&&!h?i.requestFullscreen():h&&!W&&document.exitFullscreen()}}),i.addEventListener("click",(function(l){W.stickyPointerLock&&!L&&r(i),W.stickyFullscreen&&!h&&i.requestFullscreen()}));var l=function(){return W.onResize()};if(window.ResizeObserver)new ResizeObserver(l).observe(i);else window.addEventListener("resize",l)}}function r(W){W.requestPointerLock&&W.requestPointerLock()}var N=function(W){if("loading"===document.readyState){document.addEventListener("readystatechange",(function i(){document.removeEventListener("readystatechange",i),W()}))}else setTimeout(W,1)}},38794:function(W,i,L){var h=L(41844),l=L(8669),t="undefined"!==typeof Float64Array;function p(W,i){return W[0]-i[0]}function x(){var W,i=this.stride,L=new Array(i.length);for(W=0;W<L.length;++W)L[W]=[Math.abs(i[W]),W];L.sort(p);var h=new Array(L.length);for(W=0;W<h.length;++W)h[W]=L[W][1];return h}function R(W,i){var L=["View",i,"d",W].join("");i<0&&(L="View_Nil"+W);var l="generic"===W;if(-1===i){var t="function "+L+"(a){this.data=a;};var proto="+L+".prototype;proto.dtype='"+W+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+L+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+L+"(a){return new "+L+"(a);}";return new Function(t)()}if(0===i){t="function "+L+"(a,d) {this.data = a;this.offset = d};var proto="+L+".prototype;proto.dtype='"+W+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+L+"_copy() {return new "+L+"(this.data,this.offset)};proto.pick=function "+L+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+L+"_get(){return "+(l?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+L+"_set(v){return "+(l?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+L+"(a,b,c,d){return new "+L+"(a,d)}";return new Function("TrivialArray",t)(z[W][0])}t=["'use strict'"];var p=h(i),R=p.map((function(W){return"i"+W})),r="this.offset+"+p.map((function(W){return"this.stride["+W+"]*i"+W})).join("+"),N=p.map((function(W){return"b"+W})).join(","),I=p.map((function(W){return"c"+W})).join(",");t.push("function "+L+"(a,"+N+","+I+",d){this.data=a","this.shape=["+N+"]","this.stride=["+I+"]","this.offset=d|0}","var proto="+L+".prototype","proto.dtype='"+W+"'","proto.dimension="+i),t.push("Object.defineProperty(proto,'size',{get:function "+L+"_size(){return "+p.map((function(W){return"this.shape["+W+"]"})).join("*"),"}})"),1===i?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),i<4?(t.push("function "+L+"_order(){"),2===i?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===i&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+L+"_set("+R.join(",")+",v){"),l?t.push("return this.data.set("+r+",v)}"):t.push("return this.data["+r+"]=v}"),t.push("proto.get=function "+L+"_get("+R.join(",")+"){"),l?t.push("return this.data.get("+r+")}"):t.push("return this.data["+r+"]}"),t.push("proto.index=function "+L+"_index(",R.join(),"){return "+r+"}"),t.push("proto.hi=function "+L+"_hi("+R.join(",")+"){return new "+L+"(this.data,"+p.map((function(W){return["(typeof i",W,"!=='number'||i",W,"<0)?this.shape[",W,"]:i",W,"|0"].join("")})).join(",")+","+p.map((function(W){return"this.stride["+W+"]"})).join(",")+",this.offset)}");var s=p.map((function(W){return"a"+W+"=this.shape["+W+"]"})),o=p.map((function(W){return"c"+W+"=this.stride["+W+"]"}));t.push("proto.lo=function "+L+"_lo("+R.join(",")+"){var b=this.offset,d=0,"+s.join(",")+","+o.join(","));for(var D=0;D<i;++D)t.push("if(typeof i"+D+"==='number'&&i"+D+">=0){d=i"+D+"|0;b+=c"+D+"*d;a"+D+"-=d}");t.push("return new "+L+"(this.data,"+p.map((function(W){return"a"+W})).join(",")+","+p.map((function(W){return"c"+W})).join(",")+",b)}"),t.push("proto.step=function "+L+"_step("+R.join(",")+"){var "+p.map((function(W){return"a"+W+"=this.shape["+W+"]"})).join(",")+","+p.map((function(W){return"b"+W+"=this.stride["+W+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(D=0;D<i;++D)t.push("if(typeof i"+D+"==='number'){d=i"+D+"|0;if(d<0){c+=b"+D+"*(a"+D+"-1);a"+D+"=ceil(-a"+D+"/d)}else{a"+D+"=ceil(a"+D+"/d)}b"+D+"*=d}");t.push("return new "+L+"(this.data,"+p.map((function(W){return"a"+W})).join(",")+","+p.map((function(W){return"b"+W})).join(",")+",c)}");var S=new Array(i),C=new Array(i);for(D=0;D<i;++D)S[D]="a[i"+D+"]",C[D]="b[i"+D+"]";t.push("proto.transpose=function "+L+"_transpose("+R+"){"+R.map((function(W,i){return W+"=("+W+"===undefined?"+i+":"+W+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+L+"(this.data,"+S.join(",")+","+C.join(",")+",this.offset)}"),t.push("proto.pick=function "+L+"_pick("+R+"){var a=[],b=[],c=this.offset");for(D=0;D<i;++D)t.push("if(typeof i"+D+"==='number'&&i"+D+">=0){c=(c+this.stride["+D+"]*i"+D+")|0}else{a.push(this.shape["+D+"]);b.push(this.stride["+D+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+L+"(data,shape,stride,offset){return new "+L+"(data,"+p.map((function(W){return"shape["+W+"]"})).join(",")+","+p.map((function(W){return"stride["+W+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(z[W],x)}var z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};W.exports=function(W,i,L,h){if(void 0===W)return(0,z.array[0])([]);"number"===typeof W&&(W=[W]),void 0===i&&(i=[W.length]);var p=i.length;if(void 0===L){L=new Array(p);for(var x=p-1,r=1;x>=0;--x)L[x]=r,r*=i[x]}if(void 0===h){h=0;for(x=0;x<p;++x)L[x]<0&&(h-=(i[x]-1)*L[x])}for(var N=function(W){if(l(W))return"buffer";if(t)switch(Object.prototype.toString.call(W)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(W)?"array":"generic"}(W),I=z[N];I.length<=p+1;)I.push(R(N,I.length-1));return(0,I[p+1])(W,i,L,h)}},8669:function(W){function i(W){return!!W.constructor&&"function"===typeof W.constructor.isBuffer&&W.constructor.isBuffer(W)}W.exports=function(W){return null!=W&&(i(W)||function(W){return"function"===typeof W.readFloatLE&&"function"===typeof W.slice&&i(W.slice(0,0))}(W)||!!W._isBuffer)}},12773:function(W){"use strict";var i=[],L=[],h=[],l=[],t=[],p=[],x=[],R=[],z=[],r=[],N=[],I=[];W.exports=function(W,s,o,D,S,C){for(var e=x,V=z,c=r,f=I,a=0;a<3;a++)e[a]=+o[a],c[a]=+s.max[a],V[a]=+s.base[a];C||(C=1e-10);var P=function(W,x,z,r,I,s){var o=i,D=L,S=h,C=l,e=t,V=p,c=R,f=Math.floor,a=0,P=0,y=0,M=0,b=0;if(j(),0===y)return 0;for(M=T();P<=y;){if(Z(M)&&X())return a;M=T()}for(a+=y,b=0;b<3;b++)r[b]+=z[b],I[b]+=z[b];return a;function j(){if(P=0,0!==(y=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2])))for(var W=0;W<3;W++){var i=z[W]>=0;C[W]=i?1:-1;var L=i?I[W]:r[W];o[W]=i?r[W]:I[W],D[W]=F(L,C[W]),S[W]=q(o[W],C[W]),c[W]=z[W]/y,e[W]=Math.abs(1/c[W]);var h=i?D[W]+1-L:L-D[W];V[W]=e[W]<1/0?e[W]*h:1/0}}function Z(i){for(var L=C[0],h=0===i?D[0]:S[0],l=D[0]+L,t=C[1],p=1===i?D[1]:S[1],x=D[1]+t,R=C[2],z=2===i?D[2]:S[2],r=D[2]+R,N=h;N!=l;N+=L)for(var I=p;I!=x;I+=t)for(var s=z;s!=r;s+=R)if(W(N,I,s))return!0;return!1}function X(){a+=P;var W=C[M],i=P/y,L=N;for(b=0;b<3;b++){var h=z[b]*i;r[b]+=h,I[b]+=h,L[b]=z[b]-h}if(W>0?I[M]=Math.round(I[M]):r[M]=Math.round(r[M]),x(a,M,W,L))return!0;for(b=0;b<3;b++)z[b]=L[b];return j(),0===y}function T(){var W=V[0]<V[1]?V[0]<V[2]?0:2:V[1]<V[2]?1:2,i=V[W]-P;for(P=V[W],D[W]+=C[W],V[W]+=e[W],b=0;b<3;b++)o[b]+=i*c[b],S[b]=q(o[b],C[b]);return W}function F(W,i){return f(W-i*s)}function q(W,i){return f(W+i*s)}}(W,D,e,V,c,C);if(!S){for(a=0;a<3;a++)f[a]=o[a]>0?c[a]-s.max[a]:V[a]-s.base[a];s.translate(f)}return P}},82743:function(W,i,L){"use strict";L.d(i,{d:function(){return s}});var h=L(15671),l=L(43144),t=L(97887),p=L(59344),x=function(){function W(i,L,l,x,R,z,r){(0,h.c)(this,W),this.aabb=new t(i.base,i.vec),this.mass=L,this.friction=l,this.restitution=x,this.gravityMultiplier=R,this.onCollide=z,this.autoStep=!!r,this.airDrag=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.onStep=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.velocity=p.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=p.create(),this._impulses=p.create(),this._sleepFrameCount=10}return(0,l.d)(W,[{key:"loadFromCopy",value:function(W){p.copy(this.aabb.base,W.aabb.base),p.copy(this.aabb.vec,W.aabb.vec),p.copy(this.aabb.max,W.aabb.max),this.aabb.mag=W.aabb.mag,this.mass=W.mass,this.friction=W.friction,this.restitution=W.restitution,this.gravityMultiplier=W.gravityMultiplier,this.onCollide=W.onCollide,this.autoStep=W.autoStep,this.airDrag=W.airDrag,this.fluidDrag=W.fluidDrag,this.onStep=W.onStep,this.preventFallOffEdge=W.preventFallOffEdge,this.rolledBackLastTick=W.rolledBackLastTick,p.copy(this.velocity,W.velocity),p.copy(this.resting,W.resting),this.inFluid=W.inFluid,this._ratioInFluid=W._ratioInFluid,p.copy(this._forces,W._forces),p.copy(this._impulses,W._impulses),this._sleepFrameCount=W._sleepFrameCount}},{key:"setPosition",value:function(W){R(W),p.subtract(W,W,this.aabb.base),this.aabb.translate(W),this._markActive()}},{key:"getPosition",value:function(){return p.clone(this.aabb.base)}},{key:"applyForce",value:function(W){R(W),p.add(this._forces,this._forces,W),this._markActive()}},{key:"applyImpulse",value:function(W){R(W),p.add(this._impulses,this._impulses,W),this._markActive()}},{key:"_markActive",value:function(){this._sleepFrameCount=10}},{key:"atRestX",value:function(){return this.resting[0]}},{key:"atRestY",value:function(){return this.resting[1]}},{key:"atRestZ",value:function(){return this.resting[2]}}]),W}(),R=function(W){};var z=L(97887),r=L(59344),N=L(12773);function I(){this.airDrag=.1,this.fluidDrag=.4,this.fluidDensity=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function s(W,i,L){W=Object.assign(new I,W),this.gravity=W.gravity||[0,-10,0],this.airDrag=W.airDrag||.1,this.fluidDensity=W.fluidDensity||2,this.fluidDrag=W.fluidDrag||.4,this.minBounceImpulse=W.minBounceImpulse,this.bodies=[],this.isBodyInsideUnloadedBlock=W.isBodyInsideUnloadedBlock,this.testSolid=i,this.testFluid=L}s.prototype.addBody=function(W,i,L,h,l,t){W=W||new z([0,0,0],[1,1,1]),"undefined"==typeof i&&(i=1),"undefined"==typeof L&&(L=1),"undefined"==typeof h&&(h=0),"undefined"==typeof l&&(l=1);var p=new x(W,i,L,h,l,t);return this.bodies.push(p),p},s.prototype.removeBody=function(W){var i=this.bodies.indexOf(W);i<0||(this.bodies.splice(i,1),W.aabb=W.onCollide=null)};var o=r.create(),D=r.create(),S=r.create(),C=r.create(),e=r.create(),V=r.create(),c=r.create(),f=new z([0,0,0],[1,1,1]),a=new x(f,1,1,0,1,(function(){}),!1);function P(W,i,L){return i=L,i*=1-Math.pow(1-W.ratioInFluid,2)}s.prototype.tick=function(W){var i=this;W/=1e3;var L=g(0,r.squaredLength(this.gravity));this.bodies.forEach((function(h){return function(W,i,L,h){r.copy(e,i.resting),W.isBodyInsideUnloadedBlock&&a.loadFromCopy(i);if(i.mass<=0)return r.set(i.velocity,0,0,0),r.set(i._forces,0,0,0),void r.set(i._impulses,0,0,0);var l=h||0===i.gravityMultiplier;if(function(W,i,L,h){if(i._sleepFrameCount>0)return!1;if(h)return!0;var l=!1,t=.5*L*L*i.gravityMultiplier;return r.scale(w,W.gravity,t),N(W.testSolid,i.aabb,w,(function(){return l=!0,!0}),!0),l}(W,i,L,l))return;i._sleepFrameCount--,function(W,i){var L=i.aabb,h=Math.floor(L.base[0]),l=Math.floor(L.base[2]),t=Math.floor(L.base[1]),p=Math.floor(L.max[1]);if(!W.testFluid(h,t,l))return i.inFluid=!1,void(i.ratioInFluid=0);var x=1,R=t+1;for(;R<=p&&W.testFluid(h,R,l);)x++,R++;var z=(t+x-L.base[1])/L.vec[1];z>1&&(z=1);var N=L.vec[0]*L.vec[1]*L.vec[2]*z,I=M;r.scale(I,W.gravity,-W.fluidDensity*N*i.gravityMultiplier),i.applyForce(I),i.inFluid=!0,i.ratioInFluid=z}(W,i),m(i._forces),m(i._impulses),m(i.velocity),m(i.resting),r.scale(o,i._forces,1/i.mass),r.scaleAndAdd(o,o,W.gravity,i.gravityMultiplier),r.scale(D,i._impulses,1/i.mass),r.scaleAndAdd(D,D,o,L),r.add(i.velocity,i.velocity,D),i.friction&&(b(W,0,i,D,L),b(W,1,i,D,L),b(W,2,i,D,L));var t=i.fluidDrag>=0?i.fluidDrag:W.fluidDrag,p=i.airDrag>=0?i.airDrag:W.airDrag,x=p,R=p;i.inFluid&&(x=P(i,x,i.fluidDragHoriz>=0?i.fluidDragHoriz:t),R=P(i,R,i.fluidDragVert>=0?i.fluidDragVert:t));x=Math.max(1-x*L/i.mass,0),R=Math.max(1-R*L/i.mass,0),r.set(y,x,R,x),r.multiply(i.velocity,i.velocity,y),r.scale(S,i.velocity,L),r.set(i._forces,0,0,0),r.set(i._impulses,0,0,0),i.autoStep&&n(X,i.aabb);r.copy(V,S),r.set(c,0,0,0),i.preventFallOffEdge&&function(W,i,L,h){if(!i.resting[1]||L[1]>0)return;var l=U;n(l,i.aabb);for(var t=0;t<3;t+=2){r.set(k,0,0,0),k[t]=L[t];var p=!0;(p=(p=(p=(p=p&&!B(W,l.base[0]+k[0]+1e-5,l.base[1],l.base[2]+k[2]+1e-5))&&!B(W,l.max[0]+k[0]-1e-5,l.base[1],l.base[2]+k[2]+1e-5))&&!B(W,l.base[0]+k[0]+1e-5,l.base[1],l.max[2]+k[2]-1e-5))&&!B(W,l.max[0]+k[0]-1e-5,l.base[1],l.max[2]+k[2]-1e-5))?(h[t]=L[t]>0?1:-1,L[t]=0):0===t&&(r.set(d,L[0],0,0),Z(W,l,d,h,i.slideOnCollision))}}(W,i,S,c);Z(W,i.aabb,S,i.resting,i.slideOnCollision),i.autoStep&&function(W,i,L,h){if(i.resting[1]>=0&&!i.inFluid)return;var l=0!==i.resting[0],t=0!==i.resting[2];if(!l&&!t)return;var p=Math.abs(h[0]/h[2]),x=4;if(!l&&p>x)return;if(!t&&p<1/x)return;r.add(F,L.base,h);var R=W.testSolid;N(R,L,h,(function(W,i,L,h){if(1!==i)return!0;h[i]=0}));var z=L.base[1],I=Math.floor(z+1.001)-z;r.set(q,0,I,0);var s=!1;if(N(R,L,q,(function(W,i,L,h){return s=!0,!0})),s)return;r.subtract(H,F,L.base),H[1]=0,Z(W,L,H,T,!0);var o=g(L.base[0],F[0]),D=g(L.base[2],F[2]);if(l&&!o&&(!D||!t))return;if(t&&(!o||!l)&&!D)return;var S=!0;if(S=(S=(S=(S=S&&!B(W,L.base[0]+1e-5,L.base[1],L.base[2]+1e-5))&&!B(W,L.max[0]-1e-5,L.base[1],L.base[2]+1e-5))&&!B(W,L.base[0]+1e-5,L.base[1],L.max[2]-1e-5))&&!B(W,L.max[0]-1e-5,L.base[1],L.max[2]-1e-5))return;n(i.aabb,L),i.resting[0]=T[0],i.resting[2]=T[2],i.onStep&&i.onStep()}(W,i,X,V);for(var z=0;z<3;++z)i.resting[z]=i.resting[z]||c[z],C[z]=0,i.resting[z]&&(e[z]||(C[z]=-i.velocity[z]),i.velocity[z]=0);var I=r.length(C);I>.001&&(r.scale(C,C,i.mass),i.onCollide&&i.onCollide(C),i.restitution>0&&I>W.minBounceImpulse&&(r.scale(C,C,i.restitution),i.applyImpulse(C)));r.squaredLength(i.velocity)>1e-5&&i._markActive();W.isBodyInsideUnloadedBlock&&W.isBodyInsideUnloadedBlock(i)?(i.loadFromCopy(a),i.rolledBackLastTick=!0):i.rolledBackLastTick=!1}(i,h,W,L)}))};var y=r.create([0,0,0]);var M=r.create();function b(W,i,L,h,l){var t=L.resting[i],p=h[i];if(!L.alwaysApplyHorizFriction||1!==i){if(0===t)return;if(t*p<=0)return}r.copy(j,L.velocity),j[i]=0;var x=r.length(j);if(!g(x,0)){var R=Math.abs(L.friction*W.gravity[i]*l),z=x>R?(x-R)/x:0;L.velocity[(i+1)%3]*=z,L.velocity[(i+2)%3]*=z}}var j=r.create();function Z(W,i,L,h,l){return r.set(h,0,0,0),N(W.testSolid,i,L,(function(W,i,L,t){h[i]=L,t[i]=0,l||(t[0]=0,t[1]=0,t[2]=0)}))}var X=new z([],[]),T=r.create(),F=r.create(),q=r.create(),H=r.create();var k=r.create(),U=new z([],[]),d=r.create();function B(W,i,L,h){return W.testSolid(Math.floor(i),Math.floor(L-1),Math.floor(h))}var w=r.create();function g(W,i){return Math.abs(W-i)<1e-5}function n(W,i){for(var L=0;L<3;L++)W.base[L]=i.base[L],W.max[L]=i.max[L],W.vec[L]=i.vec[L]}var m=function(W){}},50061:function(W,i){!function(W){"use strict";var i=function(W,L){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,i){W.__proto__=i}||function(W,i){for(var L in i)Object.prototype.hasOwnProperty.call(i,L)&&(W[L]=i[L])},i(W,L)};function L(W,L){if("function"!==typeof L&&null!==L)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function h(){this.constructor=W}i(W,L),W.prototype=null===L?Object.create(L):(h.prototype=L.prototype,new h)}function h(W,i,L,h){var l,t=arguments.length,p=t<3?i:null===h?h=Object.getOwnPropertyDescriptor(i,L):h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(W,i,L,h);else for(var x=W.length-1;x>=0;x--)(l=W[x])&&(p=(t<3?l(p):t>3?l(i,L,p):l(i,L))||p);return t>3&&p&&Object.defineProperty(i,L,p),p}function l(W,i,L){if(L||2===arguments.length)for(var h,l=0,t=i.length;l<t;l++)!h&&l in i||(h||(h=Array.prototype.slice.call(i,0,l)),h[l]=i[l]);return W.concat(h||Array.prototype.slice.call(i))}var t,p=255,x=213;W.OPERATION=void 0,(t=W.OPERATION||(W.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var R=function(){function i(W,i,L){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=W,this.setParent(i,L)}return i.prototype.setParent=function(W,i,L){var h=this;if(this.indexes||(this.indexes=this.ref instanceof FW?this.ref._definition.indexes:{}),this.parent=W,this.parentIndex=L,i)if(this.root=i,this.ref instanceof FW){var l=this.ref._definition;for(var t in l.schema){var p=this.ref[t];if(p&&p.$changes){var x=l.indexes[t];p.$changes.setParent(this.ref,i,x)}}}else"object"===typeof this.ref&&this.ref.forEach((function(W,i){if(W instanceof FW){var L=W.$changes,l=h.ref.$changes.indexes[i];L.setParent(h.ref,h.root,l)}}))},i.prototype.operation=function(W){this.changes.set(--this.currentCustomOperation,W)},i.prototype.change=function(i,L){void 0===L&&(L=W.OPERATION.ADD);var h="number"===typeof i?i:this.indexes[i];this.assertValidIndex(h,i);var l=this.changes.get(h);l&&l.op!==W.OPERATION.DELETE&&l.op!==W.OPERATION.TOUCH||this.changes.set(h,{op:l&&l.op===W.OPERATION.DELETE?W.OPERATION.DELETE_AND_ADD:L,index:h}),this.allChanges.add(h),this.changed=!0,this.touchParents()},i.prototype.touch=function(i){var L="number"===typeof i?i:this.indexes[i];this.assertValidIndex(L,i),this.changes.has(L)||this.changes.set(L,{op:W.OPERATION.TOUCH,index:L}),this.allChanges.add(L),this.touchParents()},i.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},i.prototype.getType=function(W){if(this.ref._definition)return(i=this.ref._definition).schema[i.fieldsByIndex[W]];var i,L=(i=this.parent._definition).schema[i.fieldsByIndex[this.parentIndex]];return Object.values(L)[0]},i.prototype.getChildrenFilter=function(){var W=this.parent._definition.childFilters;return W&&W[this.parentIndex]},i.prototype.getValue=function(W){return this.ref.getByIndex(W)},i.prototype.delete=function(i){var L="number"===typeof i?i:this.indexes[i];if(void 0!==L){var h=this.getValue(L);this.changes.set(L,{op:W.OPERATION.DELETE,index:L}),this.allChanges.delete(L),delete this.caches[L],h&&h.$changes&&(h.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(i," (").concat(L,")"))},i.prototype.discard=function(i,L){var h=this;void 0===i&&(i=!1),void 0===L&&(L=!1),this.ref instanceof FW||this.changes.forEach((function(i){if(i.op===W.OPERATION.DELETE){var L=h.ref.getIndex(i.index);delete h.indexes[L]}})),this.changes.clear(),this.changed=i,L&&this.allChanges.clear(),this.currentCustomOperation=0},i.prototype.discardAll=function(){var W=this;this.changes.forEach((function(i){var L=W.getValue(i.index);L&&L.$changes&&L.$changes.discardAll()})),this.discard()},i.prototype.cache=function(W,i){this.caches[W]=i},i.prototype.clone=function(){return new i(this.ref,this.parent,this.root)},i.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},i.prototype.assertValidIndex=function(W,i){if(void 0===W)throw new Error('ChangeTree: missing index for field "'.concat(i,'"'))},i}();function z(W,i,L,h){return W[i]||(W[i]=[]),W[i].push(L),null===h||void 0===h||h.forEach((function(W,i){return L(W,i)})),function(){return N(W[i],W[i].indexOf(L))}}function r(i){var L=this,h="string"!==typeof this.$changes.getType();this.$items.forEach((function(l,t){i.push({refId:L.$changes.refId,op:W.OPERATION.DELETE,field:t,value:void 0,previousValue:l}),h&&L.$changes.root.removeRef(l.$changes.refId)}))}function N(W,i){if(-1===i||i>=W.length)return!1;for(var L=W.length-1,h=i;h<L;h++)W[h]=W[h+1];return W.length=L,!0}var I=function(W,i){var L=W.toString(),h=i.toString();return L<h?-1:L>h?1:0};function s(W){return W.$proxy=!0,W=new Proxy(W,{get:function(W,i){return"symbol"===typeof i||isNaN(i)?W[i]:W.at(i)},set:function(W,i,L){if("symbol"===typeof i||isNaN(i))W[i]=L;else{var h=Array.from(W.$items.keys()),l=parseInt(h[i]||i);void 0===L||null===L?W.deleteAt(l):W.setAt(l,L)}return!0},deleteProperty:function(W,i){return"number"===typeof i?W.deleteAt(i):delete W[i],!0}})}var o=function(){function i(){for(var W=[],i=0;i<arguments.length;i++)W[i]=arguments[i];this.$changes=new R(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,W)}return i.prototype.onAdd=function(i,L){return void 0===L&&(L=!0),z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.ADD,i,L?this.$items:void 0)},i.prototype.onRemove=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,i)},i.prototype.onChange=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,i)},i.is=function(W){return Array.isArray(W)||void 0!==W.array},Object.defineProperty(i.prototype,"length",{get:function(){return this.$items.size},set:function(W){0===W?this.clear():this.splice(W,this.length-W)},enumerable:!1,configurable:!0}),i.prototype.push=function(){for(var W,i=this,L=[],h=0;h<arguments.length;h++)L[h]=arguments[h];return L.forEach((function(L){W=i.$refId++,i.setAt(W,L)})),W},i.prototype.pop=function(){var W=Array.from(this.$indexes.values()).pop();if(void 0!==W){this.$changes.delete(W),this.$indexes.delete(W);var i=this.$items.get(W);return this.$items.delete(W),i}},i.prototype.at=function(W){var i=Array.from(this.$items.keys())[W];return this.$items.get(i)},i.prototype.setAt=function(i,L){var h,l;if(void 0!==L&&null!==L){if(this.$items.get(i)!==L){void 0!==L.$changes&&L.$changes.setParent(this,this.$changes.root,i);var t=null!==(l=null===(h=this.$changes.indexes[i])||void 0===h?void 0:h.op)&&void 0!==l?l:W.OPERATION.ADD;this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,L),this.$changes.change(i,t)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},i.prototype.deleteAt=function(W){var i=Array.from(this.$items.keys())[W];return void 0!==i&&this.$deleteAt(i)},i.prototype.$deleteAt=function(W){return this.$changes.delete(W),this.$indexes.delete(W),this.$items.delete(W)},i.prototype.clear=function(i){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),i&&r.call(this,i),this.$items.clear(),this.$changes.operation({index:0,op:W.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.concat=function(){for(var W,L=[],h=0;h<arguments.length;h++)L[h]=arguments[h];return new(i.bind.apply(i,l([void 0],(W=Array.from(this.$items.values())).concat.apply(W,L),!1)))},i.prototype.join=function(W){return Array.from(this.$items.values()).join(W)},i.prototype.reverse=function(){var W=this,i=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(L,h){W.setAt(i[h],L)})),this},i.prototype.shift=function(){var W=Array.from(this.$items.keys()).shift();if(void 0!==W){var i=this.$items.get(W);return this.$deleteAt(W),i}},i.prototype.slice=function(W,L){var h=new i;return h.push.apply(h,Array.from(this.$items.values()).slice(W,L)),h},i.prototype.sort=function(W){var i=this;void 0===W&&(W=I);var L=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(W).forEach((function(W,h){i.setAt(L[h],W)})),this},i.prototype.splice=function(W,i){void 0===i&&(i=this.length-W);for(var L=Array.from(this.$items.keys()),h=[],l=W;l<W+i;l++)h.push(this.$items.get(L[l])),this.$deleteAt(L[l]);return h},i.prototype.unshift=function(){for(var W=this,i=[],L=0;L<arguments.length;L++)i[L]=arguments[L];var h=this.length,l=i.length,t=Array.from(this.$items.values());return i.forEach((function(i,L){W.setAt(L,i)})),t.forEach((function(i,L){W.setAt(l+L,i)})),h+l},i.prototype.indexOf=function(W,i){return Array.from(this.$items.values()).indexOf(W,i)},i.prototype.lastIndexOf=function(W,i){return void 0===i&&(i=this.length-1),Array.from(this.$items.values()).lastIndexOf(W,i)},i.prototype.every=function(W,i){return Array.from(this.$items.values()).every(W,i)},i.prototype.some=function(W,i){return Array.from(this.$items.values()).some(W,i)},i.prototype.forEach=function(W,i){Array.from(this.$items.values()).forEach(W,i)},i.prototype.map=function(W,i){return Array.from(this.$items.values()).map(W,i)},i.prototype.filter=function(W,i){return Array.from(this.$items.values()).filter(W,i)},i.prototype.reduce=function(W,i){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},i.prototype.reduceRight=function(W,i){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},i.prototype.find=function(W,i){return Array.from(this.$items.values()).find(W,i)},i.prototype.findIndex=function(W,i){return Array.from(this.$items.values()).findIndex(W,i)},i.prototype.fill=function(W,i,L){throw new Error("ArraySchema#fill() not implemented")},i.prototype.copyWithin=function(W,i,L){throw new Error("ArraySchema#copyWithin() not implemented")},i.prototype.toString=function(){return this.$items.toString()},i.prototype.toLocaleString=function(){return this.$items.toLocaleString()},i.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(i,Symbol.species,{get:function(){return i},enumerable:!1,configurable:!0}),i.prototype.entries=function(){return this.$items.entries()},i.prototype.keys=function(){return this.$items.keys()},i.prototype.values=function(){return this.$items.values()},i.prototype.includes=function(W,i){return Array.from(this.$items.values()).includes(W,i)},i.prototype.flatMap=function(W,i){throw new Error("ArraySchema#flatMap() is not supported.")},i.prototype.flat=function(W){throw new Error("ArraySchema#flat() is not supported.")},i.prototype.findLast=function(){var W=Array.from(this.$items.values());return W.findLast.apply(W,arguments)},i.prototype.findLastIndex=function(){var W=Array.from(this.$items.values());return W.findLastIndex.apply(W,arguments)},i.prototype.setIndex=function(W,i){this.$indexes.set(W,i)},i.prototype.getIndex=function(W){return this.$indexes.get(W)},i.prototype.getByIndex=function(W){return this.$items.get(this.$indexes.get(W))},i.prototype.deleteByIndex=function(W){var i=this.$indexes.get(W);this.$items.delete(i),this.$indexes.delete(W)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){return this.toArray().map((function(W){return"function"===typeof W.toJSON?W.toJSON():W}))},i.prototype.clone=function(W){return W?new(i.bind.apply(i,l([void 0],Array.from(this.$items.values()),!1))):new(i.bind.apply(i,l([void 0],this.map((function(W){return W.$changes?W.clone():W})),!1)))},i}();function D(W){return W.$proxy=!0,W=new Proxy(W,{get:function(W,i){return"symbol"!==typeof i&&"undefined"===typeof W[i]?W.get(i):W[i]},set:function(W,i,L){return"symbol"!==typeof i&&-1===i.indexOf("$")&&"onAdd"!==i&&"onRemove"!==i&&"onChange"!==i?W.set(i,L):W[i]=L,!0},deleteProperty:function(W,i){return W.delete(i),!0}})}var S=function(){function i(W){var L=this;if(this.$changes=new R(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,W)if(W instanceof Map||W instanceof i)W.forEach((function(W,i){return L.set(i,W)}));else for(var h in W)this.set(h,W[h])}return i.prototype.onAdd=function(i,L){return void 0===L&&(L=!0),z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.ADD,i,L?this.$items:void 0)},i.prototype.onRemove=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,i)},i.prototype.onChange=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,i)},i.is=function(W){return void 0!==W.map},i.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(i.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(i,Symbol.species,{get:function(){return i},enumerable:!1,configurable:!0}),i.prototype.set=function(i,L){if(void 0===L||null===L)throw new Error("MapSchema#set('".concat(i,"', ").concat(L,"): trying to set ").concat(L," value on '").concat(i,"'."));i=i.toString();var h="undefined"!==typeof this.$changes.indexes[i],l=h?this.$changes.indexes[i]:this.$refId++,t=h?W.OPERATION.REPLACE:W.OPERATION.ADD,p=void 0!==L.$changes;if(p&&L.$changes.setParent(this,this.$changes.root,l),h){if(!p&&this.$items.get(i)===L)return;p&&this.$items.get(i)!==L&&(t=W.OPERATION.ADD)}else this.$changes.indexes[i]=l,this.$indexes.set(l,i);return this.$items.set(i,L),this.$changes.change(i,t),this},i.prototype.get=function(W){return this.$items.get(W)},i.prototype.delete=function(W){return this.$changes.delete(W),this.$items.delete(W)},i.prototype.clear=function(i){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),i&&r.call(this,i),this.$items.clear(),this.$changes.operation({index:0,op:W.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(W){return this.$items.has(W)},i.prototype.forEach=function(W){this.$items.forEach(W)},i.prototype.entries=function(){return this.$items.entries()},i.prototype.keys=function(){return this.$items.keys()},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(W,i){this.$indexes.set(W,i)},i.prototype.getIndex=function(W){return this.$indexes.get(W)},i.prototype.getByIndex=function(W){return this.$items.get(this.$indexes.get(W))},i.prototype.deleteByIndex=function(W){var i=this.$indexes.get(W);this.$items.delete(i),this.$indexes.delete(W)},i.prototype.toJSON=function(){var W={};return this.forEach((function(i,L){W[L]="function"===typeof i.toJSON?i.toJSON():i})),W},i.prototype.clone=function(W){var L;return W?L=Object.assign(new i,this):(L=new i,this.forEach((function(W,i){W.$changes?L.set(i,W.clone()):L.set(i,W)}))),L},i}(),C={};function e(W,i){C[W]=i}function V(W){return C[W]}var c=function(){function W(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return W.create=function(i){var L=new W;return L.schema=Object.assign({},i&&i.schema||{}),L.indexes=Object.assign({},i&&i.indexes||{}),L.fieldsByIndex=Object.assign({},i&&i.fieldsByIndex||{}),L.descriptors=Object.assign({},i&&i.descriptors||{}),L.deprecated=Object.assign({},i&&i.deprecated||{}),L},W.prototype.addField=function(W,i){var L=this.getNextFieldIndex();this.fieldsByIndex[L]=W,this.indexes[W]=L,this.schema[W]=Array.isArray(i)?{array:i[0]}:i},W.prototype.hasField=function(W){return void 0!==this.indexes[W]},W.prototype.addFilter=function(W,i){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[W]]=i,this.indexesWithFilters.push(this.indexes[W]),!0},W.prototype.addChildrenFilter=function(W,i){var L=this.indexes[W],h=this.schema[W];if(V(Object.keys(h)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[L]=i,!0;console.warn("@filterChildren: field '".concat(W,"' can't have children. Ignoring filter."))},W.prototype.getChildrenFilter=function(W){return this.childFilters&&this.childFilters[this.indexes[W]]},W.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},W}();function f(W){return W._context&&W._context.useFilters}var a=function(){function W(){this.types={},this.schemas=new Map,this.useFilters=!1}return W.prototype.has=function(W){return this.schemas.has(W)},W.prototype.get=function(W){return this.types[W]},W.prototype.add=function(W,i){void 0===i&&(i=this.schemas.size),W._definition=c.create(W._definition),W._typeid=i,this.types[i]=W,this.schemas.set(W,i)},W.create=function(i){return void 0===i&&(i={}),function(L){return i.context||(i.context=new W),y(L,i)}},W}(),P=new a;function y(W,i){return void 0===i&&(i={}),function(L,h){var t=i.context||P,p=L.constructor;if(p._context=t,!W)throw new Error("".concat(p.name,': @type() reference provided for "').concat(h,"\" is undefined. Make sure you don't have any circular dependencies."));t.has(p)||t.add(p);var x=p._definition;if(x.addField(h,W),x.descriptors[h]){if(x.deprecated[h])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(h,"' definition on '").concat(p.name,"'.\nCheck @type() annotation"))}catch(W){var R=W.stack.split("\n")[4].trim();throw new Error("".concat(W.message," ").concat(R))}}var z=o.is(W),r=!z&&S.is(W);if("string"!==typeof W&&!FW.is(W)){var N=Object.values(W)[0];"string"===typeof N||t.has(N)||t.add(N)}if(i.manual)x.descriptors[h]={enumerable:!0,configurable:!0,writable:!0};else{var I="_".concat(h);x.descriptors[I]={enumerable:!1,configurable:!1,writable:!0},x.descriptors[h]={get:function(){return this[I]},set:function(W){W!==this[I]&&(void 0!==W&&null!==W?(!z||W instanceof o||(W=new(o.bind.apply(o,l([void 0],W,!1)))),!r||W instanceof S||(W=new S(W)),void 0===W.$proxy&&(r?W=D(W):z&&(W=s(W))),this.$changes.change(h),W.$changes&&W.$changes.setParent(this,this.$changes.root,this._definition.indexes[h])):this[I]&&this.$changes.delete(h),this[I]=W)},enumerable:!0,configurable:!0}}}}function M(W){return function(i,L){var h=i.constructor;h._definition.addFilter(L,W)&&(h._context.useFilters=!0)}}function b(W){return function(i,L){var h=i.constructor;h._definition.addChildrenFilter(L,W)&&(h._context.useFilters=!0)}}function j(W){return void 0===W&&(W=!0),function(i,L){var h=i.constructor._definition;h.deprecated[L]=!0,W&&(h.descriptors[L]={get:function(){throw new Error("".concat(L," is deprecated."))},set:function(W){},enumerable:!1,configurable:!0})}}function Z(W,i,L){for(var h in void 0===L&&(L={}),L.context||(L.context=W._context||L.context||P),i)y(i[h],L)(W.prototype,h);return W}function X(W){for(var i=0,L=0,h=0,l=W.length;h<l;h++)(i=W.charCodeAt(h))<128?L+=1:i<2048?L+=2:i<55296||i>=57344?L+=3:(h++,L+=4);return L}function T(W,i,L){for(var h=0,l=0,t=L.length;l<t;l++)(h=L.charCodeAt(l))<128?W[i++]=h:h<2048?(W[i++]=192|h>>6,W[i++]=128|63&h):h<55296||h>=57344?(W[i++]=224|h>>12,W[i++]=128|h>>6&63,W[i++]=128|63&h):(l++,h=65536+((1023&h)<<10|1023&L.charCodeAt(l)),W[i++]=240|h>>18,W[i++]=128|h>>12&63,W[i++]=128|h>>6&63,W[i++]=128|63&h)}function F(W,i){W.push(255&i)}function q(W,i){W.push(255&i)}function H(W,i){W.push(255&i),W.push(i>>8&255)}function k(W,i){W.push(255&i),W.push(i>>8&255)}function U(W,i){W.push(255&i),W.push(i>>8&255),W.push(i>>16&255),W.push(i>>24&255)}function d(W,i){var L=i>>24,h=i>>16,l=i>>8,t=i;W.push(255&t),W.push(255&l),W.push(255&h),W.push(255&L)}function B(W,i){var L=Math.floor(i/Math.pow(2,32));d(W,i>>>0),d(W,L)}function w(W,i){var L=i/Math.pow(2,32)>>0;d(W,i>>>0),d(W,L)}function g(W,i){G(W,i)}function n(W,i){u(W,i)}var m=new Int32Array(2),E=new Float32Array(m.buffer),K=new Float64Array(m.buffer);function G(W,i){E[0]=i,U(W,m[0])}function u(W,i){K[0]=i,U(W,m[0]),U(W,m[1])}function J(W,i){return q(W,i?1:0)}function A(W,i){i||(i="");var L=X(i),h=0;if(L<32)W.push(160|L),h=1;else if(L<256)W.push(217),q(W,L),h=2;else if(L<65536)W.push(218),k(W,L),h=3;else{if(!(L<4294967296))throw new Error("String too long");W.push(219),d(W,L),h=5}return T(W,W.length,i),h+L}function v(W,i){return isNaN(i)?v(W,0):isFinite(i)?i!==(0|i)?(W.push(203),u(W,i),9):i>=0?i<128?(q(W,i),1):i<256?(W.push(204),q(W,i),2):i<65536?(W.push(205),k(W,i),3):i<4294967296?(W.push(206),d(W,i),5):(W.push(207),w(W,i),9):i>=-32?(W.push(224|i+32),1):i>=-128?(W.push(208),F(W,i),2):i>=-32768?(W.push(209),H(W,i),3):i>=-2147483648?(W.push(210),U(W,i),5):(W.push(211),B(W,i),9):v(W,i>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Q=Object.freeze({__proto__:null,utf8Write:T,int8:F,uint8:q,int16:H,uint16:k,int32:U,uint32:d,int64:B,uint64:w,float32:g,float64:n,writeFloat32:G,writeFloat64:u,boolean:J,string:A,number:v});function O(W,i,L){for(var h="",l=0,t=i,p=i+L;t<p;t++){var x=W[t];0!==(128&x)?192!==(224&x)?224!==(240&x)?240!==(248&x)?console.error("Invalid byte "+x.toString(16)):(l=(7&x)<<18|(63&W[++t])<<12|(63&W[++t])<<6|(63&W[++t])<<0)>=65536?(l-=65536,h+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):h+=String.fromCharCode(l):h+=String.fromCharCode((15&x)<<12|(63&W[++t])<<6|(63&W[++t])<<0):h+=String.fromCharCode((31&x)<<6|63&W[++t]):h+=String.fromCharCode(x)}return h}function Y(W,i){return WW(W,i)<<24>>24}function WW(W,i){return W[i.offset++]}function iW(W,i){return LW(W,i)<<16>>16}function LW(W,i){return W[i.offset++]|W[i.offset++]<<8}function hW(W,i){return W[i.offset++]|W[i.offset++]<<8|W[i.offset++]<<16|W[i.offset++]<<24}function lW(W,i){return hW(W,i)>>>0}function tW(W,i){return IW(W,i)}function pW(W,i){return sW(W,i)}function xW(W,i){var L=lW(W,i);return hW(W,i)*Math.pow(2,32)+L}function RW(W,i){var L=lW(W,i);return lW(W,i)*Math.pow(2,32)+L}var zW=new Int32Array(2),rW=new Float32Array(zW.buffer),NW=new Float64Array(zW.buffer);function IW(W,i){return zW[0]=hW(W,i),rW[0]}function sW(W,i){return zW[0]=hW(W,i),zW[1]=hW(W,i),NW[0]}function oW(W,i){return WW(W,i)>0}function DW(W,i){var L,h=W[i.offset++];h<192?L=31&h:217===h?L=WW(W,i):218===h?L=LW(W,i):219===h&&(L=lW(W,i));var l=O(W,i.offset,L);return i.offset+=L,l}function SW(W,i){var L=W[i.offset];return L<192&&L>160||217===L||218===L||219===L}function CW(W,i){var L=W[i.offset++];return L<128?L:202===L?IW(W,i):203===L?sW(W,i):204===L?WW(W,i):205===L?LW(W,i):206===L?lW(W,i):207===L?RW(W,i):208===L?Y(W,i):209===L?iW(W,i):210===L?hW(W,i):211===L?xW(W,i):L>223?-1*(255-L+1):void 0}function eW(W,i){var L=W[i.offset];return L<128||L>=202&&L<=211}function VW(W,i){return W[i.offset]<160}function cW(W,i){return W[i.offset-1]===p&&(W[i.offset]<128||W[i.offset]>=202&&W[i.offset]<=211)}var fW=Object.freeze({__proto__:null,int8:Y,uint8:WW,int16:iW,uint16:LW,int32:hW,uint32:lW,float32:tW,float64:pW,int64:xW,uint64:RW,readFloat32:IW,readFloat64:sW,boolean:oW,string:DW,stringCheck:SW,number:CW,numberCheck:eW,arrayCheck:VW,switchStructureCheck:cW}),aW=function(){function i(W){var i=this;this.$changes=new R(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,W&&W.forEach((function(W){return i.add(W)}))}return i.prototype.onAdd=function(i,L){return void 0===L&&(L=!0),z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.ADD,i,L?this.$items:void 0)},i.prototype.onRemove=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,i)},i.prototype.onChange=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,i)},i.is=function(W){return void 0!==W.collection},i.prototype.add=function(W){var i=this.$refId++;return void 0!==W.$changes&&W.$changes.setParent(this,this.$changes.root,i),this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,W),this.$changes.change(i),i},i.prototype.at=function(W){var i=Array.from(this.$items.keys())[W];return this.$items.get(i)},i.prototype.entries=function(){return this.$items.entries()},i.prototype.delete=function(W){for(var i,L,h=this.$items.entries();(L=h.next())&&!L.done;)if(W===L.value[1]){i=L.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},i.prototype.clear=function(i){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),i&&r.call(this,i),this.$items.clear(),this.$changes.operation({index:0,op:W.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(W){return Array.from(this.$items.values()).some((function(i){return i===W}))},i.prototype.forEach=function(W){var i=this;this.$items.forEach((function(L,h,l){return W(L,h,i)}))},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(W,i){this.$indexes.set(W,i)},i.prototype.getIndex=function(W){return this.$indexes.get(W)},i.prototype.getByIndex=function(W){return this.$items.get(this.$indexes.get(W))},i.prototype.deleteByIndex=function(W){var i=this.$indexes.get(W);this.$items.delete(i),this.$indexes.delete(W)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){var W=[];return this.forEach((function(i,L){W.push("function"===typeof i.toJSON?i.toJSON():i)})),W},i.prototype.clone=function(W){var L;return W?L=Object.assign(new i,this):(L=new i,this.forEach((function(W){W.$changes?L.add(W.clone()):L.add(W)}))),L},i}(),PW=function(){function i(W){var i=this;this.$changes=new R(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,W&&W.forEach((function(W){return i.add(W)}))}return i.prototype.onAdd=function(i,L){return void 0===L&&(L=!0),z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.ADD,i,L?this.$items:void 0)},i.prototype.onRemove=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,i)},i.prototype.onChange=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,i)},i.is=function(W){return void 0!==W.set},i.prototype.add=function(i){var L,h;if(this.has(i))return!1;var l=this.$refId++;void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,l);var t=null!==(h=null===(L=this.$changes.indexes[l])||void 0===L?void 0:L.op)&&void 0!==h?h:W.OPERATION.ADD;return this.$changes.indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,i),this.$changes.change(l,t),l},i.prototype.entries=function(){return this.$items.entries()},i.prototype.delete=function(W){for(var i,L,h=this.$items.entries();(L=h.next())&&!L.done;)if(W===L.value[1]){i=L.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},i.prototype.clear=function(i){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),i&&r.call(this,i),this.$items.clear(),this.$changes.operation({index:0,op:W.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(W){for(var i,L=this.$items.values(),h=!1;(i=L.next())&&!i.done;)if(W===i.value){h=!0;break}return h},i.prototype.forEach=function(W){var i=this;this.$items.forEach((function(L,h,l){return W(L,h,i)}))},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(W,i){this.$indexes.set(W,i)},i.prototype.getIndex=function(W){return this.$indexes.get(W)},i.prototype.getByIndex=function(W){return this.$items.get(this.$indexes.get(W))},i.prototype.deleteByIndex=function(W){var i=this.$indexes.get(W);this.$items.delete(i),this.$indexes.delete(W)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){var W=[];return this.forEach((function(i,L){W.push("function"===typeof i.toJSON?i.toJSON():i)})),W},i.prototype.clone=function(W){var L;return W?L=Object.assign(new i,this):(L=new i,this.forEach((function(W){W.$changes?L.add(W.clone()):L.add(W)}))),L},i}(),yW=function(){function W(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return W.prototype.addRefId=function(W){this.refIds.has(W)||(this.refIds.add(W),this.containerIndexes.set(W,new Set))},W.get=function(i){return void 0===i.$filterState&&(i.$filterState=new W),i.$filterState},W}(),MW=function(){function W(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return W.prototype.getNextUniqueId=function(){return this.nextUniqueId++},W.prototype.addRef=function(W,i,L){void 0===L&&(L=!0),this.refs.set(W,i),L&&(this.refCounts[W]=(this.refCounts[W]||0)+1)},W.prototype.removeRef=function(W){this.refCounts[W]=this.refCounts[W]-1,this.deletedRefs.add(W)},W.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},W.prototype.garbageCollectDeletedRefs=function(){var W=this;this.deletedRefs.forEach((function(i){if(!(W.refCounts[i]>0)){var L=W.refs.get(i);if(L instanceof FW)for(var h in L._definition.schema)"string"!==typeof L._definition.schema[h]&&L[h]&&L[h].$changes&&W.removeRef(L[h].$changes.refId);else{var l=L.$changes.parent._definition,t=l.schema[l.fieldsByIndex[L.$changes.parentIndex]];"function"===typeof Object.values(t)[0]&&Array.from(L.values()).forEach((function(i){return W.removeRef(i.$changes.refId)}))}W.refs.delete(i),delete W.refCounts[i]}})),this.deletedRefs.clear()},W}(),bW=function(W){function i(){return null!==W&&W.apply(this,arguments)||this}return L(i,W),i}(Error);function jW(W,i,L,h){var l,t=!1;switch(i){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":l="number",isNaN(W)&&console.log('trying to encode "NaN" in '.concat(L.constructor.name,"#").concat(h));break;case"string":l="string",t=!0;break;case"boolean":return}if(typeof W!==l&&(!t||t&&null!==W)){var p="'".concat(JSON.stringify(W),"'").concat(W&&W.constructor&&" (".concat(W.constructor.name,")")||"");throw new bW("a '".concat(l,"' was expected, but ").concat(p," was provided in ").concat(L.constructor.name,"#").concat(h))}}function ZW(W,i,L,h){if(!(W instanceof i))throw new bW("a '".concat(i.name,"' was expected, but '").concat(W.constructor.name,"' was provided in ").concat(L.constructor.name,"#").concat(h))}function XW(W,i,L,h,l){jW(L,W,h,l);var t=Q[W];if(!t)throw new bW("a '".concat(W,"' was expected, but ").concat(L," was provided in ").concat(h.constructor.name,"#").concat(l));t(i,L)}function TW(W,i,L){return fW[W](i,L)}var FW=function(){function i(){for(var W=[],i=0;i<arguments.length;i++)W[i]=arguments[i];Object.defineProperties(this,{$changes:{value:new R(this,void 0,new MW),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var L=this._definition.descriptors;L&&Object.defineProperties(this,L),W[0]&&this.assign(W[0])}return i.onError=function(W){console.error(W)},i.is=function(W){return W._definition&&void 0!==W._definition.schema},i.prototype.onChange=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.REPLACE,i)},i.prototype.onRemove=function(i){return z(this.$callbacks||(this.$callbacks=[]),W.OPERATION.DELETE,i)},i.prototype.assign=function(W){return Object.assign(this,W),this},Object.defineProperty(i.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),i.prototype.setDirty=function(W,i){this.$changes.change(W,i)},i.prototype.listen=function(W,i,L){var h=this;return void 0===L&&(L=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[W]||(this.$callbacks[W]=[]),this.$callbacks[W].push(i),L&&void 0!==this[W]&&i(this[W],void 0),function(){return N(h.$callbacks[W],h.$callbacks[W].indexOf(i))}},i.prototype.decode=function(L,h,l){var t;void 0===h&&(h={offset:0}),void 0===l&&(l=this);var x=[],R=this.$changes.root,z=L.length,r=0;for(R.refs.set(r,this);h.offset<z;){var N=L[h.offset++];if(N!=p){var I=l.$changes,s=void 0!==l._definition,D=s?N>>6<<6:N;if(D!==W.OPERATION.CLEAR){var C=s?N%(D||255):CW(L,h),e=s?l._definition.fieldsByIndex[C]:"",c=I.getType(C),f=void 0,a=void 0,P=void 0;if(s?a=l["_".concat(e)]:(a=l.getByIndex(C),(D&W.OPERATION.ADD)===W.OPERATION.ADD?(P=l instanceof S?DW(L,h):C,l.setIndex(C,P)):P=l.getIndex(C)),(D&W.OPERATION.DELETE)===W.OPERATION.DELETE&&(D!==W.OPERATION.DELETE_AND_ADD&&l.deleteByIndex(C),a&&a.$changes&&R.removeRef(a.$changes.refId),f=null),void 0!==e){if(D===W.OPERATION.DELETE);else if(i.is(c)){var y=CW(L,h);if(f=R.refs.get(y),D!==W.OPERATION.REPLACE){var M=this.getSchemaType(L,h,c);f||((f=this.createTypeInstance(M)).$changes.refId=y,a&&(f.$callbacks=a.$callbacks,a.$changes.refId&&y!==a.$changes.refId&&R.removeRef(a.$changes.refId))),R.addRef(y,f,f!==a)}}else if("string"===typeof c)f=TW(c,L,h);else{var b=V(Object.keys(c)[0]),j=CW(L,h),Z=R.refs.has(j)?a||R.refs.get(j):new b.constructor;if((f=Z.clone(!0)).$changes.refId=j,a&&(f.$callbacks=a.$callbacks,a.$changes.refId&&j!==a.$changes.refId)){R.removeRef(a.$changes.refId);for(var X=a.entries(),T=void 0;(T=X.next())&&!T.done;){var F=(t=T.value)[0],q=t[1];x.push({refId:j,op:W.OPERATION.DELETE,field:F,value:void 0,previousValue:q})}}R.addRef(j,f,Z!==a)}if(null!==f&&void 0!==f)if(f.$changes&&f.$changes.setParent(I.ref,I.root,C),l instanceof i)l[e]=f;else if(l instanceof S)F=P,l.$items.set(F,f),l.$changes.allChanges.add(C);else if(l instanceof o)l.setAt(C,f);else if(l instanceof aW){var H=l.add(f);l.setIndex(C,H)}else l instanceof PW&&!1!==(H=l.add(f))&&l.setIndex(C,H);a!==f&&x.push({refId:r,op:D,field:e,dynamicIndex:P,value:f,previousValue:a})}else{console.warn("@colyseus/schema: definition mismatch");for(var k={offset:h.offset};h.offset<z&&(!cW(L,h)||(k.offset=h.offset+1,!R.refs.has(CW(L,k))));)h.offset++}}else l.clear(x)}else{r=CW(L,h);var U=R.refs.get(r);if(!U)throw new Error('"refId" not found: '.concat(r));l=U}}return this._triggerChanges(x),R.garbageCollectDeletedRefs(),x},i.prototype.encode=function(L,h,l){void 0===L&&(L=!1),void 0===h&&(h=[]),void 0===l&&(l=!1);for(var t=this.$changes,x=new WeakSet,R=[t],z=1,r=0;r<z;r++){var N=R[r],I=N.ref,s=I instanceof i;N.ensureRefId(),x.add(N),N!==t&&(N.changed||L)&&(q(h,p),v(h,N.refId));for(var o=L?Array.from(N.allChanges):Array.from(N.changes.values()),D=0,C=o.length;D<C;D++){var e=L?{op:W.OPERATION.ADD,index:o[D]}:o[D],c=e.index,f=s?I._definition.fieldsByIndex&&I._definition.fieldsByIndex[c]:c,a=h.length;if(e.op!==W.OPERATION.TOUCH)if(s)q(h,c|e.op);else{if(q(h,e.op),e.op===W.OPERATION.CLEAR)continue;v(h,c)}if(s||(e.op&W.OPERATION.ADD)!=W.OPERATION.ADD||I instanceof S&&A(h,N.ref.$indexes.get(c)),e.op!==W.OPERATION.DELETE){var P=N.getType(c),y=N.getValue(c);if(y&&y.$changes&&!x.has(y.$changes)&&(R.push(y.$changes),y.$changes.ensureRefId(),z++),e.op!==W.OPERATION.TOUCH){if(i.is(P))ZW(y,P,I,f),v(h,y.$changes.refId),(e.op&W.OPERATION.ADD)===W.OPERATION.ADD&&this.tryEncodeTypeId(h,P,y.constructor);else if("string"===typeof P)XW(P,h,y,I,f);else{var M=V(Object.keys(P)[0]);ZW(I["_".concat(f)],M.constructor,I,f),v(h,y.$changes.refId)}l&&N.cache(c,h.slice(a))}}}L||l||N.discard()}return h},i.prototype.encodeAll=function(W){return this.encode(!0,[],W)},i.prototype.applyFilters=function(L,h){var l,t;void 0===h&&(h=!1);for(var x=this,R=new Set,z=yW.get(L),r=[this.$changes],N=1,I=[],s=function(s){var o=r[s];if(R.has(o.refId))return"continue";var D=o.ref,C=D instanceof i;q(I,p),v(I,o.refId);var e=z.refIds.has(o),V=h||!e;z.addRefId(o);var c=z.containerIndexes.get(o),f=V?Array.from(o.allChanges):Array.from(o.changes.values());!h&&C&&D._definition.indexesWithFilters&&D._definition.indexesWithFilters.forEach((function(i){!c.has(i)&&o.allChanges.has(i)&&(V?f.push(i):f.push({op:W.OPERATION.ADD,index:i}))}));for(var a=0,P=f.length;a<P;a++){var y=V?{op:W.OPERATION.ADD,index:f[a]}:f[a];if(y.op!==W.OPERATION.CLEAR){var M=y.index;if(y.op!==W.OPERATION.DELETE){var b=o.getValue(M),j=o.getType(M);if(C){if((Z=D._definition.filters&&D._definition.filters[M])&&!Z.call(D,L,b,x)){b&&b.$changes&&R.add(b.$changes.refId);continue}}else{var Z,X=o.parent;if((Z=o.getChildrenFilter())&&!Z.call(X,L,D.$indexes.get(M),b,x)){b&&b.$changes&&R.add(b.$changes.refId);continue}}if(b.$changes&&(r.push(b.$changes),N++),y.op!==W.OPERATION.TOUCH)if(y.op===W.OPERATION.ADD||C)I.push.apply(I,null!==(l=o.caches[M])&&void 0!==l?l:[]),c.add(M);else if(c.has(M))I.push.apply(I,null!==(t=o.caches[M])&&void 0!==t?t:[]);else{if(c.add(M),q(I,W.OPERATION.ADD),v(I,M),D instanceof S){var T=o.ref.$indexes.get(M);A(I,T)}b.$changes?v(I,b.$changes.refId):Q[j](I,b)}else b.$changes&&!C&&(q(I,W.OPERATION.ADD),v(I,M),D instanceof S&&(T=o.ref.$indexes.get(M),A(I,T)),v(I,b.$changes.refId))}else C?q(I,y.op|M):(q(I,y.op),v(I,M))}else q(I,y.op)}},o=0;o<N;o++)s(o);return I},i.prototype.clone=function(){var W,i=new this.constructor,L=this._definition.schema;for(var h in L)"object"===typeof this[h]&&"function"===typeof(null===(W=this[h])||void 0===W?void 0:W.clone)?i[h]=this[h].clone():i[h]=this[h];return i},i.prototype.toJSON=function(){var W=this._definition.schema,i=this._definition.deprecated,L={};for(var h in W)i[h]||null===this[h]||"undefined"===typeof this[h]||(L[h]="function"===typeof this[h].toJSON?this[h].toJSON():this["_".concat(h)]);return L},i.prototype.discardAllChanges=function(){this.$changes.discardAll()},i.prototype.getByIndex=function(W){return this[this._definition.fieldsByIndex[W]]},i.prototype.deleteByIndex=function(W){this[this._definition.fieldsByIndex[W]]=void 0},i.prototype.tryEncodeTypeId=function(W,i,L){i._typeid!==L._typeid&&(q(W,x),v(W,L._typeid))},i.prototype.getSchemaType=function(W,i,L){var h;return W[i.offset]===x&&(i.offset++,h=this.constructor._context.get(CW(W,i))),h||L},i.prototype.createTypeInstance=function(W){var i=new W;return i.$changes.root=this.$changes.root,i},i.prototype._triggerChanges=function(L){for(var h,l,t,p,x,R,z,r,N,I=new Set,s=this.$changes.root.refs,o=function(o){var D=L[o],S=D.refId,C=s.get(S),e=C.$callbacks;if((D.op&W.OPERATION.DELETE)===W.OPERATION.DELETE&&D.previousValue instanceof i&&(null===(l=null===(h=D.previousValue.$callbacks)||void 0===h?void 0:h[W.OPERATION.DELETE])||void 0===l||l.forEach((function(W){return W()}))),!e)return"continue";if(C instanceof i){if(!I.has(S))try{null===(t=null===e||void 0===e?void 0:e[W.OPERATION.REPLACE])||void 0===t||t.forEach((function(W){return W()}))}catch(W){i.onError(W)}try{e.hasOwnProperty(D.field)&&(null===(p=e[D.field])||void 0===p||p.forEach((function(W){return W(D.value,D.previousValue)})))}catch(W){i.onError(W)}}else D.op===W.OPERATION.ADD&&void 0===D.previousValue?null===(x=e[W.OPERATION.ADD])||void 0===x||x.forEach((function(W){var i;return W(D.value,null!==(i=D.dynamicIndex)&&void 0!==i?i:D.field)})):D.op===W.OPERATION.DELETE?void 0!==D.previousValue&&(null===(R=e[W.OPERATION.DELETE])||void 0===R||R.forEach((function(W){var i;return W(D.previousValue,null!==(i=D.dynamicIndex)&&void 0!==i?i:D.field)}))):D.op===W.OPERATION.DELETE_AND_ADD&&(void 0!==D.previousValue&&(null===(z=e[W.OPERATION.DELETE])||void 0===z||z.forEach((function(W){var i;return W(D.previousValue,null!==(i=D.dynamicIndex)&&void 0!==i?i:D.field)}))),null===(r=e[W.OPERATION.ADD])||void 0===r||r.forEach((function(W){var i;return W(D.value,null!==(i=D.dynamicIndex)&&void 0!==i?i:D.field)}))),D.value!==D.previousValue&&(null===(N=e[W.OPERATION.REPLACE])||void 0===N||N.forEach((function(W){var i;return W(D.value,null!==(i=D.dynamicIndex)&&void 0!==i?i:D.field)})));I.add(S)},D=0;D<L.length;D++)o(D)},i._definition=c.create(),i}();function qW(W){for(var i=[W.$changes],L=1,h={},l=h,t=function(W){var L=i[W];L.changes.forEach((function(W){var i=L.ref,h=W.index,t=i._definition?i._definition.fieldsByIndex[h]:i.$indexes.get(h);l[t]=L.getValue(h)}))},p=0;p<L;p++)t(p);return h}var HW={context:new a},kW=function(W){function i(){return null!==W&&W.apply(this,arguments)||this}return L(i,W),h([y("string",HW)],i.prototype,"name",void 0),h([y("string",HW)],i.prototype,"type",void 0),h([y("number",HW)],i.prototype,"referencedType",void 0),i}(FW),UW=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.fields=new o,i}return L(i,W),h([y("number",HW)],i.prototype,"id",void 0),h([y([kW],HW)],i.prototype,"fields",void 0),i}(FW),dW=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.types=new o,i}return L(i,W),i.encode=function(W){var L=W.constructor,h=new i;h.rootType=L._typeid;var l=function(W,i){for(var L in i){var l=new kW;l.name=L;var t=void 0;if("string"===typeof i[L])t=i[L];else{var p=i[L],x=void 0;FW.is(p)?(t="ref",x=i[L]):"string"===typeof p[t=Object.keys(p)[0]]?t+=":"+p[t]:x=p[t],l.referencedType=x?x._typeid:-1}l.type=t,W.fields.push(l)}h.types.push(W)},t=L._context.types;for(var p in t){var x=new UW;x.id=Number(p),l(x,t[p]._definition.schema)}return h.encodeAll()},i.decode=function(W,h){var l=new a,t=new i;t.decode(W,h);var p=t.types.reduce((function(W,i){var h=function(W){function i(){return null!==W&&W.apply(this,arguments)||this}return L(i,W),i}(FW),t=i.id;return W[t]=h,l.add(h,t),W}),{});t.types.forEach((function(W){var i=p[W.id];W.fields.forEach((function(W){var L;if(void 0!==W.referencedType){var h=W.type,t=p[W.referencedType];if(!t){var x=W.type.split(":");h=x[0],t=x[1]}"ref"===h?y(t,{context:l})(i.prototype,W.name):y(((L={})[h]=t,L),{context:l})(i.prototype,W.name)}else y(W.type,{context:l})(i.prototype,W.name)}))}));var x=p[t.rootType],R=new x;for(var z in x._definition.schema){var r=x._definition.schema[z];"string"!==typeof r&&(R[z]="function"===typeof r?new r:new(V(Object.keys(r)[0]).constructor))}return R},h([y([UW],HW)],i.prototype,"types",void 0),h([y("number",HW)],i.prototype,"rootType",void 0),i}(FW);e("map",{constructor:S}),e("array",{constructor:o}),e("set",{constructor:PW}),e("collection",{constructor:aW}),W.ArraySchema=o,W.CollectionSchema=aW,W.Context=a,W.MapSchema=S,W.Reflection=dW,W.ReflectionField=kW,W.ReflectionType=UW,W.Schema=FW,W.SchemaDefinition=c,W.SetSchema=PW,W.decode=fW,W.defineTypes=Z,W.deprecated=j,W.dumpChanges=qW,W.encode=Q,W.filter=M,W.filterChildren=b,W.hasFilter=f,W.registerType=e,W.type=y,Object.defineProperty(W,"__esModule",{value:!0})}(i)},81238:function(W){"use strict";W.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12628:function(W,i,L){var h=L(81238),l=L(52796),t=Object.hasOwnProperty,p=Object.create(null);for(var x in h)t.call(h,x)&&(p[h[x]]=x);var R=W.exports={to:{},get:{}};function z(W,i,L){return Math.min(Math.max(i,W),L)}function r(W){var i=Math.round(W).toString(16).toUpperCase();return i.length<2?"0"+i:i}R.get=function(W){var i,L;switch(W.substring(0,3).toLowerCase()){case"hsl":i=R.get.hsl(W),L="hsl";break;case"hwb":i=R.get.hwb(W),L="hwb";break;default:i=R.get.rgb(W),L="rgb"}return i?{model:L,value:i}:null},R.get.rgb=function(W){if(!W)return null;var i,L,l,p=[0,0,0,1];if(i=W.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(l=i[2],i=i[1],L=0;L<3;L++){var x=2*L;p[L]=parseInt(i.slice(x,x+2),16)}l&&(p[3]=parseInt(l,16)/255)}else if(i=W.match(/^#([a-f0-9]{3,4})$/i)){for(l=(i=i[1])[3],L=0;L<3;L++)p[L]=parseInt(i[L]+i[L],16);l&&(p[3]=parseInt(l+l,16)/255)}else if(i=W.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(L=0;L<3;L++)p[L]=parseInt(i[L+1],0);i[4]&&(i[5]?p[3]=.01*parseFloat(i[4]):p[3]=parseFloat(i[4]))}else{if(!(i=W.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(i=W.match(/^(\w+)$/))?"transparent"===i[1]?[0,0,0,0]:t.call(h,i[1])?((p=h[i[1]])[3]=1,p):null:null;for(L=0;L<3;L++)p[L]=Math.round(2.55*parseFloat(i[L+1]));i[4]&&(i[5]?p[3]=.01*parseFloat(i[4]):p[3]=parseFloat(i[4]))}for(L=0;L<3;L++)p[L]=z(p[L],0,255);return p[3]=z(p[3],0,1),p},R.get.hsl=function(W){if(!W)return null;var i=W.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(i){var L=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,z(parseFloat(i[2]),0,100),z(parseFloat(i[3]),0,100),z(isNaN(L)?1:L,0,1)]}return null},R.get.hwb=function(W){if(!W)return null;var i=W.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(i){var L=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,z(parseFloat(i[2]),0,100),z(parseFloat(i[3]),0,100),z(isNaN(L)?1:L,0,1)]}return null},R.to.hex=function(){var W=l(arguments);return"#"+r(W[0])+r(W[1])+r(W[2])+(W[3]<1?r(Math.round(255*W[3])):"")},R.to.rgb=function(){var W=l(arguments);return W.length<4||1===W[3]?"rgb("+Math.round(W[0])+", "+Math.round(W[1])+", "+Math.round(W[2])+")":"rgba("+Math.round(W[0])+", "+Math.round(W[1])+", "+Math.round(W[2])+", "+W[3]+")"},R.to.rgb.percent=function(){var W=l(arguments),i=Math.round(W[0]/255*100),L=Math.round(W[1]/255*100),h=Math.round(W[2]/255*100);return W.length<4||1===W[3]?"rgb("+i+"%, "+L+"%, "+h+"%)":"rgba("+i+"%, "+L+"%, "+h+"%, "+W[3]+")"},R.to.hsl=function(){var W=l(arguments);return W.length<4||1===W[3]?"hsl("+W[0]+", "+W[1]+"%, "+W[2]+"%)":"hsla("+W[0]+", "+W[1]+"%, "+W[2]+"%, "+W[3]+")"},R.to.hwb=function(){var W=l(arguments),i="";return W.length>=4&&1!==W[3]&&(i=", "+W[3]),"hwb("+W[0]+", "+W[1]+"%, "+W[2]+"%"+i+")"},R.to.keyword=function(W){return p[W.slice(0,3)]}},32901:function(W,i,L){for(var h=L(27424).default,l=L(74704).default,t=L(861).default,p=L(12628),x=L(43143),R=["keyword","gray","hex"],z={},r=0,N=Object.keys(x);r<N.length;r++){var I=N[r];z[t(x[I].labels).sort().join("")]=I}var s={};function o(W,i){if(!(this instanceof o))return new o(W,i);if(i&&i in R&&(i=null),i&&!(i in x))throw new Error("Unknown model: "+i);var L,h;if(null==W)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(W instanceof o)this.model=W.model,this.color=t(W.color),this.valpha=W.valpha;else if("string"===typeof W){var l=p.get(W);if(null===l)throw new Error("Unable to parse color from string: "+W);this.model=l.model,h=x[this.model].channels,this.color=l.value.slice(0,h),this.valpha="number"===typeof l.value[h]?l.value[h]:1}else if(W.length>0){this.model=i||"rgb",h=x[this.model].channels;var r=Array.prototype.slice.call(W,0,h);this.color=f(r,h),this.valpha="number"===typeof W[h]?W[h]:1}else if("number"===typeof W)this.model="rgb",this.color=[W>>16&255,W>>8&255,255&W],this.valpha=1;else{this.valpha=1;var N=Object.keys(W);"alpha"in W&&(N.splice(N.indexOf("alpha"),1),this.valpha="number"===typeof W.alpha?W.alpha:0);var I=N.sort().join("");if(!(I in z))throw new Error("Unable to parse color from object: "+JSON.stringify(W));this.model=z[I];var D=x[this.model].labels,S=[];for(L=0;L<D.length;L++)S.push(W[D[L]]);this.color=f(S)}if(s[this.model])for(h=x[this.model].channels,L=0;L<h;L++){var C=s[this.model][L];C&&(this.color[L]=C(this.color[L]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}o.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(W){var i=this.model in p.to?this:this.rgb(),L=1===(i=i.round("number"===typeof W?W:1)).valpha?i.color:[].concat(t(i.color),[this.valpha]);return p.to[i.model](L)},percentString:function(W){var i=this.rgb().round("number"===typeof W?W:1),L=1===i.valpha?i.color:[].concat(t(i.color),[this.valpha]);return p.to.rgb.percent(L)},array:function(){return 1===this.valpha?t(this.color):[].concat(t(this.color),[this.valpha])},object:function(){for(var W={},i=x[this.model].channels,L=x[this.model].labels,h=0;h<i;h++)W[L[h]]=this.color[h];return 1!==this.valpha&&(W.alpha=this.valpha),W},unitArray:function(){var W=this.rgb().color;return W[0]/=255,W[1]/=255,W[2]/=255,1!==this.valpha&&W.push(this.valpha),W},unitObject:function(){var W=this.rgb().object();return W.r/=255,W.g/=255,W.b/=255,1!==this.valpha&&(W.alpha=this.valpha),W},round:function(W){return W=Math.max(W||0,0),new o([].concat(t(this.color.map(function(W){return function(i){return function(W,i){return Number(W.toFixed(i))}(i,W)}}(W))),[this.valpha]),this.model)},alpha:function(W){return void 0!==W?new o([].concat(t(this.color),[Math.max(0,Math.min(1,W))]),this.model):this.valpha},red:e("rgb",0,V(255)),green:e("rgb",1,V(255)),blue:e("rgb",2,V(255)),hue:e(["hsl","hsv","hsl","hwb","hcg"],0,(function(W){return(W%360+360)%360})),saturationl:e("hsl",1,V(100)),lightness:e("hsl",2,V(100)),saturationv:e("hsv",1,V(100)),value:e("hsv",2,V(100)),chroma:e("hcg",1,V(100)),gray:e("hcg",2,V(100)),white:e("hwb",1,V(100)),wblack:e("hwb",2,V(100)),cyan:e("cmyk",0,V(100)),magenta:e("cmyk",1,V(100)),yellow:e("cmyk",2,V(100)),black:e("cmyk",3,V(100)),x:e("xyz",0,V(95.047)),y:e("xyz",1,V(100)),z:e("xyz",2,V(108.833)),l:e("lab",0,V(100)),a:e("lab",1),b:e("lab",2),keyword:function(W){return void 0!==W?new o(W):x[this.model].keyword(this.color)},hex:function(W){return void 0!==W?new o(W):p.to.hex(this.rgb().round().color)},hexa:function(W){if(void 0!==W)return new o(W);var i=this.rgb().round().color,L=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===L.length&&(L="0"+L),p.to.hex(i)+L},rgbNumber:function(){var W=this.rgb().color;return(255&W[0])<<16|(255&W[1])<<8|255&W[2]},luminosity:function(){var W,i=this.rgb().color,L=[],t=l(i.entries());try{for(t.s();!(W=t.n()).done;){var p=h(W.value,2),x=p[0],R=p[1]/255;L[x]=R<=.04045?R/12.92:Math.pow((R+.055)/1.055,2.4)}}catch(W){t.e(W)}finally{t.f()}return.2126*L[0]+.7152*L[1]+.0722*L[2]},contrast:function(W){var i=this.luminosity(),L=W.luminosity();return i>L?(i+.05)/(L+.05):(L+.05)/(i+.05)},level:function(W){var i=this.contrast(W);return i>=7?"AAA":i>=4.5?"AA":""},isDark:function(){var W=this.rgb().color;return(2126*W[0]+7152*W[1]+722*W[2])/1e4<128},isLight:function(){return!this.isDark()},negate:function(){for(var W=this.rgb(),i=0;i<3;i++)W.color[i]=255-W.color[i];return W},lighten:function(W){var i=this.hsl();return i.color[2]+=i.color[2]*W,i},darken:function(W){var i=this.hsl();return i.color[2]-=i.color[2]*W,i},saturate:function(W){var i=this.hsl();return i.color[1]+=i.color[1]*W,i},desaturate:function(W){var i=this.hsl();return i.color[1]-=i.color[1]*W,i},whiten:function(W){var i=this.hwb();return i.color[1]+=i.color[1]*W,i},blacken:function(W){var i=this.hwb();return i.color[2]+=i.color[2]*W,i},grayscale:function(){var W=this.rgb().color,i=.3*W[0]+.59*W[1]+.11*W[2];return o.rgb(i,i,i)},fade:function(W){return this.alpha(this.valpha-this.valpha*W)},opaquer:function(W){return this.alpha(this.valpha+this.valpha*W)},rotate:function(W){var i=this.hsl(),L=i.color[0];return L=(L=(L+W)%360)<0?360+L:L,i.color[0]=L,i},mix:function(W,i){if(!W||!W.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof W);var L=W.rgb(),h=this.rgb(),l=void 0===i?.5:i,t=2*l-1,p=L.alpha()-h.alpha(),x=((t*p===-1?t:(t+p)/(1+t*p))+1)/2,R=1-x;return o.rgb(x*L.red()+R*h.red(),x*L.green()+R*h.green(),x*L.blue()+R*h.blue(),L.alpha()*l+h.alpha()*(1-l))}};for(var D=function(){var W=C[S];if(R.includes(W))return"continue";var i=x[W].channels;o.prototype[W]=function(){if(this.model===W)return new o(this);for(var i=arguments.length,L=new Array(i),h=0;h<i;h++)L[h]=arguments[h];return L.length>0?new o(L,W):new o([].concat(t(c(x[this.model][W].raw(this.color))),[this.valpha]),W)},o[W]=function(){for(var L=arguments.length,h=new Array(L),l=0;l<L;l++)h[l]=arguments[l];var t=h[0];return"number"===typeof t&&(t=f(h,i)),new o(t,W)}},S=0,C=Object.keys(x);S<C.length;S++)D();function e(W,i,L){W=Array.isArray(W)?W:[W];var h,t=l(W);try{for(t.s();!(h=t.n()).done;){var p=h.value;(s[p]||(s[p]=[]))[i]=L}}catch(W){t.e(W)}finally{t.f()}return W=W[0],function(h){var l;return void 0!==h?(L&&(h=L(h)),(l=this[W]()).color[i]=h,l):(l=this[W]().color[i],L&&(l=L(l)),l)}}function V(W){return function(i){return Math.max(0,Math.min(W,i))}}function c(W){return Array.isArray(W)?W:[W]}function f(W,i){for(var L=0;L<i;L++)"number"!==typeof W[L]&&(W[L]=0);return W}W.exports=o},20198:function(W,i,L){for(var h=L(27424).default,l=L(15987),t={},p=0,x=Object.keys(l);p<x.length;p++){var R=x[p];t[l[R]]=R}var z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};W.exports=z;for(var r=0,N=Object.keys(z);r<N.length;r++){var I=N[r];if(!("channels"in z[I]))throw new Error("missing channels property: "+I);if(!("labels"in z[I]))throw new Error("missing channel labels property: "+I);if(z[I].labels.length!==z[I].channels)throw new Error("channel and label counts mismatch: "+I);var s=z[I],o=s.channels,D=s.labels;delete z[I].channels,delete z[I].labels,Object.defineProperty(z[I],"channels",{value:o}),Object.defineProperty(z[I],"labels",{value:D})}z.rgb.hsl=function(W){var i,L=W[0]/255,h=W[1]/255,l=W[2]/255,t=Math.min(L,h,l),p=Math.max(L,h,l),x=p-t;p===t?i=0:L===p?i=(h-l)/x:h===p?i=2+(l-L)/x:l===p&&(i=4+(L-h)/x),(i=Math.min(60*i,360))<0&&(i+=360);var R=(t+p)/2;return[i,100*(p===t?0:R<=.5?x/(p+t):x/(2-p-t)),100*R]},z.rgb.hsv=function(W){var i,L,h,l,t,p=W[0]/255,x=W[1]/255,R=W[2]/255,z=Math.max(p,x,R),r=z-Math.min(p,x,R),N=function(W){return(z-W)/6/r+.5};return 0===r?(l=0,t=0):(t=r/z,i=N(p),L=N(x),h=N(R),p===z?l=h-L:x===z?l=1/3+i-h:R===z&&(l=2/3+L-i),l<0?l+=1:l>1&&(l-=1)),[360*l,100*t,100*z]},z.rgb.hwb=function(W){var i=W[0],L=W[1],h=W[2];return[z.rgb.hsl(W)[0],100*(1/255*Math.min(i,Math.min(L,h))),100*(h=1-1/255*Math.max(i,Math.max(L,h)))]},z.rgb.cmyk=function(W){var i=W[0]/255,L=W[1]/255,h=W[2]/255,l=Math.min(1-i,1-L,1-h);return[100*((1-i-l)/(1-l)||0),100*((1-L-l)/(1-l)||0),100*((1-h-l)/(1-l)||0),100*l]},z.rgb.keyword=function(W){var i=t[W];if(i)return i;for(var L,h,p,x=1/0,R=0,z=Object.keys(l);R<z.length;R++){var r=z[R],N=l[r],I=(h=W,p=N,Math.pow(h[0]-p[0],2)+Math.pow(h[1]-p[1],2)+Math.pow(h[2]-p[2],2));I<x&&(x=I,L=r)}return L},z.keyword.rgb=function(W){return l[W]},z.rgb.xyz=function(W){var i=W[0]/255,L=W[1]/255,h=W[2]/255;return[100*(.4124*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.3576*(L=L>.04045?Math.pow((L+.055)/1.055,2.4):L/12.92)+.1805*(h=h>.04045?Math.pow((h+.055)/1.055,2.4):h/12.92)),100*(.2126*i+.7152*L+.0722*h),100*(.0193*i+.1192*L+.9505*h)]},z.rgb.lab=function(W){var i=z.rgb.xyz(W),L=i[0],h=i[1],l=i[2];return h/=100,l/=108.883,L=(L/=95.047)>.008856?Math.pow(L,1/3):7.787*L+16/116,[116*(h=h>.008856?Math.pow(h,1/3):7.787*h+16/116)-16,500*(L-h),200*(h-(l=l>.008856?Math.pow(l,1/3):7.787*l+16/116))]},z.hsl.rgb=function(W){var i,L,h,l=W[0]/360,t=W[1]/100,p=W[2]/100;if(0===t)return[h=255*p,h,h];for(var x=2*p-(i=p<.5?p*(1+t):p+t-p*t),R=[0,0,0],z=0;z<3;z++)(L=l+1/3*-(z-1))<0&&L++,L>1&&L--,h=6*L<1?x+6*(i-x)*L:2*L<1?i:3*L<2?x+(i-x)*(2/3-L)*6:x,R[z]=255*h;return R},z.hsl.hsv=function(W){var i=W[0],L=W[1]/100,h=W[2]/100,l=L,t=Math.max(h,.01);return L*=(h*=2)<=1?h:2-h,l*=t<=1?t:2-t,[i,100*(0===h?2*l/(t+l):2*L/(h+L)),100*((h+L)/2)]},z.hsv.rgb=function(W){var i=W[0]/60,L=W[1]/100,h=W[2]/100,l=Math.floor(i)%6,t=i-Math.floor(i),p=255*h*(1-L),x=255*h*(1-L*t),R=255*h*(1-L*(1-t));switch(h*=255,l){case 0:return[h,R,p];case 1:return[x,h,p];case 2:return[p,h,R];case 3:return[p,x,h];case 4:return[R,p,h];case 5:return[h,p,x]}},z.hsv.hsl=function(W){var i,L,h=W[0],l=W[1]/100,t=W[2]/100,p=Math.max(t,.01);L=(2-l)*t;var x=(2-l)*p;return i=l*p,[h,100*(i=(i/=x<=1?x:2-x)||0),100*(L/=2)]},z.hwb.rgb=function(W){var i,L=W[0]/360,h=W[1]/100,l=W[2]/100,t=h+l;t>1&&(h/=t,l/=t);var p=Math.floor(6*L),x=1-l;i=6*L-p,0!==(1&p)&&(i=1-i);var R,z,r,N=h+i*(x-h);switch(p){default:case 6:case 0:R=x,z=N,r=h;break;case 1:R=N,z=x,r=h;break;case 2:R=h,z=x,r=N;break;case 3:R=h,z=N,r=x;break;case 4:R=N,z=h,r=x;break;case 5:R=x,z=h,r=N}return[255*R,255*z,255*r]},z.cmyk.rgb=function(W){var i=W[0]/100,L=W[1]/100,h=W[2]/100,l=W[3]/100;return[255*(1-Math.min(1,i*(1-l)+l)),255*(1-Math.min(1,L*(1-l)+l)),255*(1-Math.min(1,h*(1-l)+l))]},z.xyz.rgb=function(W){var i,L,h,l=W[0]/100,t=W[1]/100,p=W[2]/100;return L=-.9689*l+1.8758*t+.0415*p,h=.0557*l+-.204*t+1.057*p,i=(i=3.2406*l+-1.5372*t+-.4986*p)>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,L=L>.0031308?1.055*Math.pow(L,1/2.4)-.055:12.92*L,h=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:12.92*h,[255*(i=Math.min(Math.max(0,i),1)),255*(L=Math.min(Math.max(0,L),1)),255*(h=Math.min(Math.max(0,h),1))]},z.xyz.lab=function(W){var i=W[0],L=W[1],h=W[2];return L/=100,h/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(L=L>.008856?Math.pow(L,1/3):7.787*L+16/116)-16,500*(i-L),200*(L-(h=h>.008856?Math.pow(h,1/3):7.787*h+16/116))]},z.lab.xyz=function(W){var i,L,h,l=W[0];i=W[1]/500+(L=(l+16)/116),h=L-W[2]/200;var t=Math.pow(L,3),p=Math.pow(i,3),x=Math.pow(h,3);return L=t>.008856?t:(L-16/116)/7.787,i=p>.008856?p:(i-16/116)/7.787,h=x>.008856?x:(h-16/116)/7.787,[i*=95.047,L*=100,h*=108.883]},z.lab.lch=function(W){var i,L=W[0],h=W[1],l=W[2];return(i=360*Math.atan2(l,h)/2/Math.PI)<0&&(i+=360),[L,Math.sqrt(h*h+l*l),i]},z.lch.lab=function(W){var i=W[0],L=W[1],h=W[2]/360*2*Math.PI;return[i,L*Math.cos(h),L*Math.sin(h)]},z.rgb.ansi16=function(W){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=h(W,3),l=L[0],t=L[1],p=L[2],x=null===i?z.rgb.hsv(W)[2]:i;if(0===(x=Math.round(x/50)))return 30;var R=30+(Math.round(p/255)<<2|Math.round(t/255)<<1|Math.round(l/255));return 2===x&&(R+=60),R},z.hsv.ansi16=function(W){return z.rgb.ansi16(z.hsv.rgb(W),W[2])},z.rgb.ansi256=function(W){var i=W[0],L=W[1],h=W[2];return i===L&&L===h?i<8?16:i>248?231:Math.round((i-8)/247*24)+232:16+36*Math.round(i/255*5)+6*Math.round(L/255*5)+Math.round(h/255*5)},z.ansi16.rgb=function(W){var i=W%10;if(0===i||7===i)return W>50&&(i+=3.5),[i=i/10.5*255,i,i];var L=.5*(1+~~(W>50));return[(1&i)*L*255,(i>>1&1)*L*255,(i>>2&1)*L*255]},z.ansi256.rgb=function(W){if(W>=232){var i=10*(W-232)+8;return[i,i,i]}var L;return W-=16,[Math.floor(W/36)/5*255,Math.floor((L=W%36)/6)/5*255,L%6/5*255]},z.rgb.hex=function(W){var i=(((255&Math.round(W[0]))<<16)+((255&Math.round(W[1]))<<8)+(255&Math.round(W[2]))).toString(16).toUpperCase();return"000000".substring(i.length)+i},z.hex.rgb=function(W){var i=W.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!i)return[0,0,0];var L=i[0];3===i[0].length&&(L=L.split("").map((function(W){return W+W})).join(""));var h=parseInt(L,16);return[h>>16&255,h>>8&255,255&h]},z.rgb.hcg=function(W){var i,L=W[0]/255,h=W[1]/255,l=W[2]/255,t=Math.max(Math.max(L,h),l),p=Math.min(Math.min(L,h),l),x=t-p;return i=x<=0?0:t===L?(h-l)/x%6:t===h?2+(l-L)/x:4+(L-h)/x,i/=6,[360*(i%=1),100*x,100*(x<1?p/(1-x):0)]},z.hsl.hcg=function(W){var i=W[1]/100,L=W[2]/100,h=L<.5?2*i*L:2*i*(1-L),l=0;return h<1&&(l=(L-.5*h)/(1-h)),[W[0],100*h,100*l]},z.hsv.hcg=function(W){var i=W[1]/100,L=W[2]/100,h=i*L,l=0;return h<1&&(l=(L-h)/(1-h)),[W[0],100*h,100*l]},z.hcg.rgb=function(W){var i=W[0]/360,L=W[1]/100,h=W[2]/100;if(0===L)return[255*h,255*h,255*h];var l,t=[0,0,0],p=i%1*6,x=p%1,R=1-x;switch(Math.floor(p)){case 0:t[0]=1,t[1]=x,t[2]=0;break;case 1:t[0]=R,t[1]=1,t[2]=0;break;case 2:t[0]=0,t[1]=1,t[2]=x;break;case 3:t[0]=0,t[1]=R,t[2]=1;break;case 4:t[0]=x,t[1]=0,t[2]=1;break;default:t[0]=1,t[1]=0,t[2]=R}return l=(1-L)*h,[255*(L*t[0]+l),255*(L*t[1]+l),255*(L*t[2]+l)]},z.hcg.hsv=function(W){var i=W[1]/100,L=i+W[2]/100*(1-i),h=0;return L>0&&(h=i/L),[W[0],100*h,100*L]},z.hcg.hsl=function(W){var i=W[1]/100,L=W[2]/100*(1-i)+.5*i,h=0;return L>0&&L<.5?h=i/(2*L):L>=.5&&L<1&&(h=i/(2*(1-L))),[W[0],100*h,100*L]},z.hcg.hwb=function(W){var i=W[1]/100,L=i+W[2]/100*(1-i);return[W[0],100*(L-i),100*(1-L)]},z.hwb.hcg=function(W){var i=W[1]/100,L=1-W[2]/100,h=L-i,l=0;return h<1&&(l=(L-h)/(1-h)),[W[0],100*h,100*l]},z.apple.rgb=function(W){return[W[0]/65535*255,W[1]/65535*255,W[2]/65535*255]},z.rgb.apple=function(W){return[W[0]/255*65535,W[1]/255*65535,W[2]/255*65535]},z.gray.rgb=function(W){return[W[0]/100*255,W[0]/100*255,W[0]/100*255]},z.gray.hsl=function(W){return[0,0,W[0]]},z.gray.hsv=z.gray.hsl,z.gray.hwb=function(W){return[0,100,W[0]]},z.gray.cmyk=function(W){return[0,0,0,W[0]]},z.gray.lab=function(W){return[W[0],0,0]},z.gray.hex=function(W){var i=255&Math.round(W[0]/100*255),L=((i<<16)+(i<<8)+i).toString(16).toUpperCase();return"000000".substring(L.length)+L},z.rgb.gray=function(W){return[(W[0]+W[1]+W[2])/3/255*100]}},43143:function(W,i,L){var h=L(20198),l=L(63150),t={};Object.keys(h).forEach((function(W){t[W]={},Object.defineProperty(t[W],"channels",{value:h[W].channels}),Object.defineProperty(t[W],"labels",{value:h[W].labels});var i=l(W);Object.keys(i).forEach((function(L){var h=i[L];t[W][L]=function(W){var i=function(){for(var i=arguments.length,L=new Array(i),h=0;h<i;h++)L[h]=arguments[h];var l=L[0];if(void 0===l||null===l)return l;l.length>1&&(L=l);var t=W(L);if("object"===typeof t)for(var p=t.length,x=0;x<p;x++)t[x]=Math.round(t[x]);return t};return"conversion"in W&&(i.conversion=W.conversion),i}(h),t[W][L].raw=function(W){var i=function(){for(var i=arguments.length,L=new Array(i),h=0;h<i;h++)L[h]=arguments[h];var l=L[0];return void 0===l||null===l?l:(l.length>1&&(L=l),W(L))};return"conversion"in W&&(i.conversion=W.conversion),i}(h)}))})),W.exports=t},63150:function(W,i,L){var h=L(20198);function l(W){var i=function(){for(var W={},i=Object.keys(h),L=i.length,l=0;l<L;l++)W[i[l]]={distance:-1,parent:null};return W}(),L=[W];for(i[W].distance=0;L.length;)for(var l=L.pop(),t=Object.keys(h[l]),p=t.length,x=0;x<p;x++){var R=t[x],z=i[R];-1===z.distance&&(z.distance=i[l].distance+1,z.parent=l,L.unshift(R))}return i}function t(W,i){return function(L){return i(W(L))}}function p(W,i){for(var L=[i[W].parent,W],l=h[i[W].parent][W],p=i[W].parent;i[p].parent;)L.unshift(i[p].parent),l=t(h[i[p].parent][p],l),p=i[p].parent;return l.conversion=L,l}W.exports=function(W){for(var i=l(W),L={},h=Object.keys(i),t=h.length,x=0;x<t;x++){var R=h[x];null!==i[R].parent&&(L[R]=p(R,i))}return L}},15987:function(W){"use strict";W.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},37981:function(W,i,L){"use strict";var h=L(64687),l=L(56690).default,t=L(89728).default,p=this&&this.__createBinding||(Object.create?function(W,i,L,h){void 0===h&&(h=L);var l=Object.getOwnPropertyDescriptor(i,L);l&&!("get"in l?!i.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return i[L]}}),Object.defineProperty(W,h,l)}:function(W,i,L,h){void 0===h&&(h=L),W[h]=i[L]}),x=this&&this.__setModuleDefault||(Object.create?function(W,i){Object.defineProperty(W,"default",{enumerable:!0,value:i})}:function(W,i){W.default=i}),R=this&&this.__importStar||function(W){if(W&&W.__esModule)return W;var i={};if(null!=W)for(var L in W)"default"!==L&&Object.prototype.hasOwnProperty.call(W,L)&&p(i,W,L);return x(i,W),i},z=this&&this.__awaiter||function(W,i,L,h){return new(L||(L=Promise))((function(l,t){function p(W){try{R(h.next(W))}catch(W){t(W)}}function x(W){try{R(h.throw(W))}catch(W){t(W)}}function R(W){var i;W.done?l(W.value):(i=W.value,i instanceof L?i:new L((function(W){W(i)}))).then(p,x)}R((h=h.apply(W,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.Auth=i.Platform=void 0;var r=R(L(22494)),N=L(98216),I="colyseus-auth-token";!function(W){W.ios="ios",W.android="android"}(i.Platform||(i.Platform={}));var s=function(){function W(i){var L=this;l(this,W),this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=i.replace("ws","http"),(0,N.getItem)(I,(function(W){return L.token=W}))}return t(W,[{key:"hasToken",get:function(){return!!this.token}},{key:"login",value:function(){var W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return z(this,void 0,void 0,h.mark((function i(){var L,l,t;return h.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return L=Object.assign({},W),this.hasToken&&(L.token=this.token),i.next=4,this.request("post","/auth",L);case 4:for(t in l=i.sent,this.token=l.token,(0,N.setItem)(I,this.token),l)this.hasOwnProperty(t)&&(this[t]=l[t]);return this.registerPingService(),i.abrupt("return",this);case 10:case"end":return i.stop()}}),i,this)})))}},{key:"save",value:function(){return z(this,void 0,void 0,h.mark((function W(){return h.wrap((function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone});case 2:return W.abrupt("return",this);case 3:case"end":return W.stop()}}),W,this)})))}},{key:"getFriends",value:function(){return z(this,void 0,void 0,h.mark((function W(){return h.wrap((function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,this.request("get","/friends/all");case 2:return W.abrupt("return",W.sent);case 3:case"end":return W.stop()}}),W,this)})))}},{key:"getOnlineFriends",value:function(){return z(this,void 0,void 0,h.mark((function W(){return h.wrap((function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,this.request("get","/friends/online");case 2:return W.abrupt("return",W.sent);case 3:case"end":return W.stop()}}),W,this)})))}},{key:"getFriendRequests",value:function(){return z(this,void 0,void 0,h.mark((function W(){return h.wrap((function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,this.request("get","/friends/requests");case 2:return W.abrupt("return",W.sent);case 3:case"end":return W.stop()}}),W,this)})))}},{key:"sendFriendRequest",value:function(W){return z(this,void 0,void 0,h.mark((function i(){return h.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.request("post","/friends/requests",{userId:W});case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}),i,this)})))}},{key:"acceptFriendRequest",value:function(W){return z(this,void 0,void 0,h.mark((function i(){return h.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.request("put","/friends/requests",{userId:W});case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}),i,this)})))}},{key:"declineFriendRequest",value:function(W){return z(this,void 0,void 0,h.mark((function i(){return h.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.request("del","/friends/requests",{userId:W});case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}),i,this)})))}},{key:"blockUser",value:function(W){return z(this,void 0,void 0,h.mark((function i(){return h.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.request("post","/friends/block",{userId:W});case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}),i,this)})))}},{key:"unblockUser",value:function(W){return z(this,void 0,void 0,h.mark((function i(){return h.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.request("put","/friends/block",{userId:W});case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}),i,this)})))}},{key:"request",value:function(W,i){var L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return z(this,void 0,void 0,h.mark((function p(){var x,R,z,N;return h.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:for(R in t.Accept="application/json",this.hasToken&&(t.Authorization="Bearer "+this.token),x=[],L)x.push("".concat(R,"=").concat(L[R]));return z=x.length>0?"?".concat(x.join("&")):"",N={headers:t},l&&(N.body=l),h.next=9,r[W]("".concat(this.endpoint).concat(i).concat(z),N);case 9:return h.abrupt("return",h.sent.data);case 10:case"end":return h.stop()}}),p,this)})))}},{key:"logout",value:function(){this.token=void 0,(0,N.removeItem)(I),this.unregisterPingService()}},{key:"registerPingService",value:function(){var W=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((function(){return W.request("get","/auth")}),i)}},{key:"unregisterPingService",value:function(){clearInterval(this.keepOnlineInterval)}}]),W}();i.Auth=s},90442:function(W,i,L){"use strict";var h,l=L(27424).default,t=L(64687),p=L(89728).default,x=L(56690).default,R=L(66115).default,z=L(61655).default,r=L(26389).default,N=L(33496).default,I=this&&this.__awaiter||function(W,i,L,h){return new(L||(L=Promise))((function(l,t){function p(W){try{R(h.next(W))}catch(W){t(W)}}function x(W){try{R(h.throw(W))}catch(W){t(W)}}function R(W){var i;W.done?l(W.value):(i=W.value,i instanceof L?i:new L((function(W){W(i)}))).then(p,x)}R((h=h.apply(W,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.Client=i.MatchMakeError=void 0;var s=L(22494),o=L(33739),D=L(62898),S=function(W){z(L,W);var i=r(L);function L(W,h){var l;return x(this,L),(l=i.call(this,W)).code=h,Object.setPrototypeOf(R(l),L.prototype),l}return p(L)}(N(Error));i.MatchMakeError=S;var C="undefined"!==typeof window&&"undefined"!==typeof(null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567",e=function(){function W(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;if(x(this,W),"string"===typeof i){var L=new URL(i),h="https:"===L.protocol||"wss:"===L.protocol,l=Number(L.port||(h?443:80));this.settings={hostname:L.hostname,pathname:"/"!==L.pathname?L.pathname:"",port:l,secure:h}}else void 0===i.port&&(i.port=i.secure?443:80),void 0===i.pathname&&(i.pathname=""),this.settings=i}return p(W,[{key:"joinOrCreate",value:function(W){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,t.mark((function h(){return t.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.createMatchMakeRequest("joinOrCreate",W,i,L);case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}}),h,this)})))}},{key:"create",value:function(W){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,t.mark((function h(){return t.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.createMatchMakeRequest("create",W,i,L);case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}}),h,this)})))}},{key:"join",value:function(W){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,t.mark((function h(){return t.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.createMatchMakeRequest("join",W,i,L);case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}}),h,this)})))}},{key:"joinById",value:function(W){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;return I(this,void 0,void 0,t.mark((function h(){return t.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.createMatchMakeRequest("joinById",W,i,L);case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}}),h,this)})))}},{key:"reconnect",value:function(W,i){return I(this,void 0,void 0,t.mark((function L(){var h,p,x,R;return t.wrap((function(L){for(;;)switch(L.prev=L.next){case 0:if("string"!==typeof W||"string"!==typeof i){L.next=2;break}throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");case 2:return h=W.split(":"),p=l(h,2),x=p[0],R=p[1],L.next=5,this.createMatchMakeRequest("reconnect",x,{reconnectionToken:R},i);case 5:return L.abrupt("return",L.sent);case 6:case"end":return L.stop()}}),L,this)})))}},{key:"getAvailableRooms",value:function(){var W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return I(this,void 0,void 0,t.mark((function i(){return t.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,s.get)(this.getHttpEndpoint("".concat(W)),{headers:{Accept:"application/json"}});case 2:return i.abrupt("return",i.sent.data);case 3:case"end":return i.stop()}}),i,this)})))}},{key:"consumeSeatReservation",value:function(W,i,L){return I(this,void 0,void 0,t.mark((function h(){var l,p,x,R=this;return t.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:return(l=this.createRoom(W.room.name,i)).roomId=W.room.roomId,l.sessionId=W.sessionId,p={sessionId:l.sessionId},W.reconnectionToken&&(p.reconnectionToken=W.reconnectionToken),x=L||l,l.connect(this.buildEndpoint(W.room,p),W.devMode&&function(){return I(R,void 0,void 0,t.mark((function L(){var h,p,R=this;return t.wrap((function(L){for(;;)switch(L.prev=L.next){case 0:console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(l.roomId,"'...")),h=0,8,p=function L(){return I(R,void 0,void 0,t.mark((function p(){return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h++,t.prev=1,t.next=4,this.consumeSeatReservation(W,i,x);case 4:console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(l.roomId,"'")),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),h<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(h," out of ").concat(8,")")),setTimeout(L,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs."));case 10:case"end":return t.stop()}}),p,this,[[1,7]])})))},setTimeout(p,2e3);case 5:case"end":return L.stop()}}),L)})))},x),h.abrupt("return",new Promise((function(W,i){var L=function(W,L){return i(new o.ServerError(W,L))};x.onError.once(L),x.onJoin.once((function(){x.onError.remove(L),W(x)}))})));case 8:case"end":return h.stop()}}),h,this)})))}},{key:"createMatchMakeRequest",value:function(W,i){var L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},h=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return I(this,void 0,void 0,t.mark((function p(){var x;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.post)(this.getHttpEndpoint("".concat(W,"/").concat(i)),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(L)});case 2:if(!(x=t.sent.data).error){t.next=5;break}throw new S(x.error,x.code);case 5:return"reconnect"===W&&(x.reconnectionToken=L.reconnectionToken),t.next=8,this.consumeSeatReservation(x,h,l);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),p,this)})))}},{key:"createRoom",value:function(W,i){return new D.Room(W,i)}},{key:"buildEndpoint",value:function(W){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},L=[];for(var h in i)i.hasOwnProperty(h)&&L.push("".concat(h,"=").concat(i[h]));var l=this.settings.secure?"wss://":"ws://";return W.publicAddress?l+="".concat(W.publicAddress):l+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname),"".concat(l,"/").concat(W.processId,"/").concat(W.roomId,"?").concat(L.join("&"))}},{key:"getHttpEndpoint",value:function(){var W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname,"/matchmake/").concat(W)}},{key:"getEndpointPort",value:function(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""}}]),W}();i.Client=e},34787:function(W,i,L){"use strict";var h=L(56690).default,l=L(89728).default;Object.defineProperty(i,"__esModule",{value:!0}),i.Connection=void 0;var t=L(52054),p=function(){function W(){h(this,W),this.events={},this.transport=new t.WebSocketTransport(this.events)}return l(W,[{key:"send",value:function(W){this.transport.send(W)}},{key:"connect",value:function(W){this.transport.connect(W)}},{key:"close",value:function(W,i){this.transport.close(W,i)}},{key:"isOpen",get:function(){return this.transport.isOpen}}]),W}();i.Connection=p},65211:function(W,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.utf8Length=i.utf8Read=i.ErrorCode=i.Protocol=void 0,function(W){W[W.HANDSHAKE=9]="HANDSHAKE",W[W.JOIN_ROOM=10]="JOIN_ROOM",W[W.ERROR=11]="ERROR",W[W.LEAVE_ROOM=12]="LEAVE_ROOM",W[W.ROOM_DATA=13]="ROOM_DATA",W[W.ROOM_STATE=14]="ROOM_STATE",W[W.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",W[W.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",W[W.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(i.Protocol||(i.Protocol={})),function(W){W[W.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",W[W.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",W[W.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",W[W.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",W[W.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",W[W.AUTH_FAILED=4215]="AUTH_FAILED",W[W.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(i.ErrorCode||(i.ErrorCode={})),i.utf8Read=function(W,i){for(var L=W[i++],h="",l=0,t=i,p=i+L;t<p;t++){var x=W[t];if(0!==(128&x))if(192!==(224&x))if(224!==(240&x)){if(240!==(248&x))throw new Error("Invalid byte "+x.toString(16));(l=(7&x)<<18|(63&W[++t])<<12|(63&W[++t])<<6|(63&W[++t])<<0)>=65536?(l-=65536,h+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):h+=String.fromCharCode(l)}else h+=String.fromCharCode((15&x)<<12|(63&W[++t])<<6|(63&W[++t])<<0);else h+=String.fromCharCode((31&x)<<6|63&W[++t]);else h+=String.fromCharCode(x)}return h},i.utf8Length=function(){for(var W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=0,L=0,h=0,l=W.length;h<l;h++)(i=W.charCodeAt(h))<128?L+=1:i<2048?L+=2:i<55296||i>=57344?L+=3:(h++,L+=4);return L+1}},62898:function(W,i,L){"use strict";var h=L(56690).default,l=L(89728).default,t=this&&this.__createBinding||(Object.create?function(W,i,L,h){void 0===h&&(h=L);var l=Object.getOwnPropertyDescriptor(i,L);l&&!("get"in l?!i.__esModule:l.writable||l.configurable)||(l={enumerable:!0,get:function(){return i[L]}}),Object.defineProperty(W,h,l)}:function(W,i,L,h){void 0===h&&(h=L),W[h]=i[L]}),p=this&&this.__setModuleDefault||(Object.create?function(W,i){Object.defineProperty(W,"default",{enumerable:!0,value:i})}:function(W,i){W.default=i}),x=this&&this.__importStar||function(W){if(W&&W.__esModule)return W;var i={};if(null!=W)for(var L in W)"default"!==L&&Object.prototype.hasOwnProperty.call(W,L)&&t(i,W,L);return p(i,W),i};Object.defineProperty(i,"__esModule",{value:!0}),i.Room=void 0;var R=x(L(61627)),z=L(34787),r=L(65211),N=L(40765),I=L(8491),s=L(10025),o=L(50061),D=L(33739),S=function(){function W(i,L){var l=this;h(this,W),this.onStateChange=(0,s.createSignal)(),this.onError=(0,s.createSignal)(),this.onLeave=(0,s.createSignal)(),this.onJoin=(0,s.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,I.createNanoEvents)(),this.roomId=null,this.name=i,L&&(this.serializer=new((0,N.getSerializer)("schema")),this.rootSchema=L,this.serializer.state=new L),this.onError((function(W,i){var L;return null===(L=console.warn)||void 0===L?void 0:L.call(console,"colyseus.js - onError => (".concat(W,") ").concat(i))})),this.onLeave((function(){return l.removeAllListeners()}))}return l(W,[{key:"id",get:function(){return this.roomId}},{key:"connect",value:function(i,L){var h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,l=new z.Connection;h.connection=l,l.events.onmessage=W.prototype.onMessageCallback.bind(h),l.events.onclose=function(W){var i;if(!h.hasJoined)return null===(i=console.warn)||void 0===i||i.call(console,"Room connection was closed unexpectedly (".concat(W.code,"): ").concat(W.reason)),void h.onError.invoke(W.code,W.reason);W.code===D.CloseCode.DEVMODE_RESTART&&L?L():(h.onLeave.invoke(W.code),h.destroy())},l.events.onerror=function(W){var i;null===(i=console.warn)||void 0===i||i.call(console,"Room, onError (".concat(W.code,"): ").concat(W.reason)),h.onError.invoke(W.code,W.reason)},l.connect(i)}},{key:"leave",value:function(){var W=this,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((function(L){W.onLeave((function(W){return L(W)})),W.connection?i?W.connection.send([r.Protocol.LEAVE_ROOM]):W.connection.close():W.onLeave.invoke(D.CloseCode.CONSENTED)}))}},{key:"onMessage",value:function(W,i){return this.onMessageHandlers.on(this.getMessageHandlerKey(W),i)}},{key:"send",value:function(W,i){var L,h=[r.Protocol.ROOM_DATA];if("string"===typeof W?o.encode.string(h,W):o.encode.number(h,W),void 0!==i){var l=R.encode(i);(L=new Uint8Array(h.length+l.byteLength)).set(new Uint8Array(h),0),L.set(new Uint8Array(l),h.length)}else L=new Uint8Array(h);this.connection.send(L.buffer)}},{key:"sendBytes",value:function(W,i){var L,h=[r.Protocol.ROOM_DATA_BYTES];"string"===typeof W?o.encode.string(h,W):o.encode.number(h,W),(L=new Uint8Array(h.length+(i.byteLength||i.length))).set(new Uint8Array(h),0),L.set(new Uint8Array(i),h.length),this.connection.send(L.buffer)}},{key:"state",get:function(){return this.serializer.getState()}},{key:"removeAllListeners",value:function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}},{key:"onMessageCallback",value:function(W){var i=Array.from(new Uint8Array(W.data)),L=i[0];if(L===r.Protocol.JOIN_ROOM){var h=1,l=(0,r.utf8Read)(i,h);if(h+=(0,r.utf8Length)(l),this.serializerId=(0,r.utf8Read)(i,h),h+=(0,r.utf8Length)(this.serializerId),!this.serializer){var t=(0,N.getSerializer)(this.serializerId);this.serializer=new t}i.length>h&&this.serializer.handshake&&this.serializer.handshake(i,{offset:h}),this.reconnectionToken="".concat(this.roomId,":").concat(l),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([r.Protocol.JOIN_ROOM])}else if(L===r.Protocol.ERROR){var p={offset:1},x=o.decode.number(i,p),z=o.decode.string(i,p);this.onError.invoke(x,z)}else if(L===r.Protocol.LEAVE_ROOM)this.leave();else if(L===r.Protocol.ROOM_DATA_SCHEMA){var I={offset:1},s=this.serializer.getState().constructor._context.get(o.decode.number(i,I)),D=new s;D.decode(i,I),this.dispatchMessage(s,D)}else if(L===r.Protocol.ROOM_STATE)i.shift(),this.setState(i);else if(L===r.Protocol.ROOM_STATE_PATCH)i.shift(),this.patch(i);else if(L===r.Protocol.ROOM_DATA){var S={offset:1},C=o.decode.stringCheck(i,S)?o.decode.string(i,S):o.decode.number(i,S),e=i.length>S.offset?R.decode(W.data,S.offset):void 0;this.dispatchMessage(C,e)}else if(L===r.Protocol.ROOM_DATA_BYTES){var V={offset:1},c=o.decode.stringCheck(i,V)?o.decode.string(i,V):o.decode.number(i,V);this.dispatchMessage(c,new Uint8Array(i.slice(V.offset)))}}},{key:"setState",value:function(W){this.serializer.setState(W),this.onStateChange.invoke(this.serializer.getState())}},{key:"patch",value:function(W){this.serializer.patch(W),this.onStateChange.invoke(this.serializer.getState())}},{key:"dispatchMessage",value:function(W,i){var L,h=this.getMessageHandlerKey(W);this.onMessageHandlers.events[h]?this.onMessageHandlers.emit(h,i):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",W,i):null===(L=console.warn)||void 0===L||L.call(console,"colyseus.js: onMessage() not registered for type '".concat(W,"'."))}},{key:"destroy",value:function(){this.serializer&&this.serializer.teardown()}},{key:"getMessageHandlerKey",value:function(W){switch(typeof W){case"function":return"$".concat(W._typeid);case"string":return W;case"number":return"i".concat(W);default:throw new Error("invalid message type.")}}}]),W}();i.Room=S},98216:function(W,i){"use strict";var L;function h(){return L||(L="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(W,i){this.cache[W]=i},getItem:function(W){this.cache[W]},removeItem:function(W){delete this.cache[W]}}),L}Object.defineProperty(i,"__esModule",{value:!0}),i.getItem=i.removeItem=i.setItem=void 0,i.setItem=function(W,i){h().setItem(W,i)},i.removeItem=function(W){h().removeItem(W)},i.getItem=function(W,i){var L=h().getItem(W);"undefined"!==typeof Promise&&L instanceof Promise?L.then((function(W){return i(W)})):i(L)}},8491:function(W,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createNanoEvents=void 0;i.createNanoEvents=function(){return{emit:function(W){for(var i=this.events[W]||[],L=arguments.length,h=new Array(L>1?L-1:0),l=1;l<L;l++)h[l-1]=arguments[l];for(var t=0,p=i.length;t<p;t++)i[t].apply(i,h)},events:{},on:function(W,i){var L,h=this;return(null===(L=this.events[W])||void 0===L?void 0:L.push(i))||(this.events[W]=[i]),function(){var L;h.events[W]=null===(L=h.events[W])||void 0===L?void 0:L.filter((function(W){return i!==W}))}}}}},10025:function(W,i,L){"use strict";var h=L(56690).default,l=L(89728).default;Object.defineProperty(i,"__esModule",{value:!0}),i.createSignal=i.EventEmitter=void 0;var t=function(){function W(){h(this,W),this.handlers=[]}return l(W,[{key:"register",value:function(W){return this.handlers.push(W),this}},{key:"invoke",value:function(){for(var W=this,i=arguments.length,L=new Array(i),h=0;h<i;h++)L[h]=arguments[h];this.handlers.forEach((function(i){return i.apply(W,L)}))}},{key:"invokeAsync",value:function(){for(var W=this,i=arguments.length,L=new Array(i),h=0;h<i;h++)L[h]=arguments[h];return Promise.all(this.handlers.map((function(i){return i.apply(W,L)})))}},{key:"remove",value:function(W){var i=this.handlers.indexOf(W);this.handlers[i]=this.handlers[this.handlers.length-1],this.handlers.pop()}},{key:"clear",value:function(){this.handlers=[]}}]),W}();i.EventEmitter=t,i.createSignal=function(){var W=new t;function i(i){return W.register(i,null===this)}return i.once=function(i){W.register((function L(){for(var h=arguments.length,l=new Array(h),t=0;t<h;t++)l[t]=arguments[t];i.apply(this,l),W.remove(L)}))},i.remove=function(i){return W.remove(i)},i.invoke=function(){return W.invoke.apply(W,arguments)},i.invokeAsync=function(){return W.invokeAsync.apply(W,arguments)},i.clear=function(){return W.clear()},i}},33739:function(W,i,L){"use strict";var h=L(89728).default,l=L(56690).default,t=L(61655).default,p=L(26389).default,x=L(33496).default;Object.defineProperty(i,"__esModule",{value:!0}),i.ServerError=i.CloseCode=void 0,function(W){W[W.CONSENTED=4e3]="CONSENTED",W[W.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(i.CloseCode||(i.CloseCode={}));var R=function(W){t(L,W);var i=p(L);function L(W,h){var t;return l(this,L),(t=i.call(this,h)).name="ServerError",t.code=W,t}return h(L)}(x(Error));i.ServerError=R},21021:function(W,i,L){"use strict";i.b=void 0,L(80876);var h=L(90442);Object.defineProperty(i,"b",{enumerable:!0,get:function(){return h.Client}});var l=L(65211);var t=L(62898);var p=L(37981);var x=L(74042);var R=L(94183),z=L(40765);(0,z.registerSerializer)("schema",x.SchemaSerializer),(0,z.registerSerializer)("none",R.NoneSerializer)},80876:function(){ArrayBuffer.isView||(ArrayBuffer.isView=function(W){return null!==W&&"object"===typeof W&&W.buffer instanceof ArrayBuffer}),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},61627:function(W,i){"use strict";function L(W,i){if(this._offset=i,W instanceof ArrayBuffer)this._buffer=W,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(W))throw new Error("Invalid argument");this._buffer=W.buffer,this._view=new DataView(this._buffer,W.byteOffset,W.byteLength)}}Object.defineProperty(i,"__esModule",{value:!0}),i.decode=i.encode=void 0,L.prototype._array=function(W){for(var i=new Array(W),L=0;L<W;L++)i[L]=this._parse();return i},L.prototype._map=function(W){for(var i={},L=0;L<W;L++)i[this._parse()]=this._parse();return i},L.prototype._str=function(W){var i=function(W,i,L){for(var h="",l=0,t=i,p=i+L;t<p;t++){var x=W.getUint8(t);if(0!==(128&x))if(192!==(224&x))if(224!==(240&x)){if(240!==(248&x))throw new Error("Invalid byte "+x.toString(16));(l=(7&x)<<18|(63&W.getUint8(++t))<<12|(63&W.getUint8(++t))<<6|(63&W.getUint8(++t))<<0)>=65536?(l-=65536,h+=String.fromCharCode(55296+(l>>>10),56320+(1023&l))):h+=String.fromCharCode(l)}else h+=String.fromCharCode((15&x)<<12|(63&W.getUint8(++t))<<6|(63&W.getUint8(++t))<<0);else h+=String.fromCharCode((31&x)<<6|63&W.getUint8(++t));else h+=String.fromCharCode(x)}return h}(this._view,this._offset,W);return this._offset+=W,i},L.prototype._bin=function(W){var i=this._buffer.slice(this._offset,this._offset+W);return this._offset+=W,i},L.prototype._parse=function(){var W,i=this._view.getUint8(this._offset++),L=0,h=0,l=0,t=0;if(i<192)return i<128?i:i<144?this._map(15&i):i<160?this._array(15&i):this._str(31&i);if(i>223)return-1*(255-i+1);switch(i){case 192:return null;case 194:return!1;case 195:return!0;case 196:return L=this._view.getUint8(this._offset),this._offset+=1,this._bin(L);case 197:return L=this._view.getUint16(this._offset),this._offset+=2,this._bin(L);case 198:return L=this._view.getUint32(this._offset),this._offset+=4,this._bin(L);case 199:if(L=this._view.getUint8(this._offset),h=this._view.getInt8(this._offset+1),this._offset+=2,-1===h){var p=this._view.getUint32(this._offset);return l=this._view.getInt32(this._offset+4),t=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*l+t)+p/1e6)}return[h,this._bin(L)];case 200:return L=this._view.getUint16(this._offset),h=this._view.getInt8(this._offset+2),this._offset+=3,[h,this._bin(L)];case 201:return L=this._view.getUint32(this._offset),h=this._view.getInt8(this._offset+4),this._offset+=5,[h,this._bin(L)];case 202:return W=this._view.getFloat32(this._offset),this._offset+=4,W;case 203:return W=this._view.getFloat64(this._offset),this._offset+=8,W;case 204:return W=this._view.getUint8(this._offset),this._offset+=1,W;case 205:return W=this._view.getUint16(this._offset),this._offset+=2,W;case 206:return W=this._view.getUint32(this._offset),this._offset+=4,W;case 207:return l=this._view.getUint32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,l+t;case 208:return W=this._view.getInt8(this._offset),this._offset+=1,W;case 209:return W=this._view.getInt16(this._offset),this._offset+=2,W;case 210:return W=this._view.getInt32(this._offset),this._offset+=4,W;case 211:return l=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,l+t;case 212:return h=this._view.getInt8(this._offset),this._offset+=1,0===h?void(this._offset+=1):[h,this._bin(1)];case 213:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(2)];case 214:return h=this._view.getInt8(this._offset),this._offset+=1,-1===h?(W=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*W)):[h,this._bin(4)];case 215:return h=this._view.getInt8(this._offset),this._offset+=1,0===h?(l=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(l+t)):-1===h?(l=this._view.getUint32(this._offset),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&l)+t)+(l>>>2)/1e6)):[h,this._bin(8)];case 216:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(16)];case 217:return L=this._view.getUint8(this._offset),this._offset+=1,this._str(L);case 218:return L=this._view.getUint16(this._offset),this._offset+=2,this._str(L);case 219:return L=this._view.getUint32(this._offset),this._offset+=4,this._str(L);case 220:return L=this._view.getUint16(this._offset),this._offset+=2,this._array(L);case 221:return L=this._view.getUint32(this._offset),this._offset+=4,this._array(L);case 222:return L=this._view.getUint16(this._offset),this._offset+=2,this._map(L);case 223:return L=this._view.getUint32(this._offset),this._offset+=4,this._map(L)}throw new Error("Could not parse")},i.decode=function(W){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=new L(W,i),l=h._parse();if(h._offset!==W.byteLength)throw new Error(W.byteLength-h._offset+" trailing bytes");return l};function h(W,i,L){for(var h=0,l=0,t=L.length;l<t;l++)(h=L.charCodeAt(l))<128?W.setUint8(i++,h):h<2048?(W.setUint8(i++,192|h>>6),W.setUint8(i++,128|63&h)):h<55296||h>=57344?(W.setUint8(i++,224|h>>12),W.setUint8(i++,128|h>>6&63),W.setUint8(i++,128|63&h)):(l++,h=65536+((1023&h)<<10|1023&L.charCodeAt(l)),W.setUint8(i++,240|h>>18),W.setUint8(i++,128|h>>12&63),W.setUint8(i++,128|h>>6&63),W.setUint8(i++,128|63&h))}function l(W,i,L){var h=typeof L,t=0,p=0,x=0,R=0,z=0,r=0;if("string"===h){if(z=function(W){for(var i=0,L=0,h=0,l=W.length;h<l;h++)(i=W.charCodeAt(h))<128?L+=1:i<2048?L+=2:i<55296||i>=57344?L+=3:(h++,L+=4);return L}(L),z<32)W.push(160|z),r=1;else if(z<256)W.push(217,z),r=2;else if(z<65536)W.push(218,z>>8,z),r=3;else{if(!(z<4294967296))throw new Error("String too long");W.push(219,z>>24,z>>16,z>>8,z),r=5}return i.push({_str:L,_length:z,_offset:W.length}),r+z}if("number"===h)return Math.floor(L)===L&&isFinite(L)?L>=0?L<128?(W.push(L),1):L<256?(W.push(204,L),2):L<65536?(W.push(205,L>>8,L),3):L<4294967296?(W.push(206,L>>24,L>>16,L>>8,L),5):(x=L/Math.pow(2,32)>>0,R=L>>>0,W.push(207,x>>24,x>>16,x>>8,x,R>>24,R>>16,R>>8,R),9):L>=-32?(W.push(L),1):L>=-128?(W.push(208,L),2):L>=-32768?(W.push(209,L>>8,L),3):L>=-2147483648?(W.push(210,L>>24,L>>16,L>>8,L),5):(x=Math.floor(L/Math.pow(2,32)),R=L>>>0,W.push(211,x>>24,x>>16,x>>8,x,R>>24,R>>16,R>>8,R),9):(W.push(203),i.push({_float:L,_length:8,_offset:W.length}),9);if("object"===h){if(null===L)return W.push(192),1;if(Array.isArray(L)){if((z=L.length)<16)W.push(144|z),r=1;else if(z<65536)W.push(220,z>>8,z),r=3;else{if(!(z<4294967296))throw new Error("Array too large");W.push(221,z>>24,z>>16,z>>8,z),r=5}for(t=0;t<z;t++)r+=l(W,i,L[t]);return r}if(L instanceof Date){var N=L.getTime(),I=Math.floor(N/1e3),s=1e6*(N-1e3*I);return I>=0&&s>=0&&I<=17179869183?0===s&&I<=4294967295?(W.push(214,255,I>>24,I>>16,I>>8,I),6):(x=I/4294967296,R=4294967295&I,W.push(215,255,s>>22,s>>14,s>>6,x,R>>24,R>>16,R>>8,R),10):(x=Math.floor(I/4294967296),R=I>>>0,W.push(199,12,255,s>>24,s>>16,s>>8,s,x>>24,x>>16,x>>8,x,R>>24,R>>16,R>>8,R),15)}if(L instanceof ArrayBuffer){if((z=L.byteLength)<256)W.push(196,z),r=2;else if(z<65536)W.push(197,z>>8,z),r=3;else{if(!(z<4294967296))throw new Error("Buffer too large");W.push(198,z>>24,z>>16,z>>8,z),r=5}return i.push({_bin:L,_length:z,_offset:W.length}),r+z}if("function"===typeof L.toJSON)return l(W,i,L.toJSON());var o=[],D="",S=Object.keys(L);for(t=0,p=S.length;t<p;t++)void 0!==L[D=S[t]]&&"function"!==typeof L[D]&&o.push(D);if((z=o.length)<16)W.push(128|z),r=1;else if(z<65536)W.push(222,z>>8,z),r=3;else{if(!(z<4294967296))throw new Error("Object too large");W.push(223,z>>24,z>>16,z>>8,z),r=5}for(t=0;t<z;t++)r+=l(W,i,D=o[t]),r+=l(W,i,L[D]);return r}if("boolean"===h)return W.push(L?195:194),1;if("undefined"===h)return W.push(192),1;if("function"===typeof L.toJSON)return l(W,i,L.toJSON());throw new Error("Could not encode")}i.encode=function(W){var i=[],L=[],t=l(i,L,W),p=new ArrayBuffer(t),x=new DataView(p),R=0,z=0,r=-1;L.length>0&&(r=L[0]._offset);for(var N,I=0,s=0,o=0,D=i.length;o<D;o++)if(x.setUint8(z+o,i[o]),o+1===r){if(I=(N=L[R])._length,s=z+r,N._bin)for(var S=new Uint8Array(N._bin),C=0;C<I;C++)x.setUint8(s+C,S[C]);else N._str?h(x,s,N._str):void 0!==N._float&&x.setFloat64(s,N._float);z+=I,L[++R]&&(r=L[R]._offset)}return p}},94183:function(W,i,L){"use strict";var h=L(56690).default,l=L(89728).default;Object.defineProperty(i,"__esModule",{value:!0}),i.NoneSerializer=void 0;var t=function(){function W(){h(this,W)}return l(W,[{key:"setState",value:function(W){}},{key:"getState",value:function(){return null}},{key:"patch",value:function(W){}},{key:"teardown",value:function(){}},{key:"handshake",value:function(W){}}]),W}();i.NoneSerializer=t},74042:function(W,i,L){"use strict";var h=L(56690).default,l=L(89728).default;Object.defineProperty(i,"__esModule",{value:!0}),i.SchemaSerializer=void 0;var t=L(50061),p=function(){function W(){h(this,W)}return l(W,[{key:"setState",value:function(W){return this.state.decode(W)}},{key:"getState",value:function(){return this.state}},{key:"patch",value:function(W){return this.state.decode(W)}},{key:"teardown",value:function(){var W,i;null===(i=null===(W=this.state)||void 0===W?void 0:W.$changes)||void 0===i||i.root.clearRefs()}},{key:"handshake",value:function(W,i){this.state?(new t.Reflection).decode(W,i):this.state=t.Reflection.decode(W,i)}}]),W}();i.SchemaSerializer=p},40765:function(W,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getSerializer=i.registerSerializer=void 0;var L={};i.registerSerializer=function(W,i){L[W]=i},i.getSerializer=function(W){var i=L[W];if(!i)throw new Error("missing serializer: "+W);return i}},52054:function(W,i,L){"use strict";var h=L(56690).default,l=L(89728).default,t=this&&this.__importDefault||function(W){return W&&W.__esModule?W:{default:W}};Object.defineProperty(i,"__esModule",{value:!0}),i.WebSocketTransport=void 0;var p=t(L(32299)),x=globalThis.WebSocket||p.default,R=function(){function W(i){h(this,W),this.events=i}return l(W,[{key:"send",value:function(W){W instanceof ArrayBuffer?this.ws.send(W):Array.isArray(W)&&this.ws.send(new Uint8Array(W).buffer)}},{key:"connect",value:function(W){this.ws=new x(W,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}},{key:"close",value:function(W,i){this.ws.close(W,i)}},{key:"isOpen",get:function(){return this.ws.readyState===x.OPEN}}]),W}();i.WebSocketTransport=R},32299:function(W){"use strict";W.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},69113:function(W,i,L){"use strict";var h=h||function(W,i){var L={},h=L.lib={},l=function(){},t=h.Base={extend:function(W){l.prototype=this;var i=new l;return W&&i.mixIn(W),i.hasOwnProperty("init")||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var W=this.extend();return W.init.apply(W,arguments),W},init:function(){},mixIn:function(W){for(var i in W)W.hasOwnProperty(i)&&(this[i]=W[i]);W.hasOwnProperty("toString")&&(this.toString=W.toString)},clone:function(){return this.init.prototype.extend(this)}},p=h.WordArray=t.extend({init:function(W,i){W=this.words=W||[],this.sigBytes=undefined!=i?i:4*W.length},toString:function(W){return(W||R).stringify(this)},concat:function(W){var i=this.words,L=W.words,h=this.sigBytes;if(W=W.sigBytes,this.clamp(),h%4)for(var l=0;l<W;l++)i[h+l>>>2]|=(L[l>>>2]>>>24-l%4*8&255)<<24-(h+l)%4*8;else if(65535<L.length)for(l=0;l<W;l+=4)i[h+l>>>2]=L[l>>>2];else i.push.apply(i,L);return this.sigBytes+=W,this},clamp:function(){var i=this.words,L=this.sigBytes;i[L>>>2]&=4294967295<<32-L%4*8,i.length=W.ceil(L/4)},clone:function(){var W=t.clone.call(this);return W.words=this.words.slice(0),W},random:function(i){for(var L=[],h=0;h<i;h+=4)L.push(4294967296*W.random()|0);return new p.init(L,i)}}),x=L.enc={},R=x.Hex={stringify:function(W){var i=W.words;W=W.sigBytes;for(var L=[],h=0;h<W;h++){var l=i[h>>>2]>>>24-h%4*8&255;L.push((l>>>4).toString(16)),L.push((15&l).toString(16))}return L.join("")},parse:function(W){for(var i=W.length,L=[],h=0;h<i;h+=2)L[h>>>3]|=parseInt(W.substr(h,2),16)<<24-h%8*4;return new p.init(L,i/2)}},z=x.Latin1={stringify:function(W){var i=W.words;W=W.sigBytes;for(var L=[],h=0;h<W;h++)L.push(String.fromCharCode(i[h>>>2]>>>24-h%4*8&255));return L.join("")},parse:function(W){for(var i=W.length,L=[],h=0;h<i;h++)L[h>>>2]|=(255&W.charCodeAt(h))<<24-h%4*8;return new p.init(L,i)}},r=x.Utf8={stringify:function(W){try{return decodeURIComponent(escape(z.stringify(W)))}catch(W){throw Error("Malformed UTF-8 data")}},parse:function(W){return z.parse(unescape(encodeURIComponent(W)))}},N=h.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new p.init,this._nDataBytes=0},_append:function(W){"string"==typeof W&&(W=r.parse(W)),this._data.concat(W),this._nDataBytes+=W.sigBytes},_process:function(i){var L=this._data,h=L.words,l=L.sigBytes,t=this.blockSize,x=l/(4*t);if(i=(x=i?W.ceil(x):W.max((0|x)-this._minBufferSize,0))*t,l=W.min(4*i,l),i){for(var R=0;R<i;R+=t)this._doProcessBlock(h,R);R=h.splice(0,i),L.sigBytes-=l}return new p.init(R,l)},clone:function(){var W=t.clone.call(this);return W._data=this._data.clone(),W},_minBufferSize:0});h.Hasher=N.extend({cfg:t.extend(),init:function(W){this.cfg=this.cfg.extend(W),this.reset()},reset:function(){N.reset.call(this),this._doReset()},update:function(W){return this._append(W),this._process(),this},finalize:function(W){return W&&this._append(W),this._doFinalize()},blockSize:16,_createHelper:function(W){return function(i,L){return new W.init(L).finalize(i)}},_createHmacHelper:function(W){return function(i,L){return new I.HMAC.init(W,L).finalize(i)}}});var I=L.algo={};return L}(Math);!function(W){for(var i=h,L=(t=i.lib).WordArray,l=t.Hasher,t=i.algo,p=[],x=[],R=function(W){return 4294967296*(W-(0|W))|0},z=2,r=0;64>r;){var N;W:{N=z;for(var I=W.sqrt(N),s=2;s<=I;s++)if(!(N%s)){N=!1;break W}N=!0}N&&(8>r&&(p[r]=R(W.pow(z,.5))),x[r]=R(W.pow(z,1/3)),r++),z++}var o=[];t=t.SHA256=l.extend({_doReset:function(){this._hash=new L.init(p.slice(0))},_doProcessBlock:function(W,i){for(var L=this._hash.words,h=L[0],l=L[1],t=L[2],p=L[3],R=L[4],z=L[5],r=L[6],N=L[7],I=0;64>I;I++){if(16>I)o[I]=0|W[i+I];else{var s=o[I-15],D=o[I-2];o[I]=((s<<25|s>>>7)^(s<<14|s>>>18)^s>>>3)+o[I-7]+((D<<15|D>>>17)^(D<<13|D>>>19)^D>>>10)+o[I-16]}s=N+((R<<26|R>>>6)^(R<<21|R>>>11)^(R<<7|R>>>25))+(R&z^~R&r)+x[I]+o[I],D=((h<<30|h>>>2)^(h<<19|h>>>13)^(h<<10|h>>>22))+(h&l^h&t^l&t),N=r,r=z,z=R,R=p+s|0,p=t,t=l,l=h,h=s+D|0}L[0]=L[0]+h|0,L[1]=L[1]+l|0,L[2]=L[2]+t|0,L[3]=L[3]+p|0,L[4]=L[4]+R|0,L[5]=L[5]+z|0,L[6]=L[6]+r|0,L[7]=L[7]+N|0},_doFinalize:function(){var i=this._data,L=i.words,h=8*this._nDataBytes,l=8*i.sigBytes;return L[l>>>5]|=128<<24-l%32,L[14+(l+64>>>9<<4)]=W.floor(h/4294967296),L[15+(l+64>>>9<<4)]=h,i.sigBytes=4*L.length,this._process(),this._hash},clone:function(){var W=l.clone.call(this);return W._hash=this._hash.clone(),W}});i.SHA256=l._createHelper(t),i.HmacSHA256=l._createHmacHelper(t)}(Math),function(){var W=h,i=W.enc.Utf8;W.algo.HMAC=W.lib.Base.extend({init:function(W,L){W=this._hasher=new W.init,"string"==typeof L&&(L=i.parse(L));var h=W.blockSize,l=4*h;L.sigBytes>l&&(L=W.finalize(L)),L.clamp();for(var t=this._oKey=L.clone(),p=this._iKey=L.clone(),x=t.words,R=p.words,z=0;z<h;z++)x[z]^=1549556828,R[z]^=909522486;t.sigBytes=p.sigBytes=l,this.reset()},reset:function(){var W=this._hasher;W.reset(),W.update(this._iKey)},update:function(W){return this._hasher.update(W),this},finalize:function(W){var i=this._hasher;return W=i.finalize(W),i.reset(),i.finalize(this._oKey.clone().concat(W))}})}(),function(){var W=h,i=W.lib.WordArray;W.enc.Base64={stringify:function(W){var i=W.words,L=W.sigBytes,h=this._map;W.clamp(),W=[];for(var l=0;l<L;l+=3)for(var t=(i[l>>>2]>>>24-l%4*8&255)<<16|(i[l+1>>>2]>>>24-(l+1)%4*8&255)<<8|i[l+2>>>2]>>>24-(l+2)%4*8&255,p=0;4>p&&l+.75*p<L;p++)W.push(h.charAt(t>>>6*(3-p)&63));if(i=h.charAt(64))for(;W.length%4;)W.push(i);return W.join("")},parse:function(W){var L=W.length,h=this._map;(l=h.charAt(64))&&(-1!=(l=W.indexOf(l))&&(L=l));for(var l=[],t=0,p=0;p<L;p++)if(p%4){var x=h.indexOf(W.charAt(p-1))<<p%4*2,R=h.indexOf(W.charAt(p))>>>6-p%4*2;l[t>>>2]|=(x|R)<<24-t%4*8,t++}return i.create(l,t)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(W){!function(W){W[W.Undefined=0]="Undefined",W[W.Debug=1]="Debug",W[W.Info=2]="Info",W[W.Warning=3]="Warning",W[W.Error=4]="Error",W[W.Critical=5]="Critical"}(W.EGAErrorSeverity||(W.EGAErrorSeverity={})),function(W){W[W.Undefined=0]="Undefined",W[W.Start=1]="Start",W[W.Complete=2]="Complete",W[W.Fail=3]="Fail"}(W.EGAProgressionStatus||(W.EGAProgressionStatus={})),function(W){W[W.Undefined=0]="Undefined",W[W.Source=1]="Source",W[W.Sink=2]="Sink"}(W.EGAResourceFlowType||(W.EGAResourceFlowType={})),function(W){W[W.Undefined=0]="Undefined",W[W.Clicked=1]="Clicked",W[W.Show=2]="Show",W[W.FailedShow=3]="FailedShow",W[W.RewardReceived=4]="RewardReceived"}(W.EGAAdAction||(W.EGAAdAction={})),function(W){W[W.Undefined=0]="Undefined",W[W.Unknown=1]="Unknown",W[W.Offline=2]="Offline",W[W.NoFill=3]="NoFill",W[W.InternalError=4]="InternalError",W[W.InvalidRequest=5]="InvalidRequest",W[W.UnableToPrecache=6]="UnableToPrecache"}(W.EGAAdError||(W.EGAAdError={})),function(W){W[W.Undefined=0]="Undefined",W[W.Video=1]="Video",W[W.RewardedVideo=2]="RewardedVideo",W[W.Playable=3]="Playable",W[W.Interstitial=4]="Interstitial",W[W.OfferWall=5]="OfferWall",W[W.Banner=6]="Banner"}(W.EGAAdType||(W.EGAAdType={})),function(W){!function(W){W[W.NoResponse=0]="NoResponse",W[W.BadResponse=1]="BadResponse",W[W.RequestTimeout=2]="RequestTimeout",W[W.JsonEncodeFailed=3]="JsonEncodeFailed",W[W.JsonDecodeFailed=4]="JsonDecodeFailed",W[W.InternalServerError=5]="InternalServerError",W[W.BadRequest=6]="BadRequest",W[W.Unauthorized=7]="Unauthorized",W[W.UnknownResponseCode=8]="UnknownResponseCode",W[W.Ok=9]="Ok",W[W.Created=10]="Created"}(W.EGAHTTPApiResponse||(W.EGAHTTPApiResponse={}))}(W.http||(W.http={})),function(W){!function(W){W[W.Undefined=0]="Undefined",W[W.EventValidation=1]="EventValidation",W[W.Database=2]="Database",W[W.Init=3]="Init",W[W.Http=4]="Http",W[W.Json=5]="Json"}(W.EGASdkErrorCategory||(W.EGASdkErrorCategory={})),function(W){W[W.Undefined=0]="Undefined",W[W.BusinessEvent=1]="BusinessEvent",W[W.ResourceEvent=2]="ResourceEvent",W[W.ProgressionEvent=3]="ProgressionEvent",W[W.DesignEvent=4]="DesignEvent",W[W.ErrorEvent=5]="ErrorEvent",W[W.InitHttp=9]="InitHttp",W[W.EventsHttp=10]="EventsHttp",W[W.ProcessEvents=11]="ProcessEvents",W[W.AddEventsToStore=12]="AddEventsToStore",W[W.AdEvent=20]="AdEvent"}(W.EGASdkErrorArea||(W.EGASdkErrorArea={})),function(W){W[W.Undefined=0]="Undefined",W[W.InvalidCurrency=1]="InvalidCurrency",W[W.InvalidShortString=2]="InvalidShortString",W[W.InvalidEventPartLength=3]="InvalidEventPartLength",W[W.InvalidEventPartCharacters=4]="InvalidEventPartCharacters",W[W.InvalidStore=5]="InvalidStore",W[W.InvalidFlowType=6]="InvalidFlowType",W[W.StringEmptyOrNull=7]="StringEmptyOrNull",W[W.NotFoundInAvailableCurrencies=8]="NotFoundInAvailableCurrencies",W[W.InvalidAmount=9]="InvalidAmount",W[W.NotFoundInAvailableItemTypes=10]="NotFoundInAvailableItemTypes",W[W.WrongProgressionOrder=11]="WrongProgressionOrder",W[W.InvalidEventIdLength=12]="InvalidEventIdLength",W[W.InvalidEventIdCharacters=13]="InvalidEventIdCharacters",W[W.InvalidProgressionStatus=15]="InvalidProgressionStatus",W[W.InvalidSeverity=16]="InvalidSeverity",W[W.InvalidLongString=17]="InvalidLongString",W[W.DatabaseTooLarge=18]="DatabaseTooLarge",W[W.DatabaseOpenOrCreate=19]="DatabaseOpenOrCreate",W[W.JsonError=25]="JsonError",W[W.FailHttpJsonDecode=29]="FailHttpJsonDecode",W[W.FailHttpJsonEncode=30]="FailHttpJsonEncode",W[W.InvalidAdAction=31]="InvalidAdAction",W[W.InvalidAdType=32]="InvalidAdType",W[W.InvalidString=33]="InvalidString"}(W.EGASdkErrorAction||(W.EGASdkErrorAction={})),function(W){W[W.Undefined=0]="Undefined",W[W.Currency=1]="Currency",W[W.CartType=2]="CartType",W[W.ItemType=3]="ItemType",W[W.ItemId=4]="ItemId",W[W.Store=5]="Store",W[W.FlowType=6]="FlowType",W[W.Amount=7]="Amount",W[W.Progression01=8]="Progression01",W[W.Progression02=9]="Progression02",W[W.Progression03=10]="Progression03",W[W.EventId=11]="EventId",W[W.ProgressionStatus=12]="ProgressionStatus",W[W.Severity=13]="Severity",W[W.Message=14]="Message",W[W.AdAction=15]="AdAction",W[W.AdType=16]="AdType",W[W.AdSdkName=17]="AdSdkName",W[W.AdPlacement=18]="AdPlacement"}(W.EGASdkErrorParameter||(W.EGASdkErrorParameter={}))}(W.events||(W.events={}))}(l||(l={}));var l;l.EGAErrorSeverity,l.EGAProgressionStatus,l.EGAResourceFlowType;!function(W){!function(W){var i;!function(W){W[W.Error=0]="Error",W[W.Warning=1]="Warning",W[W.Info=2]="Info",W[W.Debug=3]="Debug"}(i||(i={}));var L=function(){function W(){W.debugEnabled=!1}return W.setInfoLog=function(i){W.instance.infoLogEnabled=i},W.setVerboseLog=function(i){W.instance.infoLogVerboseEnabled=i},W.i=function(L){if(W.instance.infoLogEnabled){var h="Info/"+W.Tag+": "+L;W.instance.sendNotificationMessage(h,i.Info)}},W.w=function(L){var h="Warning/"+W.Tag+": "+L;W.instance.sendNotificationMessage(h,i.Warning)},W.e=function(L){var h="Error/"+W.Tag+": "+L;W.instance.sendNotificationMessage(h,i.Error)},W.ii=function(L){if(W.instance.infoLogVerboseEnabled){var h="Verbose/"+W.Tag+": "+L;W.instance.sendNotificationMessage(h,i.Info)}},W.d=function(L){if(W.debugEnabled){var h="Debug/"+W.Tag+": "+L;W.instance.sendNotificationMessage(h,i.Debug)}},W.prototype.sendNotificationMessage=function(W,L){switch(L){case i.Error:console.error(W);break;case i.Warning:console.warn(W);break;case i.Debug:"function"===typeof console.debug?console.debug(W):console.log(W);break;case i.Info:console.log(W)}},W.instance=new W,W.Tag="GameAnalytics",W}();W.GALogger=L}(W.logging||(W.logging={}))}(l||(l={})),function(W){!function(i){var L=W.logging.GALogger,l=function(){function W(){}return W.getHmac=function(W,i){var L=h.HmacSHA256(i,W);return h.enc.Base64.stringify(L)},W.stringMatch=function(W,i){return!(!W||!i)&&i.test(W)},W.joinStringArray=function(W,i){for(var L="",h=0,l=W.length;h<l;h++)h>0&&(L+=i),L+=W[h];return L},W.stringArrayContainsString=function(W,i){if(0===W.length)return!1;for(var L in W)if(W[L]===i)return!0;return!1},W.encode64=function(i){i=encodeURI(i);var L,h,l,t,p,x="",R=0,z=0,r=0;do{l=(L=i.charCodeAt(r++))>>2,t=(3&L)<<4|(h=i.charCodeAt(r++))>>4,p=(15&h)<<2|(R=i.charCodeAt(r++))>>6,z=63&R,isNaN(h)?p=z=64:isNaN(R)&&(z=64),x=x+W.keyStr.charAt(l)+W.keyStr.charAt(t)+W.keyStr.charAt(p)+W.keyStr.charAt(z),L=h=R=0,l=t=p=z=0}while(r<i.length);return x},W.decode64=function(i){var h,l,t,p,x="",R=0,z=0,r=0;/[^A-Za-z0-9\+\/\=]/g.exec(i)&&L.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),i=i.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{h=W.keyStr.indexOf(i.charAt(r++))<<2|(t=W.keyStr.indexOf(i.charAt(r++)))>>4,l=(15&t)<<4|(p=W.keyStr.indexOf(i.charAt(r++)))>>2,R=(3&p)<<6|(z=W.keyStr.indexOf(i.charAt(r++))),x+=String.fromCharCode(h),64!=p&&(x+=String.fromCharCode(l)),64!=z&&(x+=String.fromCharCode(R)),h=l=R=0,t=p=z=0}while(r<i.length);return decodeURI(x)},W.timeIntervalSince1970=function(){var W=new Date;return Math.round(W.getTime()/1e3)},W.createGuid=function(){return(W.s4()+W.s4()+"-"+W.s4()+"-4"+W.s4().substr(0,3)+"-"+W.s4()+"-"+W.s4()+W.s4()+W.s4()).toLowerCase()},W.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},W.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",W}();i.GAUtilities=l}(W.utilities||(W.utilities={}))}(l||(l={})),function(W){!function(i){var L=W.logging.GALogger,h=W.utilities.GAUtilities,l=W.events.EGASdkErrorCategory,t=W.events.EGASdkErrorArea,p=W.events.EGASdkErrorAction,x=W.events.EGASdkErrorParameter,R=function(W,i,L,h,l){this.category=W,this.area=i,this.action=L,this.parameter=h,this.reason=l};i.ValidationResult=R;var z=function(){function i(){}return i.validateBusinessEvent=function(W,h,z,r,N){return i.validateCurrency(W)?h<0?(L.w("Validation fail - business event - amount. Cannot be less than 0. Failed amount: "+h),new R(l.EventValidation,t.BusinessEvent,p.InvalidAmount,x.Amount,h+"")):i.validateShortString(z,!0)?i.validateEventPartLength(r,!1)?i.validateEventPartCharacters(r)?i.validateEventPartLength(N,!1)?i.validateEventPartCharacters(N)?null:(L.w("Validation fail - business event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+N),new R(l.EventValidation,t.BusinessEvent,p.InvalidEventPartCharacters,x.ItemId,N)):(L.w("Validation fail - business event - itemId. Cannot be (null), empty or above 64 characters. String: "+N),new R(l.EventValidation,t.BusinessEvent,p.InvalidEventPartLength,x.ItemId,N)):(L.w("Validation fail - business event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+r),new R(l.EventValidation,t.BusinessEvent,p.InvalidEventPartCharacters,x.ItemType,r)):(L.w("Validation fail - business event - itemType: Cannot be (null), empty or above 64 characters. String: "+r),new R(l.EventValidation,t.BusinessEvent,p.InvalidEventPartLength,x.ItemType,r)):(L.w("Validation fail - business event - cartType. Cannot be above 32 length. String: "+z),new R(l.EventValidation,t.BusinessEvent,p.InvalidShortString,x.CartType,z)):(L.w("Validation fail - business event - currency: Cannot be (null) and need to be A-Z, 3 characters and in the standard at openexchangerates.org. Failed currency: "+W),new R(l.EventValidation,t.BusinessEvent,p.InvalidCurrency,x.Currency,W))},i.validateResourceEvent=function(z,r,N,I,s,o,D){return z==W.EGAResourceFlowType.Undefined?(L.w("Validation fail - resource event - flowType: Invalid flow type."),new R(l.EventValidation,t.ResourceEvent,p.InvalidFlowType,x.FlowType,"")):r?h.stringArrayContainsString(o,r)?N>0?I?i.validateEventPartLength(I,!1)?i.validateEventPartCharacters(I)?h.stringArrayContainsString(D,I)?i.validateEventPartLength(s,!1)?i.validateEventPartCharacters(s)?null:(L.w("Validation fail - resource event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+s),new R(l.EventValidation,t.ResourceEvent,p.InvalidEventPartCharacters,x.ItemId,s)):(L.w("Validation fail - resource event - itemId: Cannot be (null), empty or above 64 characters. String: "+s),new R(l.EventValidation,t.ResourceEvent,p.InvalidEventPartLength,x.ItemId,s)):(L.w("Validation fail - resource event - itemType: Not found in list of pre-defined available resource itemTypes. String: "+I),new R(l.EventValidation,t.ResourceEvent,p.NotFoundInAvailableItemTypes,x.ItemType,I)):(L.w("Validation fail - resource event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+I),new R(l.EventValidation,t.ResourceEvent,p.InvalidEventPartCharacters,x.ItemType,I)):(L.w("Validation fail - resource event - itemType: Cannot be (null), empty or above 64 characters. String: "+I),new R(l.EventValidation,t.ResourceEvent,p.InvalidEventPartLength,x.ItemType,I)):(L.w("Validation fail - resource event - itemType: Cannot be (null)"),new R(l.EventValidation,t.ResourceEvent,p.StringEmptyOrNull,x.ItemType,"")):(L.w("Validation fail - resource event - amount: Float amount cannot be 0 or negative. Value: "+N),new R(l.EventValidation,t.ResourceEvent,p.InvalidAmount,x.Amount,N+"")):(L.w("Validation fail - resource event - currency: Not found in list of pre-defined available resource currencies. String: "+r),new R(l.EventValidation,t.ResourceEvent,p.NotFoundInAvailableCurrencies,x.Currency,r)):(L.w("Validation fail - resource event - currency: Cannot be (null)"),new R(l.EventValidation,t.ResourceEvent,p.StringEmptyOrNull,x.Currency,""))},i.validateProgressionEvent=function(h,z,r,N){if(h==W.EGAProgressionStatus.Undefined)return L.w("Validation fail - progression event: Invalid progression status."),new R(l.EventValidation,t.ProgressionEvent,p.InvalidProgressionStatus,x.ProgressionStatus,"");if(N&&!r&&z)return L.w("Validation fail - progression event: 03 found but 01+02 are invalid. Progression must be set as either 01, 01+02 or 01+02+03."),new R(l.EventValidation,t.ProgressionEvent,p.WrongProgressionOrder,x.Undefined,z+":"+r+":"+N);if(r&&!z)return L.w("Validation fail - progression event: 02 found but not 01. Progression must be set as either 01, 01+02 or 01+02+03"),new R(l.EventValidation,t.ProgressionEvent,p.WrongProgressionOrder,x.Undefined,z+":"+r+":"+N);if(!z)return L.w("Validation fail - progression event: progression01 not valid. Progressions must be set as either 01, 01+02 or 01+02+03"),new R(l.EventValidation,t.ProgressionEvent,p.WrongProgressionOrder,x.Undefined,(z||"")+":"+(r||"")+":"+(N||""));if(!i.validateEventPartLength(z,!1))return L.w("Validation fail - progression event - progression01: Cannot be (null), empty or above 64 characters. String: "+z),new R(l.EventValidation,t.ProgressionEvent,p.InvalidEventPartLength,x.Progression01,z);if(!i.validateEventPartCharacters(z))return L.w("Validation fail - progression event - progression01: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+z),new R(l.EventValidation,t.ProgressionEvent,p.InvalidEventPartCharacters,x.Progression01,z);if(r){if(!i.validateEventPartLength(r,!0))return L.w("Validation fail - progression event - progression02: Cannot be empty or above 64 characters. String: "+r),new R(l.EventValidation,t.ProgressionEvent,p.InvalidEventPartLength,x.Progression02,r);if(!i.validateEventPartCharacters(r))return L.w("Validation fail - progression event - progression02: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+r),new R(l.EventValidation,t.ProgressionEvent,p.InvalidEventPartCharacters,x.Progression02,r)}if(N){if(!i.validateEventPartLength(N,!0))return L.w("Validation fail - progression event - progression03: Cannot be empty or above 64 characters. String: "+N),new R(l.EventValidation,t.ProgressionEvent,p.InvalidEventPartLength,x.Progression03,N);if(!i.validateEventPartCharacters(N))return L.w("Validation fail - progression event - progression03: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+N),new R(l.EventValidation,t.ProgressionEvent,p.InvalidEventPartCharacters,x.Progression03,N)}return null},i.validateDesignEvent=function(W){return i.validateEventIdLength(W)?i.validateEventIdCharacters(W)?null:(L.w("Validation fail - design event - eventId: Non valid characters. Only allowed A-z, 0-9, -_., ()!?. String: "+W),new R(l.EventValidation,t.DesignEvent,p.InvalidEventIdCharacters,x.EventId,W)):(L.w("Validation fail - design event - eventId: Cannot be (null) or empty. Only 5 event parts allowed seperated by :. Each part need to be 32 characters or less. String: "+W),new R(l.EventValidation,t.DesignEvent,p.InvalidEventIdLength,x.EventId,W))},i.validateErrorEvent=function(h,z){return h==W.EGAErrorSeverity.Undefined?(L.w("Validation fail - error event - severity: Severity was unsupported value."),new R(l.EventValidation,t.ErrorEvent,p.InvalidSeverity,x.Severity,"")):i.validateLongString(z,!0)?null:(L.w("Validation fail - error event - message: Message cannot be above 8192 characters."),new R(l.EventValidation,t.ErrorEvent,p.InvalidLongString,x.Message,z))},i.validateAdEvent=function(h,z,r,N){return h==W.EGAAdAction.Undefined?(L.w("Validation fail - error event - severity: Severity was unsupported value."),new R(l.EventValidation,t.AdEvent,p.InvalidAdAction,x.AdAction,"")):z==W.EGAAdType.Undefined?(L.w("Validation fail - ad event - adType: Ad type was unsupported value."),new R(l.EventValidation,t.AdEvent,p.InvalidAdType,x.AdType,"")):i.validateShortString(r,!1)?i.validateString(N,!1)?null:(L.w("Validation fail - ad event - message: Ad placement cannot be above 64 characters."),new R(l.EventValidation,t.AdEvent,p.InvalidString,x.AdPlacement,N)):(L.w("Validation fail - ad event - message: Ad SDK name cannot be above 32 characters."),new R(l.EventValidation,t.AdEvent,p.InvalidShortString,x.AdSdkName,r))},i.validateSdkErrorEvent=function(W,h,x,R,z){return!!i.validateKeys(W,h)&&(x===l.Undefined?(L.w("Validation fail - sdk error event - type: Category was unsupported value."),!1):R===t.Undefined?(L.w("Validation fail - sdk error event - type: Area was unsupported value."),!1):z!==p.Undefined||(L.w("Validation fail - sdk error event - type: Action was unsupported value."),!1))},i.validateKeys=function(W,i){return!(!h.stringMatch(W,/^[A-z0-9]{32}$/)||!h.stringMatch(i,/^[A-z0-9]{40}$/))},i.validateCurrency=function(W){return!!W&&!!h.stringMatch(W,/^[A-Z]{3}$/)},i.validateEventPartLength=function(W,i){return!(!i||W)||!!W&&!(W.length>64)},i.validateEventPartCharacters=function(W){return!!h.stringMatch(W,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},i.validateEventIdLength=function(W){return!!W&&!!h.stringMatch(W,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},i.validateEventIdCharacters=function(W){return!!W&&!!h.stringMatch(W,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},i.validateAndCleanInitRequestResponse=function(W,i){if(null==W)return L.w("validateInitRequestResponse failed - no response dictionary."),null;var h={};try{var l=W.server_ts;if(!(l>0))return L.w("validateInitRequestResponse failed - invalid value in 'server_ts' field."),null;h.server_ts=l}catch(i){return L.w("validateInitRequestResponse failed - invalid type in 'server_ts' field. type="+typeof W.server_ts+", value="+W.server_ts+", "+i),null}if(i){try{var t=W.configs;h.configs=t}catch(i){return L.w("validateInitRequestResponse failed - invalid type in 'configs' field. type="+typeof W.configs+", value="+W.configs+", "+i),null}try{var p=W.configs_hash;h.configs_hash=p}catch(i){return L.w("validateInitRequestResponse failed - invalid type in 'configs_hash' field. type="+typeof W.configs_hash+", value="+W.configs_hash+", "+i),null}try{var x=W.ab_id;h.ab_id=x}catch(i){return L.w("validateInitRequestResponse failed - invalid type in 'ab_id' field. type="+typeof W.ab_id+", value="+W.ab_id+", "+i),null}try{var R=W.ab_variant_id;h.ab_variant_id=R}catch(i){return L.w("validateInitRequestResponse failed - invalid type in 'ab_variant_id' field. type="+typeof W.ab_variant_id+", value="+W.ab_variant_id+", "+i),null}}return h},i.validateBuild=function(W){return!!i.validateShortString(W,!1)},i.validateSdkWrapperVersion=function(W){return!!h.stringMatch(W,/^(unity|unreal|gamemaker|cocos2d|construct|defold|godot) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},i.validateEngineVersion=function(W){return!(!W||!h.stringMatch(W,/^(unity|unreal|gamemaker|cocos2d|construct|defold|godot) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},i.validateUserId=function(W){return!!i.validateString(W,!1)||(L.w("Validation fail - user id: id cannot be (null), empty or above 64 characters."),!1)},i.validateShortString=function(W,i){return!(!i||W)||!(!W||W.length>32)},i.validateString=function(W,i){return!(!i||W)||!(!W||W.length>64)},i.validateLongString=function(W,i){return!(!i||W)||!(!W||W.length>8192)},i.validateConnectionType=function(W){return h.stringMatch(W,/^(wwan|wifi|lan|offline)$/)},i.validateCustomDimensions=function(W){return i.validateArrayOfStrings(20,32,!1,"custom dimensions",W)},i.validateResourceCurrencies=function(W){if(!i.validateArrayOfStrings(20,64,!1,"resource currencies",W))return!1;for(var l=0;l<W.length;++l)if(!h.stringMatch(W[l],/^[A-Za-z]+$/))return L.w("resource currencies validation failed: a resource currency can only be A-Z, a-z. String was: "+W[l]),!1;return!0},i.validateResourceItemTypes=function(W){if(!i.validateArrayOfStrings(20,32,!1,"resource item types",W))return!1;for(var h=0;h<W.length;++h)if(!i.validateEventPartCharacters(W[h]))return L.w("resource item types validation failed: a resource item type cannot contain other characters than A-z, 0-9, -_., ()!?. String was: "+W[h]),!1;return!0},i.validateDimension01=function(W,i){return!W||!!h.stringArrayContainsString(i,W)},i.validateDimension02=function(W,i){return!W||!!h.stringArrayContainsString(i,W)},i.validateDimension03=function(W,i){return!W||!!h.stringArrayContainsString(i,W)},i.validateArrayOfStrings=function(W,i,h,l,t){var p=l;if(p||(p="Array"),!t)return L.w(p+" validation failed: array cannot be null. "),!1;if(0==h&&0==t.length)return L.w(p+" validation failed: array cannot be empty. "),!1;if(W>0&&t.length>W)return L.w(p+" validation failed: array cannot exceed "+W+" values. It has "+t.length+" values."),!1;for(var x=0;x<t.length;++x){var R=t[x]?t[x].length:0;if(0===R)return L.w(p+" validation failed: contained an empty string. Array="+JSON.stringify(t)),!1;if(i>0&&R>i)return L.w(p+" validation failed: a string exceeded max allowed length (which is: "+i+"). String was: "+t[x]),!1}return!0},i.validateClientTs=function(W){return!(W<0||W>99999999999)},i}();i.GAValidator=z}(W.validators||(W.validators={}))}(l||(l={})),function(W){!function(W){var i=function(W,i,L){this.name=W,this.value=i,this.version=L};W.NameValueVersion=i;var L=function(W,i){this.name=W,this.version=i};W.NameVersion=L;var h=function(){function W(){}return W.touch=function(){},W.getRelevantSdkVersion=function(){return W.sdkGameEngineVersion?W.sdkGameEngineVersion:W.sdkWrapperVersion},W.getConnectionType=function(){return W.connectionType},W.updateConnectionType=function(){navigator.onLine?"ios"===W.buildPlatform||"android"===W.buildPlatform?W.connectionType="wwan":W.connectionType="lan":W.connectionType="offline"},W.getOSVersionString=function(){return W.buildPlatform+" "+W.osVersionPair.version},W.runtimePlatformToString=function(){return W.osVersionPair.name},W.getBrowserVersionString=function(){var i,L=navigator.userAgent,h=L.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident|fbav(?=\/))\/?\s*(\d+)/i)||[];if(0==h.length&&"ios"===W.buildPlatform)return"webkit_"+W.osVersion;if(/trident/i.test(h[1]))return"IE "+((i=/\brv[ :]+(\d+)/g.exec(L)||[])[1]||"");if("Chrome"===h[1]&&null!=(i=L.match(/\b(OPR|Edge|UBrowser)\/(\d+)/)))return i.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();if(h[1]&&"fbav"===h[1].toLowerCase()&&(h[1]="facebook",h[2]))return"facebook "+h[2];var l=h[2]?[h[1],h[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(i=L.match(/version\/(\d+)/i))&&l.splice(1,1,i[1]),l.join(" ").toLowerCase()},W.getDeviceModel=function(){return"unknown"},W.getDeviceManufacturer=function(){return"unknown"},W.matchItem=function(W,i){var h,l,t,p,x=new L("unknown","0.0.0"),R=0,z=0;for(R=0;R<i.length;R+=1)if(new RegExp(i[R].value,"i").test(W)){if(h=new RegExp(i[R].version+"[- /:;]([\\d._]+)","i"),p="",(l=W.match(h))&&l[1]&&(t=l[1]),t){var r=t.split(/[._]+/);for(z=0;z<Math.min(r.length,3);z+=1)p+=r[z]+(z<Math.min(r.length,3)-1?".":"")}else p="0.0.0";return x.name=i[R].name,x.version=p,x}return x},W.sdkWrapperVersion="javascript 4.1.6",W.osVersionPair=W.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor].join(" "),[new i("windows_phone","Windows Phone","OS"),new i("windows","Win","NT"),new i("ios","iPhone","OS"),new i("ios","iPad","OS"),new i("ios","iPod","OS"),new i("android","Android","Android"),new i("blackBerry","BlackBerry","/"),new i("mac_osx","Mac","OS X"),new i("tizen","Tizen","Tizen"),new i("linux","Linux","rv"),new i("kai_os","KAIOS","KAIOS")]),W.buildPlatform=W.runtimePlatformToString(),W.deviceModel=W.getDeviceModel(),W.deviceManufacturer=W.getDeviceManufacturer(),W.osVersion=W.getOSVersionString(),W.browserVersion=W.getBrowserVersionString(),W}();W.GADevice=h}(W.device||(W.device={}))}(l||(l={})),function(W){!function(W){var i=function(){function W(i){this.deadline=i,this.ignore=!1,this.async=!1,this.running=!1,this.id=++W.idCounter}return W.idCounter=0,W}();W.TimedBlock=i}(W.threading||(W.threading={}))}(l||(l={})),function(W){!function(W){var i=function(){function W(W){this.comparer=W,this._subQueues={},this._sortedKeys=[]}return W.prototype.enqueue=function(W,i){-1===this._sortedKeys.indexOf(W)&&this.addQueueOfPriority(W),this._subQueues[W].push(i)},W.prototype.addQueueOfPriority=function(W){var i=this;this._sortedKeys.push(W),this._sortedKeys.sort((function(W,L){return i.comparer.compare(W,L)})),this._subQueues[W]=[]},W.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},W.prototype.hasItems=function(){return this._sortedKeys.length>0},W.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},W.prototype.dequeueFromHighPriorityQueue=function(){var W=this._sortedKeys[0],i=this._subQueues[W].shift();return 0===this._subQueues[W].length&&(this._sortedKeys.shift(),delete this._subQueues[W]),i},W}();W.PriorityQueue=i}(W.threading||(W.threading={}))}(l||(l={})),function(W){!function(i){var L,h,l=W.logging.GALogger;!function(W){W[W.Equal=0]="Equal",W[W.LessOrEqual=1]="LessOrEqual",W[W.NotEqual=2]="NotEqual"}(L=i.EGAStoreArgsOperator||(i.EGAStoreArgsOperator={})),function(W){W[W.Events=0]="Events",W[W.Sessions=1]="Sessions",W[W.Progression=2]="Progression"}(h=i.EGAStore||(i.EGAStore={}));var t=function(){function W(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"===typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),W.storageAvailable=!0):W.storageAvailable=!1}catch(W){}}return W.isStorageAvailable=function(){return W.storageAvailable},W.isStoreTooLargeForEvents=function(){return W.instance.eventsStore.length+W.instance.sessionsStore.length>W.MaxNumberOfEntries},W.select=function(i,h,l,t){void 0===h&&(h=[]),void 0===l&&(l=!1),void 0===t&&(t=0);var p=W.getStore(i);if(!p)return null;for(var x=[],R=0;R<p.length;++R){for(var z=p[R],r=!0,N=0;N<h.length;++N){var I=h[N];if(z[I[0]])switch(I[1]){case L.Equal:r=z[I[0]]==I[2];break;case L.LessOrEqual:r=z[I[0]]<=I[2];break;case L.NotEqual:r=z[I[0]]!=I[2];break;default:r=!1}else r=!1;if(!r)break}r&&x.push(z)}return l&&x.sort((function(W,i){return W.client_ts-i.client_ts})),t>0&&x.length>t&&(x=x.slice(0,t+1)),x},W.update=function(i,h,l){void 0===l&&(l=[]);var t=W.getStore(i);if(!t)return!1;for(var p=0;p<t.length;++p){for(var x=t[p],R=!0,z=0;z<l.length;++z){var r=l[z];if(x[r[0]])switch(r[1]){case L.Equal:R=x[r[0]]==r[2];break;case L.LessOrEqual:R=x[r[0]]<=r[2];break;case L.NotEqual:R=x[r[0]]!=r[2];break;default:R=!1}else R=!1;if(!R)break}if(R)for(z=0;z<h.length;++z){var N=h[z];x[N[0]]=N[1]}}return!0},W.delete=function(i,h){var l=W.getStore(i);if(l)for(var t=0;t<l.length;++t){for(var p=l[t],x=!0,R=0;R<h.length;++R){var z=h[R];if(p[z[0]])switch(z[1]){case L.Equal:x=p[z[0]]==z[2];break;case L.LessOrEqual:x=p[z[0]]<=z[2];break;case L.NotEqual:x=p[z[0]]!=z[2];break;default:x=!1}else x=!1;if(!x)break}x&&(l.splice(t,1),--t)}},W.insert=function(i,L,h,l){void 0===h&&(h=!1),void 0===l&&(l=null);var t=W.getStore(i);if(t)if(h){if(!l)return;for(var p=!1,x=0;x<t.length;++x){var R=t[x];if(R[l]==L[l]){for(var z in L)R[z]=L[z];p=!0;break}}p||t.push(L)}else t.push(L)},W.save=function(i){W.isStorageAvailable()?(localStorage.setItem(W.StringFormat(W.KeyFormat,i,W.EventsStoreKey),JSON.stringify(W.instance.eventsStore)),localStorage.setItem(W.StringFormat(W.KeyFormat,i,W.SessionsStoreKey),JSON.stringify(W.instance.sessionsStore)),localStorage.setItem(W.StringFormat(W.KeyFormat,i,W.ProgressionStoreKey),JSON.stringify(W.instance.progressionStore)),localStorage.setItem(W.StringFormat(W.KeyFormat,i,W.ItemsStoreKey),JSON.stringify(W.instance.storeItems))):l.w("Storage is not available, cannot save.")},W.load=function(i){if(W.isStorageAvailable()){try{W.instance.eventsStore=JSON.parse(localStorage.getItem(W.StringFormat(W.KeyFormat,i,W.EventsStoreKey))),W.instance.eventsStore||(W.instance.eventsStore=[])}catch(i){l.w("Load failed for 'events' store. Using empty store."),W.instance.eventsStore=[]}try{W.instance.sessionsStore=JSON.parse(localStorage.getItem(W.StringFormat(W.KeyFormat,i,W.SessionsStoreKey))),W.instance.sessionsStore||(W.instance.sessionsStore=[])}catch(i){l.w("Load failed for 'sessions' store. Using empty store."),W.instance.sessionsStore=[]}try{W.instance.progressionStore=JSON.parse(localStorage.getItem(W.StringFormat(W.KeyFormat,i,W.ProgressionStoreKey))),W.instance.progressionStore||(W.instance.progressionStore=[])}catch(i){l.w("Load failed for 'progression' store. Using empty store."),W.instance.progressionStore=[]}try{W.instance.storeItems=JSON.parse(localStorage.getItem(W.StringFormat(W.KeyFormat,i,W.ItemsStoreKey))),W.instance.storeItems||(W.instance.storeItems={})}catch(i){l.w("Load failed for 'items' store. Using empty store."),W.instance.progressionStore=[]}}else l.w("Storage is not available, cannot load.")},W.setItem=function(i,L,h){var l=W.StringFormat(W.KeyFormat,i,L);h?W.instance.storeItems[l]=h:l in W.instance.storeItems&&delete W.instance.storeItems[l]},W.getItem=function(i,L){var h=W.StringFormat(W.KeyFormat,i,L);return h in W.instance.storeItems?W.instance.storeItems[h]:null},W.getStore=function(i){switch(i){case h.Events:return W.instance.eventsStore;case h.Sessions:return W.instance.sessionsStore;case h.Progression:return W.instance.progressionStore;default:return l.w("GAStore.getStore(): Cannot find store: "+i),null}},W.instance=new W,W.MaxNumberOfEntries=2e3,W.StringFormat=function(W){for(var i=[],L=1;L<arguments.length;L++)i[L-1]=arguments[L];return W.replace(/{(\d+)}/g,(function(W,L){return i[L]||""}))},W.KeyFormat="GA::{0}::{1}",W.EventsStoreKey="ga_event",W.SessionsStoreKey="ga_session",W.ProgressionStoreKey="ga_progression",W.ItemsStoreKey="ga_items",W}();i.GAStore=t}(W.store||(W.store={}))}(l||(l={})),function(W){!function(i){var L=W.validators.GAValidator,h=W.utilities.GAUtilities,l=W.logging.GALogger,t=W.store.GAStore,p=W.device.GADevice,x=W.store.EGAStore,R=W.store.EGAStoreArgsOperator,z=function(){function W(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.remoteConfigsListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={},this._isEventSubmissionEnabled=!0}return W.setUserId=function(i){W.instance.userId=i,W.cacheIdentifier()},W.getIdentifier=function(){return W.instance.identifier},W.isInitialized=function(){return W.instance.initialized},W.setInitialized=function(i){W.instance.initialized=i},W.getSessionStart=function(){return W.instance.sessionStart},W.getSessionNum=function(){return W.instance.sessionNum},W.getTransactionNum=function(){return W.instance.transactionNum},W.getSessionId=function(){return W.instance.sessionId},W.getCurrentCustomDimension01=function(){return W.instance.currentCustomDimension01},W.getCurrentCustomDimension02=function(){return W.instance.currentCustomDimension02},W.getCurrentCustomDimension03=function(){return W.instance.currentCustomDimension03},W.getGameKey=function(){return W.instance.gameKey},W.getGameSecret=function(){return W.instance.gameSecret},W.getAvailableCustomDimensions01=function(){return W.instance.availableCustomDimensions01},W.setAvailableCustomDimensions01=function(i){L.validateCustomDimensions(i)&&(W.instance.availableCustomDimensions01=i,W.validateAndFixCurrentDimensions(),l.i("Set available custom01 dimension values: ("+h.joinStringArray(i,", ")+")"))},W.getAvailableCustomDimensions02=function(){return W.instance.availableCustomDimensions02},W.setAvailableCustomDimensions02=function(i){L.validateCustomDimensions(i)&&(W.instance.availableCustomDimensions02=i,W.validateAndFixCurrentDimensions(),l.i("Set available custom02 dimension values: ("+h.joinStringArray(i,", ")+")"))},W.getAvailableCustomDimensions03=function(){return W.instance.availableCustomDimensions03},W.setAvailableCustomDimensions03=function(i){L.validateCustomDimensions(i)&&(W.instance.availableCustomDimensions03=i,W.validateAndFixCurrentDimensions(),l.i("Set available custom03 dimension values: ("+h.joinStringArray(i,", ")+")"))},W.getAvailableResourceCurrencies=function(){return W.instance.availableResourceCurrencies},W.setAvailableResourceCurrencies=function(i){L.validateResourceCurrencies(i)&&(W.instance.availableResourceCurrencies=i,l.i("Set available resource currencies: ("+h.joinStringArray(i,", ")+")"))},W.getAvailableResourceItemTypes=function(){return W.instance.availableResourceItemTypes},W.setAvailableResourceItemTypes=function(i){L.validateResourceItemTypes(i)&&(W.instance.availableResourceItemTypes=i,l.i("Set available resource item types: ("+h.joinStringArray(i,", ")+")"))},W.getBuild=function(){return W.instance.build},W.setBuild=function(i){W.instance.build=i,l.i("Set build version: "+i)},W.getUseManualSessionHandling=function(){return W.instance.useManualSessionHandling},W.isEventSubmissionEnabled=function(){return W.instance._isEventSubmissionEnabled},W.getABTestingId=function(){return W.instance.abId},W.getABTestingVariantId=function(){return W.instance.abVariantId},W.prototype.setDefaultId=function(i){this.defaultUserId=i||"",W.cacheIdentifier()},W.getDefaultId=function(){return W.instance.defaultUserId},W.getSdkConfig=function(){var i=0;for(var L in W.instance.sdkConfig)0===i&&(h=L),++i;if(h&&i>0)return W.instance.sdkConfig;var h;i=0;for(var L in W.instance.sdkConfigCached)0===i&&(h=L),++i;return h&&i>0?W.instance.sdkConfigCached:W.instance.sdkConfigDefault},W.isEnabled=function(){return!!W.instance.initAuthorized},W.setCustomDimension01=function(i){W.instance.currentCustomDimension01=i,t.setItem(W.getGameKey(),W.Dimension01Key,i),l.i("Set custom01 dimension value: "+i)},W.setCustomDimension02=function(i){W.instance.currentCustomDimension02=i,t.setItem(W.getGameKey(),W.Dimension02Key,i),l.i("Set custom02 dimension value: "+i)},W.setCustomDimension03=function(i){W.instance.currentCustomDimension03=i,t.setItem(W.getGameKey(),W.Dimension03Key,i),l.i("Set custom03 dimension value: "+i)},W.incrementSessionNum=function(){var i=W.getSessionNum()+1;W.instance.sessionNum=i},W.incrementTransactionNum=function(){var i=W.getTransactionNum()+1;W.instance.transactionNum=i},W.incrementProgressionTries=function(i){var L=W.getProgressionTries(i)+1;W.instance.progressionTries[i]=L;var h={};h.progression=i,h.tries=L,t.insert(x.Progression,h,!0,"progression")},W.getProgressionTries=function(i){return i in W.instance.progressionTries?W.instance.progressionTries[i]:0},W.clearProgressionTries=function(i){i in W.instance.progressionTries&&delete W.instance.progressionTries[i];var L=[];L.push(["progression",R.Equal,i]),t.delete(x.Progression,L)},W.setKeys=function(i,L){W.instance.gameKey=i,W.instance.gameSecret=L},W.setManualSessionHandling=function(i){W.instance.useManualSessionHandling=i,l.i("Use manual session handling: "+i)},W.setEnabledEventSubmission=function(i){W.instance._isEventSubmissionEnabled=i},W.getEventAnnotations=function(){var i={v:2};i.user_id=W.instance.identifier,i.client_ts=W.getClientTsAdjusted(),i.sdk_version=p.getRelevantSdkVersion(),i.os_version=p.osVersion,i.manufacturer=p.deviceManufacturer,i.device=p.deviceModel,i.browser_version=p.browserVersion,i.platform=p.buildPlatform,i.session_id=W.instance.sessionId,i[W.SessionNumKey]=W.instance.sessionNum;var h=p.getConnectionType();if(L.validateConnectionType(h)&&(i.connection_type=h),p.gameEngineVersion&&(i.engine_version=p.gameEngineVersion),W.instance.configurations){var l=0;for(var t in W.instance.configurations){l++;break}l>0&&(i.configurations=W.instance.configurations)}return W.instance.abId&&(i.ab_id=W.instance.abId),W.instance.abVariantId&&(i.ab_variant_id=W.instance.abVariantId),W.instance.build&&(i.build=W.instance.build),i},W.getSdkErrorEventAnnotations=function(){var i={v:2};i.category=W.CategorySdkError,i.sdk_version=p.getRelevantSdkVersion(),i.os_version=p.osVersion,i.manufacturer=p.deviceManufacturer,i.device=p.deviceModel,i.platform=p.buildPlatform;var h=p.getConnectionType();return L.validateConnectionType(h)&&(i.connection_type=h),p.gameEngineVersion&&(i.engine_version=p.gameEngineVersion),i},W.getInitAnnotations=function(){var i={};return W.getIdentifier()||W.cacheIdentifier(),i.user_id=W.getIdentifier(),i.sdk_version=p.getRelevantSdkVersion(),i.os_version=p.osVersion,i.platform=p.buildPlatform,W.getBuild()?i.build=W.getBuild():i.build=null,i.session_num=W.getSessionNum(),i.random_salt=W.getSessionNum(),i},W.getClientTsAdjusted=function(){var i=h.timeIntervalSince1970(),l=i+W.instance.clientServerTimeOffset;return L.validateClientTs(l)?l:i},W.sessionIsStarted=function(){return 0!=W.instance.sessionStart},W.cacheIdentifier=function(){W.instance.userId?W.instance.identifier=W.instance.userId:W.instance.defaultUserId&&(W.instance.identifier=W.instance.defaultUserId)},W.ensurePersistedStates=function(){t.isStorageAvailable()&&t.load(W.getGameKey());var i=W.instance;i.setDefaultId(null!=t.getItem(W.getGameKey(),W.DefaultUserIdKey)?t.getItem(W.getGameKey(),W.DefaultUserIdKey):h.createGuid()),i.sessionNum=null!=t.getItem(W.getGameKey(),W.SessionNumKey)?Number(t.getItem(W.getGameKey(),W.SessionNumKey)):0,i.transactionNum=null!=t.getItem(W.getGameKey(),W.TransactionNumKey)?Number(t.getItem(W.getGameKey(),W.TransactionNumKey)):0,i.currentCustomDimension01?t.setItem(W.getGameKey(),W.Dimension01Key,i.currentCustomDimension01):(i.currentCustomDimension01=null!=t.getItem(W.getGameKey(),W.Dimension01Key)?t.getItem(W.getGameKey(),W.Dimension01Key):"",i.currentCustomDimension01),i.currentCustomDimension02?t.setItem(W.getGameKey(),W.Dimension02Key,i.currentCustomDimension02):(i.currentCustomDimension02=null!=t.getItem(W.getGameKey(),W.Dimension02Key)?t.getItem(W.getGameKey(),W.Dimension02Key):"",i.currentCustomDimension02),i.currentCustomDimension03?t.setItem(W.getGameKey(),W.Dimension03Key,i.currentCustomDimension03):(i.currentCustomDimension03=null!=t.getItem(W.getGameKey(),W.Dimension03Key)?t.getItem(W.getGameKey(),W.Dimension03Key):"",i.currentCustomDimension03);var L=null!=t.getItem(W.getGameKey(),W.SdkConfigCachedKey)?t.getItem(W.getGameKey(),W.SdkConfigCachedKey):"";if(L){var l=JSON.parse(h.decode64(L));l&&(i.sdkConfigCached=l)}var p=W.getSdkConfig();i.configsHash=p.configs_hash?p.configs_hash:"",i.abId=p.ab_id?p.ab_id:"",i.abVariantId=p.ab_variant_id?p.ab_variant_id:"";var R=t.select(x.Progression);if(R)for(var z=0;z<R.length;++z){var r=R[z];r&&(i.progressionTries[r.progression]=r.tries)}},W.calculateServerTimeOffset=function(W){return W-h.timeIntervalSince1970()},W.validateAndCleanCustomFields=function(i){var L={};if(i){var t=0;for(var p in i){var x=i[p];if(p&&x)if(t<W.MAX_CUSTOM_FIELDS_COUNT){var R=new RegExp("^[a-zA-Z0-9_]{1,"+W.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(h.stringMatch(p,R)){var z=typeof x;if("string"===z||x instanceof String){var r=x;r.length<=W.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&r.length>0?(L[p]=r,++t):l.w("validateAndCleanCustomFields: entry with key="+p+", value="+x+" has been omitted because its value is an empty string or exceeds the max number of characters ("+W.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH+")")}else if("number"===z||x instanceof Number){var N=x;L[p]=N,++t}else l.w("validateAndCleanCustomFields: entry with key="+p+", value="+x+" has been omitted because its value is not a string or number")}else l.w("validateAndCleanCustomFields: entry with key="+p+", value="+x+" has been omitted because its key contains illegal character, is empty or exceeds the max number of characters ("+W.MAX_CUSTOM_FIELDS_KEY_LENGTH+")")}else l.w("validateAndCleanCustomFields: entry with key="+p+", value="+x+" has been omitted because it exceeds the max number of custom fields ("+W.MAX_CUSTOM_FIELDS_COUNT+")");else l.w("validateAndCleanCustomFields: entry with key="+p+", value="+x+" has been omitted because its key or value is null")}}return L},W.validateAndFixCurrentDimensions=function(){L.validateDimension01(W.getCurrentCustomDimension01(),W.getAvailableCustomDimensions01())||W.setCustomDimension01(""),L.validateDimension02(W.getCurrentCustomDimension02(),W.getAvailableCustomDimensions02())||W.setCustomDimension02(""),L.validateDimension03(W.getCurrentCustomDimension03(),W.getAvailableCustomDimensions03())||W.setCustomDimension03("")},W.getConfigurationStringValue=function(i,L){return W.instance.configurations[i]?W.instance.configurations[i].toString():L},W.isRemoteConfigsReady=function(){return W.instance.remoteConfigsIsReady},W.addRemoteConfigsListener=function(i){W.instance.remoteConfigsListeners.indexOf(i)<0&&W.instance.remoteConfigsListeners.push(i)},W.removeRemoteConfigsListener=function(i){var L=W.instance.remoteConfigsListeners.indexOf(i);L>-1&&W.instance.remoteConfigsListeners.splice(L,1)},W.getRemoteConfigsContentAsString=function(){return JSON.stringify(W.instance.configurations)},W.populateConfigurations=function(i){var L=i.configs;if(L){W.instance.configurations={};for(var h=0;h<L.length;++h){var l=L[h];if(l){var t=l.key,p=l.value,x=l.start_ts?l.start_ts:Number.MIN_VALUE,R=l.end_ts?l.end_ts:Number.MAX_VALUE,z=W.getClientTsAdjusted();t&&p&&z>x&&z<R&&(W.instance.configurations[t]=p)}}}W.instance.remoteConfigsIsReady=!0;var r=W.instance.remoteConfigsListeners;for(h=0;h<r.length;++h)r[h]&&r[h].onRemoteConfigsUpdated()},W.CategorySdkError="sdk_error",W.MAX_CUSTOM_FIELDS_COUNT=50,W.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,W.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,W.instance=new W,W.DefaultUserIdKey="default_user_id",W.SessionNumKey="session_num",W.TransactionNumKey="transaction_num",W.Dimension01Key="dimension01",W.Dimension02Key="dimension02",W.Dimension03Key="dimension03",W.SdkConfigCachedKey="sdk_config_cached",W}();i.GAState=z}(W.state||(W.state={}))}(l||(l={})),function(W){!function(i){var L=W.utilities.GAUtilities,h=W.logging.GALogger,l=function(){function W(){}return W.execute=function(i,l,t,p){var x=new Date;if(W.timestampMap[l]||(W.timestampMap[l]=x),W.countMap[l]||(W.countMap[l]=0),(x.getTime()-W.timestampMap[l].getTime())/1e3>=3600&&(W.timestampMap[l]=x,W.countMap[l]=0),!(W.countMap[l]>=W.MaxCount)){var R=L.getHmac(p,t),z=new XMLHttpRequest;z.onreadystatechange=function(){if(4===z.readyState){if(!z.responseText)return;if(200!=z.status)return void h.w("sdk error failed. response code not 200. status code: "+z.status+", description: "+z.statusText+", body: "+z.responseText);W.countMap[l]=W.countMap[l]+1}},z.open("POST",i,!0),z.setRequestHeader("Content-Type","application/json"),z.setRequestHeader("Authorization",R);try{z.send(t)}catch(W){console.error(W)}}},W.MaxCount=10,W.countMap={},W.timestampMap={},W}();i.SdkErrorTask=l}(W.tasks||(W.tasks={}))}(l||(l={})),function(W){!function(i){var L=W.state.GAState,h=W.logging.GALogger,l=W.utilities.GAUtilities,t=W.validators.GAValidator,p=W.tasks.SdkErrorTask,x=W.events.EGASdkErrorCategory,R=W.events.EGASdkErrorArea,z=W.events.EGASdkErrorAction,r=W.events.EGASdkErrorParameter,N=function(){function W(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.remoteConfigsVersion="v1",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.remoteConfigsBaseUrl=this.protocol+"://"+this.hostName+"/remote_configs/"+this.remoteConfigsVersion,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return W.prototype.requestInit=function(h,l){var t=L.getGameKey(),p=this.remoteConfigsBaseUrl+"/"+this.initializeUrlPath+"?game_key="+t+"&interval_seconds=0&configs_hash="+h,x=L.getInitAnnotations(),R=JSON.stringify(x);if(R){var z=this.createPayloadData(R,this.useGzip),r=[];r.push(R),W.sendRequest(p,z,r,this.useGzip,W.initRequestCallback,l)}else l(i.EGAHTTPApiResponse.JsonEncodeFailed,null)},W.prototype.sendEventsInArray=function(h,l,t){if(0!=h.length){var p=L.getGameKey(),x=this.baseUrl+"/"+p+"/"+this.eventsUrlPath,R=JSON.stringify(h);if(R){var z=this.createPayloadData(R,this.useGzip),r=[];r.push(R),r.push(l),r.push(h.length.toString()),W.sendRequest(x,z,r,this.useGzip,W.sendEventInArrayRequestCallback,t)}else t(i.EGAHTTPApiResponse.JsonEncodeFailed,null,l,h.length)}},W.prototype.sendSdkErrorEvent=function(i,l,x,R,z,r,N){if(L.isEventSubmissionEnabled()&&t.validateSdkErrorEvent(r,N,i,l,x)){var I,s=this.baseUrl+"/"+r+"/"+this.eventsUrlPath,o="",D=L.getSdkErrorEventAnnotations(),S=W.sdkErrorCategoryString(i);D.error_category=S,o+=S;var C=W.sdkErrorAreaString(l);D.error_area=C,o+=":"+C;var e=W.sdkErrorActionString(x);D.error_action=e;var V=W.sdkErrorParameterString(R);if(V.length>0&&(D.error_parameter=V),z.length>0){var c=z;if(z.length>W.MAX_ERROR_MESSAGE_LENGTH)c=z.substring(0,W.MAX_ERROR_MESSAGE_LENGTH);D.reason=c}var f=[];f.push(D),(I=JSON.stringify(f))?p.execute(s,o,I,N):h.w("sendSdkErrorEvent: JSON encoding failed.")}},W.sendEventInArrayRequestCallback=function(h,l,t,p){void 0===p&&(p=null);p[0],p[1];var N,I,s=p[2],o=parseInt(p[3]);N=h.responseText,I=h.status;var D=W.instance.processRequestResponse(I,h.statusText,N,"Events");if(D==i.EGAHTTPApiResponse.Ok||D==i.EGAHTTPApiResponse.Created||D==i.EGAHTTPApiResponse.BadRequest){var S=N?JSON.parse(N):{};if(null==S)return t(i.EGAHTTPApiResponse.JsonDecodeFailed,null,s,o),void W.instance.sendSdkErrorEvent(x.Http,R.EventsHttp,z.FailHttpJsonDecode,r.Undefined,N,L.getGameKey(),L.getGameSecret());i.EGAHTTPApiResponse.BadRequest,t(D,S,s,o)}else t(D,null,s,o)},W.sendRequest=function(W,i,h,t,p,x){var R=new XMLHttpRequest,z=L.getGameSecret(),r=l.getHmac(z,i),N=[];for(var I in N.push(r),h)N.push(h[I]);if(R.onreadystatechange=function(){4===R.readyState&&p(R,W,x,N)},R.open("POST",W,!0),R.setRequestHeader("Content-Type","application/json"),R.setRequestHeader("Authorization",r),t)throw new Error("gzip not supported");try{R.send(i)}catch(W){console.error(W.stack)}},W.initRequestCallback=function(h,l,p,N){void 0===N&&(N=null);var I,s;N[0],N[1];I=h.responseText,s=h.status;var o=I?JSON.parse(I):{},D=W.instance.processRequestResponse(s,h.statusText,I,"Init");if(D==i.EGAHTTPApiResponse.Ok||D==i.EGAHTTPApiResponse.Created||D==i.EGAHTTPApiResponse.BadRequest){if(null==o)return p(i.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0),void W.instance.sendSdkErrorEvent(x.Http,R.InitHttp,z.FailHttpJsonDecode,r.Undefined,I,L.getGameKey(),L.getGameSecret());if(D!==i.EGAHTTPApiResponse.BadRequest){var S=t.validateAndCleanInitRequestResponse(o,D===i.EGAHTTPApiResponse.Created);S?p(D,S,"",0):p(i.EGAHTTPApiResponse.BadResponse,null,"",0)}else p(D,null,"",0)}else p(D,null,"",0)},W.prototype.createPayloadData=function(W,i){if(i)throw new Error("gzip not supported");return W},W.prototype.processRequestResponse=function(W,L,h,l){return h?200===W?i.EGAHTTPApiResponse.Ok:201===W?i.EGAHTTPApiResponse.Created:0===W||401===W?i.EGAHTTPApiResponse.Unauthorized:400===W?i.EGAHTTPApiResponse.BadRequest:500===W?i.EGAHTTPApiResponse.InternalServerError:i.EGAHTTPApiResponse.UnknownResponseCode:i.EGAHTTPApiResponse.NoResponse},W.sdkErrorCategoryString=function(W){switch(W){case x.EventValidation:return"event_validation";case x.Database:return"db";case x.Init:return"init";case x.Http:return"http";case x.Json:return"json"}return""},W.sdkErrorAreaString=function(W){switch(W){case R.BusinessEvent:return"business";case R.ResourceEvent:return"resource";case R.ProgressionEvent:return"progression";case R.DesignEvent:return"design";case R.ErrorEvent:return"error";case R.InitHttp:return"init_http";case R.EventsHttp:return"events_http";case R.ProcessEvents:return"process_events";case R.AddEventsToStore:return"add_events_to_store"}return""},W.sdkErrorActionString=function(W){switch(W){case z.InvalidCurrency:return"invalid_currency";case z.InvalidShortString:return"invalid_short_string";case z.InvalidEventPartLength:return"invalid_event_part_length";case z.InvalidEventPartCharacters:return"invalid_event_part_characters";case z.InvalidStore:return"invalid_store";case z.InvalidFlowType:return"invalid_flow_type";case z.StringEmptyOrNull:return"string_empty_or_null";case z.NotFoundInAvailableCurrencies:return"not_found_in_available_currencies";case z.InvalidAmount:return"invalid_amount";case z.NotFoundInAvailableItemTypes:return"not_found_in_available_item_types";case z.WrongProgressionOrder:return"wrong_progression_order";case z.InvalidEventIdLength:return"invalid_event_id_length";case z.InvalidEventIdCharacters:return"invalid_event_id_characters";case z.InvalidProgressionStatus:return"invalid_progression_status";case z.InvalidSeverity:return"invalid_severity";case z.InvalidLongString:return"invalid_long_string";case z.DatabaseTooLarge:return"db_too_large";case z.DatabaseOpenOrCreate:return"db_open_or_create";case z.JsonError:return"json_error";case z.FailHttpJsonDecode:return"fail_http_json_decode";case z.FailHttpJsonEncode:return"fail_http_json_encode"}return""},W.sdkErrorParameterString=function(W){switch(W){case r.Currency:return"currency";case r.CartType:return"cart_type";case r.ItemType:return"item_type";case r.ItemId:return"item_id";case r.Store:return"store";case r.FlowType:return"flow_type";case r.Amount:return"amount";case r.Progression01:return"progression01";case r.Progression02:return"progression02";case r.Progression03:return"progression03";case r.EventId:return"event_id";case r.ProgressionStatus:return"progression_status";case r.Severity:return"severity";case r.Message:return"message"}return""},W.instance=new W,W.MAX_ERROR_MESSAGE_LENGTH=256,W}();i.GAHTTPApi=N}(W.http||(W.http={}))}(l||(l={})),function(W){!function(i){var L=W.store.GAStore,h=W.store.EGAStore,l=W.store.EGAStoreArgsOperator,t=W.state.GAState,p=W.logging.GALogger,x=W.utilities.GAUtilities,R=W.http.EGAHTTPApiResponse,z=W.http.GAHTTPApi,r=W.validators.GAValidator,N=function(){function N(){}return N.addSessionStartEvent=function(){if(t.isEventSubmissionEnabled()){var W={};W.category=N.CategorySessionStart,t.incrementSessionNum(),L.setItem(t.getGameKey(),t.SessionNumKey,t.getSessionNum().toString()),N.addDimensionsToEvent(W),N.addEventToStore(W),p.i("Add SESSION START event"),N.processEvents(N.CategorySessionStart,!1)}},N.addSessionEndEvent=function(){if(t.isEventSubmissionEnabled()){var W=t.getSessionStart(),i=t.getClientTsAdjusted()-W;i<0&&(p.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),i=0);var L={};L.category=N.CategorySessionEnd,L.length=i,N.addDimensionsToEvent(L),N.addEventToStore(L),p.i("Add SESSION END event."),N.processEvents("",!1)}},N.addBusinessEvent=function(W,i,h,l,x,R){if(void 0===x&&(x=null),t.isEventSubmissionEnabled()){var I=r.validateBusinessEvent(W,i,x,h,l);if(null==I){var s={};t.incrementTransactionNum(),L.setItem(t.getGameKey(),t.TransactionNumKey,t.getTransactionNum().toString()),s.event_id=h+":"+l,s.category=N.CategoryBusiness,s.currency=W,s.amount=i,s[t.TransactionNumKey]=t.getTransactionNum(),x&&(s.cart_type=x),N.addDimensionsToEvent(s),N.addFieldsToEvent(s,t.validateAndCleanCustomFields(R)),p.i("Add BUSINESS event: {currency:"+W+", amount:"+i+", itemType:"+h+", itemId:"+l+", cartType:"+x+"}"),N.addEventToStore(s)}else z.instance.sendSdkErrorEvent(I.category,I.area,I.action,I.parameter,I.reason,t.getGameKey(),t.getGameSecret())}},N.addResourceEvent=function(i,L,h,l,x,R){if(t.isEventSubmissionEnabled()){var I=r.validateResourceEvent(i,L,h,l,x,t.getAvailableResourceCurrencies(),t.getAvailableResourceItemTypes());if(null==I){i===W.EGAResourceFlowType.Sink&&(h*=-1);var s={},o=N.resourceFlowTypeToString(i);s.event_id=o+":"+L+":"+l+":"+x,s.category=N.CategoryResource,s.amount=h,N.addDimensionsToEvent(s),N.addFieldsToEvent(s,t.validateAndCleanCustomFields(R)),p.i("Add RESOURCE event: {currency:"+L+", amount:"+h+", itemType:"+l+", itemId:"+x+"}"),N.addEventToStore(s)}else z.instance.sendSdkErrorEvent(I.category,I.area,I.action,I.parameter,I.reason,t.getGameKey(),t.getGameSecret())}},N.addProgressionEvent=function(i,L,h,l,x,R,I){if(t.isEventSubmissionEnabled()){var s=N.progressionStatusToString(i),o=r.validateProgressionEvent(i,L,h,l);if(null==o){var D,S={};D=h?l?L+":"+h+":"+l:L+":"+h:L,S.category=N.CategoryProgression,S.event_id=s+":"+D;var C=0;R&&i!=W.EGAProgressionStatus.Start&&(S.score=x),i===W.EGAProgressionStatus.Fail&&t.incrementProgressionTries(D),i===W.EGAProgressionStatus.Complete&&(t.incrementProgressionTries(D),C=t.getProgressionTries(D),S.attempt_num=C,t.clearProgressionTries(D)),N.addDimensionsToEvent(S),N.addFieldsToEvent(S,t.validateAndCleanCustomFields(I)),p.i("Add PROGRESSION event: {status:"+s+", progression01:"+L+", progression02:"+h+", progression03:"+l+", score:"+x+", attempt:"+C+"}"),N.addEventToStore(S)}else z.instance.sendSdkErrorEvent(o.category,o.area,o.action,o.parameter,o.reason,t.getGameKey(),t.getGameSecret())}},N.addDesignEvent=function(W,i,L,h){if(t.isEventSubmissionEnabled()){var l=r.validateDesignEvent(W);if(null==l){var x={};x.category=N.CategoryDesign,x.event_id=W,L&&(x.value=i),N.addDimensionsToEvent(x),N.addFieldsToEvent(x,t.validateAndCleanCustomFields(h)),p.i("Add DESIGN event: {eventId:"+W+", value:"+i+"}"),N.addEventToStore(x)}else z.instance.sendSdkErrorEvent(l.category,l.area,l.action,l.parameter,l.reason,t.getGameKey(),t.getGameSecret())}},N.addErrorEvent=function(W,i,L){if(t.isEventSubmissionEnabled()){var h=N.errorSeverityToString(W),l=r.validateErrorEvent(W,i);if(null==l){var x={};x.category=N.CategoryError,x.severity=h,x.message=i,N.addDimensionsToEvent(x),N.addFieldsToEvent(x,t.validateAndCleanCustomFields(L)),p.i("Add ERROR event: {severity:"+h+", message:"+i+"}"),N.addEventToStore(x)}else z.instance.sendSdkErrorEvent(l.category,l.area,l.action,l.parameter,l.reason,t.getGameKey(),t.getGameSecret())}},N.addAdEvent=function(i,L,h,l,x,R,I,s){if(t.isEventSubmissionEnabled()){var o=N.adActionToString(i),D=N.adTypeToString(L),S=N.adErrorToString(x),C=r.validateAdEvent(i,L,h,l);if(null==C){var e={};e.category=N.CategoryAds,e.ad_sdk_name=h,e.ad_placement=l,e.ad_type=D,e.ad_action=o,i==W.EGAAdAction.FailedShow&&S.length>0&&(e.ad_fail_show_reason=S),!I||L!=W.EGAAdType.RewardedVideo&&L!=W.EGAAdType.Video||(e.ad_duration=R),N.addDimensionsToEvent(e),N.addFieldsToEvent(e,t.validateAndCleanCustomFields(s)),p.i("Add AD event: {ad_sdk_name:"+h+", ad_placement:"+l+", ad_type:"+D+", ad_action:"+o+(i==W.EGAAdAction.FailedShow&&S.length>0?", ad_fail_show_reason:"+S:"")+(!I||L!=W.EGAAdType.RewardedVideo&&L!=W.EGAAdType.Video?"":", ad_duration:"+R)+"}"),N.addEventToStore(e)}else z.instance.sendSdkErrorEvent(C.category,C.area,C.action,C.parameter,C.reason,t.getGameKey(),t.getGameSecret())}},N.processEvents=function(W,R){if(t.isEventSubmissionEnabled())try{var I=x.createGuid();R&&(N.cleanupEvents(),N.fixMissingSessionEndEvents());var s=[];s.push(["status",l.Equal,"new"]);var o=[];o.push(["status",l.Equal,"new"]),W&&(s.push(["category",l.Equal,W]),o.push(["category",l.Equal,W]));var D=[];D.push(["status",I]);var S=L.select(h.Events,s);if(!S||0==S.length)return p.i("Event queue: No events to send"),void N.updateSessionStore();if(S.length>N.MaxEventCount){if(!(S=L.select(h.Events,s,!0,N.MaxEventCount)))return;var C=S[S.length-1].client_ts;if(s.push(["client_ts",l.LessOrEqual,C]),!(S=L.select(h.Events,s)))return;o.push(["client_ts",l.LessOrEqual,C])}if(p.i("Event queue: Sending "+S.length+" events."),!L.update(h.Events,D,o))return;for(var e=[],V=0;V<S.length;++V){var c=S[V],f=JSON.parse(x.decode64(c.event));if(0!=f.length){var a=f.client_ts;a&&!r.validateClientTs(a)&&delete f.client_ts,e.push(f)}}z.instance.sendEventsInArray(e,I,N.processEventsCallback)}catch(W){p.e("Error during ProcessEvents(): "+W.stack),z.instance.sendSdkErrorEvent(i.EGASdkErrorCategory.Json,i.EGASdkErrorArea.ProcessEvents,i.EGASdkErrorAction.JsonError,i.EGASdkErrorParameter.Undefined,W.stack,t.getGameKey(),t.getGameSecret())}},N.processEventsCallback=function(W,i,t,x){var z=[];if(z.push(["status",l.Equal,t]),W===R.Ok)L.delete(h.Events,z),p.i("Event queue: "+x+" events sent.");else if(W===R.NoResponse){var r=[];r.push(["status","new"]),p.w("Event queue: Failed to send events to collector - Retrying next time"),L.update(h.Events,r,z)}else{if(i){var N,I=0;for(var s in i)0==I&&(N=i[s]),++I;W===R.BadRequest&&N.constructor===Array?p.w("Event queue: "+x+" events sent. "+I+" events failed GA server validation."):p.w("Event queue: Failed to send events.")}else p.w("Event queue: Failed to send events.");L.delete(h.Events,z)}},N.cleanupEvents=function(){L.update(h.Events,[["status","new"]])},N.fixMissingSessionEndEvents=function(){if(t.isEventSubmissionEnabled()){var W=[];W.push(["session_id",l.NotEqual,t.getSessionId()]);var i=L.select(h.Sessions,W);if(i&&0!=i.length){p.i(i.length+" session(s) located with missing session_end event.");for(var R=0;R<i.length;++R){var z=JSON.parse(x.decode64(i[R].event)),r=z.client_ts-i[R].timestamp;r=Math.max(0,r),z.category=N.CategorySessionEnd,z.length=r,N.addEventToStore(z)}}}},N.addEventToStore=function(W){if(t.isEventSubmissionEnabled())if(t.isInitialized())try{if(L.isStoreTooLargeForEvents()&&!x.stringMatch(W.category,/^(user|session_end|business)$/))return p.w("Database too large. Event has been blocked."),void z.instance.sendSdkErrorEvent(i.EGASdkErrorCategory.Database,i.EGASdkErrorArea.AddEventsToStore,i.EGASdkErrorAction.DatabaseTooLarge,i.EGASdkErrorParameter.Undefined,"",t.getGameKey(),t.getGameSecret());var R=t.getEventAnnotations(),r=x.encode64(JSON.stringify(R));for(var I in W)R[I]=W[I];var s=JSON.stringify(R);p.ii("Event added to queue: "+s);var o={status:"new"};o.category=R.category,o.session_id=R.session_id,o.client_ts=R.client_ts,o.event=x.encode64(JSON.stringify(R)),L.insert(h.Events,o),W.category==N.CategorySessionEnd?L.delete(h.Sessions,[["session_id",l.Equal,R.session_id]]):((o={}).session_id=R.session_id,o.timestamp=t.getSessionStart(),o.event=r,L.insert(h.Sessions,o,!0,"session_id")),L.isStorageAvailable()&&L.save(t.getGameKey())}catch(I){p.e("addEventToStore: error"),p.e(I.stack),z.instance.sendSdkErrorEvent(i.EGASdkErrorCategory.Database,i.EGASdkErrorArea.AddEventsToStore,i.EGASdkErrorAction.DatabaseTooLarge,i.EGASdkErrorParameter.Undefined,I.stack,t.getGameKey(),t.getGameSecret())}else p.w("Could not add event: SDK is not initialized")},N.updateSessionStore=function(){if(t.sessionIsStarted()){var W={};W.session_id=t.instance.sessionId,W.timestamp=t.getSessionStart(),W.event=x.encode64(JSON.stringify(t.getEventAnnotations())),L.insert(h.Sessions,W,!0,"session_id"),L.isStorageAvailable()&&L.save(t.getGameKey())}},N.addDimensionsToEvent=function(W){W&&(t.getCurrentCustomDimension01()&&(W.custom_01=t.getCurrentCustomDimension01()),t.getCurrentCustomDimension02()&&(W.custom_02=t.getCurrentCustomDimension02()),t.getCurrentCustomDimension03()&&(W.custom_03=t.getCurrentCustomDimension03()))},N.addFieldsToEvent=function(W,i){W&&i&&Object.keys(i).length>0&&(W.custom_fields=i)},N.resourceFlowTypeToString=function(i){return i==W.EGAResourceFlowType.Source||i==W.EGAResourceFlowType[W.EGAResourceFlowType.Source]?"Source":i==W.EGAResourceFlowType.Sink||i==W.EGAResourceFlowType[W.EGAResourceFlowType.Sink]?"Sink":""},N.progressionStatusToString=function(i){return i==W.EGAProgressionStatus.Start||i==W.EGAProgressionStatus[W.EGAProgressionStatus.Start]?"Start":i==W.EGAProgressionStatus.Complete||i==W.EGAProgressionStatus[W.EGAProgressionStatus.Complete]?"Complete":i==W.EGAProgressionStatus.Fail||i==W.EGAProgressionStatus[W.EGAProgressionStatus.Fail]?"Fail":""},N.errorSeverityToString=function(i){return i==W.EGAErrorSeverity.Debug||i==W.EGAErrorSeverity[W.EGAErrorSeverity.Debug]?"debug":i==W.EGAErrorSeverity.Info||i==W.EGAErrorSeverity[W.EGAErrorSeverity.Info]?"info":i==W.EGAErrorSeverity.Warning||i==W.EGAErrorSeverity[W.EGAErrorSeverity.Warning]?"warning":i==W.EGAErrorSeverity.Error||i==W.EGAErrorSeverity[W.EGAErrorSeverity.Error]?"error":i==W.EGAErrorSeverity.Critical||i==W.EGAErrorSeverity[W.EGAErrorSeverity.Critical]?"critical":""},N.adActionToString=function(i){return i==W.EGAAdAction.Clicked||i==W.EGAAdAction[W.EGAAdAction.Clicked]?"clicked":i==W.EGAAdAction.Show||i==W.EGAAdAction[W.EGAAdAction.Show]?"show":i==W.EGAAdAction.FailedShow||i==W.EGAAdAction[W.EGAAdAction.FailedShow]?"failed_show":i==W.EGAAdAction.RewardReceived||i==W.EGAAdAction[W.EGAAdAction.RewardReceived]?"reward_received":""},N.adErrorToString=function(i){return i==W.EGAAdError.Unknown||i==W.EGAAdError[W.EGAAdError.Unknown]?"unknown":i==W.EGAAdError.Offline||i==W.EGAAdError[W.EGAAdError.Offline]?"offline":i==W.EGAAdError.NoFill||i==W.EGAAdError[W.EGAAdError.NoFill]?"no_fill":i==W.EGAAdError.InternalError||i==W.EGAAdError[W.EGAAdError.InternalError]?"internal_error":i==W.EGAAdError.InvalidRequest||i==W.EGAAdError[W.EGAAdError.InvalidRequest]?"invalid_request":i==W.EGAAdError.UnableToPrecache||i==W.EGAAdError[W.EGAAdError.UnableToPrecache]?"unable_to_precache":""},N.adTypeToString=function(i){return i==W.EGAAdType.Video||i==W.EGAAdType[W.EGAAdType.Video]?"video":i==W.EGAAdType.RewardedVideo||i==W.EGAAdError[W.EGAAdType.RewardedVideo]?"rewarded_video":i==W.EGAAdType.Playable||i==W.EGAAdError[W.EGAAdType.Playable]?"playable":i==W.EGAAdType.Interstitial||i==W.EGAAdError[W.EGAAdType.Interstitial]?"interstitial":i==W.EGAAdType.OfferWall||i==W.EGAAdError[W.EGAAdType.OfferWall]?"offer_wall":i==W.EGAAdType.Banner||i==W.EGAAdError[W.EGAAdType.Banner]?"banner":""},N.CategorySessionStart="user",N.CategorySessionEnd="session_end",N.CategoryDesign="design",N.CategoryBusiness="business",N.CategoryProgression="progression",N.CategoryResource="resource",N.CategoryError="error",N.CategoryAds="ads",N.MaxEventCount=500,N}();i.GAEvents=N}(W.events||(W.events={}))}(l||(l={})),function(W){!function(i){var L=W.logging.GALogger,h=W.state.GAState,l=W.events.GAEvents,t=function(){function W(){this.blocks=new i.PriorityQueue({compare:function(W,i){return W-i}}),this.id2TimedBlockMap={},W.startThread()}return W.createTimedBlock=function(W){void 0===W&&(W=0);var L=new Date;return L.setSeconds(L.getSeconds()+W),new i.TimedBlock(L)},W.performTaskOnGAThread=function(L,h){void 0===h&&(h=0);var l=new Date;l.setSeconds(l.getSeconds()+h);var t=new i.TimedBlock(l);t.block=L,W.instance.id2TimedBlockMap[t.id]=t,W.instance.addTimedBlock(t)},W.performTimedBlockOnGAThread=function(i){W.instance.id2TimedBlockMap[i.id]=i,W.instance.addTimedBlock(i)},W.scheduleTimer=function(L,h){var l=new Date;l.setSeconds(l.getSeconds()+L);var t=new i.TimedBlock(l);return t.block=h,W.instance.id2TimedBlockMap[t.id]=t,W.instance.addTimedBlock(t),t.id},W.getTimedBlockById=function(i){return i in W.instance.id2TimedBlockMap?W.instance.id2TimedBlockMap[i]:null},W.ensureEventQueueIsRunning=function(){W.instance.keepRunning=!0,W.instance.isRunning||(W.instance.isRunning=!0,W.scheduleTimer(W.ProcessEventsIntervalInSeconds,W.processEventQueue))},W.endSessionAndStopQueue=function(){h.isInitialized()&&(L.i("Ending session."),W.stopEventQueue(),h.isEnabled()&&h.sessionIsStarted()&&(l.addSessionEndEvent(),h.instance.sessionStart=0))},W.stopEventQueue=function(){W.instance.keepRunning=!1},W.ignoreTimer=function(i){i in W.instance.id2TimedBlockMap&&(W.instance.id2TimedBlockMap[i].ignore=!0)},W.setEventProcessInterval=function(i){i>0&&(W.ProcessEventsIntervalInSeconds=i)},W.prototype.addTimedBlock=function(W){this.blocks.enqueue(W.deadline.getTime(),W)},W.run=function(){clearTimeout(W.runTimeoutId);try{for(var i;i=W.getNextBlock();)if(!i.ignore)if(i.async){if(!i.running){i.running=!0,i.block();break}}else i.block();return void(W.runTimeoutId=setTimeout(W.run,W.ThreadWaitTimeInMs))}catch(W){L.e("Error on GA thread"),L.e(W.stack)}},W.startThread=function(){W.runTimeoutId=setTimeout(W.run,0)},W.getNextBlock=function(){var i=new Date;return W.instance.blocks.hasItems()&&W.instance.blocks.peek().deadline.getTime()<=i.getTime()?W.instance.blocks.peek().async&&W.instance.blocks.peek().running?W.instance.blocks.peek():W.instance.blocks.dequeue():null},W.processEventQueue=function(){l.processEvents("",!0),W.instance.keepRunning?W.scheduleTimer(W.ProcessEventsIntervalInSeconds,W.processEventQueue):W.instance.isRunning=!1},W.instance=new W,W.ThreadWaitTimeInMs=1e3,W.ProcessEventsIntervalInSeconds=8,W}();i.GAThreading=t}(W.threading||(W.threading={}))}(l||(l={})),function(W){var i=W.threading.GAThreading,h=W.logging.GALogger,l=W.store.GAStore,t=W.state.GAState,p=W.http.GAHTTPApi,x=W.device.GADevice,R=W.validators.GAValidator,z=W.http.EGAHTTPApiResponse,r=W.utilities.GAUtilities,N=W.events.GAEvents,I=function(){function I(){}return I.getGlobalObject=function(){return"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof L.g?L.g:void 0},I.init=function(){if(x.touch(),I.methodMap.configureAvailableCustomDimensions01=I.configureAvailableCustomDimensions01,I.methodMap.configureAvailableCustomDimensions02=I.configureAvailableCustomDimensions02,I.methodMap.configureAvailableCustomDimensions03=I.configureAvailableCustomDimensions03,I.methodMap.configureAvailableResourceCurrencies=I.configureAvailableResourceCurrencies,I.methodMap.configureAvailableResourceItemTypes=I.configureAvailableResourceItemTypes,I.methodMap.configureBuild=I.configureBuild,I.methodMap.configureSdkGameEngineVersion=I.configureSdkGameEngineVersion,I.methodMap.configureGameEngineVersion=I.configureGameEngineVersion,I.methodMap.configureUserId=I.configureUserId,I.methodMap.initialize=I.initialize,I.methodMap.addBusinessEvent=I.addBusinessEvent,I.methodMap.addResourceEvent=I.addResourceEvent,I.methodMap.addProgressionEvent=I.addProgressionEvent,I.methodMap.addDesignEvent=I.addDesignEvent,I.methodMap.addErrorEvent=I.addErrorEvent,I.methodMap.addErrorEvent=I.addErrorEvent,I.methodMap.setEnabledInfoLog=I.setEnabledInfoLog,I.methodMap.setEnabledVerboseLog=I.setEnabledVerboseLog,I.methodMap.setEnabledManualSessionHandling=I.setEnabledManualSessionHandling,I.methodMap.setEnabledEventSubmission=I.setEnabledEventSubmission,I.methodMap.setCustomDimension01=I.setCustomDimension01,I.methodMap.setCustomDimension02=I.setCustomDimension02,I.methodMap.setCustomDimension03=I.setCustomDimension03,I.methodMap.setEventProcessInterval=I.setEventProcessInterval,I.methodMap.startSession=I.startSession,I.methodMap.endSession=I.endSession,I.methodMap.onStop=I.onStop,I.methodMap.onResume=I.onResume,I.methodMap.addRemoteConfigsListener=I.addRemoteConfigsListener,I.methodMap.removeRemoteConfigsListener=I.removeRemoteConfigsListener,I.methodMap.getRemoteConfigsValueAsString=I.getRemoteConfigsValueAsString,I.methodMap.isRemoteConfigsReady=I.isRemoteConfigsReady,I.methodMap.getRemoteConfigsContentAsString=I.getRemoteConfigsContentAsString,"undefined"!==typeof I.getGlobalObject()&&"undefined"!==typeof I.getGlobalObject().GameAnalytics&&"undefined"!==typeof I.getGlobalObject().GameAnalytics.q){var W=I.getGlobalObject().GameAnalytics.q;for(var L in W)I.gaCommand.apply(null,W[L])}window.addEventListener("beforeunload",(function(){console.log("addEventListener unload"),i.endSessionAndStopQueue()}))},I.gaCommand=function(){for(var i=[],L=0;L<arguments.length;L++)i[L]=arguments[L];i.length>0&&i[0]in W.GameAnalytics.methodMap&&(i.length>1?W.GameAnalytics.methodMap[i[0]].apply(null,Array.prototype.slice.call(i,1)):W.GameAnalytics.methodMap[i[0]]())},I.configureAvailableCustomDimensions01=function(W){void 0===W&&(W=[]),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)?h.w("Available custom dimensions must be set before SDK is initialized"):t.setAvailableCustomDimensions01(W)}))},I.configureAvailableCustomDimensions02=function(W){void 0===W&&(W=[]),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)?h.w("Available custom dimensions must be set before SDK is initialized"):t.setAvailableCustomDimensions02(W)}))},I.configureAvailableCustomDimensions03=function(W){void 0===W&&(W=[]),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)?h.w("Available custom dimensions must be set before SDK is initialized"):t.setAvailableCustomDimensions03(W)}))},I.configureAvailableResourceCurrencies=function(W){void 0===W&&(W=[]),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)?h.w("Available resource currencies must be set before SDK is initialized"):t.setAvailableResourceCurrencies(W)}))},I.configureAvailableResourceItemTypes=function(W){void 0===W&&(W=[]),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)?h.w("Available resource item types must be set before SDK is initialized"):t.setAvailableResourceItemTypes(W)}))},I.configureBuild=function(W){void 0===W&&(W=""),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)?h.w("Build version must be set before SDK is initialized."):R.validateBuild(W)?t.setBuild(W):h.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+W)}))},I.configureSdkGameEngineVersion=function(W){void 0===W&&(W=""),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)||(R.validateSdkWrapperVersion(W)?x.sdkGameEngineVersion=W:h.i("Validation fail - configure sdk version: Sdk version not supported. String: "+W))}))},I.configureGameEngineVersion=function(W){void 0===W&&(W=""),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)||(R.validateEngineVersion(W)?x.gameEngineVersion=W:h.i("Validation fail - configure game engine version: Game engine version not supported. String: "+W))}))},I.configureUserId=function(W){void 0===W&&(W=""),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!1)?h.w("A custom user id must be set before SDK is initialized."):R.validateUserId(W)?t.setUserId(W):h.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+W)}))},I.initialize=function(W,L){void 0===W&&(W=""),void 0===L&&(L=""),x.updateConnectionType();var l=i.createTimedBlock();l.async=!0,I.initTimedBlockId=l.id,l.block=function(){I.isSdkReady(!0,!1)?h.w("SDK already initialized. Can only be called once."):R.validateKeys(W,L)?(t.setKeys(W,L),I.internalInitialize()):h.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+W+", secretKey: "+L)},i.performTimedBlockOnGAThread(l)},I.addBusinessEvent=function(W,L,h,l,t){void 0===W&&(W=""),void 0===L&&(L=0),void 0===h&&(h=""),void 0===l&&(l=""),void 0===t&&(t=""),x.updateConnectionType(),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!0,"Could not add business event")&&N.addBusinessEvent(W,L,h,l,t,{})}))},I.addResourceEvent=function(L,h,l,t,p){void 0===L&&(L=W.EGAResourceFlowType.Undefined),void 0===h&&(h=""),void 0===l&&(l=0),void 0===t&&(t=""),void 0===p&&(p=""),x.updateConnectionType(),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!0,"Could not add resource event")&&N.addResourceEvent(L,h,l,t,p,{})}))},I.addProgressionEvent=function(L,h,l,t,p){void 0===L&&(L=W.EGAProgressionStatus.Undefined),void 0===h&&(h=""),void 0===l&&(l=""),void 0===t&&(t=""),x.updateConnectionType(),i.performTaskOnGAThread((function(){if(I.isSdkReady(!0,!0,"Could not add progression event")){var W="number"===typeof p;N.addProgressionEvent(L,h,l,t,W?p:0,W,{})}}))},I.addDesignEvent=function(W,L){x.updateConnectionType(),i.performTaskOnGAThread((function(){if(I.isSdkReady(!0,!0,"Could not add design event")){var i="number"===typeof L;N.addDesignEvent(W,i?L:0,i,{})}}))},I.addErrorEvent=function(L,h){void 0===L&&(L=W.EGAErrorSeverity.Undefined),void 0===h&&(h=""),x.updateConnectionType(),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!0,"Could not add error event")&&N.addErrorEvent(L,h,{})}))},I.addAdEventWithNoAdReason=function(L,h,l,t,p){void 0===L&&(L=W.EGAAdAction.Undefined),void 0===h&&(h=W.EGAAdType.Undefined),void 0===l&&(l=""),void 0===t&&(t=""),void 0===p&&(p=W.EGAAdError.Undefined),x.updateConnectionType(),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!0,"Could not add ad event")&&N.addAdEvent(L,h,l,t,p,0,!1,{})}))},I.addAdEventWithDuration=function(L,h,l,t,p){void 0===L&&(L=W.EGAAdAction.Undefined),void 0===h&&(h=W.EGAAdType.Undefined),void 0===l&&(l=""),void 0===t&&(t=""),void 0===p&&(p=0),x.updateConnectionType(),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!0,"Could not add ad event")&&N.addAdEvent(L,h,l,t,W.EGAAdError.Undefined,p,!0,{})}))},I.addAdEvent=function(L,h,l,t){void 0===L&&(L=W.EGAAdAction.Undefined),void 0===h&&(h=W.EGAAdType.Undefined),void 0===l&&(l=""),void 0===t&&(t=""),x.updateConnectionType(),i.performTaskOnGAThread((function(){I.isSdkReady(!0,!0,"Could not add ad event")&&N.addAdEvent(L,h,l,t,W.EGAAdError.Undefined,0,!1,{})}))},I.setEnabledInfoLog=function(W){void 0===W&&(W=!1),i.performTaskOnGAThread((function(){W?(h.setInfoLog(W),h.i("Info logging enabled")):(h.i("Info logging disabled"),h.setInfoLog(W))}))},I.setEnabledVerboseLog=function(W){void 0===W&&(W=!1),i.performTaskOnGAThread((function(){W?(h.setVerboseLog(W),h.i("Verbose logging enabled")):(h.i("Verbose logging disabled"),h.setVerboseLog(W))}))},I.setEnabledManualSessionHandling=function(W){void 0===W&&(W=!1),i.performTaskOnGAThread((function(){t.setManualSessionHandling(W)}))},I.setEnabledEventSubmission=function(W){void 0===W&&(W=!1),i.performTaskOnGAThread((function(){W?(t.setEnabledEventSubmission(W),h.i("Event submission enabled")):(h.i("Event submission disabled"),t.setEnabledEventSubmission(W))}))},I.setCustomDimension01=function(W){void 0===W&&(W=""),i.performTaskOnGAThread((function(){R.validateDimension01(W,t.getAvailableCustomDimensions01())?t.setCustomDimension01(W):h.w("Could not set custom01 dimension value to '"+W+"'. Value not found in available custom01 dimension values")}))},I.setCustomDimension02=function(W){void 0===W&&(W=""),i.performTaskOnGAThread((function(){R.validateDimension02(W,t.getAvailableCustomDimensions02())?t.setCustomDimension02(W):h.w("Could not set custom02 dimension value to '"+W+"'. Value not found in available custom02 dimension values")}))},I.setCustomDimension03=function(W){void 0===W&&(W=""),i.performTaskOnGAThread((function(){R.validateDimension03(W,t.getAvailableCustomDimensions03())?t.setCustomDimension03(W):h.w("Could not set custom03 dimension value to '"+W+"'. Value not found in available custom03 dimension values")}))},I.setEventProcessInterval=function(W){i.performTaskOnGAThread((function(){i.setEventProcessInterval(W)}))},I.startSession=function(){if(t.isInitialized()){var W=i.createTimedBlock();W.async=!0,I.initTimedBlockId=W.id,W.block=function(){t.isEnabled()&&t.sessionIsStarted()&&i.endSessionAndStopQueue(),I.resumeSessionAndStartQueue()},i.performTimedBlockOnGAThread(W)}},I.endSession=function(){I.onStop()},I.onStop=function(){i.performTaskOnGAThread((function(){try{i.endSessionAndStopQueue()}catch(W){}}))},I.onResume=function(){var W=i.createTimedBlock();W.async=!0,I.initTimedBlockId=W.id,W.block=function(){I.resumeSessionAndStartQueue()},i.performTimedBlockOnGAThread(W)},I.getRemoteConfigsValueAsString=function(W,i){return void 0===i&&(i=null),t.getConfigurationStringValue(W,i)},I.isRemoteConfigsReady=function(){return t.isRemoteConfigsReady()},I.addRemoteConfigsListener=function(W){t.addRemoteConfigsListener(W)},I.removeRemoteConfigsListener=function(W){t.removeRemoteConfigsListener(W)},I.getRemoteConfigsContentAsString=function(){return t.getRemoteConfigsContentAsString()},I.getABTestingId=function(){return t.getABTestingId()},I.getABTestingVariantId=function(){return t.getABTestingVariantId()},I.internalInitialize=function(){t.ensurePersistedStates(),l.setItem(t.getGameKey(),t.DefaultUserIdKey,t.getDefaultId()),t.setInitialized(!0),I.newSession(),t.isEnabled()&&i.ensureEventQueueIsRunning()},I.newSession=function(){h.i("Starting a new session."),t.validateAndFixCurrentDimensions(),p.instance.requestInit(t.instance.configsHash,I.startNewSessionCallback)},I.startNewSessionCallback=function(W,L){if(W!==z.Ok&&W!==z.Created||!L)W==z.Unauthorized?(h.w("Initialize SDK failed - Unauthorized"),t.instance.initAuthorized=!1):(W===z.NoResponse||W===z.RequestTimeout?h.i("Init call (session start) failed - no response. Could be offline or timeout."):W===z.BadResponse||W===z.JsonEncodeFailed||W===z.JsonDecodeFailed?h.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):W!==z.BadRequest&&W!==z.UnknownResponseCode||h.i("Init call (session start) failed - bad request or unknown response."),null==t.instance.sdkConfig?null!=t.instance.sdkConfigCached?(h.i("Init call (session start) failed - using cached init values."),t.instance.sdkConfig=t.instance.sdkConfigCached):(h.i("Init call (session start) failed - using default init values."),t.instance.sdkConfig=t.instance.sdkConfigDefault):h.i("Init call (session start) failed - using cached init values."),t.instance.initAuthorized=!0);else{var p=0;if(L.server_ts){var x=L.server_ts;p=t.calculateServerTimeOffset(x)}if(L.time_offset=p,W!=z.Created){var R=t.getSdkConfig();R.configs&&(L.configs=R.configs),R.configs_hash&&(L.configs_hash=R.configs_hash),R.ab_id&&(L.ab_id=R.ab_id),R.ab_variant_id&&(L.ab_variant_id=R.ab_variant_id)}t.instance.configsHash=L.configs_hash?L.configs_hash:"",t.instance.abId=L.ab_id?L.ab_id:"",t.instance.abVariantId=L.ab_variant_id?L.ab_variant_id:"",l.setItem(t.getGameKey(),t.SdkConfigCachedKey,r.encode64(JSON.stringify(L))),t.instance.sdkConfigCached=L,t.instance.sdkConfig=L,t.instance.initAuthorized=!0}if(t.instance.clientServerTimeOffset=t.getSdkConfig().time_offset?t.getSdkConfig().time_offset:0,t.populateConfigurations(t.getSdkConfig()),!t.isEnabled())return h.w("Could not start session: SDK is disabled."),void i.stopEventQueue();i.ensureEventQueueIsRunning();var s=r.createGuid();t.instance.sessionId=s,t.instance.sessionStart=t.getClientTsAdjusted(),N.addSessionStartEvent();var o=i.getTimedBlockById(I.initTimedBlockId);null!=o&&(o.running=!1),I.initTimedBlockId=-1},I.resumeSessionAndStartQueue=function(){t.isInitialized()&&(h.i("Resuming session."),t.sessionIsStarted()||I.newSession())},I.isSdkReady=function(W,i,L){return void 0===i&&(i=!0),void 0===L&&(L=""),L&&(L+=": "),W&&!t.isInitialized()?(i&&h.w(L+"SDK is not initialized"),!1):W&&!t.isEnabled()?(i&&h.w(L+"SDK is disabled"),!1):!(W&&!t.sessionIsStarted())||(i&&h.w(L+"Session has not started yet"),!1)},I.initTimedBlockId=-1,I.methodMap={},I}();W.GameAnalytics=I}(l||(l={})),l.GameAnalytics.init();l.GameAnalytics.gaCommand;W.exports=l},379:function(W){"use strict";W.exports=function(W){for(var i=new Array(W),L=0;L<W;++L)i[L]=L;return i}},23110:function(W){function i(W){return!!W.constructor&&"function"===typeof W.constructor.isBuffer&&W.constructor.isBuffer(W)}W.exports=function(W){return null!=W&&(i(W)||function(W){return"function"===typeof W.readFloatLE&&"function"===typeof W.slice&&i(W.slice(0,0))}(W)||!!W._isBuffer)}},74654:function(W,i,L){W=L.nmd(W);var h="__lodash_hash_undefined__",l=9007199254740991,t="[object Arguments]",p="[object Boolean]",x="[object Date]",R="[object Function]",z="[object GeneratorFunction]",r="[object Map]",N="[object Number]",I="[object Object]",s="[object Promise]",o="[object RegExp]",D="[object Set]",S="[object String]",C="[object Symbol]",e="[object WeakMap]",V="[object ArrayBuffer]",c="[object DataView]",f="[object Float32Array]",a="[object Float64Array]",P="[object Int8Array]",y="[object Int16Array]",M="[object Int32Array]",b="[object Uint8Array]",j="[object Uint8ClampedArray]",Z="[object Uint16Array]",X="[object Uint32Array]",T=/\w*$/,F=/^\[object .+?Constructor\]$/,q=/^(?:0|[1-9]\d*)$/,H={};H[t]=H["[object Array]"]=H[V]=H[c]=H[p]=H[x]=H[f]=H[a]=H[P]=H[y]=H[M]=H[r]=H[N]=H[I]=H[o]=H[D]=H[S]=H[C]=H[b]=H[j]=H[Z]=H[X]=!0,H["[object Error]"]=H[R]=H[e]=!1;var k="object"==typeof L.g&&L.g&&L.g.Object===Object&&L.g,U="object"==typeof self&&self&&self.Object===Object&&self,d=k||U||Function("return this")(),B=i&&!i.nodeType&&i,w=B&&W&&!W.nodeType&&W,g=w&&w.exports===B;function n(W,i){return W.set(i[0],i[1]),W}function m(W,i){return W.add(i),W}function E(W,i,L,h){var l=-1,t=W?W.length:0;for(h&&t&&(L=W[++l]);++l<t;)L=i(L,W[l],l,W);return L}function K(W){var i=!1;if(null!=W&&"function"!=typeof W.toString)try{i=!!(W+"")}catch(W){}return i}function G(W){var i=-1,L=Array(W.size);return W.forEach((function(W,h){L[++i]=[h,W]})),L}function u(W,i){return function(L){return W(i(L))}}function J(W){var i=-1,L=Array(W.size);return W.forEach((function(W){L[++i]=W})),L}var A=Array.prototype,v=Function.prototype,Q=Object.prototype,O=d["__core-js_shared__"],Y=function(){var W=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||"");return W?"Symbol(src)_1."+W:""}(),WW=v.toString,iW=Q.hasOwnProperty,LW=Q.toString,hW=RegExp("^"+WW.call(iW).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lW=g?d.Buffer:void 0,tW=d.Symbol,pW=d.Uint8Array,xW=u(Object.getPrototypeOf,Object),RW=Object.create,zW=Q.propertyIsEnumerable,rW=A.splice,NW=Object.getOwnPropertySymbols,IW=lW?lW.isBuffer:void 0,sW=u(Object.keys,Object),oW=gW(d,"DataView"),DW=gW(d,"Map"),SW=gW(d,"Promise"),CW=gW(d,"Set"),eW=gW(d,"WeakMap"),VW=gW(Object,"create"),cW=GW(oW),fW=GW(DW),aW=GW(SW),PW=GW(CW),yW=GW(eW),MW=tW?tW.prototype:void 0,bW=MW?MW.valueOf:void 0;function jW(W){var i=-1,L=W?W.length:0;for(this.clear();++i<L;){var h=W[i];this.set(h[0],h[1])}}function ZW(W){var i=-1,L=W?W.length:0;for(this.clear();++i<L;){var h=W[i];this.set(h[0],h[1])}}function XW(W){var i=-1,L=W?W.length:0;for(this.clear();++i<L;){var h=W[i];this.set(h[0],h[1])}}function TW(W){this.__data__=new ZW(W)}function FW(W,i){var L=JW(W)||function(W){return function(W){return function(W){return!!W&&"object"==typeof W}(W)&&AW(W)}(W)&&iW.call(W,"callee")&&(!zW.call(W,"callee")||LW.call(W)==t)}(W)?function(W,i){for(var L=-1,h=Array(W);++L<W;)h[L]=i(L);return h}(W.length,String):[],h=L.length,l=!!h;for(var p in W)!i&&!iW.call(W,p)||l&&("length"==p||EW(p,h))||L.push(p);return L}function qW(W,i,L){var h=W[i];iW.call(W,i)&&uW(h,L)&&(void 0!==L||i in W)||(W[i]=L)}function HW(W,i){for(var L=W.length;L--;)if(uW(W[L][0],i))return L;return-1}function kW(W,i,L,h,l,s,e){var F;if(h&&(F=s?h(W,l,s,e):h(W)),void 0!==F)return F;if(!OW(W))return W;var q=JW(W);if(q){if(F=function(W){var i=W.length,L=W.constructor(i);i&&"string"==typeof W[0]&&iW.call(W,"index")&&(L.index=W.index,L.input=W.input);return L}(W),!i)return function(W,i){var L=-1,h=W.length;i||(i=Array(h));for(;++L<h;)i[L]=W[L];return i}(W,F)}else{var k=mW(W),U=k==R||k==z;if(vW(W))return function(W,i){if(i)return W.slice();var L=new W.constructor(W.length);return W.copy(L),L}(W,i);if(k==I||k==t||U&&!s){if(K(W))return s?W:{};if(F=function(W){return"function"!=typeof W.constructor||KW(W)?{}:(i=xW(W),OW(i)?RW(i):{});var i}(U?{}:W),!i)return function(W,i){return BW(W,nW(W),i)}(W,function(W,i){return W&&BW(i,YW(i),W)}(F,W))}else{if(!H[k])return s?W:{};F=function(W,i,L,h){var l=W.constructor;switch(i){case V:return dW(W);case p:case x:return new l(+W);case c:return function(W,i){var L=i?dW(W.buffer):W.buffer;return new W.constructor(L,W.byteOffset,W.byteLength)}(W,h);case f:case a:case P:case y:case M:case b:case j:case Z:case X:return function(W,i){var L=i?dW(W.buffer):W.buffer;return new W.constructor(L,W.byteOffset,W.length)}(W,h);case r:return function(W,i,L){return E(i?L(G(W),!0):G(W),n,new W.constructor)}(W,h,L);case N:case S:return new l(W);case o:return function(W){var i=new W.constructor(W.source,T.exec(W));return i.lastIndex=W.lastIndex,i}(W);case D:return function(W,i,L){return E(i?L(J(W),!0):J(W),m,new W.constructor)}(W,h,L);case C:return t=W,bW?Object(bW.call(t)):{}}var t}(W,k,kW,i)}}e||(e=new TW);var d=e.get(W);if(d)return d;if(e.set(W,F),!q)var B=L?function(W){return function(W,i,L){var h=i(W);return JW(W)?h:function(W,i){for(var L=-1,h=i.length,l=W.length;++L<h;)W[l+L]=i[L];return W}(h,L(W))}(W,YW,nW)}(W):YW(W);return function(W,i){for(var L=-1,h=W?W.length:0;++L<h&&!1!==i(W[L],L,W););}(B||W,(function(l,t){B&&(l=W[t=l]),qW(F,t,kW(l,i,L,h,t,W,e))})),F}function UW(W){return!(!OW(W)||(i=W,Y&&Y in i))&&(QW(W)||K(W)?hW:F).test(GW(W));var i}function dW(W){var i=new W.constructor(W.byteLength);return new pW(i).set(new pW(W)),i}function BW(W,i,L,h){L||(L={});for(var l=-1,t=i.length;++l<t;){var p=i[l],x=h?h(L[p],W[p],p,L,W):void 0;qW(L,p,void 0===x?W[p]:x)}return L}function wW(W,i){var L=W.__data__;return function(W){var i=typeof W;return"string"==i||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==W:null===W}(i)?L["string"==typeof i?"string":"hash"]:L.map}function gW(W,i){var L=function(W,i){return null==W?void 0:W[i]}(W,i);return UW(L)?L:void 0}jW.prototype.clear=function(){this.__data__=VW?VW(null):{}},jW.prototype.delete=function(W){return this.has(W)&&delete this.__data__[W]},jW.prototype.get=function(W){var i=this.__data__;if(VW){var L=i[W];return L===h?void 0:L}return iW.call(i,W)?i[W]:void 0},jW.prototype.has=function(W){var i=this.__data__;return VW?void 0!==i[W]:iW.call(i,W)},jW.prototype.set=function(W,i){return this.__data__[W]=VW&&void 0===i?h:i,this},ZW.prototype.clear=function(){this.__data__=[]},ZW.prototype.delete=function(W){var i=this.__data__,L=HW(i,W);return!(L<0)&&(L==i.length-1?i.pop():rW.call(i,L,1),!0)},ZW.prototype.get=function(W){var i=this.__data__,L=HW(i,W);return L<0?void 0:i[L][1]},ZW.prototype.has=function(W){return HW(this.__data__,W)>-1},ZW.prototype.set=function(W,i){var L=this.__data__,h=HW(L,W);return h<0?L.push([W,i]):L[h][1]=i,this},XW.prototype.clear=function(){this.__data__={hash:new jW,map:new(DW||ZW),string:new jW}},XW.prototype.delete=function(W){return wW(this,W).delete(W)},XW.prototype.get=function(W){return wW(this,W).get(W)},XW.prototype.has=function(W){return wW(this,W).has(W)},XW.prototype.set=function(W,i){return wW(this,W).set(W,i),this},TW.prototype.clear=function(){this.__data__=new ZW},TW.prototype.delete=function(W){return this.__data__.delete(W)},TW.prototype.get=function(W){return this.__data__.get(W)},TW.prototype.has=function(W){return this.__data__.has(W)},TW.prototype.set=function(W,i){var L=this.__data__;if(L instanceof ZW){var h=L.__data__;if(!DW||h.length<199)return h.push([W,i]),this;L=this.__data__=new XW(h)}return L.set(W,i),this};var nW=NW?u(NW,Object):function(){return[]},mW=function(W){return LW.call(W)};function EW(W,i){return!!(i=null==i?l:i)&&("number"==typeof W||q.test(W))&&W>-1&&W%1==0&&W<i}function KW(W){var i=W&&W.constructor;return W===("function"==typeof i&&i.prototype||Q)}function GW(W){if(null!=W){try{return WW.call(W)}catch(W){}try{return W+""}catch(W){}}return""}function uW(W,i){return W===i||W!==W&&i!==i}(oW&&mW(new oW(new ArrayBuffer(1)))!=c||DW&&mW(new DW)!=r||SW&&mW(SW.resolve())!=s||CW&&mW(new CW)!=D||eW&&mW(new eW)!=e)&&(mW=function(W){var i=LW.call(W),L=i==I?W.constructor:void 0,h=L?GW(L):void 0;if(h)switch(h){case cW:return c;case fW:return r;case aW:return s;case PW:return D;case yW:return e}return i});var JW=Array.isArray;function AW(W){return null!=W&&function(W){return"number"==typeof W&&W>-1&&W%1==0&&W<=l}(W.length)&&!QW(W)}var vW=IW||function(){return!1};function QW(W){var i=OW(W)?LW.call(W):"";return i==R||i==z}function OW(W){var i=typeof W;return!!W&&("object"==i||"function"==i)}function YW(W){return AW(W)?FW(W):function(W){if(!KW(W))return sW(W);var i=[];for(var L in Object(W))iW.call(W,L)&&"constructor"!=L&&i.push(L);return i}(W)}W.exports=function(W){return kW(W,!0,!0)}},47786:function(W,i,L){var h=L(379),l=L(23110),t="undefined"!==typeof Float64Array;function p(W,i){return W[0]-i[0]}function x(){var W,i=this.stride,L=new Array(i.length);for(W=0;W<L.length;++W)L[W]=[Math.abs(i[W]),W];L.sort(p);var h=new Array(L.length);for(W=0;W<h.length;++W)h[W]=L[W][1];return h}function R(W,i){var L=["View",i,"d",W].join("");i<0&&(L="View_Nil"+W);var l="generic"===W;if(-1===i){var t="function "+L+"(a){this.data=a;};var proto="+L+".prototype;proto.dtype='"+W+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+L+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+L+"(a){return new "+L+"(a);}";return new Function(t)()}if(0===i){t="function "+L+"(a,d) {this.data = a;this.offset = d};var proto="+L+".prototype;proto.dtype='"+W+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+L+"_copy() {return new "+L+"(this.data,this.offset)};proto.pick=function "+L+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+L+"_get(){return "+(l?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+L+"_set(v){return "+(l?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+L+"(a,b,c,d){return new "+L+"(a,d)}";return new Function("TrivialArray",t)(z[W][0])}t=["'use strict'"];var p=h(i),R=p.map((function(W){return"i"+W})),r="this.offset+"+p.map((function(W){return"this.stride["+W+"]*i"+W})).join("+"),N=p.map((function(W){return"b"+W})).join(","),I=p.map((function(W){return"c"+W})).join(",");t.push("function "+L+"(a,"+N+","+I+",d){this.data=a","this.shape=["+N+"]","this.stride=["+I+"]","this.offset=d|0}","var proto="+L+".prototype","proto.dtype='"+W+"'","proto.dimension="+i),t.push("Object.defineProperty(proto,'size',{get:function "+L+"_size(){return "+p.map((function(W){return"this.shape["+W+"]"})).join("*"),"}})"),1===i?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),i<4?(t.push("function "+L+"_order(){"),2===i?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===i&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+L+"_set("+R.join(",")+",v){"),l?t.push("return this.data.set("+r+",v)}"):t.push("return this.data["+r+"]=v}"),t.push("proto.get=function "+L+"_get("+R.join(",")+"){"),l?t.push("return this.data.get("+r+")}"):t.push("return this.data["+r+"]}"),t.push("proto.index=function "+L+"_index(",R.join(),"){return "+r+"}"),t.push("proto.hi=function "+L+"_hi("+R.join(",")+"){return new "+L+"(this.data,"+p.map((function(W){return["(typeof i",W,"!=='number'||i",W,"<0)?this.shape[",W,"]:i",W,"|0"].join("")})).join(",")+","+p.map((function(W){return"this.stride["+W+"]"})).join(",")+",this.offset)}");var s=p.map((function(W){return"a"+W+"=this.shape["+W+"]"})),o=p.map((function(W){return"c"+W+"=this.stride["+W+"]"}));t.push("proto.lo=function "+L+"_lo("+R.join(",")+"){var b=this.offset,d=0,"+s.join(",")+","+o.join(","));for(var D=0;D<i;++D)t.push("if(typeof i"+D+"==='number'&&i"+D+">=0){d=i"+D+"|0;b+=c"+D+"*d;a"+D+"-=d}");t.push("return new "+L+"(this.data,"+p.map((function(W){return"a"+W})).join(",")+","+p.map((function(W){return"c"+W})).join(",")+",b)}"),t.push("proto.step=function "+L+"_step("+R.join(",")+"){var "+p.map((function(W){return"a"+W+"=this.shape["+W+"]"})).join(",")+","+p.map((function(W){return"b"+W+"=this.stride["+W+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(D=0;D<i;++D)t.push("if(typeof i"+D+"==='number'){d=i"+D+"|0;if(d<0){c+=b"+D+"*(a"+D+"-1);a"+D+"=ceil(-a"+D+"/d)}else{a"+D+"=ceil(a"+D+"/d)}b"+D+"*=d}");t.push("return new "+L+"(this.data,"+p.map((function(W){return"a"+W})).join(",")+","+p.map((function(W){return"b"+W})).join(",")+",c)}");var S=new Array(i),C=new Array(i);for(D=0;D<i;++D)S[D]="a[i"+D+"]",C[D]="b[i"+D+"]";t.push("proto.transpose=function "+L+"_transpose("+R+"){"+R.map((function(W,i){return W+"=("+W+"===undefined?"+i+":"+W+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+L+"(this.data,"+S.join(",")+","+C.join(",")+",this.offset)}"),t.push("proto.pick=function "+L+"_pick("+R+"){var a=[],b=[],c=this.offset");for(D=0;D<i;++D)t.push("if(typeof i"+D+"==='number'&&i"+D+">=0){c=(c+this.stride["+D+"]*i"+D+")|0}else{a.push(this.shape["+D+"]);b.push(this.stride["+D+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+L+"(data,shape,stride,offset){return new "+L+"(data,"+p.map((function(W){return"shape["+W+"]"})).join(",")+","+p.map((function(W){return"stride["+W+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(z[W],x)}var z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};W.exports=function(W,i,L,h){if(void 0===W)return(0,z.array[0])([]);"number"===typeof W&&(W=[W]),void 0===i&&(i=[W.length]);var p=i.length;if(void 0===L){L=new Array(p);for(var x=p-1,r=1;x>=0;--x)L[x]=r,r*=i[x]}if(void 0===h){h=0;for(x=0;x<p;++x)L[x]<0&&(h-=(i[x]-1)*L[x])}for(var N=function(W){if(l(W))return"buffer";if(t)switch(Object.prototype.toString.call(W)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(W)?"array":"generic"}(W),I=z[N];I.length<=p+1;)I.push(R(N,I.length-1));return(0,I[p+1])(W,i,L,h)}},13529:function(W){self,W.exports=function(){"use strict";var W={d:function(i,L){for(var h in L)W.o(L,h)&&!W.o(i,h)&&Object.defineProperty(i,h,{enumerable:!0,get:L[h]})},o:function(W,i){return Object.prototype.hasOwnProperty.call(W,i)}},i={};W.d(i,{default:function(){return F}});var L,h=function(W,i){var L=i.x-W.x,h=i.y-W.y;return Math.sqrt(L*L+h*h)},l=function(W){return W*(Math.PI/180)},t=new Map,p=function(W){t.has(W)&&clearTimeout(t.get(W)),t.set(W,setTimeout(W,100))},x=function(W,i,L){for(var h,l=i.split(/[ ,]+/g),t=0;t<l.length;t+=1)h=l[t],W.addEventListener?W.addEventListener(h,L,!1):W.attachEvent&&W.attachEvent(h,L)},R=function(W,i,L){for(var h,l=i.split(/[ ,]+/g),t=0;t<l.length;t+=1)h=l[t],W.removeEventListener?W.removeEventListener(h,L):W.detachEvent&&W.detachEvent(h,L)},z=function(W){return W.preventDefault(),W.type.match(/^touch/)?W.changedTouches:W},r=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},N=function(W,i){i.top||i.right||i.bottom||i.left?(W.style.top=i.top,W.style.right=i.right,W.style.bottom=i.bottom,W.style.left=i.left):(W.style.left=i.x+"px",W.style.top=i.y+"px")},I=function(W,i,L){var h=s(W);for(var l in h)if(h.hasOwnProperty(l))if("string"==typeof i)h[l]=i+" "+L;else{for(var t="",p=0,x=i.length;p<x;p+=1)t+=i[p]+" "+L+", ";h[l]=t.slice(0,-2)}return h},s=function(W){var i={};return i[W]="",["webkit","Moz","o"].forEach((function(L){i[L+W.charAt(0).toUpperCase()+W.slice(1)]=""})),i},o=function(W,i){for(var L in i)i.hasOwnProperty(L)&&(W[L]=i[L]);return W},D=function(W,i){if(W.length)for(var L=0,h=W.length;L<h;L+=1)i(W[L]);else i(W)},S="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,C=!!("ontouchstart"in window),e=!!window.PointerEvent,V=!!window.MSPointerEvent,c={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},f={start:"mousedown",move:"mousemove",end:"mouseup"},a={};function P(){}S?L=c:e?L={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:V?L={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:C?(L=c,a=f):L=f,P.prototype.on=function(W,i){var L,h=this,l=W.split(/[ ,]+/g);h._handlers_=h._handlers_||{};for(var t=0;t<l.length;t+=1)L=l[t],h._handlers_[L]=h._handlers_[L]||[],h._handlers_[L].push(i);return h},P.prototype.off=function(W,i){var L=this;return L._handlers_=L._handlers_||{},void 0===W?L._handlers_={}:void 0===i?L._handlers_[W]=null:L._handlers_[W]&&L._handlers_[W].indexOf(i)>=0&&L._handlers_[W].splice(L._handlers_[W].indexOf(i),1),L},P.prototype.trigger=function(W,i){var L,h=this,l=W.split(/[ ,]+/g);h._handlers_=h._handlers_||{};for(var t=0;t<l.length;t+=1)L=l[t],h._handlers_[L]&&h._handlers_[L].length&&h._handlers_[L].forEach((function(W){W.call(h,{type:L,target:h},i)}))},P.prototype.config=function(W){var i=this;i.options=i.defaults||{},W&&(i.options=function(W,i){var L={};for(var h in W)W.hasOwnProperty(h)&&i.hasOwnProperty(h)?L[h]=i[h]:W.hasOwnProperty(h)&&(L[h]=W[h]);return L}(i.options,W))},P.prototype.bindEvt=function(W,i){var h=this;return h._domHandlers_=h._domHandlers_||{},h._domHandlers_[i]=function(){"function"==typeof h["on"+i]?h["on"+i].apply(h,arguments):console.warn('[WARNING] : Missing "on'+i+'" handler.')},x(W,L[i],h._domHandlers_[i]),a[i]&&x(W,a[i],h._domHandlers_[i]),h},P.prototype.unbindEvt=function(W,i){var h=this;return h._domHandlers_=h._domHandlers_||{},R(W,L[i],h._domHandlers_[i]),a[i]&&R(W,a[i],h._domHandlers_[i]),delete h._domHandlers_[i],this};var y=P;function M(W,i){return this.identifier=i.identifier,this.position=i.position,this.frontPosition=i.frontPosition,this.collection=W,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(i),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=M.id,M.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}M.prototype=new y,M.constructor=M,M.id=0,M.prototype.buildEl=function(W){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},M.prototype.stylize=function(){if(this.options.dataOnly)return this;var W=this.options.fadeTime+"ms",i=function(W,i){var L=s("borderRadius");for(var h in L)L.hasOwnProperty(h)&&(L[h]="0.5rem");return L}(),L=I("transition","opacity",W),h={};return h.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},h.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},h.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},o(h.el,L),"circle"===this.options.shape&&o(h.back,i),o(h.front,i),this.applyStyles(h),this},M.prototype.applyStyles=function(W){for(var i in this.ui)if(this.ui.hasOwnProperty(i))for(var L in W[i])this.ui[i].style[L]=W[i][L];return this},M.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},M.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},M.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},M.prototype.show=function(W){var i=this;return i.options.dataOnly||(clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.addToDom(),i.restCallback(),setTimeout((function(){i.ui.el.style.opacity=1}),0),i.showTimeout=setTimeout((function(){i.trigger("shown",i.instance),"function"==typeof W&&W.call(this)}),i.options.fadeTime)),i},M.prototype.hide=function(W){var i=this;if(i.options.dataOnly)return i;if(i.ui.el.style.opacity=i.options.restOpacity,clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.removeTimeout=setTimeout((function(){var L="dynamic"===i.options.mode?"none":"block";i.ui.el.style.display=L,"function"==typeof W&&W.call(i),i.trigger("hidden",i.instance)}),i.options.fadeTime),i.options.restJoystick){var L=i.options.restJoystick,h={};h.x=!0===L||!1!==L.x?0:i.instance.frontPosition.x,h.y=!0===L||!1!==L.y?0:i.instance.frontPosition.y,i.setPosition(W,h)}return i},M.prototype.setPosition=function(W,i){var L=this;L.frontPosition={x:i.x,y:i.y};var h=L.options.fadeTime+"ms",l={};l.front=I("transition",["transform"],h);var t={front:{}};t.front={transform:"translate("+L.frontPosition.x+"px,"+L.frontPosition.y+"px)"},L.applyStyles(l),L.applyStyles(t),L.restTimeout=setTimeout((function(){"function"==typeof W&&W.call(L),L.restCallback()}),L.options.fadeTime)},M.prototype.restCallback=function(){var W=this,i={};i.front=I("transition","none",""),W.applyStyles(i),W.trigger("rested",W.instance)},M.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},M.prototype.computeDirection=function(W){var i,L,h,l=W.angle.radian,t=Math.PI/4,p=Math.PI/2;if(l>t&&l<3*t&&!W.lockX?i="up":l>-t&&l<=t&&!W.lockY?i="left":l>3*-t&&l<=-t&&!W.lockX?i="down":W.lockY||(i="right"),W.lockY||(L=l>-p&&l<p?"left":"right"),W.lockX||(h=l>0?"up":"down"),W.force>this.options.threshold){var x,R={};for(x in this.direction)this.direction.hasOwnProperty(x)&&(R[x]=this.direction[x]);var z={};for(x in this.direction={x:L,y:h,angle:i},W.direction=this.direction,R)R[x]===this.direction[x]&&(z[x]=!0);if(z.x&&z.y&&z.angle)return W;z.x&&z.y||this.trigger("plain",W),z.x||this.trigger("plain:"+L,W),z.y||this.trigger("plain:"+h,W),z.angle||this.trigger("dir dir:"+i,W)}else this.resetDirection();return W};var b=M;function j(W,i){var L=this;L.nipples=[],L.idles=[],L.actives=[],L.ids=[],L.pressureIntervals={},L.manager=W,L.id=j.id,j.id+=1,L.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},L.config(i),"static"!==L.options.mode&&"semi"!==L.options.mode||(L.options.multitouch=!1),L.options.multitouch||(L.options.maxNumberOfNipples=1);var h=getComputedStyle(L.options.zone.parentElement);return h&&"flex"===h.display&&(L.parentIsFlex=!0),L.updateBox(),L.prepareNipples(),L.bindings(),L.begin(),L.nipples}j.prototype=new y,j.constructor=j,j.id=0,j.prototype.prepareNipples=function(){var W=this,i=W.nipples;i.on=W.on.bind(W),i.off=W.off.bind(W),i.options=W.options,i.destroy=W.destroy.bind(W),i.ids=W.ids,i.id=W.id,i.processOnMove=W.processOnMove.bind(W),i.processOnEnd=W.processOnEnd.bind(W),i.get=function(W){if(void 0===W)return i[0];for(var L=0,h=i.length;L<h;L+=1)if(i[L].identifier===W)return i[L];return!1}},j.prototype.bindings=function(){var W=this;W.bindEvt(W.options.zone,"start"),W.options.zone.style.touchAction="none",W.options.zone.style.msTouchAction="none"},j.prototype.begin=function(){var W=this,i=W.options;if("static"===i.mode){var L=W.createNipple(i.position,W.manager.getIdentifier());L.add(),W.idles.push(L)}},j.prototype.createNipple=function(W,i){var L=this,h=L.manager.scroll,l={},t=L.options,p=L.parentIsFlex?h.x:h.x+L.box.left,x=L.parentIsFlex?h.y:h.y+L.box.top;if(W.x&&W.y)l={x:W.x-p,y:W.y-x};else if(W.top||W.right||W.bottom||W.left){var R=document.createElement("DIV");R.style.display="hidden",R.style.top=W.top,R.style.right=W.right,R.style.bottom=W.bottom,R.style.left=W.left,R.style.position="absolute",t.zone.appendChild(R);var z=R.getBoundingClientRect();t.zone.removeChild(R),l=W,W={x:z.left+h.x,y:z.top+h.y}}var r=new b(L,{color:t.color,size:t.size,threshold:t.threshold,fadeTime:t.fadeTime,dataOnly:t.dataOnly,restJoystick:t.restJoystick,restOpacity:t.restOpacity,mode:t.mode,identifier:i,position:W,zone:t.zone,frontPosition:{x:0,y:0},shape:t.shape});return t.dataOnly||(N(r.ui.el,l),N(r.ui.front,r.frontPosition)),L.nipples.push(r),L.trigger("added "+r.identifier+":added",r),L.manager.trigger("added "+r.identifier+":added",r),L.bindNipple(r),r},j.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},j.prototype.bindNipple=function(W){var i,L=this,h=function(W,h){i=W.type+" "+h.id+":"+W.type,L.trigger(i,h)};W.on("destroyed",L.onDestroyed.bind(L)),W.on("shown hidden rested dir plain",h),W.on("dir:up dir:right dir:down dir:left",h),W.on("plain:up plain:right plain:down plain:left",h)},j.prototype.pressureFn=function(W,i,L){var h=this,l=0;clearInterval(h.pressureIntervals[L]),h.pressureIntervals[L]=setInterval(function(){var L=W.force||W.pressure||W.webkitForce||0;L!==l&&(i.trigger("pressure",L),h.trigger("pressure "+i.identifier+":pressure",L),l=L)}.bind(h),100)},j.prototype.onstart=function(W){var i=this,L=i.options,h=W;return W=z(W),i.updateBox(),D(W,(function(l){i.actives.length<L.maxNumberOfNipples?i.processOnStart(l):h.type.match(/^touch/)&&(Object.keys(i.manager.ids).forEach((function(L){if(Object.values(h.touches).findIndex((function(W){return W.identifier===L}))<0){var l=[W[0]];l.identifier=L,i.processOnEnd(l)}})),i.actives.length<L.maxNumberOfNipples&&i.processOnStart(l))})),i.manager.bindDocument(),!1},j.prototype.processOnStart=function(W){var i,L=this,l=L.options,t=L.manager.getIdentifier(W),p=W.force||W.pressure||W.webkitForce||0,x={x:W.pageX,y:W.pageY},R=L.getOrCreate(t,x);R.identifier!==t&&L.manager.removeIdentifier(R.identifier),R.identifier=t;var z=function(i){i.trigger("start",i),L.trigger("start "+i.id+":start",i),i.show(),p>0&&L.pressureFn(W,i,i.identifier),L.processOnMove(W)};if((i=L.idles.indexOf(R))>=0&&L.idles.splice(i,1),L.actives.push(R),L.ids.push(R.identifier),"semi"!==l.mode)z(R);else{if(!(h(x,R.position)<=l.catchDistance))return R.destroy(),void L.processOnStart(W);z(R)}return R},j.prototype.getOrCreate=function(W,i){var L,h=this,l=h.options;return/(semi|static)/.test(l.mode)?(L=h.idles[0])?(h.idles.splice(0,1),L):"semi"===l.mode?h.createNipple(i,W):(console.warn("Coudln't find the needed nipple."),!1):L=h.createNipple(i,W)},j.prototype.processOnMove=function(W){var i=this,L=i.options,t=i.manager.getIdentifier(W),p=i.nipples.get(t),x=i.manager.scroll;if(function(W){return isNaN(W.buttons)?0!==W.pressure:0!==W.buttons}(W)){if(!p)return console.error("Found zombie joystick with ID "+t),void i.manager.removeIdentifier(t);if(L.dynamicPage){var R=p.el.getBoundingClientRect();p.position={x:x.x+R.left,y:x.y+R.top}}p.identifier=t;var z=p.options.size/2,r={x:W.pageX,y:W.pageY};L.lockX&&(r.y=p.position.y),L.lockY&&(r.x=p.position.x);var N,I,s,o,D,S,C,e,V,c,f=h(r,p.position),a=(N=r,s=(I=p.position).x-N.x,o=I.y-N.y,function(W){return W*(180/Math.PI)}(Math.atan2(o,s))),P=l(a),y=f/z,M={distance:f,position:r};if("circle"===p.options.shape?(D=Math.min(f,z),C=p.position,e=D,c={x:0,y:0},V=l(V=a),c.x=C.x-e*Math.cos(V),c.y=C.y-e*Math.sin(V),S=c):(S=function(W,i,L){return{x:Math.min(Math.max(W.x,i.x-L),i.x+L),y:Math.min(Math.max(W.y,i.y-L),i.y+L)}}(r,p.position,z),D=h(S,p.position)),L.follow){if(f>z){var b=r.x-S.x,j=r.y-S.y;p.position.x+=b,p.position.y+=j,p.el.style.top=p.position.y-(i.box.top+x.y)+"px",p.el.style.left=p.position.x-(i.box.left+x.x)+"px",f=h(r,p.position)}}else r=S,f=D;var Z=r.x-p.position.x,X=r.y-p.position.y;p.frontPosition={x:Z,y:X},L.dataOnly||(p.ui.front.style.transform="translate("+Z+"px,"+X+"px)");var T={identifier:p.identifier,position:r,force:y,pressure:W.force||W.pressure||W.webkitForce||0,distance:f,angle:{radian:P,degree:a},vector:{x:Z/z,y:-X/z},raw:M,instance:p,lockX:L.lockX,lockY:L.lockY};(T=p.computeDirection(T)).angle={radian:l(180-a),degree:180-a},p.trigger("move",T),i.trigger("move "+p.id+":move",T)}else this.processOnEnd(W)},j.prototype.processOnEnd=function(W){var i=this,L=i.options,h=i.manager.getIdentifier(W),l=i.nipples.get(h),t=i.manager.removeIdentifier(l.identifier);l&&(L.dataOnly||l.hide((function(){"dynamic"===L.mode&&(l.trigger("removed",l),i.trigger("removed "+l.id+":removed",l),i.manager.trigger("removed "+l.id+":removed",l),l.destroy())})),clearInterval(i.pressureIntervals[l.identifier]),l.resetDirection(),l.trigger("end",l),i.trigger("end "+l.id+":end",l),i.ids.indexOf(l.identifier)>=0&&i.ids.splice(i.ids.indexOf(l.identifier),1),i.actives.indexOf(l)>=0&&i.actives.splice(i.actives.indexOf(l),1),/(semi|static)/.test(L.mode)?i.idles.push(l):i.nipples.indexOf(l)>=0&&i.nipples.splice(i.nipples.indexOf(l),1),i.manager.unbindDocument(),/(semi|static)/.test(L.mode)&&(i.manager.ids[t.id]=t.identifier))},j.prototype.onDestroyed=function(W,i){var L=this;L.nipples.indexOf(i)>=0&&L.nipples.splice(L.nipples.indexOf(i),1),L.actives.indexOf(i)>=0&&L.actives.splice(L.actives.indexOf(i),1),L.idles.indexOf(i)>=0&&L.idles.splice(L.idles.indexOf(i),1),L.ids.indexOf(i.identifier)>=0&&L.ids.splice(L.ids.indexOf(i.identifier),1),L.manager.removeIdentifier(i.identifier),L.manager.unbindDocument()},j.prototype.destroy=function(){var W=this;for(var i in W.unbindEvt(W.options.zone,"start"),W.nipples.forEach((function(W){W.destroy()})),W.pressureIntervals)W.pressureIntervals.hasOwnProperty(i)&&clearInterval(W.pressureIntervals[i]);W.trigger("destroyed",W.nipples),W.manager.unbindDocument(),W.off()};var Z=j;function X(W){var i=this;i.ids={},i.index=0,i.collections=[],i.scroll=r(),i.config(W),i.prepareCollections();var L=function(){var W;i.collections.forEach((function(L){L.forEach((function(L){W=L.el.getBoundingClientRect(),L.position={x:i.scroll.x+W.left,y:i.scroll.y+W.top}}))}))};x(window,"resize",(function(){p(L)}));var h=function(){i.scroll=r()};return x(window,"scroll",(function(){p(h)})),i.collections}X.prototype=new y,X.constructor=X,X.prototype.prepareCollections=function(){var W=this;W.collections.create=W.create.bind(W),W.collections.on=W.on.bind(W),W.collections.off=W.off.bind(W),W.collections.destroy=W.destroy.bind(W),W.collections.get=function(i){var L;return W.collections.every((function(W){return!(L=W.get(i))})),L}},X.prototype.create=function(W){return this.createCollection(W)},X.prototype.createCollection=function(W){var i=this,L=new Z(i,W);return i.bindCollection(L),i.collections.push(L),L},X.prototype.bindCollection=function(W){var i,L=this,h=function(W,h){i=W.type+" "+h.id+":"+W.type,L.trigger(i,h)};W.on("destroyed",L.onDestroyed.bind(L)),W.on("shown hidden rested dir plain",h),W.on("dir:up dir:right dir:down dir:left",h),W.on("plain:up plain:right plain:down plain:left",h)},X.prototype.bindDocument=function(){var W=this;W.binded||(W.bindEvt(document,"move").bindEvt(document,"end"),W.binded=!0)},X.prototype.unbindDocument=function(W){var i=this;Object.keys(i.ids).length&&!0!==W||(i.unbindEvt(document,"move").unbindEvt(document,"end"),i.binded=!1)},X.prototype.getIdentifier=function(W){var i;return W?void 0===(i=void 0===W.identifier?W.pointerId:W.identifier)&&(i=this.latest||0):i=this.index,void 0===this.ids[i]&&(this.ids[i]=this.index,this.index+=1),this.latest=i,this.ids[i]},X.prototype.removeIdentifier=function(W){var i={};for(var L in this.ids)if(this.ids[L]===W){i.id=L,i.identifier=this.ids[L],delete this.ids[L];break}return i},X.prototype.onmove=function(W){return this.onAny("move",W),!1},X.prototype.onend=function(W){return this.onAny("end",W),!1},X.prototype.oncancel=function(W){return this.onAny("end",W),!1},X.prototype.onAny=function(W,i){var L,h=this,l="processOn"+W.charAt(0).toUpperCase()+W.slice(1);i=z(i);var t=function(W,i,L){L.ids.indexOf(i)>=0&&(L[l](W),W._found_=!0)};return D(i,(function(W){L=h.getIdentifier(W),D(h.collections,t.bind(null,W,L)),W._found_||h.removeIdentifier(L)})),!1},X.prototype.destroy=function(){var W=this;W.unbindDocument(!0),W.ids={},W.index=0,W.collections.forEach((function(W){W.destroy()})),W.off()},X.prototype.onDestroyed=function(W,i){var L=this;if(L.collections.indexOf(i)<0)return!1;L.collections.splice(L.collections.indexOf(i),1)};var T=new X,F={create:function(W){return T.create(W)},factory:T};return i.default}()},77604:function(W,i,L){"use strict";var h=L(70547),l=h.Deflate,t=h.deflate,p=h.deflateRaw,x=h.gzip,R=L(74785),z=R.Inflate,r=R.inflate,N=R.inflateRaw,I=R.ungzip,s=L(27572);W.exports.Deflate=l,W.exports.deflate=t,W.exports.deflateRaw=p,W.exports.gzip=x,W.exports.Inflate=z,W.exports.inflate=r,W.exports.inflateRaw=N,W.exports.ungzip=I,W.exports.constants=s},70547:function(W,i,L){"use strict";var h=L(38106),l=L(16931),t=L(58415),p=L(74274),x=L(70400),R=Object.prototype.toString,z=L(27572),r=z.Z_NO_FLUSH,N=z.Z_SYNC_FLUSH,I=z.Z_FULL_FLUSH,s=z.Z_FINISH,o=z.Z_OK,D=z.Z_STREAM_END,S=z.Z_DEFAULT_COMPRESSION,C=z.Z_DEFAULT_STRATEGY,e=z.Z_DEFLATED;function V(W){this.options=l.assign({level:S,method:e,chunkSize:16384,windowBits:15,memLevel:8,strategy:C},W||{});var i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0;var L=h.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(L!==o)throw new Error(p[L]);if(i.header&&h.deflateSetHeader(this.strm,i.header),i.dictionary){var z;if(z="string"===typeof i.dictionary?t.string2buf(i.dictionary):"[object ArrayBuffer]"===R.call(i.dictionary)?new Uint8Array(i.dictionary):i.dictionary,(L=h.deflateSetDictionary(this.strm,z))!==o)throw new Error(p[L]);this._dict_set=!0}}function c(W,i){var L=new V(i);if(L.push(W,!0),L.err)throw L.msg||p[L.err];return L.result}V.prototype.push=function(W,i){var L,l,p=this.strm,x=this.options.chunkSize;if(this.ended)return!1;for(l=i===~~i?i:!0===i?s:r,"string"===typeof W?p.input=t.string2buf(W):"[object ArrayBuffer]"===R.call(W)?p.input=new Uint8Array(W):p.input=W,p.next_in=0,p.avail_in=p.input.length;;)if(0===p.avail_out&&(p.output=new Uint8Array(x),p.next_out=0,p.avail_out=x),(l===N||l===I)&&p.avail_out<=6)this.onData(p.output.subarray(0,p.next_out)),p.avail_out=0;else{if((L=h.deflate(p,l))===D)return p.next_out>0&&this.onData(p.output.subarray(0,p.next_out)),L=h.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===o;if(0!==p.avail_out){if(l>0&&p.next_out>0)this.onData(p.output.subarray(0,p.next_out)),p.avail_out=0;else if(0===p.avail_in)break}else this.onData(p.output)}return!0},V.prototype.onData=function(W){this.chunks.push(W)},V.prototype.onEnd=function(W){W===o&&(this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=W,this.msg=this.strm.msg},W.exports.Deflate=V,W.exports.deflate=c,W.exports.deflateRaw=function(W,i){return(i=i||{}).raw=!0,c(W,i)},W.exports.gzip=function(W,i){return(i=i||{}).gzip=!0,c(W,i)},W.exports.constants=L(27572)},74785:function(W,i,L){"use strict";var h=L(31833),l=L(16931),t=L(58415),p=L(74274),x=L(70400),R=L(84284),z=Object.prototype.toString,r=L(27572),N=r.Z_NO_FLUSH,I=r.Z_FINISH,s=r.Z_OK,o=r.Z_STREAM_END,D=r.Z_NEED_DICT,S=r.Z_STREAM_ERROR,C=r.Z_DATA_ERROR,e=r.Z_MEM_ERROR;function V(W){this.options=l.assign({chunkSize:65536,windowBits:15,to:""},W||{});var i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||W&&W.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&0===(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0;var L=h.inflateInit2(this.strm,i.windowBits);if(L!==s)throw new Error(p[L]);if(this.header=new R,h.inflateGetHeader(this.strm,this.header),i.dictionary&&("string"===typeof i.dictionary?i.dictionary=t.string2buf(i.dictionary):"[object ArrayBuffer]"===z.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(L=h.inflateSetDictionary(this.strm,i.dictionary))!==s))throw new Error(p[L])}function c(W,i){var L=new V(i);if(L.push(W),L.err)throw L.msg||p[L.err];return L.result}V.prototype.push=function(W,i){var L,l,p,x=this.strm,R=this.options.chunkSize,r=this.options.dictionary;if(this.ended)return!1;for(l=i===~~i?i:!0===i?I:N,"[object ArrayBuffer]"===z.call(W)?x.input=new Uint8Array(W):x.input=W,x.next_in=0,x.avail_in=x.input.length;;){for(0===x.avail_out&&(x.output=new Uint8Array(R),x.next_out=0,x.avail_out=R),(L=h.inflate(x,l))===D&&r&&((L=h.inflateSetDictionary(x,r))===s?L=h.inflate(x,l):L===C&&(L=D));x.avail_in>0&&L===o&&x.state.wrap>0&&0!==W[x.next_in];)h.inflateReset(x),L=h.inflate(x,l);switch(L){case S:case C:case D:case e:return this.onEnd(L),this.ended=!0,!1}if(p=x.avail_out,x.next_out&&(0===x.avail_out||L===o))if("string"===this.options.to){var V=t.utf8border(x.output,x.next_out),c=x.next_out-V,f=t.buf2string(x.output,V);x.next_out=c,x.avail_out=R-c,c&&x.output.set(x.output.subarray(V,V+c),0),this.onData(f)}else this.onData(x.output.length===x.next_out?x.output:x.output.subarray(0,x.next_out));if(L!==s||0!==p){if(L===o)return L=h.inflateEnd(this.strm),this.onEnd(L),this.ended=!0,!0;if(0===x.avail_in)break}}return!0},V.prototype.onData=function(W){this.chunks.push(W)},V.prototype.onEnd=function(W){W===s&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=W,this.msg=this.strm.msg},W.exports.Inflate=V,W.exports.inflate=c,W.exports.inflateRaw=function(W,i){return(i=i||{}).raw=!0,c(W,i)},W.exports.ungzip=c,W.exports.constants=L(27572)},16931:function(W){"use strict";var i=function(W,i){return Object.prototype.hasOwnProperty.call(W,i)};W.exports.assign=function(W){for(var L=Array.prototype.slice.call(arguments,1);L.length;){var h=L.shift();if(h){if("object"!==typeof h)throw new TypeError(h+"must be non-object");for(var l in h)i(h,l)&&(W[l]=h[l])}}return W},W.exports.flattenChunks=function(W){for(var i=0,L=0,h=W.length;L<h;L++)i+=W[L].length;for(var l=new Uint8Array(i),t=0,p=0,x=W.length;t<x;t++){var R=W[t];l.set(R,p),p+=R.length}return l}},58415:function(W){"use strict";var i=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(W){i=!1}for(var L=new Uint8Array(256),h=0;h<256;h++)L[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;L[254]=L[254]=1,W.exports.string2buf=function(W){if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(W);var i,L,h,l,t,p=W.length,x=0;for(l=0;l<p;l++)55296===(64512&(L=W.charCodeAt(l)))&&l+1<p&&56320===(64512&(h=W.charCodeAt(l+1)))&&(L=65536+(L-55296<<10)+(h-56320),l++),x+=L<128?1:L<2048?2:L<65536?3:4;for(i=new Uint8Array(x),t=0,l=0;t<x;l++)55296===(64512&(L=W.charCodeAt(l)))&&l+1<p&&56320===(64512&(h=W.charCodeAt(l+1)))&&(L=65536+(L-55296<<10)+(h-56320),l++),L<128?i[t++]=L:L<2048?(i[t++]=192|L>>>6,i[t++]=128|63&L):L<65536?(i[t++]=224|L>>>12,i[t++]=128|L>>>6&63,i[t++]=128|63&L):(i[t++]=240|L>>>18,i[t++]=128|L>>>12&63,i[t++]=128|L>>>6&63,i[t++]=128|63&L);return i};W.exports.buf2string=function(W,h){var l,t,p=h||W.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(W.subarray(0,h));var x=new Array(2*p);for(t=0,l=0;l<p;){var R=W[l++];if(R<128)x[t++]=R;else{var z=L[R];if(z>4)x[t++]=65533,l+=z-1;else{for(R&=2===z?31:3===z?15:7;z>1&&l<p;)R=R<<6|63&W[l++],z--;z>1?x[t++]=65533:R<65536?x[t++]=R:(R-=65536,x[t++]=55296|R>>10&1023,x[t++]=56320|1023&R)}}}return function(W,L){if(L<65534&&W.subarray&&i)return String.fromCharCode.apply(null,W.length===L?W:W.subarray(0,L));for(var h="",l=0;l<L;l++)h+=String.fromCharCode(W[l]);return h}(x,t)},W.exports.utf8border=function(W,i){(i=i||W.length)>W.length&&(i=W.length);for(var h=i-1;h>=0&&128===(192&W[h]);)h--;return h<0||0===h?i:h+L[W[h]]>i?h:i}},3040:function(W){"use strict";W.exports=function(W,i,L,h){for(var l=65535&W|0,t=W>>>16&65535|0,p=0;0!==L;){L-=p=L>2e3?2e3:L;do{t=t+(l=l+i[h++]|0)|0}while(--p);l%=65521,t%=65521}return l|t<<16|0}},27572:function(W){"use strict";W.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},36558:function(W){"use strict";var i=new Uint32Array(function(){for(var W,i=[],L=0;L<256;L++){W=L;for(var h=0;h<8;h++)W=1&W?3988292384^W>>>1:W>>>1;i[L]=W}return i}());W.exports=function(W,L,h,l){var t=i,p=l+h;W^=-1;for(var x=l;x<p;x++)W=W>>>8^t[255&(W^L[x])];return-1^W}},38106:function(W,i,L){"use strict";var h=L(53226),l=h._tr_init,t=h._tr_stored_block,p=h._tr_flush_block,x=h._tr_tally,R=h._tr_align,z=L(3040),r=L(36558),N=L(74274),I=L(27572),s=I.Z_NO_FLUSH,o=I.Z_PARTIAL_FLUSH,D=I.Z_FULL_FLUSH,S=I.Z_FINISH,C=I.Z_BLOCK,e=I.Z_OK,V=I.Z_STREAM_END,c=I.Z_STREAM_ERROR,f=I.Z_DATA_ERROR,a=I.Z_BUF_ERROR,P=I.Z_DEFAULT_COMPRESSION,y=I.Z_FILTERED,M=I.Z_HUFFMAN_ONLY,b=I.Z_RLE,j=I.Z_FIXED,Z=I.Z_DEFAULT_STRATEGY,X=I.Z_UNKNOWN,T=I.Z_DEFLATED,F=258,q=262,H=103,k=113,U=666,d=function(W,i){return W.msg=N[i],i},B=function(W){return(W<<1)-(W>4?9:0)},w=function(W){for(var i=W.length;--i>=0;)W[i]=0},g=function(W,i,L){return(i<<W.hash_shift^L)&W.hash_mask},n=function(W){var i=W.state,L=i.pending;L>W.avail_out&&(L=W.avail_out),0!==L&&(W.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+L),W.next_out),W.next_out+=L,i.pending_out+=L,W.total_out+=L,W.avail_out-=L,i.pending-=L,0===i.pending&&(i.pending_out=0))},m=function(W,i){p(W,W.block_start>=0?W.block_start:-1,W.strstart-W.block_start,i),W.block_start=W.strstart,n(W.strm)},E=function(W,i){W.pending_buf[W.pending++]=i},K=function(W,i){W.pending_buf[W.pending++]=i>>>8&255,W.pending_buf[W.pending++]=255&i},G=function(W,i,L,h){var l=W.avail_in;return l>h&&(l=h),0===l?0:(W.avail_in-=l,i.set(W.input.subarray(W.next_in,W.next_in+l),L),1===W.state.wrap?W.adler=z(W.adler,i,l,L):2===W.state.wrap&&(W.adler=r(W.adler,i,l,L)),W.next_in+=l,W.total_in+=l,l)},u=function(W,i){var L,h,l=W.max_chain_length,t=W.strstart,p=W.prev_length,x=W.nice_match,R=W.strstart>W.w_size-q?W.strstart-(W.w_size-q):0,z=W.window,r=W.w_mask,N=W.prev,I=W.strstart+F,s=z[t+p-1],o=z[t+p];W.prev_length>=W.good_match&&(l>>=2),x>W.lookahead&&(x=W.lookahead);do{if(z[(L=i)+p]===o&&z[L+p-1]===s&&z[L]===z[t]&&z[++L]===z[t+1]){t+=2,L++;do{}while(z[++t]===z[++L]&&z[++t]===z[++L]&&z[++t]===z[++L]&&z[++t]===z[++L]&&z[++t]===z[++L]&&z[++t]===z[++L]&&z[++t]===z[++L]&&z[++t]===z[++L]&&t<I);if(h=F-(I-t),t=I-F,h>p){if(W.match_start=i,p=h,h>=x)break;s=z[t+p-1],o=z[t+p]}}}while((i=N[i&r])>R&&0!==--l);return p<=W.lookahead?p:W.lookahead},J=function(W){var i,L,h,l,t,p=W.w_size;do{if(l=W.window_size-W.lookahead-W.strstart,W.strstart>=p+(p-q)){W.window.set(W.window.subarray(p,p+p),0),W.match_start-=p,W.strstart-=p,W.block_start-=p,i=L=W.hash_size;do{h=W.head[--i],W.head[i]=h>=p?h-p:0}while(--L);i=L=p;do{h=W.prev[--i],W.prev[i]=h>=p?h-p:0}while(--L);l+=p}if(0===W.strm.avail_in)break;if(L=G(W.strm,W.window,W.strstart+W.lookahead,l),W.lookahead+=L,W.lookahead+W.insert>=3)for(t=W.strstart-W.insert,W.ins_h=W.window[t],W.ins_h=g(W,W.ins_h,W.window[t+1]);W.insert&&(W.ins_h=g(W,W.ins_h,W.window[t+3-1]),W.prev[t&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=t,t++,W.insert--,!(W.lookahead+W.insert<3)););}while(W.lookahead<q&&0!==W.strm.avail_in)},A=function(W,i){for(var L,h;;){if(W.lookahead<q){if(J(W),W.lookahead<q&&i===s)return 1;if(0===W.lookahead)break}if(L=0,W.lookahead>=3&&(W.ins_h=g(W,W.ins_h,W.window[W.strstart+3-1]),L=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),0!==L&&W.strstart-L<=W.w_size-q&&(W.match_length=u(W,L)),W.match_length>=3)if(h=x(W,W.strstart-W.match_start,W.match_length-3),W.lookahead-=W.match_length,W.match_length<=W.max_lazy_match&&W.lookahead>=3){W.match_length--;do{W.strstart++,W.ins_h=g(W,W.ins_h,W.window[W.strstart+3-1]),L=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart}while(0!==--W.match_length);W.strstart++}else W.strstart+=W.match_length,W.match_length=0,W.ins_h=W.window[W.strstart],W.ins_h=g(W,W.ins_h,W.window[W.strstart+1]);else h=x(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++;if(h&&(m(W,!1),0===W.strm.avail_out))return 1}return W.insert=W.strstart<2?W.strstart:2,i===S?(m(W,!0),0===W.strm.avail_out?3:4):W.last_lit&&(m(W,!1),0===W.strm.avail_out)?1:2},v=function(W,i){for(var L,h,l;;){if(W.lookahead<q){if(J(W),W.lookahead<q&&i===s)return 1;if(0===W.lookahead)break}if(L=0,W.lookahead>=3&&(W.ins_h=g(W,W.ins_h,W.window[W.strstart+3-1]),L=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),W.prev_length=W.match_length,W.prev_match=W.match_start,W.match_length=2,0!==L&&W.prev_length<W.max_lazy_match&&W.strstart-L<=W.w_size-q&&(W.match_length=u(W,L),W.match_length<=5&&(W.strategy===y||3===W.match_length&&W.strstart-W.match_start>4096)&&(W.match_length=2)),W.prev_length>=3&&W.match_length<=W.prev_length){l=W.strstart+W.lookahead-3,h=x(W,W.strstart-1-W.prev_match,W.prev_length-3),W.lookahead-=W.prev_length-1,W.prev_length-=2;do{++W.strstart<=l&&(W.ins_h=g(W,W.ins_h,W.window[W.strstart+3-1]),L=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart)}while(0!==--W.prev_length);if(W.match_available=0,W.match_length=2,W.strstart++,h&&(m(W,!1),0===W.strm.avail_out))return 1}else if(W.match_available){if((h=x(W,0,W.window[W.strstart-1]))&&m(W,!1),W.strstart++,W.lookahead--,0===W.strm.avail_out)return 1}else W.match_available=1,W.strstart++,W.lookahead--}return W.match_available&&(h=x(W,0,W.window[W.strstart-1]),W.match_available=0),W.insert=W.strstart<2?W.strstart:2,i===S?(m(W,!0),0===W.strm.avail_out?3:4):W.last_lit&&(m(W,!1),0===W.strm.avail_out)?1:2};function Q(W,i,L,h,l){this.good_length=W,this.max_lazy=i,this.nice_length=L,this.max_chain=h,this.func=l}var O=[new Q(0,0,0,0,(function(W,i){var L=65535;for(L>W.pending_buf_size-5&&(L=W.pending_buf_size-5);;){if(W.lookahead<=1){if(J(W),0===W.lookahead&&i===s)return 1;if(0===W.lookahead)break}W.strstart+=W.lookahead,W.lookahead=0;var h=W.block_start+L;if((0===W.strstart||W.strstart>=h)&&(W.lookahead=W.strstart-h,W.strstart=h,m(W,!1),0===W.strm.avail_out))return 1;if(W.strstart-W.block_start>=W.w_size-q&&(m(W,!1),0===W.strm.avail_out))return 1}return W.insert=0,i===S?(m(W,!0),0===W.strm.avail_out?3:4):(W.strstart>W.block_start&&(m(W,!1),W.strm.avail_out),1)})),new Q(4,4,8,4,A),new Q(4,5,16,8,A),new Q(4,6,32,32,A),new Q(4,4,16,16,v),new Q(8,16,32,32,v),new Q(8,16,128,128,v),new Q(8,32,128,256,v),new Q(32,128,258,1024,v),new Q(32,258,258,4096,v)];function Y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var WW=function(W){if(!W||!W.state)return d(W,c);W.total_in=W.total_out=0,W.data_type=X;var i=W.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap?42:k,W.adler=2===i.wrap?0:1,i.last_flush=s,l(i),e},iW=function(W){var i,L=WW(W);return L===e&&((i=W.state).window_size=2*i.w_size,w(i.head),i.max_lazy_match=O[i.level].max_lazy,i.good_match=O[i.level].good_length,i.nice_match=O[i.level].nice_length,i.max_chain_length=O[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),L},LW=function(W,i,L,h,l,t){if(!W)return c;var p=1;if(i===P&&(i=6),h<0?(p=0,h=-h):h>15&&(p=2,h-=16),l<1||l>9||L!==T||h<8||h>15||i<0||i>9||t<0||t>j)return d(W,c);8===h&&(h=9);var x=new Y;return W.state=x,x.strm=W,x.wrap=p,x.gzhead=null,x.w_bits=h,x.w_size=1<<x.w_bits,x.w_mask=x.w_size-1,x.hash_bits=l+7,x.hash_size=1<<x.hash_bits,x.hash_mask=x.hash_size-1,x.hash_shift=~~((x.hash_bits+3-1)/3),x.window=new Uint8Array(2*x.w_size),x.head=new Uint16Array(x.hash_size),x.prev=new Uint16Array(x.w_size),x.lit_bufsize=1<<l+6,x.pending_buf_size=4*x.lit_bufsize,x.pending_buf=new Uint8Array(x.pending_buf_size),x.d_buf=1*x.lit_bufsize,x.l_buf=3*x.lit_bufsize,x.level=i,x.strategy=t,x.method=L,iW(W)};W.exports.deflateInit=function(W,i){return LW(W,i,T,15,8,Z)},W.exports.deflateInit2=LW,W.exports.deflateReset=iW,W.exports.deflateResetKeep=WW,W.exports.deflateSetHeader=function(W,i){return W&&W.state?2!==W.state.wrap?c:(W.state.gzhead=i,e):c},W.exports.deflate=function(W,i){var L,h;if(!W||!W.state||i>C||i<0)return W?d(W,c):c;var l=W.state;if(!W.output||!W.input&&0!==W.avail_in||l.status===U&&i!==S)return d(W,0===W.avail_out?a:c);l.strm=W;var p=l.last_flush;if(l.last_flush=i,42===l.status)if(2===l.wrap)W.adler=0,E(l,31),E(l,139),E(l,8),l.gzhead?(E(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),E(l,255&l.gzhead.time),E(l,l.gzhead.time>>8&255),E(l,l.gzhead.time>>16&255),E(l,l.gzhead.time>>24&255),E(l,9===l.level?2:l.strategy>=M||l.level<2?4:0),E(l,255&l.gzhead.os),l.gzhead.extra&&l.gzhead.extra.length&&(E(l,255&l.gzhead.extra.length),E(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(W.adler=r(W.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=69):(E(l,0),E(l,0),E(l,0),E(l,0),E(l,0),E(l,9===l.level?2:l.strategy>=M||l.level<2?4:0),E(l,3),l.status=k);else{var z=T+(l.w_bits-8<<4)<<8;z|=(l.strategy>=M||l.level<2?0:l.level<6?1:6===l.level?2:3)<<6,0!==l.strstart&&(z|=32),z+=31-z%31,l.status=k,K(l,z),0!==l.strstart&&(K(l,W.adler>>>16),K(l,65535&W.adler)),W.adler=1}if(69===l.status)if(l.gzhead.extra){for(L=l.pending;l.gzindex<(65535&l.gzhead.extra.length)&&(l.pending!==l.pending_buf_size||(l.gzhead.hcrc&&l.pending>L&&(W.adler=r(W.adler,l.pending_buf,l.pending-L,L)),n(W),L=l.pending,l.pending!==l.pending_buf_size));)E(l,255&l.gzhead.extra[l.gzindex]),l.gzindex++;l.gzhead.hcrc&&l.pending>L&&(W.adler=r(W.adler,l.pending_buf,l.pending-L,L)),l.gzindex===l.gzhead.extra.length&&(l.gzindex=0,l.status=73)}else l.status=73;if(73===l.status)if(l.gzhead.name){L=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>L&&(W.adler=r(W.adler,l.pending_buf,l.pending-L,L)),n(W),L=l.pending,l.pending===l.pending_buf_size)){h=1;break}h=l.gzindex<l.gzhead.name.length?255&l.gzhead.name.charCodeAt(l.gzindex++):0,E(l,h)}while(0!==h);l.gzhead.hcrc&&l.pending>L&&(W.adler=r(W.adler,l.pending_buf,l.pending-L,L)),0===h&&(l.gzindex=0,l.status=91)}else l.status=91;if(91===l.status)if(l.gzhead.comment){L=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>L&&(W.adler=r(W.adler,l.pending_buf,l.pending-L,L)),n(W),L=l.pending,l.pending===l.pending_buf_size)){h=1;break}h=l.gzindex<l.gzhead.comment.length?255&l.gzhead.comment.charCodeAt(l.gzindex++):0,E(l,h)}while(0!==h);l.gzhead.hcrc&&l.pending>L&&(W.adler=r(W.adler,l.pending_buf,l.pending-L,L)),0===h&&(l.status=H)}else l.status=H;if(l.status===H&&(l.gzhead.hcrc?(l.pending+2>l.pending_buf_size&&n(W),l.pending+2<=l.pending_buf_size&&(E(l,255&W.adler),E(l,W.adler>>8&255),W.adler=0,l.status=k)):l.status=k),0!==l.pending){if(n(W),0===W.avail_out)return l.last_flush=-1,e}else if(0===W.avail_in&&B(i)<=B(p)&&i!==S)return d(W,a);if(l.status===U&&0!==W.avail_in)return d(W,a);if(0!==W.avail_in||0!==l.lookahead||i!==s&&l.status!==U){var N=l.strategy===M?function(W,i){for(var L;;){if(0===W.lookahead&&(J(W),0===W.lookahead)){if(i===s)return 1;break}if(W.match_length=0,L=x(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,L&&(m(W,!1),0===W.strm.avail_out))return 1}return W.insert=0,i===S?(m(W,!0),0===W.strm.avail_out?3:4):W.last_lit&&(m(W,!1),0===W.strm.avail_out)?1:2}(l,i):l.strategy===b?function(W,i){for(var L,h,l,t,p=W.window;;){if(W.lookahead<=F){if(J(W),W.lookahead<=F&&i===s)return 1;if(0===W.lookahead)break}if(W.match_length=0,W.lookahead>=3&&W.strstart>0&&(h=p[l=W.strstart-1])===p[++l]&&h===p[++l]&&h===p[++l]){t=W.strstart+F;do{}while(h===p[++l]&&h===p[++l]&&h===p[++l]&&h===p[++l]&&h===p[++l]&&h===p[++l]&&h===p[++l]&&h===p[++l]&&l<t);W.match_length=F-(t-l),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=3?(L=x(W,1,W.match_length-3),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(L=x(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),L&&(m(W,!1),0===W.strm.avail_out))return 1}return W.insert=0,i===S?(m(W,!0),0===W.strm.avail_out?3:4):W.last_lit&&(m(W,!1),0===W.strm.avail_out)?1:2}(l,i):O[l.level].func(l,i);if(3!==N&&4!==N||(l.status=U),1===N||3===N)return 0===W.avail_out&&(l.last_flush=-1),e;if(2===N&&(i===o?R(l):i!==C&&(t(l,0,0,!1),i===D&&(w(l.head),0===l.lookahead&&(l.strstart=0,l.block_start=0,l.insert=0))),n(W),0===W.avail_out))return l.last_flush=-1,e}return i!==S?e:l.wrap<=0?V:(2===l.wrap?(E(l,255&W.adler),E(l,W.adler>>8&255),E(l,W.adler>>16&255),E(l,W.adler>>24&255),E(l,255&W.total_in),E(l,W.total_in>>8&255),E(l,W.total_in>>16&255),E(l,W.total_in>>24&255)):(K(l,W.adler>>>16),K(l,65535&W.adler)),n(W),l.wrap>0&&(l.wrap=-l.wrap),0!==l.pending?e:V)},W.exports.deflateEnd=function(W){if(!W||!W.state)return c;var i=W.state.status;return 42!==i&&69!==i&&73!==i&&91!==i&&i!==H&&i!==k&&i!==U?d(W,c):(W.state=null,i===k?d(W,f):e)},W.exports.deflateSetDictionary=function(W,i){var L=i.length;if(!W||!W.state)return c;var h=W.state,l=h.wrap;if(2===l||1===l&&42!==h.status||h.lookahead)return c;if(1===l&&(W.adler=z(W.adler,i,L,0)),h.wrap=0,L>=h.w_size){0===l&&(w(h.head),h.strstart=0,h.block_start=0,h.insert=0);var t=new Uint8Array(h.w_size);t.set(i.subarray(L-h.w_size,L),0),i=t,L=h.w_size}var p=W.avail_in,x=W.next_in,R=W.input;for(W.avail_in=L,W.next_in=0,W.input=i,J(h);h.lookahead>=3;){var r=h.strstart,N=h.lookahead-2;do{h.ins_h=g(h,h.ins_h,h.window[r+3-1]),h.prev[r&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=r,r++}while(--N);h.strstart=r,h.lookahead=2,J(h)}return h.strstart+=h.lookahead,h.block_start=h.strstart,h.insert=h.lookahead,h.lookahead=0,h.match_length=h.prev_length=2,h.match_available=0,W.next_in=x,W.input=R,W.avail_in=p,h.wrap=l,e},W.exports.deflateInfo="pako deflate (from Nodeca project)"},84284:function(W){"use strict";W.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},36997:function(W){"use strict";W.exports=function(W,i){var L,h,l,t,p,x,R,z,r,N,I,s,o,D,S,C,e,V,c,f,a,P,y,M,b=W.state;L=W.next_in,y=W.input,h=L+(W.avail_in-5),l=W.next_out,M=W.output,t=l-(i-W.avail_out),p=l+(W.avail_out-257),x=b.dmax,R=b.wsize,z=b.whave,r=b.wnext,N=b.window,I=b.hold,s=b.bits,o=b.lencode,D=b.distcode,S=(1<<b.lenbits)-1,C=(1<<b.distbits)-1;W:do{s<15&&(I+=y[L++]<<s,s+=8,I+=y[L++]<<s,s+=8),e=o[I&S];i:for(;;){if(I>>>=V=e>>>24,s-=V,0===(V=e>>>16&255))M[l++]=65535&e;else{if(!(16&V)){if(0===(64&V)){e=o[(65535&e)+(I&(1<<V)-1)];continue i}if(32&V){b.mode=12;break W}W.msg="invalid literal/length code",b.mode=30;break W}c=65535&e,(V&=15)&&(s<V&&(I+=y[L++]<<s,s+=8),c+=I&(1<<V)-1,I>>>=V,s-=V),s<15&&(I+=y[L++]<<s,s+=8,I+=y[L++]<<s,s+=8),e=D[I&C];L:for(;;){if(I>>>=V=e>>>24,s-=V,!(16&(V=e>>>16&255))){if(0===(64&V)){e=D[(65535&e)+(I&(1<<V)-1)];continue L}W.msg="invalid distance code",b.mode=30;break W}if(f=65535&e,s<(V&=15)&&(I+=y[L++]<<s,(s+=8)<V&&(I+=y[L++]<<s,s+=8)),(f+=I&(1<<V)-1)>x){W.msg="invalid distance too far back",b.mode=30;break W}if(I>>>=V,s-=V,f>(V=l-t)){if((V=f-V)>z&&b.sane){W.msg="invalid distance too far back",b.mode=30;break W}if(a=0,P=N,0===r){if(a+=R-V,V<c){c-=V;do{M[l++]=N[a++]}while(--V);a=l-f,P=M}}else if(r<V){if(a+=R+r-V,(V-=r)<c){c-=V;do{M[l++]=N[a++]}while(--V);if(a=0,r<c){c-=V=r;do{M[l++]=N[a++]}while(--V);a=l-f,P=M}}}else if(a+=r-V,V<c){c-=V;do{M[l++]=N[a++]}while(--V);a=l-f,P=M}for(;c>2;)M[l++]=P[a++],M[l++]=P[a++],M[l++]=P[a++],c-=3;c&&(M[l++]=P[a++],c>1&&(M[l++]=P[a++]))}else{a=l-f;do{M[l++]=M[a++],M[l++]=M[a++],M[l++]=M[a++],c-=3}while(c>2);c&&(M[l++]=M[a++],c>1&&(M[l++]=M[a++]))}break}}break}}while(L<h&&l<p);L-=c=s>>3,I&=(1<<(s-=c<<3))-1,W.next_in=L,W.next_out=l,W.avail_in=L<h?h-L+5:5-(L-h),W.avail_out=l<p?p-l+257:257-(l-p),b.hold=I,b.bits=s}},31833:function(W,i,L){"use strict";var h=L(3040),l=L(36558),t=L(36997),p=L(33443),x=L(27572),R=x.Z_FINISH,z=x.Z_BLOCK,r=x.Z_TREES,N=x.Z_OK,I=x.Z_STREAM_END,s=x.Z_NEED_DICT,o=x.Z_STREAM_ERROR,D=x.Z_DATA_ERROR,S=x.Z_MEM_ERROR,C=x.Z_BUF_ERROR,e=x.Z_DEFLATED,V=12,c=30,f=function(W){return(W>>>24&255)+(W>>>8&65280)+((65280&W)<<8)+((255&W)<<24)};function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var P,y,M=function(W){if(!W||!W.state)return o;var i=W.state;return W.total_in=W.total_out=i.total=0,W.msg="",i.wrap&&(W.adler=1&i.wrap),i.mode=1,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,N},b=function(W){if(!W||!W.state)return o;var i=W.state;return i.wsize=0,i.whave=0,i.wnext=0,M(W)},j=function(W,i){var L;if(!W||!W.state)return o;var h=W.state;return i<0?(L=0,i=-i):(L=1+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?o:(null!==h.window&&h.wbits!==i&&(h.window=null),h.wrap=L,h.wbits=i,b(W))},Z=function(W,i){if(!W)return o;var L=new a;W.state=L,L.window=null;var h=j(W,i);return h!==N&&(W.state=null),h},X=!0,T=function(W){if(X){P=new Int32Array(512),y=new Int32Array(32);for(var i=0;i<144;)W.lens[i++]=8;for(;i<256;)W.lens[i++]=9;for(;i<280;)W.lens[i++]=7;for(;i<288;)W.lens[i++]=8;for(p(1,W.lens,0,288,P,0,W.work,{bits:9}),i=0;i<32;)W.lens[i++]=5;p(2,W.lens,0,32,y,0,W.work,{bits:5}),X=!1}W.lencode=P,W.lenbits=9,W.distcode=y,W.distbits=5},F=function(W,i,L,h){var l,t=W.state;return null===t.window&&(t.wsize=1<<t.wbits,t.wnext=0,t.whave=0,t.window=new Uint8Array(t.wsize)),h>=t.wsize?(t.window.set(i.subarray(L-t.wsize,L),0),t.wnext=0,t.whave=t.wsize):((l=t.wsize-t.wnext)>h&&(l=h),t.window.set(i.subarray(L-h,L-h+l),t.wnext),(h-=l)?(t.window.set(i.subarray(L-h,L),0),t.wnext=h,t.whave=t.wsize):(t.wnext+=l,t.wnext===t.wsize&&(t.wnext=0),t.whave<t.wsize&&(t.whave+=l))),0};W.exports.inflateReset=b,W.exports.inflateReset2=j,W.exports.inflateResetKeep=M,W.exports.inflateInit=function(W){return Z(W,15)},W.exports.inflateInit2=Z,W.exports.inflate=function(W,i){var L,x,a,P,y,M,b,j,Z,X,q,H,k,U,d,B,w,g,n,m,E,K,G,u,J=0,A=new Uint8Array(4),v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!W||!W.state||!W.output||!W.input&&0!==W.avail_in)return o;(L=W.state).mode===V&&(L.mode=13),y=W.next_out,a=W.output,b=W.avail_out,P=W.next_in,x=W.input,M=W.avail_in,j=L.hold,Z=L.bits,X=M,q=b,K=N;W:for(;;)switch(L.mode){case 1:if(0===L.wrap){L.mode=13;break}for(;Z<16;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(2&L.wrap&&35615===j){L.check=0,A[0]=255&j,A[1]=j>>>8&255,L.check=l(L.check,A,2,0),j=0,Z=0,L.mode=2;break}if(L.flags=0,L.head&&(L.head.done=!1),!(1&L.wrap)||(((255&j)<<8)+(j>>8))%31){W.msg="incorrect header check",L.mode=c;break}if((15&j)!==e){W.msg="unknown compression method",L.mode=c;break}if(Z-=4,E=8+(15&(j>>>=4)),0===L.wbits)L.wbits=E;else if(E>L.wbits){W.msg="invalid window size",L.mode=c;break}L.dmax=1<<L.wbits,W.adler=L.check=1,L.mode=512&j?10:V,j=0,Z=0;break;case 2:for(;Z<16;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(L.flags=j,(255&L.flags)!==e){W.msg="unknown compression method",L.mode=c;break}if(57344&L.flags){W.msg="unknown header flags set",L.mode=c;break}L.head&&(L.head.text=j>>8&1),512&L.flags&&(A[0]=255&j,A[1]=j>>>8&255,L.check=l(L.check,A,2,0)),j=0,Z=0,L.mode=3;case 3:for(;Z<32;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}L.head&&(L.head.time=j),512&L.flags&&(A[0]=255&j,A[1]=j>>>8&255,A[2]=j>>>16&255,A[3]=j>>>24&255,L.check=l(L.check,A,4,0)),j=0,Z=0,L.mode=4;case 4:for(;Z<16;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}L.head&&(L.head.xflags=255&j,L.head.os=j>>8),512&L.flags&&(A[0]=255&j,A[1]=j>>>8&255,L.check=l(L.check,A,2,0)),j=0,Z=0,L.mode=5;case 5:if(1024&L.flags){for(;Z<16;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}L.length=j,L.head&&(L.head.extra_len=j),512&L.flags&&(A[0]=255&j,A[1]=j>>>8&255,L.check=l(L.check,A,2,0)),j=0,Z=0}else L.head&&(L.head.extra=null);L.mode=6;case 6:if(1024&L.flags&&((H=L.length)>M&&(H=M),H&&(L.head&&(E=L.head.extra_len-L.length,L.head.extra||(L.head.extra=new Uint8Array(L.head.extra_len)),L.head.extra.set(x.subarray(P,P+H),E)),512&L.flags&&(L.check=l(L.check,x,H,P)),M-=H,P+=H,L.length-=H),L.length))break W;L.length=0,L.mode=7;case 7:if(2048&L.flags){if(0===M)break W;H=0;do{E=x[P+H++],L.head&&E&&L.length<65536&&(L.head.name+=String.fromCharCode(E))}while(E&&H<M);if(512&L.flags&&(L.check=l(L.check,x,H,P)),M-=H,P+=H,E)break W}else L.head&&(L.head.name=null);L.length=0,L.mode=8;case 8:if(4096&L.flags){if(0===M)break W;H=0;do{E=x[P+H++],L.head&&E&&L.length<65536&&(L.head.comment+=String.fromCharCode(E))}while(E&&H<M);if(512&L.flags&&(L.check=l(L.check,x,H,P)),M-=H,P+=H,E)break W}else L.head&&(L.head.comment=null);L.mode=9;case 9:if(512&L.flags){for(;Z<16;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(j!==(65535&L.check)){W.msg="header crc mismatch",L.mode=c;break}j=0,Z=0}L.head&&(L.head.hcrc=L.flags>>9&1,L.head.done=!0),W.adler=L.check=0,L.mode=V;break;case 10:for(;Z<32;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}W.adler=L.check=f(j),j=0,Z=0,L.mode=11;case 11:if(0===L.havedict)return W.next_out=y,W.avail_out=b,W.next_in=P,W.avail_in=M,L.hold=j,L.bits=Z,s;W.adler=L.check=1,L.mode=V;case V:if(i===z||i===r)break W;case 13:if(L.last){j>>>=7&Z,Z-=7&Z,L.mode=27;break}for(;Z<3;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}switch(L.last=1&j,Z-=1,3&(j>>>=1)){case 0:L.mode=14;break;case 1:if(T(L),L.mode=20,i===r){j>>>=2,Z-=2;break W}break;case 2:L.mode=17;break;case 3:W.msg="invalid block type",L.mode=c}j>>>=2,Z-=2;break;case 14:for(j>>>=7&Z,Z-=7&Z;Z<32;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if((65535&j)!==(j>>>16^65535)){W.msg="invalid stored block lengths",L.mode=c;break}if(L.length=65535&j,j=0,Z=0,L.mode=15,i===r)break W;case 15:L.mode=16;case 16:if(H=L.length){if(H>M&&(H=M),H>b&&(H=b),0===H)break W;a.set(x.subarray(P,P+H),y),M-=H,P+=H,b-=H,y+=H,L.length-=H;break}L.mode=V;break;case 17:for(;Z<14;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(L.nlen=257+(31&j),j>>>=5,Z-=5,L.ndist=1+(31&j),j>>>=5,Z-=5,L.ncode=4+(15&j),j>>>=4,Z-=4,L.nlen>286||L.ndist>30){W.msg="too many length or distance symbols",L.mode=c;break}L.have=0,L.mode=18;case 18:for(;L.have<L.ncode;){for(;Z<3;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}L.lens[v[L.have++]]=7&j,j>>>=3,Z-=3}for(;L.have<19;)L.lens[v[L.have++]]=0;if(L.lencode=L.lendyn,L.lenbits=7,G={bits:L.lenbits},K=p(0,L.lens,0,19,L.lencode,0,L.work,G),L.lenbits=G.bits,K){W.msg="invalid code lengths set",L.mode=c;break}L.have=0,L.mode=19;case 19:for(;L.have<L.nlen+L.ndist;){for(;B=(J=L.lencode[j&(1<<L.lenbits)-1])>>>16&255,w=65535&J,!((d=J>>>24)<=Z);){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(w<16)j>>>=d,Z-=d,L.lens[L.have++]=w;else{if(16===w){for(u=d+2;Z<u;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(j>>>=d,Z-=d,0===L.have){W.msg="invalid bit length repeat",L.mode=c;break}E=L.lens[L.have-1],H=3+(3&j),j>>>=2,Z-=2}else if(17===w){for(u=d+3;Z<u;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}Z-=d,E=0,H=3+(7&(j>>>=d)),j>>>=3,Z-=3}else{for(u=d+7;Z<u;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}Z-=d,E=0,H=11+(127&(j>>>=d)),j>>>=7,Z-=7}if(L.have+H>L.nlen+L.ndist){W.msg="invalid bit length repeat",L.mode=c;break}for(;H--;)L.lens[L.have++]=E}}if(L.mode===c)break;if(0===L.lens[256]){W.msg="invalid code -- missing end-of-block",L.mode=c;break}if(L.lenbits=9,G={bits:L.lenbits},K=p(1,L.lens,0,L.nlen,L.lencode,0,L.work,G),L.lenbits=G.bits,K){W.msg="invalid literal/lengths set",L.mode=c;break}if(L.distbits=6,L.distcode=L.distdyn,G={bits:L.distbits},K=p(2,L.lens,L.nlen,L.ndist,L.distcode,0,L.work,G),L.distbits=G.bits,K){W.msg="invalid distances set",L.mode=c;break}if(L.mode=20,i===r)break W;case 20:L.mode=21;case 21:if(M>=6&&b>=258){W.next_out=y,W.avail_out=b,W.next_in=P,W.avail_in=M,L.hold=j,L.bits=Z,t(W,q),y=W.next_out,a=W.output,b=W.avail_out,P=W.next_in,x=W.input,M=W.avail_in,j=L.hold,Z=L.bits,L.mode===V&&(L.back=-1);break}for(L.back=0;B=(J=L.lencode[j&(1<<L.lenbits)-1])>>>16&255,w=65535&J,!((d=J>>>24)<=Z);){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(B&&0===(240&B)){for(g=d,n=B,m=w;B=(J=L.lencode[m+((j&(1<<g+n)-1)>>g)])>>>16&255,w=65535&J,!(g+(d=J>>>24)<=Z);){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}j>>>=g,Z-=g,L.back+=g}if(j>>>=d,Z-=d,L.back+=d,L.length=w,0===B){L.mode=26;break}if(32&B){L.back=-1,L.mode=V;break}if(64&B){W.msg="invalid literal/length code",L.mode=c;break}L.extra=15&B,L.mode=22;case 22:if(L.extra){for(u=L.extra;Z<u;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}L.length+=j&(1<<L.extra)-1,j>>>=L.extra,Z-=L.extra,L.back+=L.extra}L.was=L.length,L.mode=23;case 23:for(;B=(J=L.distcode[j&(1<<L.distbits)-1])>>>16&255,w=65535&J,!((d=J>>>24)<=Z);){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(0===(240&B)){for(g=d,n=B,m=w;B=(J=L.distcode[m+((j&(1<<g+n)-1)>>g)])>>>16&255,w=65535&J,!(g+(d=J>>>24)<=Z);){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}j>>>=g,Z-=g,L.back+=g}if(j>>>=d,Z-=d,L.back+=d,64&B){W.msg="invalid distance code",L.mode=c;break}L.offset=w,L.extra=15&B,L.mode=24;case 24:if(L.extra){for(u=L.extra;Z<u;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}L.offset+=j&(1<<L.extra)-1,j>>>=L.extra,Z-=L.extra,L.back+=L.extra}if(L.offset>L.dmax){W.msg="invalid distance too far back",L.mode=c;break}L.mode=25;case 25:if(0===b)break W;if(H=q-b,L.offset>H){if((H=L.offset-H)>L.whave&&L.sane){W.msg="invalid distance too far back",L.mode=c;break}H>L.wnext?(H-=L.wnext,k=L.wsize-H):k=L.wnext-H,H>L.length&&(H=L.length),U=L.window}else U=a,k=y-L.offset,H=L.length;H>b&&(H=b),b-=H,L.length-=H;do{a[y++]=U[k++]}while(--H);0===L.length&&(L.mode=21);break;case 26:if(0===b)break W;a[y++]=L.length,b--,L.mode=21;break;case 27:if(L.wrap){for(;Z<32;){if(0===M)break W;M--,j|=x[P++]<<Z,Z+=8}if(q-=b,W.total_out+=q,L.total+=q,q&&(W.adler=L.check=L.flags?l(L.check,a,q,y-q):h(L.check,a,q,y-q)),q=b,(L.flags?j:f(j))!==L.check){W.msg="incorrect data check",L.mode=c;break}j=0,Z=0}L.mode=28;case 28:if(L.wrap&&L.flags){for(;Z<32;){if(0===M)break W;M--,j+=x[P++]<<Z,Z+=8}if(j!==(4294967295&L.total)){W.msg="incorrect length check",L.mode=c;break}j=0,Z=0}L.mode=29;case 29:K=I;break W;case c:K=D;break W;case 31:return S;default:return o}return W.next_out=y,W.avail_out=b,W.next_in=P,W.avail_in=M,L.hold=j,L.bits=Z,(L.wsize||q!==W.avail_out&&L.mode<c&&(L.mode<27||i!==R))&&F(W,W.output,W.next_out,q-W.avail_out)?(L.mode=31,S):(X-=W.avail_in,q-=W.avail_out,W.total_in+=X,W.total_out+=q,L.total+=q,L.wrap&&q&&(W.adler=L.check=L.flags?l(L.check,a,q,W.next_out-q):h(L.check,a,q,W.next_out-q)),W.data_type=L.bits+(L.last?64:0)+(L.mode===V?128:0)+(20===L.mode||15===L.mode?256:0),(0===X&&0===q||i===R)&&K===N&&(K=C),K)},W.exports.inflateEnd=function(W){if(!W||!W.state)return o;var i=W.state;return i.window&&(i.window=null),W.state=null,N},W.exports.inflateGetHeader=function(W,i){if(!W||!W.state)return o;var L=W.state;return 0===(2&L.wrap)?o:(L.head=i,i.done=!1,N)},W.exports.inflateSetDictionary=function(W,i){var L,l=i.length;return W&&W.state?0!==(L=W.state).wrap&&11!==L.mode?o:11===L.mode&&h(1,i,l,0)!==L.check?D:F(W,i,l,l)?(L.mode=31,S):(L.havedict=1,N):o},W.exports.inflateInfo="pako inflate (from Nodeca project)"},33443:function(W){"use strict";var i=15,L=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),h=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),l=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),t=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);W.exports=function(W,p,x,R,z,r,N,I){var s,o,D,S,C,e,V,c,f,a=I.bits,P=0,y=0,M=0,b=0,j=0,Z=0,X=0,T=0,F=0,q=0,H=null,k=0,U=new Uint16Array(16),d=new Uint16Array(16),B=null,w=0;for(P=0;P<=i;P++)U[P]=0;for(y=0;y<R;y++)U[p[x+y]]++;for(j=a,b=i;b>=1&&0===U[b];b--);if(j>b&&(j=b),0===b)return z[r++]=20971520,z[r++]=20971520,I.bits=1,0;for(M=1;M<b&&0===U[M];M++);for(j<M&&(j=M),T=1,P=1;P<=i;P++)if(T<<=1,(T-=U[P])<0)return-1;if(T>0&&(0===W||1!==b))return-1;for(d[1]=0,P=1;P<i;P++)d[P+1]=d[P]+U[P];for(y=0;y<R;y++)0!==p[x+y]&&(N[d[p[x+y]]++]=y);if(0===W?(H=B=N,e=19):1===W?(H=L,k-=257,B=h,w-=257,e=256):(H=l,B=t,e=-1),q=0,y=0,P=M,C=r,Z=j,X=0,D=-1,S=(F=1<<j)-1,1===W&&F>852||2===W&&F>592)return 1;for(;;){V=P-X,N[y]<e?(c=0,f=N[y]):N[y]>e?(c=B[w+N[y]],f=H[k+N[y]]):(c=96,f=0),s=1<<P-X,M=o=1<<Z;do{z[C+(q>>X)+(o-=s)]=V<<24|c<<16|f|0}while(0!==o);for(s=1<<P-1;q&s;)s>>=1;if(0!==s?(q&=s-1,q+=s):q=0,y++,0===--U[P]){if(P===b)break;P=p[x+N[y]]}if(P>j&&(q&S)!==D){for(0===X&&(X=j),C+=M,T=1<<(Z=P-X);Z+X<b&&!((T-=U[Z+X])<=0);)Z++,T<<=1;if(F+=1<<Z,1===W&&F>852||2===W&&F>592)return 1;z[D=q&S]=j<<24|Z<<16|C-r|0}}return 0!==q&&(z[C+q]=P-X<<24|64<<16|0),I.bits=j,0}},74274:function(W){"use strict";W.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},53226:function(W){"use strict";function i(W){for(var i=W.length;--i>=0;)W[i]=0}var L=256,h=286,l=30,t=15,p=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),x=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),R=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new Array(576);i(r);var N=new Array(60);i(N);var I=new Array(512);i(I);var s=new Array(256);i(s);var o=new Array(29);i(o);var D,S,C,e=new Array(l);function V(W,i,L,h,l){this.static_tree=W,this.extra_bits=i,this.extra_base=L,this.elems=h,this.max_length=l,this.has_stree=W&&W.length}function c(W,i){this.dyn_tree=W,this.max_code=0,this.stat_desc=i}i(e);var f=function(W){return W<256?I[W]:I[256+(W>>>7)]},a=function(W,i){W.pending_buf[W.pending++]=255&i,W.pending_buf[W.pending++]=i>>>8&255},P=function(W,i,L){W.bi_valid>16-L?(W.bi_buf|=i<<W.bi_valid&65535,a(W,W.bi_buf),W.bi_buf=i>>16-W.bi_valid,W.bi_valid+=L-16):(W.bi_buf|=i<<W.bi_valid&65535,W.bi_valid+=L)},y=function(W,i,L){P(W,L[2*i],L[2*i+1])},M=function(W,i){var L=0;do{L|=1&W,W>>>=1,L<<=1}while(--i>0);return L>>>1},b=function(W,i,L){var h,l,p=new Array(16),x=0;for(h=1;h<=t;h++)p[h]=x=x+L[h-1]<<1;for(l=0;l<=i;l++){var R=W[2*l+1];0!==R&&(W[2*l]=M(p[R]++,R))}},j=function(W){var i;for(i=0;i<h;i++)W.dyn_ltree[2*i]=0;for(i=0;i<l;i++)W.dyn_dtree[2*i]=0;for(i=0;i<19;i++)W.bl_tree[2*i]=0;W.dyn_ltree[512]=1,W.opt_len=W.static_len=0,W.last_lit=W.matches=0},Z=function(W){W.bi_valid>8?a(W,W.bi_buf):W.bi_valid>0&&(W.pending_buf[W.pending++]=W.bi_buf),W.bi_buf=0,W.bi_valid=0},X=function(W,i,L,h){var l=2*i,t=2*L;return W[l]<W[t]||W[l]===W[t]&&h[i]<=h[L]},T=function(W,i,L){for(var h=W.heap[L],l=L<<1;l<=W.heap_len&&(l<W.heap_len&&X(i,W.heap[l+1],W.heap[l],W.depth)&&l++,!X(i,h,W.heap[l],W.depth));)W.heap[L]=W.heap[l],L=l,l<<=1;W.heap[L]=h},F=function(W,i,h){var l,t,R,z,r=0;if(0!==W.last_lit)do{l=W.pending_buf[W.d_buf+2*r]<<8|W.pending_buf[W.d_buf+2*r+1],t=W.pending_buf[W.l_buf+r],r++,0===l?y(W,t,i):(R=s[t],y(W,R+L+1,i),0!==(z=p[R])&&(t-=o[R],P(W,t,z)),l--,R=f(l),y(W,R,h),0!==(z=x[R])&&(l-=e[R],P(W,l,z)))}while(r<W.last_lit);y(W,256,i)},q=function(W,i){var L,h,l,p=i.dyn_tree,x=i.stat_desc.static_tree,R=i.stat_desc.has_stree,z=i.stat_desc.elems,r=-1;for(W.heap_len=0,W.heap_max=573,L=0;L<z;L++)0!==p[2*L]?(W.heap[++W.heap_len]=r=L,W.depth[L]=0):p[2*L+1]=0;for(;W.heap_len<2;)p[2*(l=W.heap[++W.heap_len]=r<2?++r:0)]=1,W.depth[l]=0,W.opt_len--,R&&(W.static_len-=x[2*l+1]);for(i.max_code=r,L=W.heap_len>>1;L>=1;L--)T(W,p,L);l=z;do{L=W.heap[1],W.heap[1]=W.heap[W.heap_len--],T(W,p,1),h=W.heap[1],W.heap[--W.heap_max]=L,W.heap[--W.heap_max]=h,p[2*l]=p[2*L]+p[2*h],W.depth[l]=(W.depth[L]>=W.depth[h]?W.depth[L]:W.depth[h])+1,p[2*L+1]=p[2*h+1]=l,W.heap[1]=l++,T(W,p,1)}while(W.heap_len>=2);W.heap[--W.heap_max]=W.heap[1],function(W,i){var L,h,l,p,x,R,z=i.dyn_tree,r=i.max_code,N=i.stat_desc.static_tree,I=i.stat_desc.has_stree,s=i.stat_desc.extra_bits,o=i.stat_desc.extra_base,D=i.stat_desc.max_length,S=0;for(p=0;p<=t;p++)W.bl_count[p]=0;for(z[2*W.heap[W.heap_max]+1]=0,L=W.heap_max+1;L<573;L++)(p=z[2*z[2*(h=W.heap[L])+1]+1]+1)>D&&(p=D,S++),z[2*h+1]=p,h>r||(W.bl_count[p]++,x=0,h>=o&&(x=s[h-o]),R=z[2*h],W.opt_len+=R*(p+x),I&&(W.static_len+=R*(N[2*h+1]+x)));if(0!==S){do{for(p=D-1;0===W.bl_count[p];)p--;W.bl_count[p]--,W.bl_count[p+1]+=2,W.bl_count[D]--,S-=2}while(S>0);for(p=D;0!==p;p--)for(h=W.bl_count[p];0!==h;)(l=W.heap[--L])>r||(z[2*l+1]!==p&&(W.opt_len+=(p-z[2*l+1])*z[2*l],z[2*l+1]=p),h--)}}(W,i),b(p,r,W.bl_count)},H=function(W,i,L){var h,l,t=-1,p=i[1],x=0,R=7,z=4;for(0===p&&(R=138,z=3),i[2*(L+1)+1]=65535,h=0;h<=L;h++)l=p,p=i[2*(h+1)+1],++x<R&&l===p||(x<z?W.bl_tree[2*l]+=x:0!==l?(l!==t&&W.bl_tree[2*l]++,W.bl_tree[32]++):x<=10?W.bl_tree[34]++:W.bl_tree[36]++,x=0,t=l,0===p?(R=138,z=3):l===p?(R=6,z=3):(R=7,z=4))},k=function(W,i,L){var h,l,t=-1,p=i[1],x=0,R=7,z=4;for(0===p&&(R=138,z=3),h=0;h<=L;h++)if(l=p,p=i[2*(h+1)+1],!(++x<R&&l===p)){if(x<z)do{y(W,l,W.bl_tree)}while(0!==--x);else 0!==l?(l!==t&&(y(W,l,W.bl_tree),x--),y(W,16,W.bl_tree),P(W,x-3,2)):x<=10?(y(W,17,W.bl_tree),P(W,x-3,3)):(y(W,18,W.bl_tree),P(W,x-11,7));x=0,t=l,0===p?(R=138,z=3):l===p?(R=6,z=3):(R=7,z=4)}},U=!1,d=function(W,i,L,h){P(W,0+(h?1:0),3),function(W,i,L,h){Z(W),h&&(a(W,L),a(W,~L)),W.pending_buf.set(W.window.subarray(i,i+L),W.pending),W.pending+=L}(W,i,L,!0)};W.exports._tr_init=function(W){U||(!function(){var W,i,L,z,c,f=new Array(16);for(L=0,z=0;z<28;z++)for(o[z]=L,W=0;W<1<<p[z];W++)s[L++]=z;for(s[L-1]=z,c=0,z=0;z<16;z++)for(e[z]=c,W=0;W<1<<x[z];W++)I[c++]=z;for(c>>=7;z<l;z++)for(e[z]=c<<7,W=0;W<1<<x[z]-7;W++)I[256+c++]=z;for(i=0;i<=t;i++)f[i]=0;for(W=0;W<=143;)r[2*W+1]=8,W++,f[8]++;for(;W<=255;)r[2*W+1]=9,W++,f[9]++;for(;W<=279;)r[2*W+1]=7,W++,f[7]++;for(;W<=287;)r[2*W+1]=8,W++,f[8]++;for(b(r,287,f),W=0;W<l;W++)N[2*W+1]=5,N[2*W]=M(W,5);D=new V(r,p,257,h,t),S=new V(N,x,0,l,t),C=new V(new Array(0),R,0,19,7)}(),U=!0),W.l_desc=new c(W.dyn_ltree,D),W.d_desc=new c(W.dyn_dtree,S),W.bl_desc=new c(W.bl_tree,C),W.bi_buf=0,W.bi_valid=0,j(W)},W.exports._tr_stored_block=d,W.exports._tr_flush_block=function(W,i,h,l){var t,p,x=0;W.level>0?(2===W.strm.data_type&&(W.strm.data_type=function(W){var i,h=4093624447;for(i=0;i<=31;i++,h>>>=1)if(1&h&&0!==W.dyn_ltree[2*i])return 0;if(0!==W.dyn_ltree[18]||0!==W.dyn_ltree[20]||0!==W.dyn_ltree[26])return 1;for(i=32;i<L;i++)if(0!==W.dyn_ltree[2*i])return 1;return 0}(W)),q(W,W.l_desc),q(W,W.d_desc),x=function(W){var i;for(H(W,W.dyn_ltree,W.l_desc.max_code),H(W,W.dyn_dtree,W.d_desc.max_code),q(W,W.bl_desc),i=18;i>=3&&0===W.bl_tree[2*z[i]+1];i--);return W.opt_len+=3*(i+1)+5+5+4,i}(W),t=W.opt_len+3+7>>>3,(p=W.static_len+3+7>>>3)<=t&&(t=p)):t=p=h+5,h+4<=t&&-1!==i?d(W,i,h,l):4===W.strategy||p===t?(P(W,2+(l?1:0),3),F(W,r,N)):(P(W,4+(l?1:0),3),function(W,i,L,h){var l;for(P(W,i-257,5),P(W,L-1,5),P(W,h-4,4),l=0;l<h;l++)P(W,W.bl_tree[2*z[l]+1],3);k(W,W.dyn_ltree,i-1),k(W,W.dyn_dtree,L-1)}(W,W.l_desc.max_code+1,W.d_desc.max_code+1,x+1),F(W,W.dyn_ltree,W.dyn_dtree)),j(W),l&&Z(W)},W.exports._tr_tally=function(W,i,h){return W.pending_buf[W.d_buf+2*W.last_lit]=i>>>8&255,W.pending_buf[W.d_buf+2*W.last_lit+1]=255&i,W.pending_buf[W.l_buf+W.last_lit]=255&h,W.last_lit++,0===i?W.dyn_ltree[2*h]++:(W.matches++,i--,W.dyn_ltree[2*(s[h]+L+1)]++,W.dyn_dtree[2*f(i)]++),W.last_lit===W.lit_bufsize-1},W.exports._tr_align=function(W){P(W,2,3),y(W,256,r),function(W){16===W.bi_valid?(a(W,W.bi_buf),W.bi_buf=0,W.bi_valid=0):W.bi_valid>=8&&(W.pending_buf[W.pending++]=255&W.bi_buf,W.bi_buf>>=8,W.bi_valid-=8)}(W)}},70400:function(W){"use strict";W.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},53984:function(W){function i(W,i,L){for(var h=W.length,l=-1/0,t=1/0,p=0;p<h;p++){var x=(L[0][p]-W[p])/i[p],R=(L[1][p]-W[p])/i[p];if(x>R){var z=x;x=R,R=z}if(R<l||x>t)return 1/0;x>l&&(l=x),R<t&&(t=R)}return l>t?1/0:l}W.exports=function(W,L,h,l){var t=i(L,h,l);if(t===1/0)W=null;else{W=W||[];for(var p=0;p<L.length;p++)W[p]=L[p]+h[p]*t}return W},W.exports.distance=i},95319:function(W,i,L){"use strict";L.d(i,{e:function(){return t}});var h=L(47313),l=L(24898),t=function(W){var i=(0,l.d)(W);(0,h.useEffect)((function(){var W=function(W){var L;if(null!=i.current&&(L=i.current(W)),W.defaultPrevented&&(W.returnValue=""),"string"===typeof L)return W.returnValue=L,L};return window.addEventListener("beforeunload",W),function(){window.removeEventListener("beforeunload",W)}}),[])}},52796:function(W,i,L){"use strict";var h=L(41065),l=Array.prototype.concat,t=Array.prototype.slice,p=W.exports=function(W){for(var i=[],L=0,p=W.length;L<p;L++){var x=W[L];h(x)?i=l.call(i,t.call(x)):i.push(x)}return i};p.wrap=function(W){return function(){return W(p(arguments))}}},41065:function(W){W.exports=function(W){return!(!W||"string"===typeof W)&&(W instanceof Array||Array.isArray(W)||W.length>=0&&(W.splice instanceof Function||Object.getOwnPropertyDescriptor(W,W.length-1)&&"String"!==W.constructor.name))}},85882:function(W,i,L){var h=L(83895);function l(W){for(var i,L,l=0,t=W.length,p=0;p<W.length;){for(i=W[p],L=0;p<t&&W[p]===i;)++p,++L;l+=h.log2(L)/7|0,l+=h.log2(i>>>0)/7|0,l+=2}return l}i.size=l,i.encode=function(W,i){i||(i=new Uint8Array(l(W)));for(var L,h,t=0,p=i.length,x=0;x<W.length;){for(L=W[x],h=0;x<W.length&&W[x]===L;)++x,++h;for(;t<p&&h>=128;)i[t++]=128+(127&h),h>>>=7;if(t>=p)throw new Error("RLE buffer overflow");for(i[t++]=h,L>>>=0;t<p&&L>=128;)i[t++]=128+(127&L),L>>>=7;if(t>=p)throw new Error("RLE buffer overflow");i[t++]=L}return i},i.decode=function(W,i){for(var L,h,l,t,p=i.length,x=W.length,R=0,z=0;z<x;){for(L=0,h=0;z<x&&W[z]>=128;)L+=(127&W[z++])<<h,h+=7;if(L+=W[z++]<<h,z>=x)throw new Error("RLE buffer underrun");if(R+L>p)throw new Error("Chunk buffer overflow");for(l=0,h=0;z<x&&W[z]>=128;)l+=(127&W[z++])<<h,h+=7;if(z>=x)throw new Error("RLE buffer underrun");for(l+=W[z++]<<h,t=0;t<L;++t)i[R++]=l}return i}},83895:function(W,i){"use strict";function L(W){var i=32;return(W&=-W)&&i--,65535&W&&(i-=16),16711935&W&&(i-=8),252645135&W&&(i-=4),858993459&W&&(i-=2),1431655765&W&&(i-=1),i}i.INT_BITS=32,i.INT_MAX=2147483647,i.INT_MIN=-1<<31,i.sign=function(W){return(W>0)-(W<0)},i.abs=function(W){var i=W>>31;return(W^i)-i},i.min=function(W,i){return i^(W^i)&-(W<i)},i.max=function(W,i){return W^(W^i)&-(W<i)},i.isPow2=function(W){return!(W&W-1)&&!!W},i.log2=function(W){var i,L;return i=(W>65535)<<4,i|=L=((W>>>=i)>255)<<3,i|=L=((W>>>=L)>15)<<2,(i|=L=((W>>>=L)>3)<<1)|(W>>>=L)>>1},i.log10=function(W){return W>=1e9?9:W>=1e8?8:W>=1e7?7:W>=1e6?6:W>=1e5?5:W>=1e4?4:W>=1e3?3:W>=100?2:W>=10?1:0},i.popCount=function(W){return 16843009*((W=(858993459&(W-=W>>>1&1431655765))+(W>>>2&858993459))+(W>>>4)&252645135)>>>24},i.countTrailingZeros=L,i.nextPow2=function(W){return W+=0===W,--W,W|=W>>>1,W|=W>>>2,W|=W>>>4,W|=W>>>8,(W|=W>>>16)+1},i.prevPow2=function(W){return W|=W>>>1,W|=W>>>2,W|=W>>>4,W|=W>>>8,(W|=W>>>16)-(W>>>1)},i.parity=function(W){return W^=W>>>16,W^=W>>>8,W^=W>>>4,27030>>>(W&=15)&1};var h=new Array(256);!function(W){for(var i=0;i<256;++i){var L=i,h=i,l=7;for(L>>>=1;L;L>>>=1)h<<=1,h|=1&L,--l;W[i]=h<<l&255}}(h),i.reverse=function(W){return h[255&W]<<24|h[W>>>8&255]<<16|h[W>>>16&255]<<8|h[W>>>24&255]},i.interleave2=function(W,i){return(W=1431655765&((W=858993459&((W=252645135&((W=16711935&((W&=65535)|W<<8))|W<<4))|W<<2))|W<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))<<1},i.deinterleave2=function(W,i){return(W=65535&((W=16711935&((W=252645135&((W=858993459&((W=W>>>i&1431655765)|W>>>1))|W>>>2))|W>>>4))|W>>>16))<<16>>16},i.interleave3=function(W,i,L){return W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2),(W|=(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<1)|(L=1227133513&((L=3272356035&((L=251719695&((L=4278190335&((L&=1023)|L<<16))|L<<8))|L<<4))|L<<2))<<2},i.deinterleave3=function(W,i){return(W=1023&((W=4278190335&((W=251719695&((W=3272356035&((W=W>>>i&1227133513)|W>>>2))|W>>>4))|W>>>8))|W>>>16))<<22>>22},i.nextCombination=function(W){var i=W|W-1;return i+1|(~i&-~i)-1>>>L(W)+1}},20477:function(W){"use strict";W.exports=function(W,i,L,h){var l=self||window;try{try{var t;try{t=new l.Blob([W])}catch(i){(t=new(l.BlobBuilder||l.WebKitBlobBuilder||l.MozBlobBuilder||l.MSBlobBuilder)).append(W),t=t.getBlob()}var p=l.URL||l.webkitURL,x=p.createObjectURL(t),R=new l[i](x,L);return p.revokeObjectURL(x),R}catch(h){return new l[i]("data:application/javascript,".concat(encodeURIComponent(W)),L)}}catch(W){if(!h)throw Error("Inline worker is not supported");return new l[i](h,L)}}},53229:function(W,i,L){"use strict";function h(W,i,L,h,l){var t={};return Object.keys(h).forEach((function(W){t[W]=h[W]})),t.enumerable=!!t.enumerable,t.configurable=!!t.configurable,("value"in t||t.initializer)&&(t.writable=!0),t=L.slice().reverse().reduce((function(L,h){return h(W,i,L)||L}),t),l&&void 0!==t.initializer&&(t.value=t.initializer?t.initializer.call(l):void 0,t.initializer=void 0),void 0===t.initializer&&(Object.defineProperty(W,i,t),t=null),t}L.d(i,{d:function(){return h}})},11752:function(W,i,L){"use strict";L.d(i,{d:function(){return t}});var h=L(61120);function l(W,i){for(;!Object.prototype.hasOwnProperty.call(W,i)&&null!==(W=(0,h.d)(W)););return W}function t(){return t="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(W,i,L){var h=l(W,i);if(h){var t=Object.getOwnPropertyDescriptor(h,i);return t.get?t.get.call(arguments.length<3?W:L):t.value}},t.apply(this,arguments)}},43269:function(W,i,L){"use strict";function h(W,i,L,h){L&&Object.defineProperty(W,i,{enumerable:L.enumerable,configurable:L.configurable,writable:L.writable,value:L.initializer?L.initializer.call(h):void 0})}L.d(i,{b:function(){return h}})},21664:function(W,i,L){"use strict";L.d(i,{c:function(){return s}});var h=L(80105),l=L(9488),t=L(96658),p=L(9892),x=L(31709),R=L(25488),z=L(7686),r=L(74134),N=L(2111),I=L(67935),s=function(){function W(i,L,h,l,t,p){this.name=i,this.targetProperty=L,this.framePerSecond=h,this.dataType=l,this.loopMode=t,this.enableBlending=p,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=L.split("."),this.dataType=l,this.loopMode=void 0===t?W.ANIMATIONLOOPMODE_CYCLE:t,this.uniqueId=W._UniqueIdGenerator++}return W._PrepareAnimation=function(i,L,t,p,x,R,z,r){var I=void 0;if(!isNaN(parseFloat(x))&&isFinite(x)?I=W.ANIMATIONTYPE_FLOAT:x instanceof h.g?I=W.ANIMATIONTYPE_QUATERNION:x instanceof h.m?I=W.ANIMATIONTYPE_VECTOR3:x instanceof h.k?I=W.ANIMATIONTYPE_VECTOR2:x instanceof l.d?I=W.ANIMATIONTYPE_COLOR3:x instanceof l.g?I=W.ANIMATIONTYPE_COLOR4:x instanceof N.c&&(I=W.ANIMATIONTYPE_SIZE),void 0==I)return null;var s=new W(i,L,t,I,z),o=[{frame:0,value:x},{frame:p,value:R}];return s.setKeys(o),void 0!==r&&s.setEasingFunction(r),s},W.CreateAnimation=function(i,L,h,l){var t=new W(i+"Animation",i,h,L,W.ANIMATIONLOOPMODE_CONSTANT);return t.setEasingFunction(l),t},W.CreateAndStartAnimation=function(i,L,h,l,t,p,x,R,z,r,N){var I=W._PrepareAnimation(i,h,l,t,p,x,R,z);return I?(L.getScene&&(N=L.getScene()),N?N.beginDirectAnimation(L,[I],0,t,1===I.loopMode,1,r):null):null},W.CreateAndStartHierarchyAnimation=function(i,L,h,l,t,p,x,R,z,r,N){var I=W._PrepareAnimation(i,l,t,p,x,R,z,r);return I?L.getScene().beginDirectHierarchyAnimation(L,h,[I],0,p,1===I.loopMode,1,N):null},W.CreateMergeAndStartAnimation=function(i,L,h,l,t,p,x,R,z,r){var N=W._PrepareAnimation(i,h,l,t,p,x,R,z);return N?(L.animations.push(N),L.getScene().beginAnimation(L,0,t,1===N.loopMode,1,r)):null},W.MakeAnimationAdditive=function(i,L,l,t,p){void 0===L&&(L=0),void 0===t&&(t=!1);var x=i;if(t&&((x=i.clone()).name=p||x.name),!x._keys.length)return x;L=L>=0?L:0;var R=0,z=x._keys[0],r=x._keys.length-1,N=x._keys[r],I={referenceValue:z.value,referencePosition:h.h.Vector3[0],referenceQuaternion:h.h.Quaternion[0],referenceScaling:h.h.Vector3[1],keyPosition:h.h.Vector3[2],keyQuaternion:h.h.Quaternion[1],keyScaling:h.h.Vector3[3]},s=!1,o=z.frame,D=N.frame;if(l){var S=x.getRange(l);S&&(o=S.from,D=S.to)}var C=z.frame===o,e=N.frame===D;if(1===x._keys.length){var V=x._getKeyValue(x._keys[0]);I.referenceValue=V.clone?V.clone():V,s=!0}else if(L<=z.frame){V=x._getKeyValue(z.value);I.referenceValue=V.clone?V.clone():V,s=!0}else if(L>=N.frame){V=x._getKeyValue(N.value);I.referenceValue=V.clone?V.clone():V,s=!0}for(var c=0;!s||!C||!e&&c<x._keys.length-1;){var f=x._keys[c],a=x._keys[c+1];if(!s&&L>=f.frame&&L<=a.frame){V=void 0;if(L===f.frame)V=x._getKeyValue(f.value);else if(L===a.frame)V=x._getKeyValue(a.value);else{var P={key:c,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};V=x._interpolate(L,P)}I.referenceValue=V.clone?V.clone():V,s=!0}if(!C&&o>=f.frame&&o<=a.frame){if(o===f.frame)R=c;else if(o===a.frame)R=c+1;else{P={key:c,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};var y={frame:o,value:(V=x._interpolate(o,P)).clone?V.clone():V};x._keys.splice(c+1,0,y),R=c+1}C=!0}if(!e&&D>=f.frame&&D<=a.frame){if(D===f.frame)r=c;else if(D===a.frame)r=c+1;else{P={key:c,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},y={frame:D,value:(V=x._interpolate(D,P)).clone?V.clone():V};x._keys.splice(c+1,0,y),r=c+1}e=!0}c++}for(x.dataType===W.ANIMATIONTYPE_QUATERNION?I.referenceValue.normalize().conjugateInPlace():x.dataType===W.ANIMATIONTYPE_MATRIX&&(I.referenceValue.decompose(I.referenceScaling,I.referenceQuaternion,I.referencePosition),I.referenceQuaternion.normalize().conjugateInPlace()),c=R;c<=r;c++){y=x._keys[c];if(!c||x.dataType===W.ANIMATIONTYPE_FLOAT||y.value!==z.value)switch(x.dataType){case W.ANIMATIONTYPE_MATRIX:y.value.decompose(I.keyScaling,I.keyQuaternion,I.keyPosition),I.keyPosition.subtractInPlace(I.referencePosition),I.keyScaling.divideInPlace(I.referenceScaling),I.referenceQuaternion.multiplyToRef(I.keyQuaternion,I.keyQuaternion),h.d.ComposeToRef(I.keyScaling,I.keyQuaternion,I.keyPosition,y.value);break;case W.ANIMATIONTYPE_QUATERNION:I.referenceValue.multiplyToRef(y.value,y.value);break;case W.ANIMATIONTYPE_VECTOR2:case W.ANIMATIONTYPE_VECTOR3:case W.ANIMATIONTYPE_COLOR3:case W.ANIMATIONTYPE_COLOR4:y.value.subtractToRef(I.referenceValue,y.value);break;case W.ANIMATIONTYPE_SIZE:y.value.width-=I.referenceValue.width,y.value.height-=I.referenceValue.height;break;default:y.value-=I.referenceValue}}return x},W.TransitionTo=function(W,i,L,h,l,t,p,x){if(void 0===x&&(x=null),p<=0)return L[W]=i,x&&x(),null;var R=l*(p/1e3);t.setKeys([{frame:0,value:L[W].clone?L[W].clone():L[W]},{frame:R,value:i}]),L.animations||(L.animations=[]),L.animations.push(t);var z=h.beginAnimation(L,0,R,!1);return z.onAnimationEnd=x,z},Object.defineProperty(W.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var W=0,i=this._runtimeAnimations;W<i.length;W++){if(!i[W].isStopped())return!0}return!1},enumerable:!1,configurable:!0}),W.prototype.toString=function(W){var i="Name: "+this.name+", property: "+this.targetProperty;if(i+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],i+=", nKeys: "+(this._keys?this._keys.length:"none"),i+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),W){i+=", Ranges: {";var L=!0;for(var h in this._ranges)L&&(i+=", ",L=!1),i+=h;i+="}"}return i},W.prototype.addEvent=function(W){this._events.push(W),this._events.sort((function(W,i){return W.frame-i.frame}))},W.prototype.removeEvents=function(W){for(var i=0;i<this._events.length;i++)this._events[i].frame===W&&(this._events.splice(i,1),i--)},W.prototype.getEvents=function(){return this._events},W.prototype.createRange=function(W,i,L){this._ranges[W]||(this._ranges[W]=new z.e(W,i,L))},W.prototype.deleteRange=function(W,i){void 0===i&&(i=!0);var L=this._ranges[W];if(L){if(i)for(var h=L.from,l=L.to,t=this._keys.length-1;t>=0;t--)this._keys[t].frame>=h&&this._keys[t].frame<=l&&this._keys.splice(t,1);this._ranges[W]=null}},W.prototype.getRange=function(W){return this._ranges[W]},W.prototype.getKeys=function(){return this._keys},W.prototype.getHighestFrame=function(){for(var W=0,i=0,L=this._keys.length;i<L;i++)W<this._keys[i].frame&&(W=this._keys[i].frame);return W},W.prototype.getEasingFunction=function(){return this._easingFunction},W.prototype.setEasingFunction=function(W){this._easingFunction=W},W.prototype.floatInterpolateFunction=function(W,i,L){return t.d.Lerp(W,i,L)},W.prototype.floatInterpolateFunctionWithTangents=function(W,i,L,h,l){return t.d.Hermite(W,i,L,h,l)},W.prototype.quaternionInterpolateFunction=function(W,i,L){return h.g.Slerp(W,i,L)},W.prototype.quaternionInterpolateFunctionWithTangents=function(W,i,L,l,t){return h.g.Hermite(W,i,L,l,t).normalize()},W.prototype.vector3InterpolateFunction=function(W,i,L){return h.m.Lerp(W,i,L)},W.prototype.vector3InterpolateFunctionWithTangents=function(W,i,L,l,t){return h.m.Hermite(W,i,L,l,t)},W.prototype.vector2InterpolateFunction=function(W,i,L){return h.k.Lerp(W,i,L)},W.prototype.vector2InterpolateFunctionWithTangents=function(W,i,L,l,t){return h.k.Hermite(W,i,L,l,t)},W.prototype.sizeInterpolateFunction=function(W,i,L){return N.c.Lerp(W,i,L)},W.prototype.color3InterpolateFunction=function(W,i,L){return l.d.Lerp(W,i,L)},W.prototype.color3InterpolateFunctionWithTangents=function(W,i,L,h,t){return l.d.Hermite(W,i,L,h,t)},W.prototype.color4InterpolateFunction=function(W,i,L){return l.g.Lerp(W,i,L)},W.prototype.color4InterpolateFunctionWithTangents=function(W,i,L,h,t){return l.g.Hermite(W,i,L,h,t)},W.prototype._getKeyValue=function(W){return"function"===typeof W?W():W},W.prototype.evaluate=function(i){return this._interpolate(i,{key:0,repeatCount:0,loopMode:W.ANIMATIONLOOPMODE_CONSTANT})},W.prototype._interpolate=function(i,L){if(L.loopMode===W.ANIMATIONLOOPMODE_CONSTANT&&L.repeatCount>0)return L.highLimitValue.clone?L.highLimitValue.clone():L.highLimitValue;var h=this._keys;if(1===h.length)return this._getKeyValue(h[0].value);var l=L.key;if(h[l].frame>=i)for(;l-1>=0&&h[l].frame>=i;)l--;for(var t=l;t<h.length-1;t++){var p=h[t+1];if(p.frame>=i){L.key=t;var x=h[t],z=this._getKeyValue(x.value),r=this._getKeyValue(p.value);if(x.interpolation===R.e.STEP)return p.frame>i?z:r;var N=void 0!==x.outTangent&&void 0!==p.inTangent,I=p.frame-x.frame,s=(i-x.frame)/I,o=this.getEasingFunction();switch(null!==o&&(s=o.ease(s)),this.dataType){case W.ANIMATIONTYPE_FLOAT:var D=N?this.floatInterpolateFunctionWithTangents(z,x.outTangent*I,r,p.inTangent*I,s):this.floatInterpolateFunction(z,r,s);switch(L.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:return D;case W.ANIMATIONLOOPMODE_RELATIVE:return L.offsetValue*L.repeatCount+D}break;case W.ANIMATIONTYPE_QUATERNION:var S=N?this.quaternionInterpolateFunctionWithTangents(z,x.outTangent.scale(I),r,p.inTangent.scale(I),s):this.quaternionInterpolateFunction(z,r,s);switch(L.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:return S;case W.ANIMATIONLOOPMODE_RELATIVE:return S.addInPlace(L.offsetValue.scale(L.repeatCount))}return S;case W.ANIMATIONTYPE_VECTOR3:var C=N?this.vector3InterpolateFunctionWithTangents(z,x.outTangent.scale(I),r,p.inTangent.scale(I),s):this.vector3InterpolateFunction(z,r,s);switch(L.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:return C;case W.ANIMATIONLOOPMODE_RELATIVE:return C.add(L.offsetValue.scale(L.repeatCount))}break;case W.ANIMATIONTYPE_VECTOR2:var e=N?this.vector2InterpolateFunctionWithTangents(z,x.outTangent.scale(I),r,p.inTangent.scale(I),s):this.vector2InterpolateFunction(z,r,s);switch(L.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:return e;case W.ANIMATIONLOOPMODE_RELATIVE:return e.add(L.offsetValue.scale(L.repeatCount))}break;case W.ANIMATIONTYPE_SIZE:switch(L.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(z,r,s);case W.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(z,r,s).add(L.offsetValue.scale(L.repeatCount))}break;case W.ANIMATIONTYPE_COLOR3:var V=N?this.color3InterpolateFunctionWithTangents(z,x.outTangent.scale(I),r,p.inTangent.scale(I),s):this.color3InterpolateFunction(z,r,s);switch(L.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:return V;case W.ANIMATIONLOOPMODE_RELATIVE:return V.add(L.offsetValue.scale(L.repeatCount))}break;case W.ANIMATIONTYPE_COLOR4:var c=N?this.color4InterpolateFunctionWithTangents(z,x.outTangent.scale(I),r,p.inTangent.scale(I),s):this.color4InterpolateFunction(z,r,s);switch(L.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:return c;case W.ANIMATIONLOOPMODE_RELATIVE:return c.add(L.offsetValue.scale(L.repeatCount))}break;case W.ANIMATIONTYPE_MATRIX:switch(L.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:return W.AllowMatricesInterpolation?this.matrixInterpolateFunction(z,r,s,L.workValue):z;case W.ANIMATIONLOOPMODE_RELATIVE:return z}}break}}return this._getKeyValue(h[h.length-1].value)},W.prototype.matrixInterpolateFunction=function(i,L,l,t){return W.AllowMatrixDecomposeForInterpolation?t?(h.d.DecomposeLerpToRef(i,L,l,t),t):h.d.DecomposeLerp(i,L,l):t?(h.d.LerpToRef(i,L,l,t),t):h.d.Lerp(i,L,l)},W.prototype.clone=function(){var i=new W(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(i.enableBlending=this.enableBlending,i.blendingSpeed=this.blendingSpeed,this._keys&&i.setKeys(this._keys),this._ranges)for(var L in i._ranges={},this._ranges){var h=this._ranges[L];h&&(i._ranges[L]=h.clone())}return i},W.prototype.setKeys=function(W){this._keys=W.slice(0)},W.prototype.serialize=function(){var i={};i.name=this.name,i.property=this.targetProperty,i.framePerSecond=this.framePerSecond,i.dataType=this.dataType,i.loopBehavior=this.loopMode,i.enableBlending=this.enableBlending,i.blendingSpeed=this.blendingSpeed;var L=this.dataType;i.keys=[];for(var h=this.getKeys(),l=0;l<h.length;l++){var t=h[l],p={};switch(p.frame=t.frame,L){case W.ANIMATIONTYPE_FLOAT:p.values=[t.value],void 0!==t.inTangent&&p.values.push(t.inTangent),void 0!==t.outTangent&&(void 0===t.inTangent&&p.values.push(void 0),p.values.push(t.outTangent)),void 0!==t.interpolation&&(void 0===t.inTangent&&p.values.push(void 0),void 0===t.outTangent&&p.values.push(void 0),p.values.push(t.interpolation));break;case W.ANIMATIONTYPE_QUATERNION:case W.ANIMATIONTYPE_MATRIX:case W.ANIMATIONTYPE_VECTOR3:case W.ANIMATIONTYPE_COLOR3:case W.ANIMATIONTYPE_COLOR4:p.values=t.value.asArray(),void 0!=t.inTangent&&p.values.push(t.inTangent.asArray()),void 0!=t.outTangent&&(void 0===t.inTangent&&p.values.push(void 0),p.values.push(t.outTangent.asArray())),void 0!==t.interpolation&&(void 0===t.inTangent&&p.values.push(void 0),void 0===t.outTangent&&p.values.push(void 0),p.values.push(t.interpolation))}i.keys.push(p)}for(var x in i.ranges=[],this._ranges){var R=this._ranges[x];if(R){var z={};z.name=x,z.from=R.from,z.to=R.to,i.ranges.push(z)}}return i},W._UniversalLerp=function(W,i,L){var h=W.constructor;return h.Lerp?h.Lerp(W,i,L):h.Slerp?h.Slerp(W,i,L):W.toFixed?W*(1-L)+L*i:i},W.Parse=function(i){var L,t,p=new W(i.name,i.property,i.framePerSecond,i.dataType,i.loopBehavior),x=i.dataType,R=[];for(i.enableBlending&&(p.enableBlending=i.enableBlending),i.blendingSpeed&&(p.blendingSpeed=i.blendingSpeed),t=0;t<i.keys.length;t++){var z=i.keys[t],r=void 0,N=void 0,I=void 0;switch(x){case W.ANIMATIONTYPE_FLOAT:L=z.values[0],z.values.length>=2&&(r=z.values[1]),z.values.length>=3&&(N=z.values[2]),z.values.length>=4&&(I=z.values[3]);break;case W.ANIMATIONTYPE_QUATERNION:if(L=h.g.FromArray(z.values),z.values.length>=8){var s=h.g.FromArray(z.values.slice(4,8));s.equals(h.g.Zero())||(r=s)}if(z.values.length>=12){var o=h.g.FromArray(z.values.slice(8,12));o.equals(h.g.Zero())||(N=o)}z.values.length>=13&&(I=z.values[12]);break;case W.ANIMATIONTYPE_MATRIX:L=h.d.FromArray(z.values),z.values.length>=17&&(I=z.values[16]);break;case W.ANIMATIONTYPE_COLOR3:L=l.d.FromArray(z.values),z.values[3]&&(r=l.d.FromArray(z.values[3])),z.values[4]&&(N=l.d.FromArray(z.values[4])),z.values[5]&&(I=z.values[5]);break;case W.ANIMATIONTYPE_COLOR4:L=l.g.FromArray(z.values),z.values[4]&&(r=l.g.FromArray(z.values[4])),z.values[5]&&(N=l.g.FromArray(z.values[5])),z.values[6]&&(I=l.g.FromArray(z.values[6]));break;case W.ANIMATIONTYPE_VECTOR3:default:L=h.m.FromArray(z.values),z.values[3]&&(r=h.m.FromArray(z.values[3])),z.values[4]&&(N=h.m.FromArray(z.values[4])),z.values[5]&&(I=z.values[5])}var D={};D.frame=z.frame,D.value=L,void 0!=r&&(D.inTangent=r),void 0!=N&&(D.outTangent=N),void 0!=I&&(D.interpolation=I),R.push(D)}if(p.setKeys(R),i.ranges)for(t=0;t<i.ranges.length;t++)L=i.ranges[t],p.createRange(L.name,L.from,L.to);return p},W.AppendSerializedAnimations=function(W,i){p.d.AppendSerializedAnimations(W,i)},W.ParseFromFileAsync=function(W,i){var L=this;return new Promise((function(h,l){var t=new I.d;t.addEventListener("readystatechange",(function(){if(4==t.readyState)if(200==t.status){var i=JSON.parse(t.responseText);if(i.animations&&(i=i.animations),i.length){for(var p=new Array,x=0,R=i;x<R.length;x++){var z=R[x];p.push(L.Parse(z))}h(p)}else{p=L.Parse(i);W&&(p.name=W),h(p)}}else l("Unable to load the animation")})),t.open("GET",i),t.send()}))},W.CreateFromSnippetAsync=function(W){var i=this;return new Promise((function(L,h){var l=new I.d;l.addEventListener("readystatechange",(function(){if(4==l.readyState)if(200==l.status){var t=JSON.parse(JSON.parse(l.responseText).jsonPayload);if(t.animations){for(var p=JSON.parse(t.animations),x=new Array,R=0,z=p.animations;R<z.length;R++){var r=z[R];(N=i.Parse(r)).snippetId=W,x.push(N)}L(x)}else{var N;p=JSON.parse(t.animation);(N=i.Parse(p)).snippetId=W,L(N)}}else h("Unable to load the snippet "+W)})),l.open("GET",i.SnippetUrl+"/"+W.replace(/#/g,"/")),l.send()}))},W._UniqueIdGenerator=0,W.AllowMatricesInterpolation=!1,W.AllowMatrixDecomposeForInterpolation=!0,W.SnippetUrl="https://snippet.babylonjs.com",W.ANIMATIONTYPE_FLOAT=0,W.ANIMATIONTYPE_VECTOR3=1,W.ANIMATIONTYPE_QUATERNION=2,W.ANIMATIONTYPE_MATRIX=3,W.ANIMATIONTYPE_COLOR3=4,W.ANIMATIONTYPE_COLOR4=7,W.ANIMATIONTYPE_VECTOR2=5,W.ANIMATIONTYPE_SIZE=6,W.ANIMATIONLOOPMODE_RELATIVE=0,W.ANIMATIONLOOPMODE_CYCLE=1,W.ANIMATIONLOOPMODE_CONSTANT=2,W}();(0,x.c)("BABYLON.Animation",s),r.b._AnimationRangeFactory=function(W,i,L){return new z.e(W,i,L)}},25488:function(W,i,L){"use strict";var h;L.d(i,{e:function(){return h}}),function(W){W[W.NONE=0]="NONE",W[W.STEP=1]="STEP"}(h||(h={}))},7686:function(W,i,L){"use strict";L.d(i,{e:function(){return h}});var h=function(){function W(W,i,L){this.name=W,this.from=i,this.to=L}return W.prototype.clone=function(){return new W(this.name,this.from,this.to)},W}()},4268:function(W,i,L){"use strict";L.d(i,{e:function(){return H}});var h=L(40061),l=L(9892),t=L(9271),p=L(80105),x=L(74134),R=L(65847),z=L(25239),r=L(19500),N=L(61686),I=function(){function W(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(W.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(W){this._zoomStopsAnimation=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(W){this._idleRotationSpeed=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(W){this._idleRotationWaitTime=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(W){this._idleRotationSpinupTime=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),W.prototype.init=function(){},W.prototype.attach=function(W){var i=this;this._attachedCamera=W;var L=this._attachedCamera.getScene();this._onPrePointerObservableObserver=L.onPrePointerObservable.add((function(W){W.type!==z.e.POINTERDOWN?W.type===z.e.POINTERUP&&(i._isPointerDown=!1):i._isPointerDown=!0})),this._onAfterCheckInputsObserver=W.onAfterCheckInputsObservable.add((function(){if(!i._reachTargetAlpha()){var W=r.e.Now,L=0;null!=i._lastFrameTime&&(L=W-i._lastFrameTime),i._lastFrameTime=W,i._applyUserInteraction();var h=W-i._lastInteractionTime-i._idleRotationWaitTime,l=Math.max(Math.min(h/i._idleRotationSpinupTime,1),0);i._cameraRotationSpeed=i._idleRotationSpeed*l,i._attachedCamera&&(i._attachedCamera.alpha-=i._cameraRotationSpeed*(L/1e3))}}))},W.prototype.detach=function(){if(this._attachedCamera){var W=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&W.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},W.prototype.resetLastInteractionTime=function(W){this._lastInteractionTime=null!==W&&void 0!==W?W:r.e.Now},W.prototype._reachTargetAlpha=function(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<N.e},W.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},W.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var W=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(W=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?W:this._userIsZooming()},W.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=r.e.Now)},W.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},W}(),s=L(12476),o=function(){function W(){this._easingMode=W.EASINGMODE_EASEIN}return W.prototype.setEasingMode=function(W){var i=Math.min(Math.max(W,0),2);this._easingMode=i},W.prototype.getEasingMode=function(){return this._easingMode},W.prototype.easeInCore=function(W){throw new Error("You must implement this method")},W.prototype.ease=function(i){switch(this._easingMode){case W.EASINGMODE_EASEIN:return this.easeInCore(i);case W.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-i)}return i>=.5?.5*(1-this.easeInCore(2*(1-i)))+.5:.5*this.easeInCore(2*i)},W.EASINGMODE_EASEIN=0,W.EASINGMODE_EASEOUT=1,W.EASINGMODE_EASEINOUT=2,W}(),D=(function(W){function i(){return null!==W&&W.apply(this,arguments)||this}(0,h.n)(i,W),i.prototype.easeInCore=function(W){return W=Math.max(0,Math.min(1,W)),1-Math.sqrt(1-W*W)}}(o),function(W){function i(i){void 0===i&&(i=1);var L=W.call(this)||this;return L.amplitude=i,L}return(0,h.n)(i,W),i.prototype.easeInCore=function(W){var i=Math.max(0,this.amplitude);return Math.pow(W,3)-W*i*Math.sin(3.141592653589793*W)},i}(o)),S=(function(W){function i(i,L){void 0===i&&(i=3),void 0===L&&(L=2);var h=W.call(this)||this;return h.bounces=i,h.bounciness=L,h}(0,h.n)(i,W),i.prototype.easeInCore=function(W){var i=Math.max(0,this.bounces),L=this.bounciness;L<=1&&(L=1.001);var h=Math.pow(L,i),l=1-L,t=(1-h)/l+.5*h,p=W*t,x=Math.log(-p*(1-L)+1)/Math.log(L),R=Math.floor(x),z=R+1,r=(1-Math.pow(L,R))/(l*t),N=.5*(r+(1-Math.pow(L,z))/(l*t)),I=W-N,s=N-r;return-Math.pow(1/L,i-R)/(s*s)*(I-s)*(I+s)}}(o),function(W){function i(){return null!==W&&W.apply(this,arguments)||this}(0,h.n)(i,W),i.prototype.easeInCore=function(W){return W*W*W}}(o),function(W){function i(i,L){void 0===i&&(i=3),void 0===L&&(L=3);var h=W.call(this)||this;return h.oscillations=i,h.springiness=L,h}(0,h.n)(i,W),i.prototype.easeInCore=function(W){var i=Math.max(0,this.oscillations),L=Math.max(0,this.springiness);return(0==L?W:(Math.exp(L*W)-1)/(Math.exp(L)-1))*Math.sin((6.283185307179586*i+1.5707963267948966)*W)}}(o),function(W){function i(i){void 0===i&&(i=2);var L=W.call(this)||this;return L.exponent=i,L}return(0,h.n)(i,W),i.prototype.easeInCore=function(W){return this.exponent<=0?W:(Math.exp(this.exponent*W)-1)/(Math.exp(this.exponent)-1)},i}(o)),C=(function(W){function i(i){void 0===i&&(i=2);var L=W.call(this)||this;return L.power=i,L}(0,h.n)(i,W),i.prototype.easeInCore=function(W){var i=Math.max(0,this.power);return Math.pow(W,i)}}(o),function(W){function i(){return null!==W&&W.apply(this,arguments)||this}(0,h.n)(i,W),i.prototype.easeInCore=function(W){return W*W}}(o),function(W){function i(){return null!==W&&W.apply(this,arguments)||this}(0,h.n)(i,W),i.prototype.easeInCore=function(W){return W*W*W*W}}(o),function(W){function i(){return null!==W&&W.apply(this,arguments)||this}(0,h.n)(i,W),i.prototype.easeInCore=function(W){return W*W*W*W*W}}(o),function(W){function i(){return null!==W&&W.apply(this,arguments)||this}(0,h.n)(i,W),i.prototype.easeInCore=function(W){return 1-Math.sin(1.5707963267948966*(1-W))}}(o),function(W){function i(i,L,h,l){void 0===i&&(i=0),void 0===L&&(L=0),void 0===h&&(h=1),void 0===l&&(l=1);var t=W.call(this)||this;return t.x1=i,t.y1=L,t.x2=h,t.y2=l,t}(0,h.n)(i,W),i.prototype.easeInCore=function(W){return s.c.Interpolate(W,this.x1,this.y1,this.x2,this.y2)}}(o),L(21664)),e=function(){function W(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(W.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(W){var i=this;if(this._autoTransitionRange!==W){this._autoTransitionRange=W;var L=this._attachedCamera;L&&(W?this._onMeshTargetChangedObserver=L.onMeshTargetChangedObservable.add((function(W){if(W){W.computeWorldMatrix(!0);var L=W.getBoundingInfo().diagonalLength;i.lowerRadiusTransitionRange=.05*L,i.upperRadiusTransitionRange=.05*L}})):this._onMeshTargetChangedObserver&&L.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),W.prototype.init=function(){},W.prototype.attach=function(W){var i=this;this._attachedCamera=W,this._onAfterCheckInputsObserver=W.onAfterCheckInputsObservable.add((function(){i._attachedCamera&&(i._isRadiusAtLimit(i._attachedCamera.lowerRadiusLimit)&&i._applyBoundRadiusAnimation(i.lowerRadiusTransitionRange),i._isRadiusAtLimit(i._attachedCamera.upperRadiusLimit)&&i._applyBoundRadiusAnimation(i.upperRadiusTransitionRange))}))},W.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},W.prototype._isRadiusAtLimit=function(W){return!!this._attachedCamera&&(this._attachedCamera.radius===W&&!this._radiusIsAnimating)},W.prototype._applyBoundRadiusAnimation=function(i){var L=this;if(this._attachedCamera){this._radiusBounceTransition||(W.EasingFunction.setEasingMode(W.EasingMode),this._radiusBounceTransition=C.c.CreateAnimation("radius",C.c.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var h=C.c.TransitionTo("radius",this._attachedCamera.radius+i,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(function(){return L._clearAnimationLocks()}));h&&this._animatables.push(h)}},W.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},W.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},W.EasingFunction=new D(.3),W.EasingMode=o.EASINGMODE_EASEOUT,W}(),V=function(){function W(){this.onTargetFramingAnimationEndObservable=new t.c,this._mode=W.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(W.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"mode",{get:function(){return this._mode},set:function(W){this._mode=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(W){this._radiusScale=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"positionScale",{get:function(){return this._positionScale},set:function(W){this._positionScale=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(W){this._defaultElevation=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(W){this._elevationReturnTime=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(W){this._elevationReturnWaitTime=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(W){this._zoomStopsAnimation=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"framingTime",{get:function(){return this._framingTime},set:function(W){this._framingTime=W},enumerable:!1,configurable:!0}),W.prototype.init=function(){},W.prototype.attach=function(i){var L=this;this._attachedCamera=i;var h=this._attachedCamera.getScene();W.EasingFunction.setEasingMode(W.EasingMode),this._onPrePointerObservableObserver=h.onPrePointerObservable.add((function(W){W.type!==z.e.POINTERDOWN?W.type===z.e.POINTERUP&&(L._isPointerDown=!1):L._isPointerDown=!0})),this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add((function(W){W&&L.zoomOnMesh(W,void 0,(function(){L.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=i.onAfterCheckInputsObservable.add((function(){L._applyUserInteraction(),L._maintainCameraAboveGround()}))},W.prototype.detach=function(){if(this._attachedCamera){var W=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&W.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},W.prototype.zoomOnMesh=function(W,i,L){void 0===i&&(i=!1),void 0===L&&(L=null),W.computeWorldMatrix(!0);var h=W.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(h.minimumWorld,h.maximumWorld,i,L)},W.prototype.zoomOnMeshHierarchy=function(W,i,L){void 0===i&&(i=!1),void 0===L&&(L=null),W.computeWorldMatrix(!0);var h=W.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(h.min,h.max,i,L)},W.prototype.zoomOnMeshesHierarchy=function(W,i,L){void 0===i&&(i=!1),void 0===L&&(L=null);for(var h=new p.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new p.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),t=0;t<W.length;t++){var x=W[t].getHierarchyBoundingVectors(!0);p.m.CheckExtends(x.min,h,l),p.m.CheckExtends(x.max,h,l)}this.zoomOnBoundingInfo(h,l,i,L)},W.prototype.zoomOnBoundingInfo=function(i,L,h,l){var t,x=this;if(void 0===h&&(h=!1),void 0===l&&(l=null),this._attachedCamera){var R=i.y,z=R+(L.y-R)*this._positionScale,r=L.subtract(i).scale(.5);if(h)t=new p.m(0,z,0);else{var N=i.add(r);t=new p.m(N.x,z,N.z)}this._vectorTransition||(this._vectorTransition=C.c.CreateAnimation("target",C.c.ANIMATIONTYPE_VECTOR3,60,W.EasingFunction)),this._betaIsAnimating=!0;var I=C.c.TransitionTo("target",t,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);I&&this._animatables.push(I);var s=0;if(this._mode===W.FitFrustumSidesMode){var o=this._calculateLowerRadiusFromModelBoundingSphere(i,L);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=r.length()+this._attachedCamera.minZ),s=o}else this._mode===W.IgnoreBoundsSizeMode&&(s=this._calculateLowerRadiusFromModelBoundingSphere(i,L),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var D=L.subtract(i).length();this._attachedCamera.panningSensibility=5e3/D,this._attachedCamera.wheelPrecision=100/s}this._radiusTransition||(this._radiusTransition=C.c.CreateAnimation("radius",C.c.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),(I=C.c.TransitionTo("radius",s,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(function(){x.stopAllAnimations(),l&&l(),x._attachedCamera&&x._attachedCamera.useInputToRestoreState&&x._attachedCamera.storeState()})))&&this._animatables.push(I)}},W.prototype._calculateLowerRadiusFromModelBoundingSphere=function(i,L){var h=L.subtract(i).length(),l=this._getFrustumSlope(),t=.5*h*this._radiusScale,p=t*Math.sqrt(1+1/(l.x*l.x)),x=t*Math.sqrt(1+1/(l.y*l.y)),R=Math.max(p,x),z=this._attachedCamera;return z?(z.lowerRadiusLimit&&this._mode===W.IgnoreBoundsSizeMode&&(R=R<z.lowerRadiusLimit?z.lowerRadiusLimit:R),z.upperRadiusLimit&&(R=R>z.upperRadiusLimit?z.upperRadiusLimit:R),R):0},W.prototype._maintainCameraAboveGround=function(){var i=this;if(!(this._elevationReturnTime<0)){var L=r.e.Now-this._lastInteractionTime,h=.5*Math.PI-this._defaultElevation,l=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>l&&L>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=C.c.CreateAnimation("beta",C.c.ANIMATIONTYPE_FLOAT,60,W.EasingFunction));var t=C.c.TransitionTo("beta",h,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(function(){i._clearAnimationLocks(),i.stopAllAnimations()}));t&&this._animatables.push(t)}}},W.prototype._getFrustumSlope=function(){var W=this._attachedCamera;if(!W)return p.k.Zero();var i=W.getScene().getEngine().getAspectRatio(W),L=Math.tan(W.fov/2),h=L*i;return new p.k(h,L)},W.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},W.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=r.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())},W.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(W.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!1,configurable:!0}),W.EasingFunction=new S,W.EasingMode=o.EASINGMODE_EASEINOUT,W.IgnoreBoundsSizeMode=0,W.FitFrustumSidesMode=1,W}(),c=L(37643),f=L(2517),a=L(49815),P=L(9217),y=function(){function W(){this._currentActiveButton=-1,this.buttons=[0,1,2]}return W.prototype.attachControl=function(W){var i=this;W=P.h.BackCompatCameraNoPreventDefault(arguments);var L=this.camera.getEngine(),h=L.getInputElement(),l=0,t=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(p){var x=p.event,R="touch"===x.pointerType;if(!L.isInVRExclusivePointerMode&&(p.type===z.e.POINTERMOVE||-1!==i.buttons.indexOf(x.button))){var r=x.srcElement||x.target;if(i._altKey=x.altKey,i._ctrlKey=x.ctrlKey,i._metaKey=x.metaKey,i._shiftKey=x.shiftKey,i._buttonsPressed=x.buttons,L.isPointerLock){var N=x.movementX||x.mozMovementX||x.webkitMovementX||x.msMovementX||0,I=x.movementY||x.mozMovementY||x.webkitMovementY||x.msMovementY||0;i.onTouch(null,N,I),i._pointA=null,i._pointB=null}else if(p.type!==z.e.POINTERDOWN||-1!==i._currentActiveButton&&!R)if(p.type===z.e.POINTERDOUBLETAP)i.onDoubleTap(x.pointerType);else if(p.type!==z.e.POINTERUP||i._currentActiveButton!==x.button&&!R){if(p.type===z.e.POINTERMOVE)if(W||x.preventDefault(),i._pointA&&null===i._pointB){N=x.clientX-i._pointA.x,I=x.clientY-i._pointA.y;i.onTouch(i._pointA,N,I),i._pointA.x=x.clientX,i._pointA.y=x.clientY}else if(i._pointA&&i._pointB){var s=i._pointA.pointerId===x.pointerId?i._pointA:i._pointB;s.x=x.clientX,s.y=x.clientY;var o=i._pointA.x-i._pointB.x,D=i._pointA.y-i._pointB.y,S=o*o+D*D,C={x:(i._pointA.x+i._pointB.x)/2,y:(i._pointA.y+i._pointB.y)/2,pointerId:x.pointerId,type:p.type};i.onMultiTouch(i._pointA,i._pointB,l,S,t,C),t=C,l=S}}else{try{null===r||void 0===r||r.releasePointerCapture(x.pointerId)}catch(W){}R||(i._pointB=null),L._badOS?i._pointA=i._pointB=null:i._pointB&&i._pointA&&i._pointA.pointerId==x.pointerId?(i._pointA=i._pointB,i._pointB=null):i._pointA&&i._pointB&&i._pointB.pointerId==x.pointerId?i._pointB=null:i._pointA=i._pointB=null,(0!==l||t)&&(i.onMultiTouch(i._pointA,i._pointB,l,0,t,null),l=0,t=null),i._currentActiveButton=-1,i.onButtonUp(x),W||x.preventDefault()}else{try{null===r||void 0===r||r.setPointerCapture(x.pointerId)}catch(W){}null===i._pointA?i._pointA={x:x.clientX,y:x.clientY,pointerId:x.pointerId,type:x.pointerType}:null===i._pointB&&(i._pointB={x:x.clientX,y:x.clientY,pointerId:x.pointerId,type:x.pointerType}),-1!==i._currentActiveButton||R||(i._currentActiveButton=x.button),i.onButtonDown(x),W||(x.preventDefault(),h&&h.focus())}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,z.e.POINTERDOWN|z.e.POINTERUP|z.e.POINTERMOVE|z.e.POINTERDOUBLETAP),this._onLostFocus=function(){i._pointA=i._pointB=null,l=0,t=null,i.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),h&&h.addEventListener("contextmenu",this._contextMenuBind,!1);var p=this.camera.getScene().getEngine().getHostWindow();p&&P.h.RegisterTopRootEvents(p,[{name:"blur",handler:this._onLostFocus}])},W.prototype.detachControl=function(){if(this._onLostFocus){var W=this.camera.getScene().getEngine().getHostWindow();W&&P.h.UnregisterTopRootEvents(W,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._contextMenuBind){var i=this.camera.getScene().getEngine().getInputElement();i&&i.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1},W.prototype.getClassName=function(){return"BaseCameraPointersInput"},W.prototype.getSimpleName=function(){return"pointers"},W.prototype.onDoubleTap=function(W){},W.prototype.onTouch=function(W,i,L){},W.prototype.onMultiTouch=function(W,i,L,h,l,t){},W.prototype.onContextMenu=function(W){W.preventDefault()},W.prototype.onButtonDown=function(W){},W.prototype.onButtonUp=function(W){},W.prototype.onLostFocus=function(){},(0,h.j)([(0,l.H)()],W.prototype,"buttons",void 0),W}(),M=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.buttons=[0,1,2],i.angularSensibilityX=1e3,i.angularSensibilityY=1e3,i.pinchPrecision=12,i.pinchDeltaPercentage=0,i.useNaturalPinchZoom=!1,i.pinchZoom=!0,i.panningSensibility=1e3,i.multiTouchPanning=!0,i.multiTouchPanAndZoom=!0,i.pinchInwards=!0,i._isPanClick=!1,i._twoFingerActivityCount=0,i._isPinching=!1,i}return(0,h.n)(i,W),i.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},i.prototype._computeMultiTouchPanning=function(W,i){if(0!==this.panningSensibility&&W&&i){var L=i.x-W.x,h=i.y-W.y;this.camera.inertialPanningX+=-L/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility}},i.prototype._computePinchZoom=function(W,L){var h=this.camera.radius||i.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=h*Math.sqrt(W)/Math.sqrt(L):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(L-W)*h*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(L-W)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)},i.prototype.onTouch=function(W,i,L){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=L/this.panningSensibility):(this.camera.inertialAlphaOffset-=i/this.angularSensibilityX,this.camera.inertialBetaOffset-=L/this.angularSensibilityY)},i.prototype.onDoubleTap=function(){this.camera.useInputToRestoreState&&this.camera.restoreState()},i.prototype.onMultiTouch=function(W,i,L,h,l,t){0===L&&null===l||0===h&&null===t||(this.multiTouchPanAndZoom?(this._computePinchZoom(L,h),this._computeMultiTouchPanning(l,t)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(h)-Math.sqrt(L))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(L,h),this._isPinching=!0):this._computeMultiTouchPanning(l,t)):this.multiTouchPanning?this._computeMultiTouchPanning(l,t):this.pinchZoom&&this._computePinchZoom(L,h))},i.prototype.onButtonDown=function(W){this._isPanClick=W.button===this.camera._panningMouseButton},i.prototype.onButtonUp=function(){this._twoFingerActivityCount=0,this._isPinching=!1},i.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},i.MinimumRadiusForPinch=.001,(0,h.j)([(0,l.H)()],i.prototype,"buttons",void 0),(0,h.j)([(0,l.H)()],i.prototype,"angularSensibilityX",void 0),(0,h.j)([(0,l.H)()],i.prototype,"angularSensibilityY",void 0),(0,h.j)([(0,l.H)()],i.prototype,"pinchPrecision",void 0),(0,h.j)([(0,l.H)()],i.prototype,"pinchDeltaPercentage",void 0),(0,h.j)([(0,l.H)()],i.prototype,"useNaturalPinchZoom",void 0),(0,h.j)([(0,l.H)()],i.prototype,"pinchZoom",void 0),(0,h.j)([(0,l.H)()],i.prototype,"panningSensibility",void 0),(0,h.j)([(0,l.H)()],i.prototype,"multiTouchPanning",void 0),(0,h.j)([(0,l.H)()],i.prototype,"multiTouchPanAndZoom",void 0),i}(y);a.b.ArcRotateCameraPointersInput=M;var b=L(45591),j=function(){function W(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return W.prototype.attachControl=function(W){var i=this;W=P.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){i._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(L){var h,l=L.event;l.metaKey||(L.type===b.c.KEYDOWN?(i._ctrlPressed=l.ctrlKey,i._altPressed=l.altKey,(-1!==i.keysUp.indexOf(l.keyCode)||-1!==i.keysDown.indexOf(l.keyCode)||-1!==i.keysLeft.indexOf(l.keyCode)||-1!==i.keysRight.indexOf(l.keyCode)||-1!==i.keysReset.indexOf(l.keyCode))&&(-1===(h=i._keys.indexOf(l.keyCode))&&i._keys.push(l.keyCode),l.preventDefault&&(W||l.preventDefault()))):-1===i.keysUp.indexOf(l.keyCode)&&-1===i.keysDown.indexOf(l.keyCode)&&-1===i.keysLeft.indexOf(l.keyCode)&&-1===i.keysRight.indexOf(l.keyCode)&&-1===i.keysReset.indexOf(l.keyCode)||((h=i._keys.indexOf(l.keyCode))>=0&&i._keys.splice(h,1),l.preventDefault&&(W||l.preventDefault())))})))},W.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},W.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var W=this.camera,i=0;i<this._keys.length;i++){var L=this._keys[i];-1!==this.keysLeft.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?W.inertialPanningX-=1/this.panningSensibility:W.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?W.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?W.inertialRadiusOffset+=1/this.zoomingSensibility:W.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?W.inertialPanningX+=1/this.panningSensibility:W.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(L)?this._ctrlPressed&&this.camera._useCtrlForPanning?W.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?W.inertialRadiusOffset-=1/this.zoomingSensibility:W.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(L)&&W.useInputToRestoreState&&W.restoreState()}},W.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},W.prototype.getSimpleName=function(){return"keyboard"},(0,h.j)([(0,l.H)()],W.prototype,"keysUp",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysDown",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysLeft",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysRight",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysReset",void 0),(0,h.j)([(0,l.H)()],W.prototype,"panningSensibility",void 0),(0,h.j)([(0,l.H)()],W.prototype,"zoomingSensibility",void 0),(0,h.j)([(0,l.H)()],W.prototype,"useAltToZoom",void 0),(0,h.j)([(0,l.H)()],W.prototype,"angularSpeed",void 0),W}();a.b.ArcRotateCameraKeyboardMoveInput=j;var Z=L(85567),X=L(13316),T=L(96658),F=function(){function W(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=p.m.Zero()}return W.prototype._computeDeltaFromMouseWheelLegacyEvent=function(W,i){var L=.01*W*this.wheelDeltaPercentage*i;return W>0?L/(1+this.wheelDeltaPercentage):L*(1+this.wheelDeltaPercentage)},W.prototype.attachControl=function(W){var i=this;this._wheel=function(W){if(W.type===z.e.POINTERWHEEL){var L=W.event,h=0,l=L,t=0,p=L.deltaMode===X.b.DOM_DELTA_LINE?40:1;if(t=void 0!==L.deltaY?-L.deltaY*p:void 0!==L.wheelDeltaY?-L.wheelDeltaY*p:l.wheelDelta,i.customComputeDeltaFromMouseWheel)h=i.customComputeDeltaFromMouseWheel(t,i,L);else if(i.wheelDeltaPercentage){if((h=i._computeDeltaFromMouseWheelLegacyEvent(t,i.camera.radius))>0){for(var x=i.camera.radius,R=i.camera.inertialRadiusOffset+h,r=0;r<20&&Math.abs(R)>.001;r++)x-=R,R*=i.camera.inertia;x=T.d.Clamp(x,0,Number.MAX_VALUE),h=i._computeDeltaFromMouseWheelLegacyEvent(t,x)}}else h=t/(40*i.wheelPrecision);h&&(i.zoomToMouseLocation&&i._hitPlane?i._zoomToMouse(h):i.camera.inertialRadiusOffset+=h)}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,z.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)},W.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},W.prototype.checkInputs=function(){if(this.zoomToMouseLocation){var W=this.camera;0+W.inertialAlphaOffset+W.inertialBetaOffset+W.inertialRadiusOffset&&(this._updateHitPlane(),W.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(W.inertia),this._zeroIfClose(this._inertialPanning))}},W.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},W.prototype.getSimpleName=function(){return"mousewheel"},W.prototype._updateHitPlane=function(){var W=this.camera,i=W.target.subtract(W.position);this._hitPlane=Z.e.FromPositionAndNormal(W.target,i)},W.prototype._getPosition=function(){var W,i=this.camera,L=i.getScene(),h=L.createPickingRay(L.pointerX,L.pointerY,p.d.Identity(),i,!1),l=0;return this._hitPlane&&(l=null!==(W=h.intersectsPlane(this._hitPlane))&&void 0!==W?W:0),h.origin.addInPlace(h.direction.scaleInPlace(l))},W.prototype._zoomToMouse=function(W){var i,L,h=this.camera,l=1-h.inertia;if(h.lowerRadiusLimit){var t=null!==(i=h.lowerRadiusLimit)&&void 0!==i?i:0;h.radius-(h.inertialRadiusOffset+W)/l<t&&(W=(h.radius-t)*l-h.inertialRadiusOffset)}if(h.upperRadiusLimit){var x=null!==(L=h.upperRadiusLimit)&&void 0!==L?L:0;h.radius-(h.inertialRadiusOffset+W)/l>x&&(W=(h.radius-x)*l-h.inertialRadiusOffset)}var R=W/l/h.radius,z=this._getPosition(),r=p.h.Vector3[6];z.subtractToRef(h.target,r),r.scaleInPlace(R),r.scaleInPlace(l),this._inertialPanning.addInPlace(r),h.inertialRadiusOffset+=W},W.prototype._zeroIfClose=function(W){Math.abs(W.x)<N.e&&(W.x=0),Math.abs(W.y)<N.e&&(W.y=0),Math.abs(W.z)<N.e&&(W.z=0)},(0,h.j)([(0,l.H)()],W.prototype,"wheelPrecision",void 0),(0,h.j)([(0,l.H)()],W.prototype,"zoomToMouseLocation",void 0),(0,h.j)([(0,l.H)()],W.prototype,"wheelDeltaPercentage",void 0),W}();a.b.ArcRotateCameraMouseWheelInput=F;var q=function(W){function i(i){return W.call(this,i)||this}return(0,h.n)(i,W),i.prototype.addMouseWheel=function(){return this.add(new F),this},i.prototype.addPointers=function(){return this.add(new M),this},i.prototype.addKeyboard=function(){return this.add(new j),this},i}(a.c);x.b.AddNodeConstructor("ArcRotateCamera",(function(W,i){return function(){return new H(W,0,0,1,p.m.Zero(),i)}}));var H=function(W){function i(i,L,h,l,x,R,z){void 0===z&&(z=!0);var r=W.call(this,i,p.m.Zero(),R,z)||this;return r.inertialAlphaOffset=0,r.inertialBetaOffset=0,r.inertialRadiusOffset=0,r.lowerAlphaLimit=null,r.upperAlphaLimit=null,r.lowerBetaLimit=.01,r.upperBetaLimit=Math.PI-.01,r.lowerRadiusLimit=null,r.upperRadiusLimit=null,r.inertialPanningX=0,r.inertialPanningY=0,r.pinchToPanMaxDistance=20,r.panningDistanceLimit=null,r.panningOriginTarget=p.m.Zero(),r.panningInertia=.9,r.zoomOnFactor=1,r.targetScreenOffset=p.k.Zero(),r.allowUpsideDown=!0,r.useInputToRestoreState=!0,r._viewMatrix=new p.d,r.panningAxis=new p.m(1,1,0),r._transformedDirection=new p.m,r.mapPanning=!1,r.onMeshTargetChangedObservable=new t.c,r.checkCollisions=!1,r.collisionRadius=new p.m(.5,.5,.5),r._previousPosition=p.m.Zero(),r._collisionVelocity=p.m.Zero(),r._newPosition=p.m.Zero(),r._computationVector=p.m.Zero(),r._onCollisionPositionChange=function(W,i,L){void 0===L&&(L=null),L?(r.setPosition(i),r.onCollide&&r.onCollide(L)):r._previousPosition.copyFrom(r._position);var h=Math.cos(r.alpha),l=Math.sin(r.alpha),t=Math.cos(r.beta),p=Math.sin(r.beta);0===p&&(p=1e-4);var x=r._getTargetPosition();r._computationVector.copyFromFloats(r.radius*h*p,r.radius*t,r.radius*l*p),x.addToRef(r._computationVector,r._newPosition),r._position.copyFrom(r._newPosition);var R=r.upVector;r.allowUpsideDown&&r.beta<0&&(R=(R=R.clone()).negate()),r._computeViewMatrix(r._position,x,R),r._viewMatrix.addAtIndex(12,r.targetScreenOffset.x),r._viewMatrix.addAtIndex(13,r.targetScreenOffset.y),r._collisionTriggered=!1},r._target=p.m.Zero(),x&&r.setTarget(x),r.alpha=L,r.beta=h,r.radius=l,r.getViewMatrix(),r.inputs=new q(r),r.inputs.addKeyboard().addMouseWheel().addPointers(),r}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"target",{get:function(){return this._target},set:function(W){this.setTarget(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetHost",{get:function(){return this._targetHost},set:function(W){W&&this.setTarget(W)},enumerable:!1,configurable:!0}),i.prototype.getTarget=function(){return this.target},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(W){this.setPosition(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"upVector",{get:function(){return this._upVector},set:function(W){this._upToYMatrix||(this._yToUpMatrix=new p.d,this._upToYMatrix=new p.d,this._upVector=p.m.Zero()),W.normalize(),this._upVector.copyFrom(W),this.setMatUp()},enumerable:!1,configurable:!0}),i.prototype.setMatUp=function(){p.d.RotationAlignToRef(p.m.UpReadOnly,this._upVector,this._yToUpMatrix),p.d.RotationAlignToRef(this._upVector,p.m.UpReadOnly,this._upToYMatrix)},Object.defineProperty(i.prototype,"angularSensibilityX",{get:function(){var W=this.inputs.attached.pointers;return W?W.angularSensibilityX:0},set:function(W){var i=this.inputs.attached.pointers;i&&(i.angularSensibilityX=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"angularSensibilityY",{get:function(){var W=this.inputs.attached.pointers;return W?W.angularSensibilityY:0},set:function(W){var i=this.inputs.attached.pointers;i&&(i.angularSensibilityY=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pinchPrecision",{get:function(){var W=this.inputs.attached.pointers;return W?W.pinchPrecision:0},set:function(W){var i=this.inputs.attached.pointers;i&&(i.pinchPrecision=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pinchDeltaPercentage",{get:function(){var W=this.inputs.attached.pointers;return W?W.pinchDeltaPercentage:0},set:function(W){var i=this.inputs.attached.pointers;i&&(i.pinchDeltaPercentage=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useNaturalPinchZoom",{get:function(){var W=this.inputs.attached.pointers;return!!W&&W.useNaturalPinchZoom},set:function(W){var i=this.inputs.attached.pointers;i&&(i.useNaturalPinchZoom=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"panningSensibility",{get:function(){var W=this.inputs.attached.pointers;return W?W.panningSensibility:0},set:function(W){var i=this.inputs.attached.pointers;i&&(i.panningSensibility=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysUp",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysUp:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysUp=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysDown",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysDown:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysDown=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysLeft",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysLeft:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysLeft=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysRight",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysRight:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysRight=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelPrecision",{get:function(){var W=this.inputs.attached.mousewheel;return W?W.wheelPrecision:0},set:function(W){var i=this.inputs.attached.mousewheel;i&&(i.wheelPrecision=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomToMouseLocation",{get:function(){var W=this.inputs.attached.mousewheel;return!!W&&W.zoomToMouseLocation},set:function(W){var i=this.inputs.attached.mousewheel;i&&(i.zoomToMouseLocation=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelDeltaPercentage",{get:function(){var W=this.inputs.attached.mousewheel;return W?W.wheelDeltaPercentage:0},set:function(W){var i=this.inputs.attached.mousewheel;i&&(i.wheelDeltaPercentage=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(W){W!==this.useBouncingBehavior&&(W?(this._bouncingBehavior=new e,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(W){W!==this.useFramingBehavior&&(W?(this._framingBehavior=new V,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(W){W!==this.useAutoRotationBehavior&&(W?(this._autoRotationBehavior=new I,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),i.prototype._initCache=function(){W.prototype._initCache.call(this),this._cache._target=new p.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=p.k.Zero()},i.prototype._updateCache=function(i){i||W.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},i.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var W=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?W.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(W)}var i=this._getLockedTargetPosition();return i||this._target},i.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),W.prototype.storeState.call(this)},i.prototype._restoreStateValues=function(){return!!W.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},i.prototype._isSynchronizedViewMatrix=function(){return!!W.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},i.prototype.attachControl=function(W,i,L,h){var l=this;void 0===L&&(L=!0),void 0===h&&(h=2);var t=arguments;i=P.h.BackCompatCameraNoPreventDefault(t),this._useCtrlForPanning=L,this._panningMouseButton=h,"boolean"===typeof t[0]&&(t.length>1&&(this._useCtrlForPanning=t[1]),t.length>2&&(this._panningMouseButton=t[2])),this.inputs.attachElement(i),this._reset=function(){l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.inertialPanningX=0,l.inertialPanningY=0}},i.prototype.detachControl=function(){this.inputs.detachElement(),this._reset&&this._reset()},i.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var i=this.inertialAlphaOffset;this.beta<=0&&(i*=-1),this.getScene().useRightHandedSystem&&(i*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(i*=-1),this.alpha+=i,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<N.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<N.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*N.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){var L=new p.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),L.multiplyInPlace(this.panningAxis),p.m.TransformNormalToRef(L,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),p.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*N.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*N.e&&(this.inertialPanningY=0)}this._checkLimits(),W.prototype._checkInputs.call(this)}},i.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},i.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);var W=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var i=Math.round((W-this.alpha)/(2*Math.PI));this.alpha+=2*i*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},i.prototype.setPosition=function(W){this._position.equals(W)||(this._position.copyFrom(W),this.rebuildAnglesAndRadius())},i.prototype.setTarget=function(W,i,L,h){var l;if(void 0===i&&(i=!1),void 0===L&&(L=!1),void 0===h&&(h=!1),h=null!==(l=this.overrideCloneAlphaBetaRadius)&&void 0!==l?l:h,W.getBoundingInfo)this._targetBoundingCenter=i?W.getBoundingInfo().boundingBox.centerWorld.clone():null,W.computeWorldMatrix(),this._targetHost=W,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var t=W,p=this._getTargetPosition();if(p&&!L&&p.equals(t))return;this._targetHost=null,this._target=t,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}h||this.rebuildAnglesAndRadius()},i.prototype._getViewMatrix=function(){var W=Math.cos(this.alpha),i=Math.sin(this.alpha),L=Math.cos(this.beta),h=Math.sin(this.beta);0===h&&(h=1e-4),0===this.radius&&(this.radius=1e-4);var l=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*W*h,this.radius*L,this.radius*i*h),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),l.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var x=this.upVector;this.allowUpsideDown&&h<0&&(x=x.negate()),this._computeViewMatrix(this._position,l,x),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=l,this._viewMatrix},i.prototype.zoomOn=function(W,i){void 0===i&&(i=!1),W=W||this.getScene().meshes;var L=R.e.MinMax(W),h=p.m.Distance(L.min,L.max);this.radius=h*this.zoomOnFactor,this.focusOn({min:L.min,max:L.max,distance:h},i)},i.prototype.focusOn=function(W,i){var L,h;if(void 0===i&&(i=!1),void 0===W.min){var l=W||this.getScene().meshes;L=R.e.MinMax(l),h=p.m.Distance(L.min,L.max)}else{L=W,h=W.distance}this._target=R.e.Center(L),i||(this.maxZ=2*h)},i.prototype.createRigCamera=function(W,L){var h=0;switch(this.cameraRigMode){case c.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.c.RIG_MODE_VR:h=this._cameraRigParams.stereoHalfAngle*(0===L?1:-1);break;case c.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h=this._cameraRigParams.stereoHalfAngle*(0===L?-1:1)}var l=new i(W,this.alpha+h,this.beta,this.radius,this._target,this.getScene());return l._cameraRigParams={},l.isRigCamera=!0,l.rigParent=this,l.upVector=this.upVector,l},i.prototype._updateRigCameras=function(){var i=this._rigCameras[0],L=this._rigCameras[1];switch(i.beta=L.beta=this.beta,this.cameraRigMode){case c.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.c.RIG_MODE_VR:i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,L.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case c.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,L.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}W.prototype._updateRigCameras.call(this)},i.prototype.dispose=function(){this.inputs.clear(),W.prototype.dispose.call(this)},i.prototype.getClassName=function(){return"ArcRotateCamera"},(0,h.j)([(0,l.H)()],i.prototype,"alpha",void 0),(0,h.j)([(0,l.H)()],i.prototype,"beta",void 0),(0,h.j)([(0,l.H)()],i.prototype,"radius",void 0),(0,h.j)([(0,l.H)()],i.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,h.j)([(0,l.G)("target")],i.prototype,"_target",void 0),(0,h.j)([(0,l.z)("targetHost")],i.prototype,"_targetHost",void 0),(0,h.j)([(0,l.H)()],i.prototype,"inertialAlphaOffset",void 0),(0,h.j)([(0,l.H)()],i.prototype,"inertialBetaOffset",void 0),(0,h.j)([(0,l.H)()],i.prototype,"inertialRadiusOffset",void 0),(0,h.j)([(0,l.H)()],i.prototype,"lowerAlphaLimit",void 0),(0,h.j)([(0,l.H)()],i.prototype,"upperAlphaLimit",void 0),(0,h.j)([(0,l.H)()],i.prototype,"lowerBetaLimit",void 0),(0,h.j)([(0,l.H)()],i.prototype,"upperBetaLimit",void 0),(0,h.j)([(0,l.H)()],i.prototype,"lowerRadiusLimit",void 0),(0,h.j)([(0,l.H)()],i.prototype,"upperRadiusLimit",void 0),(0,h.j)([(0,l.H)()],i.prototype,"inertialPanningX",void 0),(0,h.j)([(0,l.H)()],i.prototype,"inertialPanningY",void 0),(0,h.j)([(0,l.H)()],i.prototype,"pinchToPanMaxDistance",void 0),(0,h.j)([(0,l.H)()],i.prototype,"panningDistanceLimit",void 0),(0,h.j)([(0,l.G)()],i.prototype,"panningOriginTarget",void 0),(0,h.j)([(0,l.H)()],i.prototype,"panningInertia",void 0),(0,h.j)([(0,l.H)()],i.prototype,"zoomToMouseLocation",null),(0,h.j)([(0,l.H)()],i.prototype,"zoomOnFactor",void 0),(0,h.j)([(0,l.F)()],i.prototype,"targetScreenOffset",void 0),(0,h.j)([(0,l.H)()],i.prototype,"allowUpsideDown",void 0),(0,h.j)([(0,l.H)()],i.prototype,"useInputToRestoreState",void 0),i}(f.e)},49815:function(W,i,L){"use strict";L.d(i,{b:function(){return p},c:function(){return x}});var h=L(9127),l=L(9892),t=L(37643),p={},x=function(){function W(W){this.attachedToElement=!1,this.attached={},this.camera=W,this.checkInputs=function(){}}return W.prototype.add=function(W){var i=W.getSimpleName();this.attached[i]?h.e.Warn("camera input of type "+i+" already exists on camera"):(this.attached[i]=W,W.camera=this.camera,W.checkInputs&&(this.checkInputs=this._addCheckInputs(W.checkInputs.bind(W))),this.attachedToElement&&W.attachControl())},W.prototype.remove=function(W){for(var i in this.attached){var L=this.attached[i];L===W&&(L.detachControl(),L.camera=null,delete this.attached[i],this.rebuildInputCheck())}},W.prototype.removeByType=function(W){for(var i in this.attached){var L=this.attached[i];L.getClassName()===W&&(L.detachControl(),L.camera=null,delete this.attached[i],this.rebuildInputCheck())}},W.prototype._addCheckInputs=function(W){var i=this.checkInputs;return function(){i(),W()}},W.prototype.attachInput=function(W){this.attachedToElement&&W.attachControl(this.noPreventDefault)},W.prototype.attachElement=function(W){if(void 0===W&&(W=!1),!this.attachedToElement)for(var i in W=!t.c.ForceAttachControlToAlwaysPreventDefault&&W,this.attachedToElement=!0,this.noPreventDefault=W,this.attached)this.attached[i].attachControl(W)},W.prototype.detachElement=function(W){for(var i in void 0===W&&(W=!1),this.attached)this.attached[i].detachControl(),W&&(this.attached[i].camera=null);this.attachedToElement=!1},W.prototype.rebuildInputCheck=function(){for(var W in this.checkInputs=function(){},this.attached){var i=this.attached[W];i.checkInputs&&(this.checkInputs=this._addCheckInputs(i.checkInputs.bind(i)))}},W.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},W.prototype.serialize=function(W){var i={};for(var L in this.attached){var h=this.attached[L],t=l.d.Serialize(h);i[h.getClassName()]=t}W.inputsmgr=i},W.prototype.parse=function(W){var i=W.inputsmgr;if(i){this.clear();var L=function(W){var L=p[W];if(L){var t=i[W],x=l.d.Parse((function(){return new L}),t,null);h.add(x)}},h=this;for(var t in i)L(t)}else{var x=function(i){var L=p[R.attached[i].getClassName()];if(L){var h=l.d.Parse((function(){return new L}),W,null);R.remove(R.attached[i]),R.add(h)}},R=this;for(var t in this.attached)x(t)}},W}()},35958:function(W,i,L){"use strict";L.d(i,{c:function(){return a}});var h=L(40061),l=L(9892),t=L(80105),p=L(90690),x=L(2517),R=L(49815),z=L(45591),r=L(9217),N=function(){function W(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this._keys=new Array}return W.prototype.attachControl=function(W){var i=this;W=r.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){i._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(L){var h,l=L.event;l.metaKey||(L.type===z.c.KEYDOWN?-1===i.keysUp.indexOf(l.keyCode)&&-1===i.keysDown.indexOf(l.keyCode)&&-1===i.keysLeft.indexOf(l.keyCode)&&-1===i.keysRight.indexOf(l.keyCode)&&-1===i.keysUpward.indexOf(l.keyCode)&&-1===i.keysDownward.indexOf(l.keyCode)&&-1===i.keysRotateLeft.indexOf(l.keyCode)&&-1===i.keysRotateRight.indexOf(l.keyCode)||(-1===(h=i._keys.indexOf(l.keyCode))&&i._keys.push(l.keyCode),W||l.preventDefault()):-1===i.keysUp.indexOf(l.keyCode)&&-1===i.keysDown.indexOf(l.keyCode)&&-1===i.keysLeft.indexOf(l.keyCode)&&-1===i.keysRight.indexOf(l.keyCode)&&-1===i.keysUpward.indexOf(l.keyCode)&&-1===i.keysDownward.indexOf(l.keyCode)&&-1===i.keysRotateLeft.indexOf(l.keyCode)&&-1===i.keysRotateRight.indexOf(l.keyCode)||((h=i._keys.indexOf(l.keyCode))>=0&&i._keys.splice(h,1),W||l.preventDefault()))})))},W.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},W.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var W=this.camera,i=0;i<this._keys.length;i++){var L=this._keys[i],h=W._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(L)?W._localDirection.copyFromFloats(-h,0,0):-1!==this.keysUp.indexOf(L)?W._localDirection.copyFromFloats(0,0,h):-1!==this.keysRight.indexOf(L)?W._localDirection.copyFromFloats(h,0,0):-1!==this.keysDown.indexOf(L)?W._localDirection.copyFromFloats(0,0,-h):-1!==this.keysUpward.indexOf(L)?W._localDirection.copyFromFloats(0,h,0):-1!==this.keysDownward.indexOf(L)?W._localDirection.copyFromFloats(0,-h,0):-1!==this.keysRotateLeft.indexOf(L)?(W._localDirection.copyFromFloats(0,0,0),W.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(L)&&(W._localDirection.copyFromFloats(0,0,0),W.cameraRotation.y+=this._getLocalRotation()),W.getScene().useRightHandedSystem&&(W._localDirection.z*=-1),W.getViewMatrix().invertToRef(W._cameraTransformMatrix),t.m.TransformNormalToRef(W._localDirection,W._cameraTransformMatrix,W._transformedDirection),W.cameraDirection.addInPlace(W._transformedDirection)}},W.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},W.prototype._onLostFocus=function(){this._keys=[]},W.prototype.getSimpleName=function(){return"keyboard"},W.prototype._getLocalRotation=function(){var W=this.rotationSpeed*this._engine.getDeltaTime()/1e3;return this.camera.getScene().useRightHandedSystem&&(W*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(W*=-1),W},(0,h.j)([(0,l.H)()],W.prototype,"keysUp",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysUpward",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysDown",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysDownward",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysLeft",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysRight",void 0),(0,h.j)([(0,l.H)()],W.prototype,"rotationSpeed",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysRotateLeft",void 0),(0,h.j)([(0,l.H)()],W.prototype,"keysRotateRight",void 0),W}();R.b.FreeCameraKeyboardMoveInput=N;var I=L(9271),s=L(25239),o=function(){function W(W){void 0===W&&(W=!0),this.touchEnabled=W,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new I.c,this._allowCameraRotation=!0,this._currentActiveButton=-1}return W.prototype.attachControl=function(W){var i=this;W=r.h.BackCompatCameraNoPreventDefault(arguments);var L=this.camera.getEngine(),h=L.getInputElement();this._pointerInput||(this._pointerInput=function(l){var t=l.event,p="touch"===t.pointerType;if(!L.isInVRExclusivePointerMode&&(i.touchEnabled||!p)&&(l.type===s.e.POINTERMOVE||-1!==i.buttons.indexOf(t.button))){var x=t.srcElement||t.target;if(l.type!==s.e.POINTERDOWN||-1!==i._currentActiveButton&&!p)if(l.type!==s.e.POINTERUP||i._currentActiveButton!==t.button&&!p){if(l.type===s.e.POINTERMOVE)if(L.isPointerLock&&i._onMouseMove)i._onMouseMove(l.event);else if(i._previousPosition){var R=t.clientX-i._previousPosition.x,z=t.clientY-i._previousPosition.y;i.camera.getScene().useRightHandedSystem&&(R*=-1),i.camera.parent&&i.camera.parent._getWorldMatrixDeterminant()<0&&(R*=-1),i._allowCameraRotation&&(i.camera.cameraRotation.y+=R/i.angularSensibility,i.camera.cameraRotation.x+=z/i.angularSensibility),i.onPointerMovedObservable.notifyObservers({offsetX:R,offsetY:z}),i._previousPosition={x:t.clientX,y:t.clientY},W||t.preventDefault()}}else{try{null===x||void 0===x||x.releasePointerCapture(t.pointerId)}catch(W){}i._currentActiveButton=-1,i._previousPosition=null,W||t.preventDefault()}else{try{null===x||void 0===x||x.setPointerCapture(t.pointerId)}catch(W){}-1===i._currentActiveButton&&(i._currentActiveButton=t.button),i._previousPosition={x:t.clientX,y:t.clientY},W||(t.preventDefault(),h&&h.focus()),L.isPointerLock&&i._onMouseMove&&i._onMouseMove(l.event)}}}),this._onMouseMove=function(h){if(L.isPointerLock&&!L.isInVRExclusivePointerMode){var l=h.movementX||h.mozMovementX||h.webkitMovementX||h.msMovementX||0;i.camera.getScene().useRightHandedSystem&&(l*=-1),i.camera.parent&&i.camera.parent._getWorldMatrixDeterminant()<0&&(l*=-1),i.camera.cameraRotation.y+=l/i.angularSensibility;var t=h.movementY||h.mozMovementY||h.webkitMovementY||h.msMovementY||0;i.camera.cameraRotation.x+=t/i.angularSensibility,i._previousPosition=null,W||h.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,s.e.POINTERDOWN|s.e.POINTERUP|s.e.POINTERMOVE),h&&(this._contextMenuBind=this.onContextMenu.bind(this),h.addEventListener("contextmenu",this._contextMenuBind,!1))},W.prototype.onContextMenu=function(W){W.preventDefault()},W.prototype.detachControl=function(){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._contextMenuBind){var W=this.camera.getEngine().getInputElement();W&&W.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._currentActiveButton=-1},W.prototype.getClassName=function(){return"FreeCameraMouseInput"},W.prototype.getSimpleName=function(){return"mouse"},(0,h.j)([(0,l.H)()],W.prototype,"buttons",void 0),(0,h.j)([(0,l.H)()],W.prototype,"angularSensibility",void 0),W}();R.b.FreeCameraMouseInput=o;var D,S=L(13316),C=function(){function W(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new I.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return W.prototype.attachControl=function(W){var i=this;this._wheel=function(W){if(W.type===s.e.POINTERWHEEL){var L=W.event,h=L.deltaMode===S.b.DOM_DELTA_LINE?i._ffMultiplier:1;void 0!==L.deltaY?(i._wheelDeltaX+=i.wheelPrecisionX*h*L.deltaX/i._normalize,i._wheelDeltaY-=i.wheelPrecisionY*h*L.deltaY/i._normalize,i._wheelDeltaZ+=i.wheelPrecisionZ*h*L.deltaZ/i._normalize):void 0!==L.wheelDeltaY?(i._wheelDeltaX+=i.wheelPrecisionX*h*L.wheelDeltaX/i._normalize,i._wheelDeltaY-=i.wheelPrecisionY*h*L.wheelDeltaY/i._normalize,i._wheelDeltaZ+=i.wheelPrecisionZ*h*L.wheelDeltaZ/i._normalize):L.wheelDelta&&(i._wheelDeltaY-=i.wheelPrecisionY*L.wheelDelta/i._normalize)}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,s.e.POINTERWHEEL)},W.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},W.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},W.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},W.prototype.getSimpleName=function(){return"mousewheel"},(0,h.j)([(0,l.H)()],W.prototype,"wheelPrecisionX",void 0),(0,h.j)([(0,l.H)()],W.prototype,"wheelPrecisionY",void 0),(0,h.j)([(0,l.H)()],W.prototype,"wheelPrecisionZ",void 0),W}(),e=L(54044);!function(W){W[W.MoveRelative=0]="MoveRelative",W[W.RotateRelative=1]="RotateRelative",W[W.MoveScene=2]="MoveScene"}(D||(D={}));var V=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i._moveRelative=t.m.Zero(),i._rotateRelative=t.m.Zero(),i._moveScene=t.m.Zero(),i._wheelXAction=D.MoveRelative,i._wheelXActionCoordinate=e.i.X,i._wheelYAction=D.MoveRelative,i._wheelYActionCoordinate=e.i.Z,i._wheelZAction=null,i._wheelZActionCoordinate=null,i}return(0,h.n)(i,W),i.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(i.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==D.MoveRelative?null:this._wheelXActionCoordinate},set:function(W){null===W&&this._wheelXAction!==D.MoveRelative||(this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==D.MoveRelative?null:this._wheelYActionCoordinate},set:function(W){null===W&&this._wheelYAction!==D.MoveRelative||(this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==D.MoveRelative?null:this._wheelZActionCoordinate},set:function(W){null===W&&this._wheelZAction!==D.MoveRelative||(this._wheelZAction=D.MoveRelative,this._wheelZActionCoordinate=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==D.RotateRelative?null:this._wheelXActionCoordinate},set:function(W){null===W&&this._wheelXAction!==D.RotateRelative||(this._wheelXAction=D.RotateRelative,this._wheelXActionCoordinate=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==D.RotateRelative?null:this._wheelYActionCoordinate},set:function(W){null===W&&this._wheelYAction!==D.RotateRelative||(this._wheelYAction=D.RotateRelative,this._wheelYActionCoordinate=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==D.RotateRelative?null:this._wheelZActionCoordinate},set:function(W){null===W&&this._wheelZAction!==D.RotateRelative||(this._wheelZAction=D.RotateRelative,this._wheelZActionCoordinate=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==D.MoveScene?null:this._wheelXActionCoordinate},set:function(W){null===W&&this._wheelXAction!==D.MoveScene||(this._wheelXAction=D.MoveScene,this._wheelXActionCoordinate=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==D.MoveScene?null:this._wheelYActionCoordinate},set:function(W){null===W&&this._wheelYAction!==D.MoveScene||(this._wheelYAction=D.MoveScene,this._wheelYActionCoordinate=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==D.MoveScene?null:this._wheelZActionCoordinate},set:function(W){null===W&&this._wheelZAction!==D.MoveScene||(this._wheelZAction=D.MoveScene,this._wheelZActionCoordinate=W)},enumerable:!1,configurable:!0}),i.prototype.checkInputs=function(){if(0!==this._wheelDeltaX||0!==this._wheelDeltaY||0!=this._wheelDeltaZ){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var i=t.d.Zero();this.camera.getViewMatrix().invertToRef(i);var L=t.m.Zero();t.m.TransformNormalToRef(this._moveRelative,i,L),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(L),this.camera.cameraDirection.addInPlace(this._moveScene),W.prototype.checkInputs.call(this)}},i.prototype._updateCamera=function(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},i.prototype._updateCameraProperty=function(W,i,L){if(0!==W&&null!==i&&null!==L){var h=null;switch(i){case D.MoveRelative:h=this._moveRelative;break;case D.RotateRelative:h=this._rotateRelative;break;case D.MoveScene:h=this._moveScene}switch(L){case e.i.X:h.set(W,0,0);break;case e.i.Y:h.set(0,W,0);break;case e.i.Z:h.set(0,0,W)}}},(0,h.j)([(0,l.H)()],i.prototype,"wheelXMoveRelative",null),(0,h.j)([(0,l.H)()],i.prototype,"wheelYMoveRelative",null),(0,h.j)([(0,l.H)()],i.prototype,"wheelZMoveRelative",null),(0,h.j)([(0,l.H)()],i.prototype,"wheelXRotateRelative",null),(0,h.j)([(0,l.H)()],i.prototype,"wheelYRotateRelative",null),(0,h.j)([(0,l.H)()],i.prototype,"wheelZRotateRelative",null),(0,h.j)([(0,l.H)()],i.prototype,"wheelXMoveScene",null),(0,h.j)([(0,l.H)()],i.prototype,"wheelYMoveScene",null),(0,h.j)([(0,l.H)()],i.prototype,"wheelZMoveScene",null),i}(C);R.b.FreeCameraMouseWheelInput=V;var c=function(){function W(W){void 0===W&&(W=!1),this.allowMouse=W,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=r.h.IsSafari()}return W.prototype.attachControl=function(W){var i=this;W=r.h.BackCompatCameraNoPreventDefault(arguments);var L=null;if(void 0===this._pointerInput&&(this._onLostFocus=function(){i._offsetX=null,i._offsetY=null},this._pointerInput=function(h){var l=h.event,t="mouse"===l.pointerType||i._isSafari&&"undefined"===typeof l.pointerType;if(i.allowMouse||!t)if(h.type===s.e.POINTERDOWN){if(W||l.preventDefault(),i._pointerPressed.push(l.pointerId),1!==i._pointerPressed.length)return;L={x:l.clientX,y:l.clientY}}else if(h.type===s.e.POINTERUP){if(W||l.preventDefault(),-1===(p=i._pointerPressed.indexOf(l.pointerId)))return;if(i._pointerPressed.splice(p,1),0!=p)return;L=null,i._offsetX=null,i._offsetY=null}else if(h.type===s.e.POINTERMOVE){if(W||l.preventDefault(),!L)return;var p;if(0!=(p=i._pointerPressed.indexOf(l.pointerId)))return;i._offsetX=l.clientX-L.x,i._offsetY=-(l.clientY-L.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,s.e.POINTERDOWN|s.e.POINTERUP|s.e.POINTERMOVE),this._onLostFocus){var h=this.camera.getEngine(),l=h.getInputElement();l&&l.addEventListener("blur",this._onLostFocus)}},W.prototype.detachControl=function(){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var W=this.camera.getEngine().getInputElement();W&&W.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed=[],this._offsetX=null,this._offsetY=null}},W.prototype.checkInputs=function(){if(null!==this._offsetX&&null!==this._offsetY&&(0!==this._offsetX||0!==this._offsetY)){var W=this.camera;if(W.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)W.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var i=W._computeLocalCameraSpeed(),L=new t.m(0,0,0!==this.touchMoveSensibility?i*this._offsetY/this.touchMoveSensibility:0);t.d.RotationYawPitchRollToRef(W.rotation.y,W.rotation.x,0,W._cameraRotationMatrix),W.cameraDirection.addInPlace(t.m.TransformCoordinates(L,W._cameraRotationMatrix))}}},W.prototype.getClassName=function(){return"FreeCameraTouchInput"},W.prototype.getSimpleName=function(){return"touch"},(0,h.j)([(0,l.H)()],W.prototype,"touchAngularSensibility",void 0),(0,h.j)([(0,l.H)()],W.prototype,"touchMoveSensibility",void 0),W}();R.b.FreeCameraTouchInput=c;var f=function(W){function i(i){var L=W.call(this,i)||this;return L._mouseInput=null,L._mouseWheelInput=null,L}return(0,h.n)(i,W),i.prototype.addKeyboard=function(){return this.add(new N),this},i.prototype.addMouse=function(W){return void 0===W&&(W=!0),this._mouseInput||(this._mouseInput=new o(W),this.add(this._mouseInput)),this},i.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},i.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new V,this.add(this._mouseWheelInput)),this},i.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},i.prototype.addTouch=function(){return this.add(new c),this},i.prototype.clear=function(){W.prototype.clear.call(this),this._mouseInput=null},i}(R.c),a=function(W){function i(i,L,h,l){void 0===l&&(l=!0);var x=W.call(this,i,L,h,l)||this;return x.ellipsoid=new t.m(.5,1,.5),x.ellipsoidOffset=new t.m(0,0,0),x.checkCollisions=!1,x.applyGravity=!1,x._needMoveForGravity=!1,x._oldPosition=t.m.Zero(),x._diffPosition=t.m.Zero(),x._newPosition=t.m.Zero(),x._collisionMask=-1,x._onCollisionPositionChange=function(W,i,L){void 0===L&&(L=null);var h;h=i,x._newPosition.copyFrom(h),x._newPosition.subtractToRef(x._oldPosition,x._diffPosition),x._diffPosition.length()>p.c.CollisionsEpsilon&&(x.position.addInPlace(x._diffPosition),x.onCollide&&L&&x.onCollide(L))},x.inputs=new f(x),x.inputs.addKeyboard().addMouse(),x}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"angularSensibility",{get:function(){var W=this.inputs.attached.mouse;return W?W.angularSensibility:0},set:function(W){var i=this.inputs.attached.mouse;i&&(i.angularSensibility=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysUp",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysUp:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysUp=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysUpward",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysUpward:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysUpward=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysDown",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysDown:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysDown=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysDownward",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysDownward:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysDownward=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysLeft",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysLeft:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysLeft=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysRight",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysRight:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysRight=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysRotateLeft",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysRotateLeft:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysRotateLeft=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keysRotateRight",{get:function(){var W=this.inputs.attached.keyboard;return W?W.keysRotateRight:[]},set:function(W){var i=this.inputs.attached.keyboard;i&&(i.keysRotateRight=W)},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(W,i){i=r.h.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(i)},i.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new t.m(0,0,0),this.cameraRotation=new t.k(0,0)},Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(W){this._collisionMask=isNaN(W)?-1:W},enumerable:!1,configurable:!0}),i.prototype._collideWithWorld=function(W){(this.parent?t.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var L=W;this.applyGravity&&(L=W.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,L,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},i.prototype._checkInputs=function(){this._localDirection||(this._localDirection=t.m.Zero(),this._transformedDirection=t.m.Zero()),this.inputs.checkInputs(),W.prototype._checkInputs.call(this)},i.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):W.prototype._updatePosition.call(this)},i.prototype.dispose=function(){this.inputs.clear(),W.prototype.dispose.call(this)},i.prototype.getClassName=function(){return"FreeCamera"},(0,h.j)([(0,l.G)()],i.prototype,"ellipsoid",void 0),(0,h.j)([(0,l.G)()],i.prototype,"ellipsoidOffset",void 0),(0,h.j)([(0,l.H)()],i.prototype,"checkCollisions",void 0),(0,h.j)([(0,l.H)()],i.prototype,"applyGravity",void 0),i}(x.e)},2517:function(W,i,L){"use strict";L.d(i,{e:function(){return z}});var h=L(40061),l=L(9892),t=L(37643),p=L(80105),x=L(61686),R=L(54044),z=function(W){function i(i,L,h,l){void 0===l&&(l=!0);var t=W.call(this,i,L,h,l)||this;return t._tmpUpVector=p.m.Zero(),t._tmpTargetVector=p.m.Zero(),t.cameraDirection=new p.m(0,0,0),t.cameraRotation=new p.k(0,0),t.ignoreParentScaling=!1,t.updateUpVectorFromRotation=!1,t._tmpQuaternion=new p.g,t.rotation=new p.m(0,0,0),t.speed=2,t.noRotationConstraint=!1,t.invertRotation=!1,t.inverseRotationSpeed=.2,t.lockedTarget=null,t._currentTarget=p.m.Zero(),t._initialFocalDistance=1,t._viewMatrix=p.d.Zero(),t._camMatrix=p.d.Zero(),t._cameraTransformMatrix=p.d.Zero(),t._cameraRotationMatrix=p.d.Zero(),t._referencePoint=new p.m(0,0,1),t._transformedReferencePoint=p.m.Zero(),t._defaultUp=p.m.Up(),t._cachedRotationZ=0,t._cachedQuaternionRotationZ=0,t}return(0,h.n)(i,W),i.prototype.getFrontPosition=function(W){this.getWorldMatrix();var i=this.getTarget().subtract(this.position);return i.normalize(),i.scaleInPlace(W),this.globalPosition.add(i)},i.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},i.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),W.prototype.storeState.call(this)},i.prototype._restoreStateValues=function(){return!!W.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},i.prototype._initCache=function(){W.prototype._initCache.call(this),this._cache.lockedTarget=new p.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new p.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new p.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype._updateCache=function(i){i||W.prototype._updateCache.call(this);var L=this._getLockedTargetPosition();L?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(L):this._cache.lockedTarget=L.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},i.prototype._isSynchronizedViewMatrix=function(){if(!W.prototype._isSynchronizedViewMatrix.call(this))return!1;var i=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(i):!i)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},i.prototype._computeLocalCameraSpeed=function(){var W=this.getEngine();return this.speed*Math.sqrt(W.getDeltaTime()/(100*W.getFps()))},i.prototype.setTarget=function(W){this.upVector.normalize(),this._initialFocalDistance=W.subtract(this.position).length(),this.position.z===W.z&&(this.position.z+=x.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),p.d.LookAtLHToRef(this.position,W,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=W.subtract(this.position);i.x>=0?this.rotation.y=-Math.atan(i.z/i.x)+Math.PI/2:this.rotation.y=-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&p.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(i.prototype,"target",{get:function(){return this.getTarget()},set:function(W){this.setTarget(W)},enumerable:!1,configurable:!0}),i.prototype.getTarget=function(){return this._currentTarget},i.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(p.h.Matrix[0]),p.m.TransformNormalToRef(this.cameraDirection,p.h.Matrix[0],p.h.Vector3[0]),void this.position.addInPlace(p.h.Vector3[0]);this.position.addInPlace(this.cameraDirection)},i.prototype._checkInputs=function(){var i=this.invertRotation?-this.inverseRotationSpeed:1,L=this._decideIfNeedsToMove(),h=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(L&&this._updatePosition(),h){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*i,this.rotation.y+=this.cameraRotation.y*i,!this.noRotationConstraint){var l=1.570796;this.rotation.x>l&&(this.rotation.x=l),this.rotation.x<-l&&(this.rotation.x=-l)}if(this.rotationQuaternion)this.rotation.lengthSquared()&&p.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}L&&(Math.abs(this.cameraDirection.x)<this.speed*x.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*x.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*x.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),h&&(Math.abs(this.cameraRotation.x)<this.speed*x.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*x.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),W.prototype._checkInputs.call(this)},i.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):p.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},i.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return p.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},i.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),p.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?R.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(p.g.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),R.e.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},i.prototype._computeViewMatrix=function(W,i,L){if(this.ignoreParentScaling){if(this.parent){var h=this.parent.getWorldMatrix();p.m.TransformCoordinatesToRef(W,h,this._globalPosition),p.m.TransformCoordinatesToRef(i,h,this._tmpTargetVector),p.m.TransformNormalToRef(L,h,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(W),this._tmpTargetVector.copyFrom(i),this._tmpUpVector.copyFrom(L);this.getScene().useRightHandedSystem?p.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):p.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?p.d.LookAtRHToRef(W,i,L,this._viewMatrix):p.d.LookAtLHToRef(W,i,L,this._viewMatrix),this.parent){h=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(h,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(W)},i.prototype.createRigCamera=function(W,L){if(this.cameraRigMode!==t.c.RIG_MODE_NONE){var h=new i(W,this.position.clone(),this.getScene());return h.isRigCamera=!0,h.rigParent=this,this.cameraRigMode!==t.c.RIG_MODE_VR&&this.cameraRigMode!==t.c.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new p.g),h._cameraRigParams={},h.rotationQuaternion=new p.g),h}return null},i.prototype._updateRigCameras=function(){var i=this._rigCameras[0],L=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case t.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case t.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.c.RIG_MODE_STEREOSCOPIC_INTERLACED:var h=this.cameraRigMode===t.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,l=this.cameraRigMode===t.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*h,i),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*l,L);break;case t.c.RIG_MODE_VR:i.rotationQuaternion?(i.rotationQuaternion.copyFrom(this.rotationQuaternion),L.rotationQuaternion.copyFrom(this.rotationQuaternion)):(i.rotation.copyFrom(this.rotation),L.rotation.copyFrom(this.rotation)),i.position.copyFrom(this.position),L.position.copyFrom(this.position)}W.prototype._updateRigCameras.call(this)},i.prototype._getRigCamPositionAndTarget=function(W,L){this.getTarget().subtractToRef(this.position,i._TargetFocalPoint),i._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var h=i._TargetFocalPoint.addInPlace(this.position);p.d.TranslationToRef(-h.x,-h.y,-h.z,i._TargetTransformMatrix),i._TargetTransformMatrix.multiplyToRef(p.d.RotationAxis(L.upVector,W),i._RigCamTransformMatrix),p.d.TranslationToRef(h.x,h.y,h.z,i._TargetTransformMatrix),i._RigCamTransformMatrix.multiplyToRef(i._TargetTransformMatrix,i._RigCamTransformMatrix),p.m.TransformCoordinatesToRef(this.position,i._RigCamTransformMatrix,L.position),L.setTarget(h)},i.prototype.getClassName=function(){return"TargetCamera"},i._RigCamTransformMatrix=new p.d,i._TargetTransformMatrix=new p.d,i._TargetFocalPoint=new p.m,(0,h.j)([(0,l.G)()],i.prototype,"rotation",void 0),(0,h.j)([(0,l.H)()],i.prototype,"speed",void 0),(0,h.j)([(0,l.z)("lockedTargetId")],i.prototype,"lockedTarget",void 0),i}(t.c)},69382:function(W,i,L){"use strict";L.d(i,{c:function(){return t}});var h=L(21901),l=L(87223),t=function(){function W(W,i,L){void 0===L&&(L=2),this.maxDepth=L,this.dynamicContent=new Array,this._maxBlockCapacity=i||64,this._selectionContent=new h.d(1024),this._creationFunc=W}return W.prototype.update=function(W,i,L){l.b._CreateBlocks(W,i,L,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},W.prototype.addMesh=function(W){for(var i=0;i<this.blocks.length;i++){this.blocks[i].addEntry(W)}},W.prototype.removeMesh=function(W){for(var i=0;i<this.blocks.length;i++){this.blocks[i].removeEntry(W)}},W.prototype.select=function(W,i){this._selectionContent.reset();for(var L=0;L<this.blocks.length;L++){this.blocks[L].select(W,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},W.prototype.intersects=function(W,i,L){this._selectionContent.reset();for(var h=0;h<this.blocks.length;h++){this.blocks[h].intersects(W,i,this._selectionContent,L)}return L?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},W.prototype.intersectsRay=function(W){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++){this.blocks[i].intersectsRay(W,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},W.CreationFuncForMeshes=function(W,i){var L=W.getBoundingInfo();!W.isBlocked&&L.boundingBox.intersectsMinMax(i.minPoint,i.maxPoint)&&i.entries.push(W)},W.CreationFuncForSubMeshes=function(W,i){W.getBoundingInfo().boundingBox.intersectsMinMax(i.minPoint,i.maxPoint)&&i.entries.push(W)},W}()},87223:function(W,i,L){"use strict";L.d(i,{b:function(){return t}});var h=L(80105),l=L(86724),t=function(){function W(W,i,L,h,l,t){this.entries=new Array,this._boundingVectors=new Array,this._capacity=L,this._depth=h,this._maxDepth=l,this._creationFunc=t,this._minPoint=W,this._maxPoint=i,this._boundingVectors.push(W.clone()),this._boundingVectors.push(i.clone()),this._boundingVectors.push(W.clone()),this._boundingVectors[2].x=i.x,this._boundingVectors.push(W.clone()),this._boundingVectors[3].y=i.y,this._boundingVectors.push(W.clone()),this._boundingVectors[4].z=i.z,this._boundingVectors.push(i.clone()),this._boundingVectors[5].z=W.z,this._boundingVectors.push(i.clone()),this._boundingVectors[6].x=W.x,this._boundingVectors.push(i.clone()),this._boundingVectors[7].y=W.y}return Object.defineProperty(W.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!1,configurable:!0}),W.prototype.addEntry=function(W){if(this.blocks)for(var i=0;i<this.blocks.length;i++){this.blocks[i].addEntry(W)}else this._creationFunc(W,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},W.prototype.removeEntry=function(W){if(this.blocks)for(var i=0;i<this.blocks.length;i++){this.blocks[i].removeEntry(W)}else{var L=this.entries.indexOf(W);L>-1&&this.entries.splice(L,1)}},W.prototype.addEntries=function(W){for(var i=0;i<W.length;i++){var L=W[i];this.addEntry(L)}},W.prototype.select=function(W,i,L){if(l.c.IsInFrustum(this._boundingVectors,W)){if(this.blocks){for(var h=0;h<this.blocks.length;h++){this.blocks[h].select(W,i,L)}return}L?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},W.prototype.intersects=function(W,i,L,h){if(l.c.IntersectsSphere(this._minPoint,this._maxPoint,W,i)){if(this.blocks){for(var t=0;t<this.blocks.length;t++){this.blocks[t].intersects(W,i,L,h)}return}h?L.concat(this.entries):L.concatWithNoDuplicate(this.entries)}},W.prototype.intersectsRay=function(W,i){if(W.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var L=0;L<this.blocks.length;L++){this.blocks[L].intersectsRay(W,i)}return}i.concatWithNoDuplicate(this.entries)}},W.prototype.createInnerBlocks=function(){W._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},W._CreateBlocks=function(i,L,l,t,p,x,R,z){R.blocks=new Array;for(var r=new h.m((L.x-i.x)/2,(L.y-i.y)/2,(L.z-i.z)/2),N=0;N<2;N++)for(var I=0;I<2;I++)for(var s=0;s<2;s++){var o=new W(i.add(r.multiplyByFloats(N,I,s)),i.add(r.multiplyByFloats(N+1,I+1,s+1)),t,p+1,x,z);o.addEntries(l),R.blocks.push(o)}},W}()},36642:function(W,i,L){"use strict";L.d(i,{d:function(){return r}});var h=L(37105),l=L(80105),t=L(52644),p=L(11126),x=L(21693),R=L(69382),z=L(78588);h.b.prototype.createOrUpdateSelectionOctree=function(W,i){void 0===W&&(W=64),void 0===i&&(i=2);var L=this._getComponent(x.e.NAME_OCTREE);L||(L=new r(this),this._addComponent(L)),this._selectionOctree||(this._selectionOctree=new R.c(R.c.CreationFuncForMeshes,W,i));var h=this.getWorldExtends();return this._selectionOctree.update(h.min,h.max,this.meshes),this._selectionOctree},Object.defineProperty(h.b.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),t.e.prototype.createOrUpdateSubmeshesOctree=function(W,i){void 0===W&&(W=64),void 0===i&&(i=2);var L=this.getScene(),h=L._getComponent(x.e.NAME_OCTREE);h||(h=new r(L),L._addComponent(h)),this._submeshesOctree||(this._submeshesOctree=new R.c(R.c.CreationFuncForSubMeshes,W,i)),this.computeWorldMatrix(!0);var l=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(l.minimumWorld,l.maximumWorld,this.subMeshes),this._submeshesOctree};var r=function(){function W(W){this.name=x.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new p.e(l.m.Zero(),new l.m(1,1,1)),(W=W||z.d.LastCreatedScene)&&(this.scene=W,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this))}return W.prototype.register=function(){var W=this;this.scene.onMeshRemovedObservable.add((function(i){var L=W.scene.selectionOctree;if(void 0!==L&&null!==L){var h=L.dynamicContent.indexOf(i);-1!==h&&L.dynamicContent.splice(h,1)}})),this.scene.onMeshImportedObservable.add((function(i){var L=W.scene.selectionOctree;void 0!==L&&null!==L&&L.addMesh(i)}))},W.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},W.prototype.getActiveSubMeshCandidates=function(W){return W._submeshesOctree&&W.useOctreeForRenderingSelection?W._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(W)},W.prototype.getIntersectingSubMeshCandidates=function(W,i){return W._submeshesOctree&&W.useOctreeForPicking?(p.e.TransformToRef(i,W.getWorldMatrix(),this._tempRay),W._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(W)},W.prototype.getCollidingSubMeshCandidates=function(W,i){if(W._submeshesOctree&&W.useOctreeForCollisions){var L=i._velocityWorldLength+Math.max(i._radius.x,i._radius.y,i._radius.z);return W._submeshesOctree.intersects(i._basePointWorld,L)}return this.scene._getDefaultSubMeshCandidates(W)},W.prototype.rebuild=function(){},W.prototype.dispose=function(){},W}()},11126:function(W,i,L){"use strict";L.d(i,{e:function(){return r}});var h=L(89214),l=L(80105),t=L(44904),p=L(16035),x=L(37105),R=L(37643),z=L(78588),r=function(){function W(W,i,L){void 0===L&&(L=Number.MAX_VALUE),this.origin=W,this.direction=i,this.length=L}return W.prototype.clone=function(){return new W(this.origin.clone(),this.direction.clone(),this.length)},W.prototype.intersectsBoxMinMax=function(i,L,h){void 0===h&&(h=0);var l,t,p,x,R=W._TmpVector3[0].copyFromFloats(i.x-h,i.y-h,i.z-h),z=W._TmpVector3[1].copyFromFloats(L.x+h,L.y+h,L.z+h),r=0,N=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<R.x||this.origin.x>z.x)return!1}else if(l=1/this.direction.x,t=(R.x-this.origin.x)*l,(p=(z.x-this.origin.x)*l)===-1/0&&(p=1/0),t>p&&(x=t,t=p,p=x),(r=Math.max(t,r))>(N=Math.min(p,N)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<R.y||this.origin.y>z.y)return!1}else if(l=1/this.direction.y,t=(R.y-this.origin.y)*l,(p=(z.y-this.origin.y)*l)===-1/0&&(p=1/0),t>p&&(x=t,t=p,p=x),(r=Math.max(t,r))>(N=Math.min(p,N)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<R.z||this.origin.z>z.z)return!1}else if(l=1/this.direction.z,t=(R.z-this.origin.z)*l,(p=(z.z-this.origin.z)*l)===-1/0&&(p=1/0),t>p&&(x=t,t=p,p=x),(r=Math.max(t,r))>(N=Math.min(p,N)))return!1;return!0},W.prototype.intersectsBox=function(W,i){return void 0===i&&(i=0),this.intersectsBoxMinMax(W.minimum,W.maximum,i)},W.prototype.intersectsSphere=function(W,i){void 0===i&&(i=0);var L=W.center.x-this.origin.x,h=W.center.y-this.origin.y,l=W.center.z-this.origin.z,t=L*L+h*h+l*l,p=W.radius+i,x=p*p;if(t<=x)return!0;var R=L*this.direction.x+h*this.direction.y+l*this.direction.z;return!(R<0)&&t-R*R<=x},W.prototype.intersectsTriangle=function(i,L,h){var t=W._TmpVector3[0],x=W._TmpVector3[1],R=W._TmpVector3[2],z=W._TmpVector3[3],r=W._TmpVector3[4];L.subtractToRef(i,t),h.subtractToRef(i,x),l.m.CrossToRef(this.direction,x,R);var N=l.m.Dot(t,R);if(0===N)return null;var I=1/N;this.origin.subtractToRef(i,z);var s=l.m.Dot(z,R)*I;if(s<0||s>1)return null;l.m.CrossToRef(z,t,r);var o=l.m.Dot(this.direction,r)*I;if(o<0||s+o>1)return null;var D=l.m.Dot(x,r)*I;return D>this.length?null:new p.e(1-s-o,s,D)},W.prototype.intersectsPlane=function(W){var i,L=l.m.Dot(W.normal,this.direction);if(Math.abs(L)<9.99999997475243e-7)return null;var h=l.m.Dot(W.normal,this.origin);return(i=(-W.d-h)/L)<0?i<-9.99999997475243e-7?null:0:i},W.prototype.intersectsAxis=function(W,i){switch(void 0===i&&(i=0),W){case"y":return(L=(this.origin.y-i)/this.direction.y)>0?null:new l.m(this.origin.x+this.direction.x*-L,i,this.origin.z+this.direction.z*-L);case"x":return(L=(this.origin.x-i)/this.direction.x)>0?null:new l.m(i,this.origin.y+this.direction.y*-L,this.origin.z+this.direction.z*-L);case"z":var L;return(L=(this.origin.z-i)/this.direction.z)>0?null:new l.m(this.origin.x+this.direction.x*-L,this.origin.y+this.direction.y*-L,i);default:return null}},W.prototype.intersectsMesh=function(i,L){var h=l.h.Matrix[0];return i.getWorldMatrix().invertToRef(h),this._tmpRay?W.TransformToRef(this,h,this._tmpRay):this._tmpRay=W.Transform(this,h),i.intersects(this._tmpRay,L)},W.prototype.intersectsMeshes=function(W,i,L){L?L.length=0:L=[];for(var h=0;h<W.length;h++){var l=this.intersectsMesh(W[h],i);l.hit&&L.push(l)}return L.sort(this._comparePickingInfo),L},W.prototype._comparePickingInfo=function(W,i){return W.distance<i.distance?-1:W.distance>i.distance?1:0},W.prototype.intersectionSegment=function(i,L,h){var t=this.origin,p=l.h.Vector3[0],x=l.h.Vector3[1],R=l.h.Vector3[2],z=l.h.Vector3[3];L.subtractToRef(i,p),this.direction.scaleToRef(W._Rayl,R),t.addToRef(R,x),i.subtractToRef(t,z);var r,N,I=l.m.Dot(p,p),s=l.m.Dot(p,R),o=l.m.Dot(R,R),D=l.m.Dot(p,z),S=l.m.Dot(R,z),C=I*o-s*s,e=C,V=C;C<W._Smallnum?(r=0,e=1,N=S,V=o):(N=I*S-s*D,(r=s*S-o*D)<0?(r=0,N=S,V=o):r>e&&(r=e,N=S+s,V=o)),N<0?(N=0,-D<0?r=0:-D>I?r=e:(r=-D,e=I)):N>V&&(N=V,-D+s<0?r=0:-D+s>I?r=e:(r=-D+s,e=I));var c=Math.abs(r)<W._Smallnum?0:r/e,f=Math.abs(N)<W._Smallnum?0:N/V,a=l.h.Vector3[4];R.scaleToRef(f,a);var P=l.h.Vector3[5];p.scaleToRef(c,P),P.addInPlace(z);var y=l.h.Vector3[6];return P.subtractToRef(a,y),f>0&&f<=this.length&&y.lengthSquared()<h*h?P.length():-1},W.prototype.update=function(i,L,h,t,p,x,R,z){if(void 0===z&&(z=!1),z){W._RayDistant||(W._RayDistant=W.Zero()),W._RayDistant.unprojectRayToRef(i,L,h,t,l.d.IdentityReadOnly,x,R);var r=l.h.Matrix[0];p.invertToRef(r),W.TransformToRef(W._RayDistant,r,this)}else this.unprojectRayToRef(i,L,h,t,p,x,R);return this},W.Zero=function(){return new W(l.m.Zero(),l.m.Zero())},W.CreateNew=function(i,L,h,l,t,p,x){return W.Zero().update(i,L,h,l,t,p,x)},W.CreateNewFromTo=function(i,L,h){void 0===h&&(h=l.d.IdentityReadOnly);var t=L.subtract(i),p=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return t.normalize(),W.Transform(new W(i,t,p),h)},W.Transform=function(i,L){var h=new W(new l.m(0,0,0),new l.m(0,0,0));return W.TransformToRef(i,L,h),h},W.TransformToRef=function(W,i,L){l.m.TransformCoordinatesToRef(W.origin,i,L.origin),l.m.TransformNormalToRef(W.direction,i,L.direction),L.length=W.length;var h=L.direction,t=h.length();if(0!==t&&1!==t){var p=1/t;h.x*=p,h.y*=p,h.z*=p,L.length*=t}},W.prototype.unprojectRayToRef=function(W,i,L,h,t,p,x){var R,r=l.h.Matrix[0];t.multiplyToRef(p,r),r.multiplyToRef(x,r),r.invert();var N=l.h.Vector3[0];N.x=W/L*2-1,N.y=-(i/h*2-1),N.z=(null===(R=z.d.LastCreatedEngine)||void 0===R?void 0:R.isNDCHalfZRange)?0:-1;var I=l.h.Vector3[1].copyFromFloats(N.x,N.y,1-1e-8),s=l.h.Vector3[2],o=l.h.Vector3[3];l.m._UnprojectFromInvertedMatrixToRef(N,r,s),l.m._UnprojectFromInvertedMatrixToRef(I,r,o),this.origin.copyFrom(s),o.subtractToRef(s,this.direction),this.direction.normalize()},W._TmpVector3=h.e.BuildArray(6,l.m.Zero),W._RayDistant=W.Zero(),W._Smallnum=1e-8,W._Rayl=1e9,W}();x.b.prototype.createPickingRay=function(W,i,L,h,l){void 0===l&&(l=!1);var t=r.Zero();return this.createPickingRayToRef(W,i,L,t,h,l),t},x.b.prototype.createPickingRayToRef=function(W,i,L,h,t,p,x){void 0===p&&(p=!1),void 0===x&&(x=!1);var R=this.getEngine();if(!t){if(!this.activeCamera)return this;t=this.activeCamera}var z=t.viewport.toGlobal(R.getRenderWidth(),R.getRenderHeight());return W=W/R.getHardwareScalingLevel()-z.x,i=i/R.getHardwareScalingLevel()-(R.getRenderHeight()-z.y-z.height),h.update(W,i,z.width,z.height,L||l.d.IdentityReadOnly,p?l.d.IdentityReadOnly:t.getViewMatrix(),t.getProjectionMatrix(),x),this},x.b.prototype.createPickingRayInCameraSpace=function(W,i,L){var h=r.Zero();return this.createPickingRayInCameraSpaceToRef(W,i,h,L),h},x.b.prototype.createPickingRayInCameraSpaceToRef=function(W,i,L,h){if(!t.e)return this;var p=this.getEngine();if(!h){if(!this.activeCamera)throw new Error("Active camera not set");h=this.activeCamera}var x=h.viewport.toGlobal(p.getRenderWidth(),p.getRenderHeight()),R=l.d.Identity();return W=W/p.getHardwareScalingLevel()-x.x,i=i/p.getHardwareScalingLevel()-(p.getRenderHeight()-x.y-x.height),L.update(W,i,x.width,x.height,R,R,h.getProjectionMatrix()),this},x.b.prototype._internalPickForMesh=function(W,i,L,h,l,t,p,x){var R=i(h,L.enableDistantPicking),z=L.intersects(R,l,p,t,h,x);return z&&z.hit?!l&&null!=W&&z.distance>=W.distance?null:z:null},x.b.prototype._internalPick=function(W,i,L,h,p){if(!t.e)return null;for(var x=null,R=0;R<this.meshes.length;R++){var z=this.meshes[R];if(i){if(!i(z))continue}else if(!z.isEnabled()||!z.isVisible||!z.isPickable)continue;var r,N=z.getWorldMatrix();if(z.hasThinInstances&&z.thinInstanceEnablePicking){if(r=this._internalPickForMesh(x,W,z,N,!0,!0,p)){if(h)return r;for(var I=l.h.Matrix[1],s=z.thinInstanceGetWorldMatrices(),o=0;o<s.length;o++){s[o].multiplyToRef(N,I);var D=this._internalPickForMesh(x,W,z,I,L,h,p,!0);if(D&&((x=D).thinInstanceIndex=o,L))return x}}}else if((r=this._internalPickForMesh(x,W,z,N,L,h,p))&&(x=r,L))return x}return x||new t.e},x.b.prototype._internalMultiPick=function(W,i,L){if(!t.e)return null;for(var h=new Array,p=0;p<this.meshes.length;p++){var x=this.meshes[p];if(i){if(!i(x))continue}else if(!x.isEnabled()||!x.isVisible||!x.isPickable)continue;var R,z=x.getWorldMatrix();if(x.hasThinInstances&&x.thinInstanceEnablePicking){if(R=this._internalPickForMesh(null,W,x,z,!0,!0,L))for(var r=l.h.Matrix[1],N=x.thinInstanceGetWorldMatrices(),I=0;I<N.length;I++){N[I].multiplyToRef(z,r);var s=this._internalPickForMesh(null,W,x,r,!1,!1,L,!0);s&&(s.thinInstanceIndex=I,h.push(s))}}else(R=this._internalPickForMesh(null,W,x,z,!1,!1,L))&&h.push(R)}return h},x.b.prototype.pickWithBoundingInfo=function(W,i,L,h,p){var x=this;if(!t.e)return null;var R=this._internalPick((function(L){return x._tempPickingRay||(x._tempPickingRay=r.Zero()),x.createPickingRayToRef(W,i,L,x._tempPickingRay,p||null),x._tempPickingRay}),L,h,!0);return R&&(R.ray=this.createPickingRay(W,i,l.d.Identity(),p||null)),R},x.b.prototype.pick=function(W,i,L,h,p,x,R){var z=this;if(void 0===R&&(R=!1),!t.e)return null;var N=this._internalPick((function(L,h){return z._tempPickingRay||(z._tempPickingRay=r.Zero()),z.createPickingRayToRef(W,i,L,z._tempPickingRay,p||null,!1,h),z._tempPickingRay}),L,h,!1,x);return N&&(N.ray=this.createPickingRay(W,i,l.d.Identity(),p||null)),N},x.b.prototype.pickWithRay=function(W,i,L,h){var t=this,p=this._internalPick((function(i){return t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=l.d.Identity()),i.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=r.Zero()),r.TransformToRef(W,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform}),i,L,!1,h);return p&&(p.ray=W),p},x.b.prototype.multiPick=function(W,i,L,h,l){var t=this;return this._internalMultiPick((function(L){return t.createPickingRay(W,i,L,h||null)}),L,l)},x.b.prototype.multiPickWithRay=function(W,i,L){var h=this;return this._internalMultiPick((function(i){return h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=l.d.Identity()),i.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=r.Zero()),r.TransformToRef(W,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform}),i,L)},R.c.prototype.getForwardRay=function(W,i,L){return void 0===W&&(W=100),this.getForwardRayToRef(new r(l.m.Zero(),l.m.Zero(),W),W,i,L)},R.c.prototype.getForwardRayToRef=function(W,i,L,h){return void 0===i&&(i=100),L||(L=this.getWorldMatrix()),W.length=i,h?W.origin.copyFrom(h):W.origin.copyFrom(this.position),l.h.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),l.m.TransformNormalToRef(l.h.Vector3[2],L,l.h.Vector3[3]),l.m.NormalizeToRef(l.h.Vector3[3],W.direction),W}},36125:function(W,i,L){"use strict";var h=L(60766),l=L(9127),t=L(9217),p=L(72284);function x(W,i,L,h){var l,t=1;1===h?l=new Float32Array(i*L*4):2===h?(l=new Uint16Array(i*L*4),t=15360):l=7===h?new Uint32Array(i*L*4):new Uint8Array(i*L*4);for(var p=0;p<i;p++)for(var x=0;x<L;x++){var R=3*(x*i+p),z=4*(x*i+p);l[z+0]=W[R+0],l[z+1]=W[R+1],l[z+2]=W[R+2],l[z+3]=t}return l}function R(W){return function(i,L,l,t,p,x,R,z,r,N){void 0===r&&(r=null),void 0===N&&(N=0);var I=W?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,s=W?h.b.Raw3D:h.b.Raw2DArray,o=new h.e(this,s);o.baseWidth=L,o.baseHeight=l,o.baseDepth=t,o.width=L,o.height=l,o.depth=t,o.format=p,o.type=N,o.generateMipMaps=x,o.samplingMode=z,W?o.is3D=!0:o.is2DArray=!0,this._doNotHandleContextLost||(o._bufferView=i),W?this.updateRawTexture3D(o,i,p,R,r,N):this.updateRawTexture2DArray(o,i,p,R,r,N),this._bindTextureDirectly(I,o,!0);var D=this._getSamplingParameters(z,x);return this._gl.texParameteri(I,this._gl.TEXTURE_MAG_FILTER,D.mag),this._gl.texParameteri(I,this._gl.TEXTURE_MIN_FILTER,D.min),x&&this._gl.generateMipmap(I),this._bindTextureDirectly(I,null),this._internalTexturesCache.push(o),o}}function z(W){return function(i,L,h,l,t,p){void 0===t&&(t=null),void 0===p&&(p=0);var x=W?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,R=this._getWebGLTextureType(p),z=this._getInternalFormat(h),r=this._getRGBABufferInternalSizedFormat(p,h);this._bindTextureDirectly(x,i,!0),this._unpackFlipY(void 0===l||!!l),this._doNotHandleContextLost||(i._bufferView=L,i.format=h,i.invertY=l,i._compression=t),i.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),t&&L?this._gl.compressedTexImage3D(x,0,this.getCaps().s3tc[t],i.width,i.height,i.depth,0,L):this._gl.texImage3D(x,0,r,i.width,i.height,i.depth,0,z,R,L),i.generateMipMaps&&this._gl.generateMipmap(x),this._bindTextureDirectly(x,null),i.isReady=!0}}p.e.prototype.updateRawTexture=function(W,i,L,h,l,t,p){if(void 0===l&&(l=null),void 0===t&&(t=0),void 0===p&&(p=!1),W){var x=this._getRGBABufferInternalSizedFormat(t,L,p),R=this._getInternalFormat(L),z=this._getWebGLTextureType(t);this._bindTextureDirectly(this._gl.TEXTURE_2D,W,!0),this._unpackFlipY(void 0===h||!!h),this._doNotHandleContextLost||(W._bufferView=i,W.format=L,W.type=t,W.invertY=h,W._compression=l),W.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),l&&i?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[l],W.width,W.height,0,i):this._gl.texImage2D(this._gl.TEXTURE_2D,0,x,W.width,W.height,0,R,z,i),W.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),W.isReady=!0}},p.e.prototype.createRawTexture=function(W,i,L,l,t,p,x,R,z,r,N){void 0===R&&(R=null),void 0===z&&(z=0),void 0===r&&(r=0),void 0===N&&(N=!1);var I=new h.e(this,h.b.Raw);I.baseWidth=i,I.baseHeight=L,I.width=i,I.height=L,I.format=l,I.generateMipMaps=t,I.samplingMode=x,I.invertY=p,I._compression=R,I.type=z,I._useSRGBBuffer=this._getUseSRGBBuffer(N,!t),this._doNotHandleContextLost||(I._bufferView=W),this.updateRawTexture(I,W,l,p,R,z,I._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,I,!0);var s=this._getSamplingParameters(x,t);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,s.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,s.min),t&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(I),I},p.e.prototype.createRawCubeTexture=function(W,i,L,p,x,R,z,r){void 0===r&&(r=null);var N=this._gl,I=new h.e(this,h.b.CubeRaw);I.isCube=!0,I.format=L,I.type=p,this._doNotHandleContextLost||(I._bufferViewArray=W);var s=this._getWebGLTextureType(p),o=this._getInternalFormat(L);o===N.RGB&&(o=N.RGBA),s!==N.FLOAT||this._caps.textureFloatLinearFiltering?s!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?s!==N.FLOAT||this._caps.textureFloatRender?s!==N.HALF_FLOAT||this._caps.colorBufferFloat||(x=!1,l.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(x=!1,l.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(x=!1,z=1,l.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(x=!1,z=1,l.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var D=i,S=D;I.width=D,I.height=S,!this.needPOTTextures||t.h.IsExponentOfTwo(I.width)&&t.h.IsExponentOfTwo(I.height)||(x=!1),W&&this.updateRawCubeTexture(I,W,L,p,R,r),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,I,!0),W&&x&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var C=this._getSamplingParameters(z,x);return N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAG_FILTER,C.mag),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MIN_FILTER,C.min),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),this._bindTextureDirectly(N.TEXTURE_CUBE_MAP,null),I.generateMipMaps=x,I.samplingMode=z,I},p.e.prototype.updateRawCubeTexture=function(W,i,L,h,l,p,R){void 0===p&&(p=null),void 0===R&&(R=0),W._bufferViewArray=i,W.format=L,W.type=h,W.invertY=l,W._compression=p;var z=this._gl,r=this._getWebGLTextureType(h),N=this._getInternalFormat(L),I=this._getRGBABufferInternalSizedFormat(h),s=!1;N===z.RGB&&(N=z.RGBA,s=!0),this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,W,!0),this._unpackFlipY(void 0===l||!!l),W.width%4!==0&&z.pixelStorei(z.UNPACK_ALIGNMENT,1);for(var o=0;o<6;o++){var D=i[o];p?z.compressedTexImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+o,R,this.getCaps().s3tc[p],W.width,W.height,0,D):(s&&(D=x(D,W.width,W.height,h)),z.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+o,R,I,W.width,W.height,0,N,r,D))}(!this.needPOTTextures||t.h.IsExponentOfTwo(W.width)&&t.h.IsExponentOfTwo(W.height))&&W.generateMipMaps&&0===R&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),W.isReady=!0},p.e.prototype.createRawCubeTextureFromUrl=function(W,i,L,h,l,t,p,R,z,r,N,I){var s=this;void 0===z&&(z=null),void 0===r&&(r=null),void 0===N&&(N=3),void 0===I&&(I=!1);var o=this._gl,D=this.createRawCubeTexture(null,L,h,l,!t,I,N,null);null===i||void 0===i||i._addPendingData(D),D.url=W,this._internalTexturesCache.push(D);return this._loadFile(W,(function(W){!function(W){var L=D.width,t=p(W);if(t){if(R){var r=s._getWebGLTextureType(l),N=s._getInternalFormat(h),S=s._getRGBABufferInternalSizedFormat(l),C=!1;N===o.RGB&&(N=o.RGBA,C=!0),s._bindTextureDirectly(o.TEXTURE_CUBE_MAP,D,!0),s._unpackFlipY(!1);for(var e=R(t),V=0;V<e.length;V++)for(var c=L>>V,f=0;f<6;f++){var a=e[V][f];C&&(a=x(a,c,c,l)),o.texImage2D(f,V,S,c,c,0,N,r,a)}s._bindTextureDirectly(o.TEXTURE_CUBE_MAP,null)}else s.updateRawCubeTexture(D,t,h,l,I);D.isReady=!0,null===i||void 0===i||i._removePendingData(D),D.onLoadedObservable.notifyObservers(D),D.onLoadedObservable.clear(),z&&z()}}(W)}),void 0,null===i||void 0===i?void 0:i.offlineProvider,!0,(function(W,L){null===i||void 0===i||i._removePendingData(D),r&&W&&r(W.status+" "+W.statusText,L)})),D},p.e.prototype.createRawTexture2DArray=R(!1),p.e.prototype.createRawTexture3D=R(!0),p.e.prototype.updateRawTexture2DArray=z(!1),p.e.prototype.updateRawTexture3D=z(!0)},84468:function(W,i,L){"use strict";var h=L(40061),l=L(60766),t=L(9127),p=L(72284),x=function(W){function i(i,L,h,l,t){var p=W.call(this,i,L,h,l)||this;return p._framebuffer=null,p._depthStencilBuffer=null,p._MSAAFramebuffer=null,p._colorTextureArray=null,p._depthStencilTextureArray=null,p._context=t,p}return(0,h.n)(i,W),i.prototype._cloneRenderTargetWrapper=function(){var i=null;return this._colorTextureArray&&this._depthStencilTextureArray?(i=this._engine.createMultiviewRenderTargetTexture(this.width,this.height)).texture.isReady=!0:i=W.prototype._cloneRenderTargetWrapper.call(this),i},i.prototype._swapRenderTargetWrapper=function(i){W.prototype._swapRenderTargetWrapper.call(this,i),i._framebuffer=this._framebuffer,i._depthStencilBuffer=this._depthStencilBuffer,i._MSAAFramebuffer=this._MSAAFramebuffer,i._colorTextureArray=this._colorTextureArray,i._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null},i.prototype._shareDepth=function(i){W.prototype._shareDepth.call(this,i);var L=this._context,h=this._depthStencilBuffer,l=i._framebuffer;i._depthStencilBuffer&&L.deleteRenderbuffer(i._depthStencilBuffer),i._depthStencilBuffer=this._depthStencilBuffer,this._engine._bindUnboundFramebuffer(l),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_ATTACHMENT,L.RENDERBUFFER,h),this._engine._bindUnboundFramebuffer(null)},i.prototype._bindTextureRenderTarget=function(W,i,L,h){if(void 0===i&&(i=0),void 0===L&&(L=-1),void 0===h&&(h=0),W._hardwareTexture){var l=this._context,t=this._framebuffer,p=this._engine._currentFramebuffer;this._engine._bindUnboundFramebuffer(t);var x=l[this._engine.webGLVersion>1?"COLOR_ATTACHMENT"+i:"COLOR_ATTACHMENT"+i+"_WEBGL"],R=-1!==L?l.TEXTURE_CUBE_MAP_POSITIVE_X+L:l.TEXTURE_2D;l.framebufferTexture2D(l.FRAMEBUFFER,x,R,W._hardwareTexture.underlyingResource,h),this._engine._bindUnboundFramebuffer(p)}},i.prototype.setTexture=function(i,L,h){void 0===L&&(L=0),void 0===h&&(h=!0),W.prototype.setTexture.call(this,i,L,h),this._bindTextureRenderTarget(i,L)},i.prototype.dispose=function(i){void 0===i&&(i=!1);var L=this._context;i||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(L.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(L.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(L.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),W.prototype.dispose.call(this,i)},i}(L(52311).d);p.e.prototype._createHardwareRenderTargetWrapper=function(W,i,L){var h=new x(W,i,L,this,this._gl);return this._renderTargetWrapperCache.push(h),h},p.e.prototype.createRenderTargetTexture=function(W,i){var L=this._createHardwareRenderTargetWrapper(!1,!1,W),h={};void 0!==i&&"object"===typeof i?(h.generateDepthBuffer=!!i.generateDepthBuffer,h.generateStencilBuffer=!!i.generateStencilBuffer,h.noColorTarget=!!i.noColorTarget):(h.generateDepthBuffer=!0,h.generateStencilBuffer=!1,h.noColorTarget=!1);var t=h.noColorTarget?null:this._createInternalTexture(W,i,!0,l.b.RenderTarget),p=W.width||W,x=W.height||W,R=this._currentFramebuffer,z=this._gl,r=z.createFramebuffer();return this._bindUnboundFramebuffer(r),L._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!h.generateStencilBuffer,h.generateDepthBuffer,p,x),t&&!t.is2DArray&&z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,t._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(R),L._framebuffer=r,L._generateDepthBuffer=h.generateDepthBuffer,L._generateStencilBuffer=!!h.generateStencilBuffer,L.setTextures(t),L},p.e.prototype.createDepthStencilTexture=function(W,i,L){if(i.isCube){var h=W.width||W;return this._createDepthStencilCubeTexture(h,i,L)}return this._createDepthStencilTexture(W,i,L)},p.e.prototype._createDepthStencilTexture=function(W,i,L){var p=this._gl,x=W.layers||0,R=0!==x?p.TEXTURE_2D_ARRAY:p.TEXTURE_2D,z=new l.e(this,l.b.DepthStencil);if(!this._caps.depthTextureExtension)return t.e.Error("Depth texture is not supported by your browser or hardware."),z;var r=(0,h.d)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},i);if(this._bindTextureDirectly(R,z,!0),this._setupDepthStencilTexture(z,W,r.generateStencil,0!==r.comparisonFunction&&r.bilinearFiltering,r.comparisonFunction),void 0!==r.depthTextureFormat){if(15!==r.depthTextureFormat&&16!==r.depthTextureFormat&&17!==r.depthTextureFormat&&13!==r.depthTextureFormat&&14!==r.depthTextureFormat&&18!==r.depthTextureFormat)return t.e.Error("Depth texture format is not supported."),z;z.format=r.depthTextureFormat}else z.format=r.generateStencil?13:16;var N=17===z.format||13===z.format||18===z.format;L._depthStencilTexture=z,L._depthStencilTextureWithStencil=N;var I=p.UNSIGNED_INT;15===z.format?I=p.UNSIGNED_SHORT:17===z.format||13===z.format?I=p.UNSIGNED_INT_24_8:14===z.format?I=p.FLOAT:18===z.format&&(I=p.FLOAT_32_UNSIGNED_INT_24_8_REV);var s=N?p.DEPTH_STENCIL:p.DEPTH_COMPONENT,o=s;this.webGLVersion>1&&(15===z.format?o=p.DEPTH_COMPONENT16:16===z.format?o=p.DEPTH_COMPONENT24:17===z.format||13===z.format?o=p.DEPTH24_STENCIL8:14===z.format?o=p.DEPTH_COMPONENT32F:18===z.format&&(o=p.DEPTH32F_STENCIL8)),z.is2DArray?p.texImage3D(R,0,o,z.width,z.height,x,0,s,I,null):p.texImage2D(R,0,o,z.width,z.height,0,s,I,null),this._bindTextureDirectly(R,null),this._internalTexturesCache.push(z);var D=L;if(D._depthStencilBuffer){var S=this._currentFramebuffer;this._bindUnboundFramebuffer(D._framebuffer),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,null),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,null),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.STENCIL_ATTACHMENT,p.RENDERBUFFER,null),this._bindUnboundFramebuffer(S),p.deleteRenderbuffer(D._depthStencilBuffer),D._depthStencilBuffer=null}return z},p.e.prototype.updateRenderTargetTextureSampleCount=function(W,i){if(this.webGLVersion<2||!W||!W.texture)return 1;if(W.samples===i)return i;var L=this._gl;i=Math.min(i,this.getCaps().maxMSAASamples),W._depthStencilBuffer&&(L.deleteRenderbuffer(W._depthStencilBuffer),W._depthStencilBuffer=null),W._MSAAFramebuffer&&(L.deleteFramebuffer(W._MSAAFramebuffer),W._MSAAFramebuffer=null);var h=W.texture._hardwareTexture;if(h._MSAARenderBuffer&&(L.deleteRenderbuffer(h._MSAARenderBuffer),h._MSAARenderBuffer=null),i>1&&L.renderbufferStorageMultisample){var l=L.createFramebuffer();if(!l)throw new Error("Unable to create multi sampled framebuffer");W._MSAAFramebuffer=l,this._bindUnboundFramebuffer(W._MSAAFramebuffer);var t=this._createRenderBuffer(W.texture.width,W.texture.height,i,-1,this._getRGBAMultiSampleBufferFormat(W.texture.type),L.COLOR_ATTACHMENT0,!1);if(!t)throw new Error("Unable to create multi sampled framebuffer");h._MSAARenderBuffer=t}else this._bindUnboundFramebuffer(W._framebuffer);return W.texture.samples=i,W._depthStencilBuffer=this._setupFramebufferDepthAttachments(W._generateStencilBuffer,W._generateDepthBuffer,W.texture.width,W.texture.height,i),this._bindUnboundFramebuffer(null),i}},42373:function(W,i,L){"use strict";var h=L(40061),l=L(60766),t=L(9127);L(72284).e.prototype.createRenderTargetCubeTexture=function(W,i){var L=this._createHardwareRenderTargetWrapper(!1,!0,W),p=(0,h.d)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},i);p.generateStencilBuffer=p.generateDepthBuffer&&p.generateStencilBuffer,(1!==p.type||this._caps.textureFloatLinearFiltering)&&(2!==p.type||this._caps.textureHalfFloatLinearFiltering)||(p.samplingMode=1);var x=this._gl,R=new l.e(this,l.b.RenderTarget);this._bindTextureDirectly(x.TEXTURE_CUBE_MAP,R,!0);var z=this._getSamplingParameters(p.samplingMode,p.generateMipMaps);1!==p.type||this._caps.textureFloat||(p.type=0,t.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MAG_FILTER,z.mag),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MIN_FILTER,z.min),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE);for(var r=0;r<6;r++)x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,this._getRGBABufferInternalSizedFormat(p.type,p.format),W,W,0,this._getInternalFormat(p.format),this._getWebGLTextureType(p.type),null);var N=x.createFramebuffer();return this._bindUnboundFramebuffer(N),L._depthStencilBuffer=this._setupFramebufferDepthAttachments(p.generateStencilBuffer,p.generateDepthBuffer,W,W),p.generateMipMaps&&x.generateMipmap(x.TEXTURE_CUBE_MAP),this._bindTextureDirectly(x.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),L._framebuffer=N,L._generateDepthBuffer=p.generateDepthBuffer,L._generateStencilBuffer=p.generateStencilBuffer,R.width=W,R.height=W,R.isReady=!0,R.isCube=!0,R.samples=1,R.generateMipMaps=p.generateMipMaps,R.samplingMode=p.samplingMode,R.type=p.type,R.format=p.format,this._internalTexturesCache.push(R),L.setTextures(R),L}},48479:function(W,i,L){"use strict";var h=L(40061),l=L(9127),t=L(90690),p=L(60766),x=L(82419),R=L(30899),z=L(61803),r=L(52311),N=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4};!function(W){function i(i){void 0===i&&(i=new N);var L=W.call(this,null)||this;t.c.Instances.push(L),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),L._options=i,R.d.SetMatrixPrecision(!!i.useHighPrecisionMatrix),L._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,supportOcclusionQuery:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1,canUseGLInstanceID:!1,canUseGLVertexID:!1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:!1,textureMaxLevel:!1,texture2DArrayMaxLayerCount:128},L._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:!1,supportDepthStencilTexture:!1,supportShadowSamplers:!1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:!1,basisNeedsPOT:!1,support3DTextures:!1,needTypeSuffixInShaderConstants:!1,supportMSAA:!1,supportSSAO2:!1,supportExtendedTextureFormats:!1,supportSwitchCaseInShader:!1,supportSyncTextureRead:!1,needsInvertingBitmap:!1,useUBOBindingCache:!1,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!0,_collectUbosUpdatedInFrame:!1},l.e.Log("Babylon.js v".concat(t.c.Version," - Null engine"));var h="undefined"!==typeof self?self:"undefined"!==typeof global?global:window;return"undefined"===typeof URL&&(h.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"===typeof Blob&&(h.Blob=function(){}),L}(0,h.n)(i,W),i.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},i.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},i.prototype.getHardwareScalingLevel=function(){return 1},i.prototype.createVertexBuffer=function(W){var i=new x.c;return i.references=1,i},i.prototype.createIndexBuffer=function(W){var i=new x.c;return i.references=1,i},i.prototype.clear=function(W,i,L,h){void 0===h&&(h=!1)},i.prototype.getRenderWidth=function(W){return void 0===W&&(W=!1),!W&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},i.prototype.getRenderHeight=function(W){return void 0===W&&(W=!1),!W&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},i.prototype.setViewport=function(W,i,L){this._cachedViewport=W},i.prototype.createShaderProgram=function(W,i,L,h,l){return{__SPECTOR_rebuildProgram:null}},i.prototype.getUniforms=function(W,i){return[]},i.prototype.getAttributes=function(W,i){return[]},i.prototype.bindSamplers=function(W){this._currentEffect=null},i.prototype.enableEffect=function(W){W=null!==W&&z.b.IsWrapper(W)?W.effect:W,this._currentEffect=W,W&&(W.onBind&&W.onBind(W),W._onBindObservable&&W._onBindObservable.notifyObservers(W))},i.prototype.setState=function(W,i,L,h,l,t,p){void 0===i&&(i=0),void 0===h&&(h=!1),void 0===p&&(p=0)},i.prototype.setIntArray=function(W,i){return!0},i.prototype.setIntArray2=function(W,i){return!0},i.prototype.setIntArray3=function(W,i){return!0},i.prototype.setIntArray4=function(W,i){return!0},i.prototype.setFloatArray=function(W,i){return!0},i.prototype.setFloatArray2=function(W,i){return!0},i.prototype.setFloatArray3=function(W,i){return!0},i.prototype.setFloatArray4=function(W,i){return!0},i.prototype.setArray=function(W,i){return!0},i.prototype.setArray2=function(W,i){return!0},i.prototype.setArray3=function(W,i){return!0},i.prototype.setArray4=function(W,i){return!0},i.prototype.setMatrices=function(W,i){return!0},i.prototype.setMatrix3x3=function(W,i){return!0},i.prototype.setMatrix2x2=function(W,i){return!0},i.prototype.setFloat=function(W,i){return!0},i.prototype.setFloat2=function(W,i,L){return!0},i.prototype.setFloat3=function(W,i,L,h){return!0},i.prototype.setBool=function(W,i){return!0},i.prototype.setFloat4=function(W,i,L,h,l){return!0},i.prototype.setAlphaMode=function(W,i){void 0===i&&(i=!1),this._alphaMode!==W&&(this.alphaState.alphaBlend=0!==W,i||this.setDepthWrite(0===W),this._alphaMode=W)},i.prototype.bindBuffers=function(W,i,L){},i.prototype.wipeCaches=function(W){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,W&&(this._currentProgram=null,this._stencilStateComposer.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},i.prototype.draw=function(W,i,L,h){},i.prototype.drawElementsType=function(W,i,L,h){},i.prototype.drawArraysType=function(W,i,L,h){},i.prototype._createTexture=function(){return{}},i.prototype._releaseTexture=function(W){},i.prototype.createTexture=function(W,i,L,h,l,t,x,R,z,r,N,I){void 0===l&&(l=3),void 0===t&&(t=null),void 0===x&&(x=null),void 0===R&&(R=null),void 0===z&&(z=null),void 0===r&&(r=null),void 0===N&&(N=null);var s=new p.e(this,p.b.Url),o=String(W);return s.url=o,s.generateMipMaps=!i,s.samplingMode=l,s.invertY=L,s.baseWidth=this._options.textureSize,s.baseHeight=this._options.textureSize,s.width=this._options.textureSize,s.height=this._options.textureSize,r&&(s.format=r),s.isReady=!0,t&&setTimeout((function(){t(s)})),this._internalTexturesCache.push(s),s},i.prototype._createHardwareRenderTargetWrapper=function(W,i,L){var h=new r.d(W,i,L,this);return this._renderTargetWrapperCache.push(h),h},i.prototype.createRenderTargetTexture=function(W,i){var L=this._createHardwareRenderTargetWrapper(!1,!1,W),h={};void 0!==i&&"object"===typeof i?(h.generateMipMaps=i.generateMipMaps,h.generateDepthBuffer=void 0===i.generateDepthBuffer||i.generateDepthBuffer,h.generateStencilBuffer=h.generateDepthBuffer&&i.generateStencilBuffer,h.type=void 0===i.type?0:i.type,h.samplingMode=void 0===i.samplingMode?3:i.samplingMode):(h.generateMipMaps=i,h.generateDepthBuffer=!0,h.generateStencilBuffer=!1,h.type=0,h.samplingMode=3);var l=new p.e(this,p.b.RenderTarget),t=W.width||W,x=W.height||W;return L._generateDepthBuffer=h.generateDepthBuffer,L._generateStencilBuffer=!!h.generateStencilBuffer,l.baseWidth=t,l.baseHeight=x,l.width=t,l.height=x,l.isReady=!0,l.samples=1,l.generateMipMaps=!!h.generateMipMaps,l.samplingMode=h.samplingMode,l.type=h.type,this._internalTexturesCache.push(l),L},i.prototype.updateTextureSamplingMode=function(W,i){i.samplingMode=W},i.prototype.createRawTexture=function(W,i,L,h,l,t,x,R,z,r,N){void 0===R&&(R=null),void 0===z&&(z=0),void 0===r&&(r=0),void 0===N&&(N=!1);var I=new p.e(this,p.b.Raw);return I.baseWidth=i,I.baseHeight=L,I.width=i,I.height=L,I.format=h,I.generateMipMaps=l,I.samplingMode=x,I.invertY=t,I._compression=R,I.type=z,I._useSRGBBuffer=N,this._doNotHandleContextLost||(I._bufferView=W),I},i.prototype.updateRawTexture=function(W,i,L,h,l,t,p){void 0===l&&(l=null),void 0===t&&(t=0),void 0===p&&(p=!1),W&&(W._bufferView=i,W.format=L,W.invertY=h,W._compression=l,W.type=t,W._useSRGBBuffer=p)},i.prototype.bindFramebuffer=function(W,i,L,h,l){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=W,this._currentFramebuffer=null,this._cachedViewport&&!l&&this.setViewport(this._cachedViewport,L,h)},i.prototype.unBindFramebuffer=function(W,i,L){void 0===i&&(i=!1),this._currentRenderTarget=null,L&&L(),this._currentFramebuffer=null},i.prototype.createDynamicVertexBuffer=function(W){var i=new x.c;return i.references=1,i.capacity=1,i},i.prototype.updateDynamicTexture=function(W,i,L,h,l){void 0===h&&(h=!1)},i.prototype.areAllEffectsReady=function(){return!0},i.prototype.getError=function(){return 0},i.prototype._getUnpackAlignement=function(){return 1},i.prototype._unpackFlipY=function(W){},i.prototype.updateDynamicIndexBuffer=function(W,i,L){void 0===L&&(L=0)},i.prototype.updateDynamicVertexBuffer=function(W,i,L,h){},i.prototype._bindTextureDirectly=function(W,i){return this._boundTexturesCache[this._activeChannel]!==i&&(this._boundTexturesCache[this._activeChannel]=i,!0)},i.prototype._bindTexture=function(W,i){W<0||this._bindTextureDirectly(0,i)},i.prototype._deleteBuffer=function(W){},i.prototype.releaseEffects=function(){},i.prototype.displayLoadingUI=function(){},i.prototype.hideLoadingUI=function(){},Object.defineProperty(i.prototype,"loadingUIText",{set:function(W){},enumerable:!1,configurable:!0}),i.prototype._uploadCompressedDataToTextureDirectly=function(W,i,L,h,l,t,p){void 0===t&&(t=0),void 0===p&&(p=0)},i.prototype._uploadDataToTextureDirectly=function(W,i,L,h){void 0===L&&(L=0),void 0===h&&(h=0)},i.prototype._uploadArrayBufferViewToTexture=function(W,i,L,h){void 0===L&&(L=0),void 0===h&&(h=0)},i.prototype._uploadImageToTexture=function(W,i,L,h){void 0===L&&(L=0),void 0===h&&(h=0)}}(t.c)},52311:function(W,i,L){"use strict";L.d(i,{d:function(){return l}});var h=L(60766),l=function(){function W(W,i,L,h){this._textures=null,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=W,this._isCube=i,this._size=L,this._engine=h,this._depthStencilTexture=null}return Object.defineProperty(W.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"depthStencilTextureWithStencil",{get:function(){return this._depthStencilTextureWithStencil},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isCube",{get:function(){return this._isCube},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isMulti",{get:function(){return this._isMulti},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"is2DArray",{get:function(){return this.layers>0},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"size",{get:function(){return this.width},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"width",{get:function(){return this._size.width||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"height",{get:function(){return this._size.height||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"layers",{get:function(){return this._size.layers||0},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"texture",{get:function(){var W,i;return null!==(i=null===(W=this._textures)||void 0===W?void 0:W[0])&&void 0!==i?i:null},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"samples",{get:function(){var W,i;return null!==(i=null===(W=this.texture)||void 0===W?void 0:W.samples)&&void 0!==i?i:1},enumerable:!1,configurable:!0}),W.prototype.setSamples=function(W,i,L){return void 0===i&&(i=!0),void 0===L&&(L=!1),this.samples!==W||L?this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,W,i):this._engine.updateRenderTargetTextureSampleCount(this,W):W},W.prototype.setTextures=function(W){Array.isArray(W)?this._textures=W:this._textures=W?[W]:null},W.prototype.setTexture=function(W,i,L){void 0===i&&(i=0),void 0===L&&(L=!0),this._textures||(this._textures=[]),this._textures[i]&&L&&this._textures[i].dispose(),this._textures[i]=W},W.prototype.createDepthStencilTexture=function(W,i,L,h,l){var t;return void 0===W&&(W=0),void 0===i&&(i=!0),void 0===L&&(L=!1),void 0===h&&(h=1),void 0===l&&(l=14),null===(t=this._depthStencilTexture)||void 0===t||t.dispose(),this._depthStencilTextureWithStencil=L,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:i,comparisonFunction:W,generateStencil:L,isCube:this._isCube,samples:h,depthTextureFormat:l},this),this._depthStencilTexture},W.prototype._shareDepth=function(W){this._depthStencilTexture&&(W._depthStencilTexture&&W._depthStencilTexture.dispose(),W._depthStencilTexture=this._depthStencilTexture,this._depthStencilTexture.incrementReferences())},W.prototype._swapAndDie=function(W){this.texture&&this.texture._swapAndDie(W),this._textures=null,this.dispose(!0)},W.prototype._cloneRenderTargetWrapper=function(){var W,i,L,l,t,p,x=null;if(this._isMulti){var R=this.textures;if(R&&R.length>0){var z=!1,r=R.length,N=R[R.length-1]._source;N!==h.b.Depth&&N!==h.b.DepthStencil||(z=!0,r--);for(var I=[],s=[],o=0;o<r;++o){var D=R[o];I.push(D.samplingMode),s.push(D.type)}var S={samplingModes:I,generateMipMaps:R[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:z,types:s,textureCount:r},C={width:this.width,height:this.height};x=this._engine.createMultipleRenderTarget(C,S)}}else{var e={};if(e.generateDepthBuffer=this._generateDepthBuffer,e.generateMipMaps=null!==(i=null===(W=this.texture)||void 0===W?void 0:W.generateMipMaps)&&void 0!==i&&i,e.generateStencilBuffer=this._generateStencilBuffer,e.samplingMode=null===(L=this.texture)||void 0===L?void 0:L.samplingMode,e.type=null===(l=this.texture)||void 0===l?void 0:l.type,e.format=null===(t=this.texture)||void 0===t?void 0:t.format,this.isCube)x=this._engine.createRenderTargetCubeTexture(this.width,e);else{C={width:this.width,height:this.height,layers:this.is2DArray?null===(p=this.texture)||void 0===p?void 0:p.depth:void 0};x=this._engine.createRenderTargetTexture(C,e)}x.texture.isReady=!0}return x},W.prototype._swapRenderTargetWrapper=function(W){if(this._textures&&W._textures)for(var i=0;i<this._textures.length;++i)this._textures[i]._swapAndDie(W._textures[i],!1),W._textures[i].isReady=!0;this._depthStencilTexture&&W._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(W._depthStencilTexture),W._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null},W.prototype._rebuild=function(){var W=this._cloneRenderTargetWrapper();if(W){if(this._depthStencilTexture){var i=this._depthStencilTexture.samplingMode,L=2===i||3===i||11===i;W.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,L,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples)}this.samples>1&&W.setSamples(this.samples),W._swapRenderTargetWrapper(this),W.dispose()}},W.prototype.releaseTextures=function(){var W,i;if(this._textures)for(var L=0;null!==(i=L<(null===(W=this._textures)||void 0===W?void 0:W.length))&&void 0!==i&&i;++L)this._textures[L].dispose();this._textures=null},W.prototype.dispose=function(W){var i;void 0===W&&(W=!1),W||(null===(i=this._depthStencilTexture)||void 0===i||i.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)},W}()},23257:function(W,i,L){"use strict";L.r(i),L.d(i,{SceneInstrumentation:function(){return t}});var h=L(9217),l=L(16945),t=function(){function W(W){var i=this;this.scene=W,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new l.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new l.e,this._captureFrameTime=!1,this._frameTime=new l.e,this._captureRenderTime=!1,this._renderTime=new l.e,this._captureInterFrameTime=!1,this._interFrameTime=new l.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new l.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new l.e,this._capturePhysicsTime=!1,this._physicsTime=new l.e,this._captureAnimationsTime=!1,this._animationsTime=new l.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new l.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=W.onBeforeAnimationsObservable.add((function(){i._captureActiveMeshesEvaluationTime&&i._activeMeshesEvaluationTime.fetchNewFrame(),i._captureRenderTargetsRenderTime&&i._renderTargetsRenderTime.fetchNewFrame(),i._captureFrameTime&&(h.h.StartPerformanceCounter("Scene rendering"),i._frameTime.beginMonitoring()),i._captureInterFrameTime&&i._interFrameTime.endMonitoring(),i._captureParticlesRenderTime&&i._particlesRenderTime.fetchNewFrame(),i._captureSpritesRenderTime&&i._spritesRenderTime.fetchNewFrame(),i._captureAnimationsTime&&i._animationsTime.beginMonitoring(),i.scene.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=W.onAfterRenderObservable.add((function(){i._captureFrameTime&&(h.h.EndPerformanceCounter("Scene rendering"),i._frameTime.endMonitoring()),i._captureRenderTime&&i._renderTime.endMonitoring(!1),i._captureInterFrameTime&&i._interFrameTime.beginMonitoring()}))}return Object.defineProperty(W.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(W){var i=this;W!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=W,W?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add((function(){h.h.StartPerformanceCounter("Active meshes evaluation"),i._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add((function(){h.h.EndPerformanceCounter("Active meshes evaluation"),i._activeMeshesEvaluationTime.endMonitoring()}))):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(W){var i=this;W!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=W,W?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add((function(){h.h.StartPerformanceCounter("Render targets rendering"),i._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add((function(){h.h.EndPerformanceCounter("Render targets rendering"),i._renderTargetsRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(W){var i=this;W!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=W,W?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add((function(){h.h.StartPerformanceCounter("Particles"),i._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add((function(){h.h.EndPerformanceCounter("Particles"),i._particlesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(W){var i=this;W!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=W,this.scene.spriteManagers&&(W?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add((function(){h.h.StartPerformanceCounter("Sprites"),i._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add((function(){h.h.EndPerformanceCounter("Sprites"),i._spritesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(W){var i=this;W!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=W,W?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add((function(){h.h.StartPerformanceCounter("Physics"),i._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add((function(){h.h.EndPerformanceCounter("Physics"),i._physicsTime.endMonitoring()}))):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(W){var i=this;W!==this._captureAnimationsTime&&(this._captureAnimationsTime=W,W?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add((function(){i._animationsTime.endMonitoring()})):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(W){this._captureFrameTime=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(W){this._captureInterFrameTime=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(W){var i=this;W!==this._captureRenderTime&&(this._captureRenderTime=W,W?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add((function(){i._renderTime.beginMonitoring(),h.h.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add((function(){i._renderTime.endMonitoring(!1),h.h.EndPerformanceCounter("Main render")}))):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(W){var i=this;W!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=W,W?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add((function(W){i._cameraRenderTime.beginMonitoring(),h.h.StartPerformanceCounter("Rendering camera ".concat(W.name))})),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add((function(W){i._cameraRenderTime.endMonitoring(!1),h.h.EndPerformanceCounter("Rendering camera ".concat(W.name))}))):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!1,configurable:!0}),W.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},W}()},15706:function(W,i,L){"use strict";L.d(i,{d:function(){return z}});var h=L(40061),l=L(9892),t=L(80105),p=L(74134),x=L(315),R=L(13680);p.b.AddNodeConstructor("Light_Type_1",(function(W,i){return function(){return new z(W,t.m.Zero(),i)}}));var z=function(W){function i(i,L,h){var l=W.call(this,i,h)||this;return l._shadowFrustumSize=0,l._shadowOrthoScale=.1,l.autoUpdateExtends=!0,l.autoCalcShadowZBounds=!1,l._orthoLeft=Number.MAX_VALUE,l._orthoRight=Number.MIN_VALUE,l._orthoTop=Number.MIN_VALUE,l._orthoBottom=Number.MAX_VALUE,l.position=L.scale(-1),l.direction=L,l}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(W){this._shadowFrustumSize=W,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(W){this._shadowOrthoScale=W,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"orthoLeft",{get:function(){return this._orthoLeft},set:function(W){this._orthoLeft=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"orthoRight",{get:function(){return this._orthoRight},set:function(W){this._orthoRight=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"orthoTop",{get:function(){return this._orthoTop},set:function(W){this._orthoTop=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"orthoBottom",{get:function(){return this._orthoBottom},set:function(W){this._orthoBottom=W},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"DirectionalLight"},i.prototype.getTypeID=function(){return x.d.LIGHTTYPEID_DIRECTIONALLIGHT},i.prototype._setDefaultShadowProjectionMatrix=function(W,i,L){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(W):this._setDefaultAutoExtendShadowProjectionMatrix(W,i,L)},i.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(W){var i=this.getScene().activeCamera;i&&t.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:i.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,W,this.getScene().getEngine().isNDCHalfZRange)},i.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(W,i,L){var h=this.getScene().activeCamera;if(h){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var l=t.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var p=Number.MAX_VALUE,x=Number.MIN_VALUE,R=0;R<L.length;R++){var z=L[R];if(z)for(var r=z.getBoundingInfo().boundingBox,N=0;N<r.vectorsWorld.length;N++)t.m.TransformCoordinatesToRef(r.vectorsWorld[N],i,l),l.x<this._orthoLeft&&(this._orthoLeft=l.x),l.y<this._orthoBottom&&(this._orthoBottom=l.y),l.x>this._orthoRight&&(this._orthoRight=l.x),l.y>this._orthoTop&&(this._orthoTop=l.y),this.autoCalcShadowZBounds&&(l.z<p&&(p=l.z),l.z>x&&(x=l.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=p,this._shadowMaxZ=x)}var I=this._orthoRight-this._orthoLeft,s=this._orthoTop-this._orthoBottom,o=void 0!==this.shadowMinZ?this.shadowMinZ:h.minZ,D=void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,S=this.getScene().getEngine().useReverseDepthBuffer;t.d.OrthoOffCenterLHToRef(this._orthoLeft-I*this.shadowOrthoScale,this._orthoRight+I*this.shadowOrthoScale,this._orthoBottom-s*this.shadowOrthoScale,this._orthoTop+s*this.shadowOrthoScale,S?D:o,S?o:D,W,this.getScene().getEngine().isNDCHalfZRange)}},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.transferToEffect=function(W,i){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,i),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,i),this)},i.prototype.transferToNodeMaterialEffect=function(W,i){return this.computeTransformedInformation()?(W.setFloat3(i,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(W.setFloat3(i,this.direction.x,this.direction.y,this.direction.z),this)},i.prototype.getDepthMinZ=function(W){var i=this._scene.getEngine();return!i.useReverseDepthBuffer&&i.isNDCHalfZRange?0:1},i.prototype.getDepthMaxZ=function(W){var i=this._scene.getEngine();return i.useReverseDepthBuffer&&i.isNDCHalfZRange?0:1},i.prototype.prepareLightSpecificDefines=function(W,i){W["DIRLIGHT"+i]=!0},(0,h.j)([(0,l.H)()],i.prototype,"shadowFrustumSize",null),(0,h.j)([(0,l.H)()],i.prototype,"shadowOrthoScale",null),(0,h.j)([(0,l.H)()],i.prototype,"autoUpdateExtends",void 0),(0,h.j)([(0,l.H)()],i.prototype,"autoCalcShadowZBounds",void 0),(0,h.j)([(0,l.H)("orthoLeft")],i.prototype,"_orthoLeft",void 0),(0,h.j)([(0,l.H)("orthoRight")],i.prototype,"_orthoRight",void 0),(0,h.j)([(0,l.H)("orthoTop")],i.prototype,"_orthoTop",void 0),(0,h.j)([(0,l.H)("orthoBottom")],i.prototype,"_orthoBottom",void 0),i}(R.c)},23056:function(W,i,L){"use strict";L.d(i,{e:function(){return z}});var h=L(40061),l=L(9892),t=L(80105),p=L(9488),x=L(74134),R=L(315);x.b.AddNodeConstructor("Light_Type_3",(function(W,i){return function(){return new z(W,t.m.Zero(),i)}}));var z=function(W){function i(i,L,h){var l=W.call(this,i,h)||this;return l.groundColor=new p.d(0,0,0),l.direction=L||t.m.Up(),l}return(0,h.n)(i,W),i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.getClassName=function(){return"HemisphericLight"},i.prototype.setDirectionToTarget=function(W){return this.direction=t.m.Normalize(W.subtract(t.m.Zero())),this.direction},i.prototype.getShadowGenerator=function(){return null},i.prototype.transferToEffect=function(W,i){var L=t.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",L.x,L.y,L.z,0,i),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),i),this},i.prototype.transferToNodeMaterialEffect=function(W,i){var L=t.m.Normalize(this.direction);return W.setFloat3(i,L.x,L.y,L.z),this},i.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=t.d.Identity()),this._worldMatrix},i.prototype.getTypeID=function(){return R.d.LIGHTTYPEID_HEMISPHERICLIGHT},i.prototype.prepareLightSpecificDefines=function(W,i){W["HEMILIGHT"+i]=!0},(0,h.j)([(0,l.q)()],i.prototype,"groundColor",void 0),(0,h.j)([(0,l.G)()],i.prototype,"direction",void 0),i}(R.d)},13680:function(W,i,L){"use strict";L.d(i,{c:function(){return R}});var h=L(40061),l=L(9892),t=L(80105),p=L(315),x=L(54044),R=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i._needProjectionMatrixCompute=!0,i}return(0,h.n)(i,W),i.prototype._setPosition=function(W){this._position=W},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(W){this._setPosition(W)},enumerable:!1,configurable:!0}),i.prototype._setDirection=function(W){this._direction=W},Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(W){this._setDirection(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(W){this._shadowMinZ=W,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(W){this._shadowMaxZ=W,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),i.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=t.m.Zero()),t.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=t.m.Zero()),t.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},i.prototype.getDepthScale=function(){return 50},i.prototype.getShadowDirection=function(W){return this.transformedDirection?this.transformedDirection:this.direction},i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setDirectionToTarget=function(W){return this.direction=t.m.Normalize(W.subtract(this.position)),this.direction},i.prototype.getRotation=function(){this.direction.normalize();var W=t.m.Cross(this.direction,x.e.Y),i=t.m.Cross(W,this.direction);return t.m.RotationFromAxis(W,i,this.direction)},i.prototype.needCube=function(){return!1},i.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},i.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},i.prototype._initCache=function(){W.prototype._initCache.call(this),this._cache.position=t.m.Zero()},i.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},i.prototype.computeWorldMatrix=function(W){return!W&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=t.d.Identity()),t.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},i.prototype.getDepthMinZ=function(W){return void 0!==this.shadowMinZ?this.shadowMinZ:W.minZ},i.prototype.getDepthMaxZ=function(W){return void 0!==this.shadowMaxZ?this.shadowMaxZ:W.maxZ},i.prototype.setShadowProjectionMatrix=function(W,i,L){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(i,L,W):this._setDefaultShadowProjectionMatrix(W,i,L),this},i.prototype._syncParentEnabledState=function(){W.prototype._syncParentEnabledState.call(this),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)},(0,h.j)([(0,l.G)()],i.prototype,"position",null),(0,h.j)([(0,l.G)()],i.prototype,"direction",null),(0,h.j)([(0,l.H)()],i.prototype,"shadowMinZ",null),(0,h.j)([(0,l.H)()],i.prototype,"shadowMaxZ",null),i}(p.d)},67269:function(W,i,L){"use strict";L.d(i,{e:function(){return s}});var h,l=L(9217),t=L(9271),p=L(37105),x=L(90690),R=L(78588),z=L(9127),r=L(97964),N=L(82790),I=L(33224);!function(W){W[W.Clean=0]="Clean",W[W.Stop=1]="Stop",W[W.Sync=2]="Sync",W[W.NoSync=3]="NoSync"}(h||(h={}));var s=function(){function W(){}return Object.defineProperty(W,"ForceFullSceneLoadingForIncremental",{get:function(){return r.e.ForceFullSceneLoadingForIncremental},set:function(W){r.e.ForceFullSceneLoadingForIncremental=W},enumerable:!1,configurable:!0}),Object.defineProperty(W,"ShowLoadingScreen",{get:function(){return r.e.ShowLoadingScreen},set:function(W){r.e.ShowLoadingScreen=W},enumerable:!1,configurable:!0}),Object.defineProperty(W,"loggingLevel",{get:function(){return r.e.loggingLevel},set:function(W){r.e.loggingLevel=W},enumerable:!1,configurable:!0}),Object.defineProperty(W,"CleanBoneMatrixWeights",{get:function(){return r.e.CleanBoneMatrixWeights},set:function(W){r.e.CleanBoneMatrixWeights=W},enumerable:!1,configurable:!0}),W.GetDefaultPlugin=function(){return W._RegisteredPlugins[".babylon"]},W._GetPluginForExtension=function(i){var L=W._RegisteredPlugins[i];return L||(z.e.Warn("Unable to find a plugin to load "+i+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type"),W.GetDefaultPlugin())},W._GetPluginForDirectLoad=function(i){for(var L in W._RegisteredPlugins){var h=W._RegisteredPlugins[L].plugin;if(h.canDirectLoad&&h.canDirectLoad(i))return W._RegisteredPlugins[L]}return W.GetDefaultPlugin()},W._GetPluginForFilename=function(i){var L=i.indexOf("?");-1!==L&&(i=i.substring(0,L));var h=i.lastIndexOf("."),l=i.substring(h,i.length).toLowerCase();return W._GetPluginForExtension(l)},W._GetDirectLoad=function(W){return"data:"===W.substr(0,5)?W.substr(5):null},W._FormatErrorMessage=function(W,i,L){var h="Unable to load from "+W.url;return i?h+=": ".concat(i):L&&(h+=": ".concat(L)),h},W._LoadData=function(i,L,h,l,t,p,R){var z,r=W._GetDirectLoad(i.url),I=R?W._GetPluginForExtension(R):r?W._GetPluginForDirectLoad(i.url):W._GetPluginForFilename(i.url);if(!(z=void 0!==I.plugin.createPlugin?I.plugin.createPlugin():I.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(W.OnPluginActivatedObservable.notifyObservers(z),r&&(z.canDirectLoad&&z.canDirectLoad(i.url)||!(0,N.g)(i.url))){if(z.directLoad){var s=z.directLoad(L,r);s.then?s.then((function(W){h(z,W)})).catch((function(W){t("Error in directLoad of _loadData: "+W,W)})):h(z,s)}else h(z,r);return z}var o=I.isBinary,D=function(W,i){L.isDisposed?t("Scene has been disposed"):h(z,W,i)},S=null,C=!1,e=z.onDisposeObservable;e&&e.add((function(){C=!0,S&&(S.abort(),S=null),p()}));var V=function(){if(!C){var W=function(W,i){t(null===W||void 0===W?void 0:W.statusText,i)},h=i.file||i.url;S=z.loadFile?z.loadFile(L,h,D,l,o,W):L._loadFile(h,D,l,!0,o,W)}},c=L.getEngine(),f=c.enableOfflineSupport;if(f){for(var a=!1,P=0,y=L.disableOfflineSupportExceptionRules;P<y.length;P++){if(y[P].test(i.url)){a=!0;break}}f=!a}return f&&x.c.OfflineProviderFactory?L.offlineProvider=x.c.OfflineProviderFactory(i.url,V,c.disableManifestCheck):V(),z},W._GetFileInfo=function(W,i){var L,h,t=null;if(i)if(i.name){var p=i;L="file:".concat(p.name),h=p.name,t=p}else if("string"===typeof i&&i.startsWith("data:"))L=i,h="";else{var x=i;if("/"===x.substr(0,1))return l.h.Error("Wrong sceneFilename parameter"),null;L=W+x,h=x}else L=W,h=l.h.GetFilename(W),W=l.h.GetFolderPath(W);return{url:L,rootUrl:W,name:h,file:t}},W.GetPluginForExtension=function(i){return W._GetPluginForExtension(i).plugin},W.IsPluginForExtensionAvailable=function(i){return!!W._RegisteredPlugins[i]},W.RegisterPlugin=function(i){if("string"===typeof i.extensions){var L=i.extensions;W._RegisteredPlugins[L.toLowerCase()]={plugin:i,isBinary:!1}}else{var h=i.extensions;Object.keys(h).forEach((function(L){W._RegisteredPlugins[L.toLowerCase()]={plugin:i,isBinary:h[L].isBinary}}))}},W.ImportMesh=function(i,L,h,l,t,p,x,r){if(void 0===h&&(h=""),void 0===l&&(l=R.d.LastCreatedScene),void 0===t&&(t=null),void 0===p&&(p=null),void 0===x&&(x=null),void 0===r&&(r=null),!l)return z.e.Error("No scene available to import mesh to"),null;var N=W._GetFileInfo(L,h);if(!N)return null;var s={};l._addPendingData(s);var o=function(){l._removePendingData(s)},D=function(i,L){var h=W._FormatErrorMessage(N,i,L);x?x(l,h,new I.j(h,I.f.SceneLoaderError,L)):z.e.Error(h),o()},S=p?function(W){try{p(W)}catch(W){D("Error in onProgress callback: "+W,W)}}:void 0,C=function(W,i,L,h,p,x,R){if(l.importedMeshesFiles.push(N.url),t)try{t(W,i,L,h,p,x,R)}catch(W){D("Error in onSuccess callback: "+W,W)}l._removePendingData(s)};return W._LoadData(N,l,(function(W,L,h){if(W.rewriteRootURL&&(N.rootUrl=W.rewriteRootURL(N.rootUrl,h)),W.importMesh){var t=W,p=new Array,x=new Array,R=new Array;if(!t.importMesh(i,l,L,N.rootUrl,p,x,R,D))return;l.loadingPluginName=W.name,C(p,x,R,[],[],[],[])}else{W.importMeshAsync(i,l,L,N.rootUrl,S,N.name).then((function(i){l.loadingPluginName=W.name,C(i.meshes,i.particleSystems,i.skeletons,i.animationGroups,i.transformNodes,i.geometries,i.lights)})).catch((function(W){D(W.message,W)}))}}),S,D,o,r)},W.ImportMeshAsync=function(i,L,h,l,t,p){return void 0===h&&(h=""),void 0===l&&(l=R.d.LastCreatedScene),void 0===t&&(t=null),void 0===p&&(p=null),new Promise((function(x,R){W.ImportMesh(i,L,h,l,(function(W,i,L,h,l,t,p){x({meshes:W,particleSystems:i,skeletons:L,animationGroups:h,transformNodes:l,geometries:t,lights:p})}),t,(function(W,i,L){R(L||new Error(i))}),p)}))},W.Load=function(i,L,h,t,x,z,r){return void 0===L&&(L=""),void 0===h&&(h=R.d.LastCreatedEngine),void 0===t&&(t=null),void 0===x&&(x=null),void 0===z&&(z=null),void 0===r&&(r=null),h?W.Append(i,L,new p.b(h),t,x,z,r):(l.h.Error("No engine available"),null)},W.LoadAsync=function(i,L,h,l,t){return void 0===L&&(L=""),void 0===h&&(h=R.d.LastCreatedEngine),void 0===l&&(l=null),void 0===t&&(t=null),new Promise((function(p,x){W.Load(i,L,h,(function(W){p(W)}),l,(function(W,i,L){x(L||new Error(i))}),t)}))},W.Append=function(i,L,h,l,t,p,x){var r=this;if(void 0===L&&(L=""),void 0===h&&(h=R.d.LastCreatedScene),void 0===l&&(l=null),void 0===t&&(t=null),void 0===p&&(p=null),void 0===x&&(x=null),!h)return z.e.Error("No scene available to append to"),null;var N=W._GetFileInfo(i,L);if(!N)return null;W.ShowLoadingScreen&&!this._ShowingLoadingScreen&&(this._ShowingLoadingScreen=!0,h.getEngine().displayLoadingUI(),h.executeWhenReady((function(){h.getEngine().hideLoadingUI(),r._ShowingLoadingScreen=!1})));var s={};h._addPendingData(s);var o=function(){h._removePendingData(s)},D=function(i,L){var l=W._FormatErrorMessage(N,i,L);p?p(h,l,new I.j(l,I.f.SceneLoaderError,L)):z.e.Error(l),o()},S=t?function(W){try{t(W)}catch(W){D("Error in onProgress callback",W)}}:void 0,C=function(){if(l)try{l(h)}catch(W){D("Error in onSuccess callback",W)}h._removePendingData(s)};return W._LoadData(N,h,(function(W,i){if(W.load){if(!W.load(h,i,N.rootUrl,D))return;h.loadingPluginName=W.name,C()}else{W.loadAsync(h,i,N.rootUrl,S,N.name).then((function(){h.loadingPluginName=W.name,C()})).catch((function(W){D(W.message,W)}))}}),S,D,o,x)},W.AppendAsync=function(i,L,h,l,t){return void 0===L&&(L=""),void 0===h&&(h=R.d.LastCreatedScene),void 0===l&&(l=null),void 0===t&&(t=null),new Promise((function(p,x){W.Append(i,L,h,(function(W){p(W)}),l,(function(W,i,L){x(L||new Error(i))}),t)}))},W.LoadAssetContainer=function(i,L,h,l,t,p,x){if(void 0===L&&(L=""),void 0===h&&(h=R.d.LastCreatedScene),void 0===l&&(l=null),void 0===t&&(t=null),void 0===p&&(p=null),void 0===x&&(x=null),!h)return z.e.Error("No scene available to load asset container to"),null;var r=W._GetFileInfo(i,L);if(!r)return null;var N={};h._addPendingData(N);var s=function(){h._removePendingData(N)},o=function(i,L){var l=W._FormatErrorMessage(r,i,L);p?p(h,l,new I.j(l,I.f.SceneLoaderError,L)):z.e.Error(l),s()},D=t?function(W){try{t(W)}catch(W){o("Error in onProgress callback",W)}}:void 0,S=function(W){if(l)try{l(W)}catch(W){o("Error in onSuccess callback",W)}h._removePendingData(N)};return W._LoadData(r,h,(function(W,i){if(W.loadAssetContainer){var L=W.loadAssetContainer(h,i,r.rootUrl,o);if(!L)return;h.loadingPluginName=W.name,S(L)}else if(W.loadAssetContainerAsync){W.loadAssetContainerAsync(h,i,r.rootUrl,D,r.name).then((function(i){h.loadingPluginName=W.name,S(i)})).catch((function(W){o(W.message,W)}))}else o("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),D,o,s,x)},W.LoadAssetContainerAsync=function(i,L,h,l,t){return void 0===L&&(L=""),void 0===h&&(h=R.d.LastCreatedScene),void 0===l&&(l=null),void 0===t&&(t=null),new Promise((function(p,x){W.LoadAssetContainer(i,L,h,(function(W){p(W)}),l,(function(W,i,L){x(L||new Error(i))}),t)}))},W.ImportAnimations=function(W,i,L,l,t,p,x,r,N,I){if(void 0===i&&(i=""),void 0===L&&(L=R.d.LastCreatedScene),void 0===l&&(l=!0),void 0===t&&(t=h.Clean),void 0===p&&(p=null),void 0===x&&(x=null),void 0===r&&(r=null),void 0===N&&(N=null),void 0===I&&(I=null),L){if(l){for(var s=0,o=L.animatables;s<o.length;s++){o[s].reset()}L.stopAllAnimations(),L.animationGroups.slice().forEach((function(W){W.dispose()})),L.getNodes().forEach((function(W){W.animations&&(W.animations=[])}))}else switch(t){case h.Clean:L.animationGroups.slice().forEach((function(W){W.dispose()}));break;case h.Stop:L.animationGroups.forEach((function(W){W.stop()}));break;case h.Sync:L.animationGroups.forEach((function(W){W.reset(),W.restart()}));break;case h.NoSync:break;default:return void z.e.Error("Unknown animation group loading mode value '"+t+"'")}var D=L.animatables.length;this.LoadAssetContainer(W,i,L,(function(W){W.mergeAnimationsTo(L,L.animatables.slice(D),p),W.dispose(),L.onAnimationFileImportedObservable.notifyObservers(L),x&&x(L)}),r,N,I)}else z.e.Error("No scene available to load animations to")},W.ImportAnimationsAsync=function(i,L,l,t,p,x,z,r,N,I){return void 0===L&&(L=""),void 0===l&&(l=R.d.LastCreatedScene),void 0===t&&(t=!0),void 0===p&&(p=h.Clean),void 0===x&&(x=null),void 0===z&&(z=null),void 0===r&&(r=null),void 0===N&&(N=null),void 0===I&&(I=null),new Promise((function(h,R){W.ImportAnimations(i,L,l,t,p,x,(function(W){h(W)}),r,(function(W,i,L){R(L||new Error(i))}),I)}))},W.NO_LOGGING=0,W.MINIMAL_LOGGING=1,W.SUMMARY_LOGGING=2,W.DETAILED_LOGGING=3,W.OnPluginActivatedObservable=new t.c,W._RegisteredPlugins={},W._ShowingLoadingScreen=!1,W}()},97964:function(W,i,L){"use strict";L.d(i,{e:function(){return h}});var h=function(){function W(){}return Object.defineProperty(W,"ForceFullSceneLoadingForIncremental",{get:function(){return W._ForceFullSceneLoadingForIncremental},set:function(i){W._ForceFullSceneLoadingForIncremental=i},enumerable:!1,configurable:!0}),Object.defineProperty(W,"ShowLoadingScreen",{get:function(){return W._ShowLoadingScreen},set:function(i){W._ShowLoadingScreen=i},enumerable:!1,configurable:!0}),Object.defineProperty(W,"loggingLevel",{get:function(){return W._LoggingLevel},set:function(i){W._LoggingLevel=i},enumerable:!1,configurable:!0}),Object.defineProperty(W,"CleanBoneMatrixWeights",{get:function(){return W._CleanBoneMatrixWeights},set:function(i){W._CleanBoneMatrixWeights=i},enumerable:!1,configurable:!0}),W._ForceFullSceneLoadingForIncremental=!1,W._ShowLoadingScreen=!0,W._CleanBoneMatrixWeights=!1,W._LoggingLevel=0,W}()},82325:function(W,i,L){"use strict";L.d(i,{c:function(){return ZW}});var h=L(40061),l=L(9892),t=L(9127),p=L(21901),x=L(5344),R=L(37105),z=L(80105),r=L(43251),N=L(4241),I=L(96558),s=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.BRDF_V_HEIGHT_CORRELATED=!1,i.MS_BRDF_ENERGY_CONSERVATION=!1,i.SPHERICAL_HARMONICS=!1,i.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,i}return(0,h.n)(i,W),i}(N.b),o=function(W){function i(L,h){void 0===h&&(h=!0);var l=W.call(this,L,"PBRBRDF",90,new s,h)||this;return l._useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,l.useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,l._useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,l.useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,l._useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,l.useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,l._useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,l.useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,l._internalMarkAllSubMeshesAsMiscDirty=L._dirtyCallbacks[16],l._enable(!0),l}return(0,h.n)(i,W),i.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},i.prototype.prepareDefines=function(W){W.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,W.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,W.SPHERICAL_HARMONICS=this._useSphericalHarmonics,W.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},i.prototype.getClassName=function(){return"PBRBRDFConfiguration"},i.DEFAULT_USE_ENERGY_CONSERVATION=!0,i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,i.DEFAULT_USE_SPHERICAL_HARMONICS=!0,i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useEnergyConservation",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSphericalHarmonics",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),i}(I.e),D=L(90888),S=L(9488),C=L(96658),e=L(23016),V=L(46907),c=L(38956),f=L(29553),a=L(33048),P=L(70937),y=L(37001),M=(L(28689),L(16179)),b=(L(74422),L(44184),"uniform vec4 vEyePosition;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec4 vMetallicReflectanceFactors;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\nuniform vec3 vAmbientColor;\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REALTIME_FILTERING\nuniform vec2 vReflectionFilteringInfo;\n#endif\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#if defined(SS_REFRACTION) && defined(SS_USE_LOCAL_REFRACTIONMAP_CUBIC)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n#ifdef IRIDESCENCE\nuniform vec4 vIridescenceParams;\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_ROUGHNESS\nuniform float vSheenRoughness;\n#endif\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#ifdef REALTIME_FILTERING\nuniform vec2 vRefractionFilteringInfo;\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;\nuniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;\nuniform mat4 translucencyIntensityMatrix;\n#endif\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n#endif\n#ifdef PREPASS\n#ifdef SS_SCATTERING\nuniform float scatteringDiffusionProfile;\n#endif\n#endif\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n#endif\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n");M.e.IncludesShadersStore.pbrFragmentDeclaration=b;L(88987),L(61496);var j="layout(std140,column_major) uniform;\nuniform Material {\nvec2 vAlbedoInfos;\nvec4 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec3 vReflectivityInfos;\nvec2 vMicroSurfaceSamplerInfos;\nvec2 vReflectionInfos;\nvec2 vReflectionFilteringInfo;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec3 vBumpInfos;\nmat4 albedoMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 reflectivityMatrix;\nmat4 microSurfaceSamplerMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nmat4 reflectionMatrix;\nvec3 vReflectionColor;\nvec4 vAlbedoColor;\nvec4 vLightingIntensity;\nvec3 vReflectionMicrosurfaceInfos;\nfloat pointSize;\nvec4 vReflectivityColor;\nvec3 vEmissiveColor;\nvec3 vAmbientColor;\nvec2 vDebugMode;\nvec4 vMetallicReflectanceFactors;\nvec2 vMetallicReflectanceInfos;\nmat4 metallicReflectanceMatrix;\nvec2 vReflectanceInfos;\nmat4 reflectanceMatrix;\nvec3 vSphericalL00;\nvec3 vSphericalL1_1;\nvec3 vSphericalL10;\nvec3 vSphericalL11;\nvec3 vSphericalL2_2;\nvec3 vSphericalL2_1;\nvec3 vSphericalL20;\nvec3 vSphericalL21;\nvec3 vSphericalL22;\nvec3 vSphericalX;\nvec3 vSphericalY;\nvec3 vSphericalZ;\nvec3 vSphericalXX_ZZ;\nvec3 vSphericalYY_ZZ;\nvec3 vSphericalZZ;\nvec3 vSphericalXY;\nvec3 vSphericalYZ;\nvec3 vSphericalZX;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";M.e.IncludesShadersStore.pbrUboDeclaration=j;L(87321);var Z="varying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n";M.e.IncludesShadersStore.pbrFragmentExtraDeclaration=Z;L(65084),L(45928),L(54587);var X="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n#endif\n";M.e.IncludesShadersStore.samplerFragmentAlternateDeclaration=X;var T="#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D clearCoatRoughnessSampler;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D sheenRoughnessSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;\nuniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D refractionSamplerLow;\nuniform sampler2D refractionSamplerHigh;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#endif\n";M.e.IncludesShadersStore.pbrFragmentSamplersDeclaration=T;L(23598),L(76578),L(96919),L(35850),L(83874);var F="bool testLightingForSSS(float diffusionProfile)\n{\nreturn diffusionProfile<1.;\n}";M.e.IncludesShadersStore.subSurfaceScatteringFunctions=F;var q="vec3 hemisphereCosSample(vec2 u) {\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=1.-u.y;\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { \nfloat phi=2.*PI*u.x;\nfloat sinTheta=pow(u.y,a/(2.*a+1.));\nfloat cosTheta=sqrt(1.-sinTheta*sinTheta);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}";M.e.IncludesShadersStore.importanceSampling=q;var H="#define RECIPROCAL_PI2 0.15915494\n#define RECIPROCAL_PI 0.31830988618\n#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{\nreturn square(roughness)+MINIMUMVARIANCE;\n}\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=saturate(reflectance0*25.0);\nreturn reflectance90;\n}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);\nvec3 nDfdy=dFdy(normalVector.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\nfloat geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\ngeometricAlphaGFactor*=0.75;\nreturn vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {\nfloat alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);\nfloat alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);\nreturn vec2(alphaT,alphaB);\n}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {\nvec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;\nvec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);\nvec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);\nvec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));\nreturn anisotropicNormal;\n}\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nvec3 cocaLambert(vec3 alpha,float distance) {\nreturn exp(-alpha*distance);\n}\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {\nreturn cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));\n}\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {\nreturn -log(color)/distance;\n}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);\nreturn clearCoatAbsorption;\n}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n#endif\n";M.e.IncludesShadersStore.pbrHelperFunctions=H;L(68923),L(35765);var k="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nreturn vSphericalL00\n+ vSphericalL1_1*(normal.y)\n+ vSphericalL10*(normal.z)\n+ vSphericalL11*(normal.x)\n+ vSphericalL2_2*(normal.y*normal.x)\n+ vSphericalL2_1*(normal.y*normal.z)\n+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ vSphericalL21*(normal.z*normal.x)\n+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));\n}\n#else\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz *Nz+C1;\nvec3 t2=a2 *Ny+t1;\nvec3 t3=b3 *Nx+t2;\nreturn t3;\n}\n#endif\n#endif\n";M.e.IncludesShadersStore.harmonicsFunctions=k;var U="struct preLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat lightDistance;\nfloat attenuation;\nvec3 L;\nvec3 H;\nfloat NdotV;\nfloat NdotLUnclamped;\nfloat NdotL;\nfloat VdotH;\nfloat roughness;\n#ifdef IRIDESCENCE\nfloat iridescenceIntensity;\n#endif\n};\npreLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nresult.lightDistance=sqrt(result.lightDistanceSquared);\nresult.L=normalize(result.lightOffset);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.lightDistance=length(-lightData.xyz);\nresult.L=normalize(-lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.NdotL=dot(N,lightData.xyz)*0.5+0.5;\nresult.NdotL=saturateEps(result.NdotL);\nresult.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;\n}";M.e.IncludesShadersStore.pbrDirectLightingSetupFunctions=U;var d="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/maxEps(lightDistanceSquared);\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nfloat lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=saturate(1.0-factor*factor);\nattenuation*=attenuation;\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=saturate(cd*lightAngleScale+lightAngleOffset);\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}";M.e.IncludesShadersStore.pbrDirectLightingFalloffFunctions=d;var B="#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\nvec2 UV=vec2(NdotV,perceptualRoughness);\nvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{\nfloat c=1.0-NdotV;\nfloat c3=c*c*c;\nreturn 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));\n}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);\nvec3 getIORTfromAirToSurfaceR0(vec3 f0) {\nvec3 sqrtF0=sqrt(f0);\nreturn (1.+sqrtF0)/(1.-sqrtF0);\n}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {\nreturn square((iorT-vec3(iorI))/(iorT+vec3(iorI)));\n}\nfloat getR0fromIORs(float iorT,float iorI) {\nreturn square((iorT-iorI)/(iorT+iorI));\n}\nvec3 evalSensitivity(float opd,vec3 shift) {\nfloat phase=2.0*PI*opd*1.0e-9;\nconst vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);\nconst vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);\nconst vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);\nvec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);\nxyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));\nxyz/=1.0685e-7;\nvec3 srgb=XYZ_TO_REC709*xyz;\nreturn srgb;\n}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {\nvec3 I=vec3(1.0);\nfloat iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));\nfloat sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));\nfloat cosTheta2Sq=1.0-sinTheta2Sq;\nif (cosTheta2Sq<0.0) {\nreturn I;\n}\nfloat cosTheta2=sqrt(cosTheta2Sq);\nfloat R0=getR0fromIORs(iridescenceIOR,outsideIOR);\nfloat R12=fresnelSchlickGGX(cosTheta1,R0,1.);\nfloat R21=R12;\nfloat T121=1.0-R12;\nfloat phi12=0.0;\nif (iridescenceIOR<outsideIOR) phi12=PI;\nfloat phi21=PI-phi12;\nvec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);\nvec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));\nvec3 phi23=vec3(0.0);\nif (baseIOR[0]<iridescenceIOR) phi23[0]=PI;\nif (baseIOR[1]<iridescenceIOR) phi23[1]=PI;\nif (baseIOR[2]<iridescenceIOR) phi23[2]=PI;\nfloat opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;\nvec3 phi=vec3(phi21)+phi23;\nvec3 R123=clamp(R12*R23,1e-5,0.9999);\nvec3 r123=sqrt(R123);\nvec3 Rs=square(T121)*R23/(vec3(1.0)-R123);\nvec3 C0=R12+Rs;\nI=C0;\nvec3 Cm=Rs-T121;\nfor (int m=1; m<=2; ++m)\n{\nCm*=r123;\nvec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);\nI+=Cm*Sm;\n}\nreturn max(I,vec3(0.0));\n}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\nreturn 0.25/(VdotH*VdotH); \n}\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{\nfloat oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);\nfloat a=mix(21.5473,25.3245,oneMinusAlphaSq);\nfloat b=mix(3.82987,3.32435,oneMinusAlphaSq);\nfloat c=mix(0.19823,0.16801,oneMinusAlphaSq);\nfloat d=mix(-1.97760,-1.27393,oneMinusAlphaSq);\nfloat e=mix(-4.32054,-4.85967,oneMinusAlphaSq);\nreturn a/(1.0+b*pow(x,c))+d*x+e;\n}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{\nreturn abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));\n}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{\nfloat G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));\nreturn G/(4.0*NdotV*NdotL);\n}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n";M.e.IncludesShadersStore.pbrBRDFFunctions=B;var w="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#if defined(WEBGL2) || defined(WEBGPU)\nfloat radicalInverse_VdC(uint bits) \n{\nbits=(bits<<16u) | (bits>>16u);\nbits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);\nbits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);\nbits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);\nbits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);\nreturn float(bits)*2.3283064365386963e-10; \n}\nvec2 hammersley(uint i,uint N)\n{\nreturn vec2(float(i)/float(N),radicalInverse_VdC(i));\n}\n#else\nfloat vanDerCorpus(int n,int base)\n{\nfloat invBase=1.0/float(base);\nfloat denom =1.0;\nfloat result =0.0;\nfor(int i=0; i<32; ++i)\n{\nif(n>0)\n{\ndenom =mod(float(n),2.0);\nresult+=denom*invBase;\ninvBase=invBase/2.0;\nn =int(float(n)/2.0);\n}\n}\nreturn result;\n}\nvec2 hammersley(int i,int N)\n{\nreturn vec2(float(i)/float(N),vanDerCorpus(i,2));\n}\n#endif\nfloat log4(float x) {\nreturn log2(x)/2.;\n}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);\nconst float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;\nconst float K=4.;\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nvec3 result=vec3(0.0);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\n#if defined(WEBGL2) || defined(WEBGPU)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 Ls=hemisphereCosSample(Xi);\nLs=normalize(Ls);\nvec3 Ns=vec3(0.,0.,1.);\nfloat NoL=dot(Ns,Ls);\nif (NoL>0.) {\nfloat pdf_inversed=PI/NoL;\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(l,0.0,maxLevel);\nvec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;\n}\n}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;\nreturn result;\n}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nif (alphaG==0.) {\nvec3 c=textureCube(inputTexture,n).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;\n} else {\nvec3 result=vec3(0.);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\nfloat weight=0.;\n#if defined(WEBGL2) || defined(WEBGPU)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);\nfloat NoV=1.;\nfloat NoH=H.z;\nfloat NoH2=H.z*H.z;\nfloat NoL=2.*NoH2-1.;\nvec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);\nL=normalize(L);\nif (NoL>0.) {\nfloat pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(float(l),0.0,maxLevel);\nweight+=NoL;\nvec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;\n}\n}\nresult=result/weight;\nreturn result;\n}\n}\n#endif\n#endif\n";M.e.IncludesShadersStore.hdrFilteringFunctions=w;var g="#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nfloat lightRoughness=lightRadius/lightDistance;\nfloat totalRoughness=saturate(lightRoughness+roughness);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\nreturn mix(groundColor,lightColor,info.NdotL);\n}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\nfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\nfloat NdotL=absEps(info.NdotLUnclamped);\nfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\nfloat trAdapt=step(0.,info.NdotLUnclamped);\nvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\nfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\n}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat TdotH=dot(T,info.H);\nfloat BdotH=dot(B,info.H);\nfloat TdotV=dot(T,V);\nfloat BdotV=dot(B,V);\nfloat TdotL=dot(T,info.L);\nfloat BdotL=dot(B,info.L);\nfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\nvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\nalphaTB=max(alphaTB,square(geometricRoughnessFactor));\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\nfloat smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\nfloat NccdotL=saturateEps(dot(Ncc,info.L));\nfloat NccdotH=saturateEps(dot(Ncc,info.H));\nfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\nfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnel*=clearCoatIntensity;\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\nfloat kelemenVisibility=visibility_Kelemen(info.VdotH);\nfloat clearCoatTerm=fresnel*distribution*kelemenVisibility;\nreturn vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);\n}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\nfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\nvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\nreturn absorption;\n}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat fresnel=1.;\nfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\n/*#ifdef SHEEN_SOFTER\nfloat visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\n/* #endif */\nfloat sheenTerm=fresnel*distribution*visibility;\nreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n";M.e.IncludesShadersStore.pbrDirectLightingFunctions=g;var n="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {\nfloat microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {\nfloat lod=log2(cubeMapDimensionPixels)*roughness;\nreturn lod;\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn saturate(square(temp)-1.0+ambientOcclusion);\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {\nvec3 reflection=reflect(view,normal);\nfloat temp=saturate(1.0+1.1*dot(reflection,geometricNormal));\nreturn square(temp);\n}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nreturn getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);\n}\n#endif\n";M.e.IncludesShadersStore.pbrIBLFunctions=n;L(72994),L(49904),L(31814);var m="struct albedoOpacityOutParams\n{\nvec3 surfaceAlbedo;\nfloat alpha;\n};\n#define pbr_inline\nvoid albedoOpacityBlock(\nin vec4 vAlbedoColor,\n#ifdef ALBEDO\nin vec4 albedoTexture,\nin vec2 albedoInfos,\n#endif\n#ifdef OPACITY\nin vec4 opacityMap,\nin vec2 vOpacityInfos,\n#endif\n#ifdef DETAIL\nin vec4 detailColor,\nin vec4 vDetailInfos,\n#endif\nout albedoOpacityOutParams outParams\n)\n{\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#ifdef DETAIL\nfloat detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);\nsurfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;\noutParams.alpha=alpha;\n}\n";M.e.IncludesShadersStore.pbrBlockAlbedoOpacity=m;var E="struct reflectivityOutParams\n{\nfloat microSurface;\nfloat roughness;\nvec3 surfaceReflectivityColor;\n#ifdef METALLICWORKFLOW\nvec3 surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nvec3 ambientOcclusionColor;\n#endif\n#if DEBUGMODE>0\nvec4 surfaceMetallicColorMap;\nvec4 surfaceReflectivityColorMap;\nvec2 metallicRoughness;\nvec3 metallicF0;\n#endif\n};\n#define pbr_inline\nvoid reflectivityBlock(\nin vec4 vReflectivityColor,\n#ifdef METALLICWORKFLOW\nin vec3 surfaceAlbedo,\nin vec4 metallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nin vec3 reflectivityInfos,\nin vec4 surfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nin vec3 ambientOcclusionColorIn,\n#endif\n#ifdef MICROSURFACEMAP\nin vec4 microSurfaceTexel,\n#endif\n#ifdef DETAIL\nin vec4 detailColor,\nin vec4 vDetailInfos,\n#endif\nout reflectivityOutParams outParams\n)\n{\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);\noutParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nfloat detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);\nfloat loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);\nfloat hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);\nmetallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;\nvec3 baseColor=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);\nsurfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);\nsurfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;\nmicroSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);\nfloat roughness=1.-microSurface;\noutParams.microSurface=microSurface;\noutParams.roughness=roughness;\noutParams.surfaceReflectivityColor=surfaceReflectivityColor;\n}\n";M.e.IncludesShadersStore.pbrBlockReflectivity=E;var K="struct ambientOcclusionOutParams\n{\nvec3 ambientOcclusionColor;\n#if DEBUGMODE>0\nvec3 ambientOcclusionColorMap;\n#endif\n};\n#define pbr_inline\nvoid ambientOcclusionBlock(\n#ifdef AMBIENT\nin vec3 ambientOcclusionColorMap_,\nin vec4 vAmbientInfos,\n#endif\nout ambientOcclusionOutParams outParams\n)\n{\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;\n}\n";M.e.IncludesShadersStore.pbrBlockAmbientOcclusion=K;var G="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{\nfloat alpha;\n};\n#define pbr_inline\nvoid alphaFresnelBlock(\nin vec3 normalW,\nin vec3 viewDirectionW,\nin float alpha,\nin float microSurface,\nout alphaFresnelOutParams outParams\n)\n{\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\noutParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\n}\n#endif\n#endif\n";M.e.IncludesShadersStore.pbrBlockAlphaFresnel=G;var u="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{\nfloat anisotropy;\nvec3 anisotropicTangent;\nvec3 anisotropicBitangent;\nvec3 anisotropicNormal;\n#if DEBUGMODE>0\nvec3 anisotropyMapData;\n#endif\n};\n#define pbr_inline\nvoid anisotropicBlock(\nin vec3 vAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nin vec3 anisotropyMapData,\n#endif\nin mat3 TBN,\nin vec3 normalW,\nin vec3 viewDirectionW,\nout anisotropicOutParams outParams\n)\n{\nfloat anisotropy=vAnisotropy.b;\nvec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nanisotropy*=anisotropyMapData.b;\nanisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));\nvec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);\nvec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));\noutParams.anisotropy=anisotropy;\noutParams.anisotropicTangent=anisotropicTangent;\noutParams.anisotropicBitangent=anisotropicBitangent;\noutParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);\n}\n#endif\n";M.e.IncludesShadersStore.pbrBlockAnisotropic=u;var J="#ifdef REFLECTION\nstruct reflectionOutParams\n{\nvec4 environmentRadiance;\nvec3 environmentIrradiance;\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords;\n#else\nvec2 reflectionCoords;\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nvec3 irradianceVector;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nvoid createReflectionCoords(\nin vec3 vPositionW,\nin vec3 normalW,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REFLECTIONMAP_3D\nout vec3 reflectionCoords\n#else\nout vec2 reflectionCoords\n#endif\n)\n{\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n}\n#define pbr_inline\n#define inline\nvoid sampleReflectionTexture(\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nconst vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nconst vec2 reflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout vec4 environmentRadiance\n)\n{\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);\nif (lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nenvironmentRadiance=mix(\nenvironmentMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\n}\n#define pbr_inline\n#define inline\nvoid reflectionBlock(\nin vec3 vPositionW,\nin vec3 normalW,\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\n#else\nin sampler2D reflectionSampler,\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nin vec3 vEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nin mat4 reflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nin samplerCube irradianceSampler,\n#else\nin sampler2D irradianceSampler,\n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout reflectionOutParams outParams\n)\n{\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=vec3(0.);\n#else\nvec2 reflectionCoords=vec2(0.);\n#endif\ncreateReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\nreflectionCoords\n);\nsampleReflectionTexture(\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionSampler,\nreflectionCoords,\n#else\nreflectionSampler,\nreflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentRadiance\n);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);\nenvironmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;\noutParams.environmentRadiance=environmentRadiance;\noutParams.environmentIrradiance=environmentIrradiance;\noutParams.reflectionCoords=reflectionCoords;\n}\n#endif\n";M.e.IncludesShadersStore.pbrBlockReflection=J;var A="#ifdef SHEEN\nstruct sheenOutParams\n{\nfloat sheenIntensity;\nvec3 sheenColor;\nfloat sheenRoughness;\n#ifdef SHEEN_LINKWITHALBEDO\nvec3 surfaceAlbedo;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfloat sheenAlbedoScaling;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 finalSheenRadianceScaled;\n#endif\n#if DEBUGMODE>0\nvec4 sheenMapData;\nvec3 sheenEnvironmentReflectance;\n#endif\n};\n#define pbr_inline\n#define inline\nvoid sheenBlock(\nin vec4 vSheenColor,\n#ifdef SHEEN_ROUGHNESS\nin float vSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nin vec4 sheenMapRoughnessData,\n#endif\n#endif\nin float roughness,\n#ifdef SHEEN_TEXTURE\nin vec4 sheenMapData,\nin float sheenMapLevel,\n#endif\nin float reflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nin vec3 baseColor,\nin vec3 surfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nin float NdotV,\nin vec3 environmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nin vec2 AARoughnessFactors,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\nin vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nin vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nin vec2 reflectionCoords,\n#endif\nin float NdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nin float seo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nin float eho,\n#endif\n#endif\nout sheenOutParams outParams\n)\n{\nfloat sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);\nvec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);\nfloat sheenRoughness=sheenIntensity;\noutParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#else\nsheenColor.rgb*=sheenMapData.rgb;\n#endif\nsheenColor.rgb*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nfloat sheenRoughness=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\n#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL\nsheenRoughness*=sheenMapData.a;\n#else\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#endif\n#else\nfloat sheenRoughness=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvec3 environmentSheenBrdf=vec3(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvec3 environmentSheenBrdf=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);\nsampleReflectionTexture(\nsheenAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nsheenRoughness,\n#endif\nreflectionSampler,\nreflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentSheenRadiance\n);\nvec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;\noutParams.sheenColor=sheenColor;\noutParams.sheenRoughness=sheenRoughness;\n}\n#endif\n";M.e.IncludesShadersStore.pbrBlockSheen=A;var v="struct clearcoatOutParams\n{\nvec3 specularEnvironmentR0;\nfloat conservationFactor;\nvec3 clearCoatNormalW;\nvec2 clearCoatAARoughnessFactors;\nfloat clearCoatIntensity;\nfloat clearCoatRoughness;\n#ifdef REFLECTION\nvec3 finalClearCoatRadianceScaled;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 absorption;\nfloat clearCoatNdotVRefract;\nvec3 clearCoatColor;\nfloat clearCoatThickness;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nvec3 energyConservationFactorClearCoat;\n#endif\n#if DEBUGMODE>0\nmat3 TBNClearCoat;\nvec2 clearCoatMapData;\nvec4 clearCoatTintMapData;\nvec4 environmentClearCoatRadiance;\nfloat clearCoatNdotV;\nvec3 clearCoatEnvironmentReflectance;\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\n#define inline\nvoid clearcoatBlock(\nin vec3 vPositionW,\nin vec3 geometricNormalW,\nin vec3 viewDirectionW,\nin vec2 vClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nin vec4 clearCoatMapRoughnessData,\n#endif\nin vec3 specularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nin vec2 clearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nin vec4 vClearCoatTintParams,\nin float clearCoatColorAtDistance,\nin vec4 vClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nin vec4 clearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nin vec2 vClearCoatBumpInfos,\nin vec4 clearCoatBumpMapData,\nin vec2 vClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nin mat3 vTBN,\n#else\nin vec2 vClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nin mat4 normalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nin vec3 faceNormal,\n#endif\n#ifdef REFLECTION\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\nin vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\n#else\nin sampler2D reflectionSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nin float ambientMonochrome,\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\nin float frontFacingMultiplier,\n#endif\nout clearcoatOutParams outParams\n)\n{\nfloat clearCoatIntensity=vClearCoatParams.x;\nfloat clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL\nclearCoatRoughness*=clearCoatMapData.y;\n#else\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;\noutParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;\nfloat clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);\noutParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvec3 specularEnvironmentR0Updated=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);\nvec3 clearCoatNormalW=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nvec2 TBNClearCoatUV=vClearCoatBumpUV*frontFacingMultiplier;\nmat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);\nclearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;\noutParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);\nfloat clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);\nfloat clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatVRefract=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);\noutParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);\nvec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nsampleReflectionTexture(\nclearCoatAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nclearCoatNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nclearCoatRoughness,\n#endif\nreflectionSampler,\nclearCoatReflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentClearCoatRadiance\n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef RADIANCEOCCLUSION\nfloat clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);\nclearCoatEnvironmentReflectance*=clearCoatSeo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);\nclearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnelIBLClearCoat*=clearCoatIntensity;\noutParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\n}\n#endif\n";M.e.IncludesShadersStore.pbrBlockClearcoat=v;var Q="struct iridescenceOutParams\n{\nfloat iridescenceIntensity;\nfloat iridescenceIOR;\nfloat iridescenceThickness;\nvec3 specularEnvironmentR0;\n};\n#ifdef IRIDESCENCE\n#define pbr_inline\n#define inline\nvoid iridescenceBlock(\nin vec4 vIridescenceParams,\nin float viewAngle,\nin vec3 specularEnvironmentR0,\n#ifdef IRIDESCENCE_TEXTURE\nin vec2 iridescenceMapData,\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nin vec2 iridescenceThicknessMapData,\n#endif\n#ifdef CLEARCOAT\nin float NdotVUnclamped,\n#ifdef CLEARCOAT_TEXTURE\nin vec2 clearCoatMapData,\n#endif\n#endif\nout iridescenceOutParams outParams\n)\n{\nfloat iridescenceIntensity=vIridescenceParams.x;\nfloat iridescenceIOR=vIridescenceParams.y;\nfloat iridescenceThicknessMin=vIridescenceParams.z;\nfloat iridescenceThicknessMax=vIridescenceParams.w;\nfloat iridescenceThicknessWeight=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#ifdef IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE\niridescenceThicknessWeight=iridescenceMapData.g;\n#endif\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nfloat iridescenceThickness=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);\nfloat topIor=1.; \n#ifdef CLEARCOAT\nfloat clearCoatIntensity=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,vClearCoatRefractionParams.w-1.,clearCoatIntensity);\nviewAngle=sqrt(1.0+square(1.0/topIor)*(square(NdotVUnclamped)-1.0));\n#endif\nvec3 iridescenceFresnel=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);\noutParams.iridescenceIntensity=iridescenceIntensity;\noutParams.iridescenceThickness=iridescenceThickness;\noutParams.iridescenceIOR=iridescenceIOR;\n}\n#endif\n";M.e.IncludesShadersStore.pbrBlockIridescence=Q;var O="struct subSurfaceOutParams\n{\nvec3 specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvec3 finalRefraction;\nvec3 surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nfloat alpha;\n#endif\n#ifdef REFLECTION\nfloat refractionFactorForIrradiance;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvec3 transmittance;\nfloat translucencyIntensity;\n#ifdef REFLECTION\nvec3 refractionIrradiance;\n#endif\n#endif\n#if DEBUGMODE>0\nvec4 thicknessMap;\nvec4 environmentRefraction;\nvec3 refractionTransmittance;\n#endif\n};\n#ifdef SUBSURFACE\n#define pbr_inline\n#define inline\nvoid subSurfaceBlock(\nin vec3 vSubSurfaceIntensity,\nin vec2 vThicknessParam,\nin vec4 vTintColor,\nin vec3 normalW,\nin vec3 specularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nin vec4 thicknessMap,\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nin vec4 refractionIntensityMap,\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nin vec4 translucencyIntensityMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nin mat4 reflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nin vec3 irradianceVector_,\n#endif\n#if defined(REALTIME_FILTERING)\nin samplerCube reflectionSampler,\nin vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nin samplerCube irradianceSampler,\n#else\nin sampler2D irradianceSampler,\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\nin vec3 surfaceAlbedo,\n#endif\n#ifdef SS_REFRACTION\nin vec3 vPositionW,\nin vec3 viewDirectionW,\nin mat4 view,\nin vec4 vRefractionInfos,\nin mat4 refractionMatrix,\nin vec4 vRefractionMicrosurfaceInfos,\nin vec4 vLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nin float alpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nin float NdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nin float roughness,\n#endif\nin float alphaG,\n#ifdef SS_REFRACTIONMAP_3D\nin samplerCube refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nin samplerCube refractionSamplerLow,\nin samplerCube refractionSamplerHigh,\n#endif\n#else\nin sampler2D refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nin sampler2D refractionSamplerLow,\nin sampler2D refractionSamplerHigh,\n#endif\n#endif\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vRefractionFilteringInfo,\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nin vec3 refractionPosition,\nin vec3 refractionSize,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nin vec3 vDiffusionDistance,\n#endif\nout subSurfaceOutParams outParams\n)\n{\noutParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);\noutParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#if defined(SS_USE_GLTF_TEXTURES)\nfloat thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#ifdef SS_MASK_FROM_THICKNESS_TEXTURE\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE)\n#if defined(SS_USE_GLTF_TEXTURES)\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE)\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);\nvec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);\ntransmittance*=translucencyIntensity;\noutParams.transmittance=transmittance;\noutParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,vRefractionInfos.y);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*thickness,1.0)));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\n#endif\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef SS_HAS_THICKNESS\nfloat ior=vRefractionInfos.y;\n#else\nfloat ior=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionAlphaG=alphaG;\nrefractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionRoughness=alphaG;\nrefractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nfloat refractionAlphaG=alphaG;\nrefractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif (lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n} else {\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);\nvec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);\nenvironmentRefraction.rgb*=volumeAlbedo;\n#else\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\noutParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvec3 irradianceVector=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvec3 irradianceCoords=irradianceVector;\n#else\nvec2 irradianceCoords=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec4 refractionIrradiance=vec4(0.);\n#endif\nrefractionIrradiance.rgb*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance.rgb;\n#endif\n}\n#endif\n";M.e.IncludesShadersStore.pbrBlockSubSurface=O;L(69991),L(84098);var Y="vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\nvec3 geometricNormalW=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;\n#endif\n";M.e.IncludesShadersStore.pbrBlockNormalGeometric=Y;L(78767);var WW="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n";M.e.IncludesShadersStore.pbrBlockNormalFinal=WW;L(75060);var iW="#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n";M.e.IncludesShadersStore.pbrBlockLightmapInit=iW;var LW="float NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=absEps(NdotVUnclamped);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=aoOut.ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n";M.e.IncludesShadersStore.pbrBlockGeometryInfo=LW;var hW="float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);\nvec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);\n#else \nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nspecularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n";M.e.IncludesShadersStore.pbrBlockReflectance0=hW;var lW="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n";M.e.IncludesShadersStore.pbrBlockReflectance=lW;var tW="vec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\npreLightingInfo preInfo;\nlightingInfo info;\nfloat shadow=1.; \n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvec3 absorption=vec3(0.);\n#endif\n";M.e.IncludesShadersStore.pbrBlockDirectLighting=tW;L(57932);var pW="#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvec3 finalIrradiance=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);\nfinalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;\nfinalIrradiance*=vLightingIntensity.z;\nfinalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvec3 finalRadiance=reflectionOut.environmentRadiance.rgb;\nfinalRadiance*=subSurfaceOut.specularEnvironmentReflectance;\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenOut.sheenColor;\nfinalSheen=max(finalSheen,0.0);\nvec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;\nfinalClearCoat=max(finalClearCoat,0.0);\nvec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n";M.e.IncludesShadersStore.pbrBlockFinalLitComponents=pW;var xW="vec3 finalDiffuse=diffuseBase;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\nfinalDiffuse*=vLightingIntensity.x;\nvec3 finalAmbient=vAmbientColor;\nfinalAmbient*=surfaceAlbedo.rgb;\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= vEmissiveInfos.y;\n#endif\nfinalEmissive*=vLightingIntensity.y;\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;\nfinalDiffuse*=ambientOcclusionForDirectDiffuse;\n";M.e.IncludesShadersStore.pbrBlockFinalUnlitComponents=xW;var RW="vec4 finalColor=vec4(\nfinalAmbient +\nfinalDiffuse +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalEmissive,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,0.0);\n";M.e.IncludesShadersStore.pbrBlockFinalColorComposition=RW;L(84981),L(80345);var zW="#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\nfinalColor.rgb*=finalColor.a;\n#endif\n";M.e.IncludesShadersStore.pbrBlockImageProcessing=zW;var rW="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {\n#if DEBUGMODE==1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#elif DEBUGMODE==21 && defined(AMBIENT)\ngl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ngl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE==64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE==65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE==87\ngl_FragColor.rgb=vec3(alpha);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#ifdef PREPASS\ngl_FragData[0]=toLinearSpace(gl_FragColor); \ngl_FragData[1]=vec4(0.,0.,0.,0.); \n#endif\nreturn;\n}\n#endif\n";M.e.IncludesShadersStore.pbrDebug=rW;var NW="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\nprecision highp float;\n#include<oitDeclaration>\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockIridescence>\n#include<pbrBlockSubSurface>\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<oitFragment>\n#include<clipPlaneFragment>\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\nalbedoOpacityOutParams albedoOpacityOut;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#endif\nalbedoOpacityBlock(\nvAlbedoColor,\n#ifdef ALBEDO\nalbedoTexture,\nvAlbedoInfos,\n#endif\n#ifdef OPACITY\nopacityMap,\nvOpacityInfos,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nalbedoOpacityOut\n);\nvec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;\nfloat alpha=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\nambientOcclusionOutParams aoOut;\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;\n#endif\nambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nvAmbientInfos,\n#endif\naoOut\n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\nvec3 baseColor=surfaceAlbedo;\nreflectivityOutParams reflectivityOut;\n#if defined(REFLECTIVITY)\nvec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nvec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\n#ifdef REFLECTIVITY_GAMMA\nsurfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);\n#endif\nsurfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvec4 metallicReflectanceFactors=vMetallicReflectanceFactors;\n#ifdef REFLECTANCE\nvec4 reflectanceFactorsMap=texture2D(reflectanceSampler,vReflectanceUV+uvOffset);\n#ifdef REFLECTANCE_GAMMA\nreflectanceFactorsMap=toLinearSpace(reflectanceFactorsMap);\n#endif\nmetallicReflectanceFactors.rgb*=reflectanceFactorsMap.rgb;\n#endif\n#ifdef METALLIC_REFLECTANCE\nvec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);\n#ifdef METALLIC_REFLECTANCE_GAMMA\nmetallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);\n#endif\n#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY\nmetallicReflectanceFactors.rgb*=metallicReflectanceFactorsMap.rgb;\n#endif\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap.a;\n#endif\n#endif\nreflectivityBlock(\nvReflectivityColor,\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo,\nmetallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nvReflectivityInfos,\nsurfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor,\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurfaceTexel,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nreflectivityOut\n);\nfloat microSurface=reflectivityOut.microSurface;\nfloat roughness=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nalphaFresnelOutParams alphaFresnelOut;\nalphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface,\nalphaFresnelOut\n);\nalpha=alphaFresnelOut.alpha;\n#endif\n#endif\n#include<pbrBlockGeometryInfo>\n#ifdef ANISOTROPIC\nanisotropicOutParams anisotropicOut;\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\n#endif\nanisotropicBlock(\nvAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW,\nanisotropicOut\n);\n#endif\n#ifdef REFLECTION\nreflectionOutParams reflectionOut;\n#ifndef USE_CUSTOM_REFLECTION\nreflectionBlock(\nvPositionW,\nnormalW,\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\nreflectionSampler,\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nvEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nreflectionOut\n);\n#else\n#define CUSTOM_REFLECTION\n#endif\n#endif\n#include<pbrBlockReflectance0>\n#ifdef SHEEN\nsheenOutParams sheenOut;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset);\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;\n#endif\nsheenBlock(\nvSheenColor,\n#ifdef SHEEN_ROUGHNESS\nvSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nsheenMapRoughnessData,\n#endif\n#endif\nroughness,\n#ifdef SHEEN_TEXTURE\nsheenMapData,\nvSheenInfos.y,\n#endif\nreflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nbaseColor,\nsurfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nNdotV,\nenvironmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nAARoughnessFactors,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\nreflectionOut.reflectionCoords,\nNdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nseo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\neho,\n#endif\n#endif\nsheenOut\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\n#endif\n#endif\n#ifdef IRIDESCENCE\niridescenceOutParams iridescenceOut;\n#ifdef IRIDESCENCE_TEXTURE\nvec2 iridescenceMapData=texture2D(iridescenceSampler,vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nvec2 iridescenceThicknessMapData=texture2D(iridescenceThicknessSampler,vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;\n#endif\niridescenceBlock(\nvIridescenceParams,\nNdotV,\nspecularEnvironmentR0,\n#ifdef IRIDESCENCE_TEXTURE\niridescenceMapData,\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\niridescenceThicknessMapData,\n#endif\n#ifdef CLEARCOAT\nNdotVUnclamped,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#endif\niridescenceOut\n);\nfloat iridescenceIntensity=iridescenceOut.iridescenceIntensity;\nspecularEnvironmentR0=iridescenceOut.specularEnvironmentR0;\n#endif\nclearcoatOutParams clearcoatOut;\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\n#endif\n#ifdef CLEARCOAT_BUMP\nvec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatBlock(\nvPositionW,\ngeometricNormalW,\nviewDirectionW,\nvClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatMapRoughnessData,\n#endif\nspecularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nvClearCoatTintParams,\nclearCoatColorAtDistance,\nvClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nclearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nvClearCoatBumpInfos,\nclearCoatBumpMapData,\nvClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nvTBN,\n#else\nvClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nnormalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nfaceNormal,\n#endif\n#ifdef REFLECTION\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nambientMonochrome,\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n(gl_FrontFacing ? 1. : -1.),\n#endif\nclearcoatOut\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n#include<pbrBlockReflectance>\nsubSurfaceOutParams subSurfaceOut;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nvec4 refractionIntensityMap=texture2D(refractionIntensitySampler,vRefractionIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nvec4 translucencyIntensityMap=texture2D(translucencyIntensitySampler,vTranslucencyIntensityUV+uvOffset);\n#endif\nsubSurfaceBlock(\nvSubSurfaceIntensity,\nvThicknessParam,\nvTintColor,\nnormalW,\nspecularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nthicknessMap,\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nrefractionIntensityMap,\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\ntranslucencyIntensityMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nreflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionOut.irradianceVector,\n#endif\n#if defined(REALTIME_FILTERING)\nreflectionSampler,\nvReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\nsurfaceAlbedo,\n#endif\n#ifdef SS_REFRACTION\nvPositionW,\nviewDirectionW,\nview,\nvRefractionInfos,\nrefractionMatrix,\nvRefractionMicrosurfaceInfos,\nvLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nNdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nroughness,\n#endif\nalphaG,\nrefractionSampler,\n#ifndef LODBASEDMICROSFURACE\nrefractionSamplerLow,\nrefractionSamplerHigh,\n#endif\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nvRefractionFilteringInfo,\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nvRefractionPosition,\nvRefractionSize,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvDiffusionDistance,\n#endif\nsubSurfaceOut\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n#include<pbrBlockFinalLitComponents>\n#endif \n#include<pbrBlockFinalUnlitComponents>\n#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=finalColor.a>0.4 ? 1.0 : 0.0;\n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nvec3 sqAlbedo=sqrt(surfaceAlbedo); \n#endif\n#ifdef PREPASS_IRRADIANCE\nvec3 irradiance=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\n#ifdef SS_SCATTERING\ngl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a); \nirradiance/=sqAlbedo;\n#else\ngl_FragData[0]=finalColor; \nfloat scatteringDiffusionProfile=255.;\n#endif\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(clamp(irradiance,vec3(0.),vec3(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); \n#else\ngl_FragData[0]=vec4(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4((view*vec4(normalW,0.0)).rgb,writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(sqAlbedo,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toGammaSpace(specularEnvironmentR0),microSurface)*writeGeometryInfo;\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=finalColor;\n#endif\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=finalColor.rgb*finalColor.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-finalColor.a);\n} else {\nbackColor+=finalColor;\n}\n#endif\n#include<pbrDebug>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";M.e.ShadersStore.pbrPixelShader=NW;var IW="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef METALLIC_REFLECTANCE\nuniform vec2 vMetallicReflectanceInfos;\nuniform mat4 metallicReflectanceMatrix;\n#endif\n#ifdef REFLECTANCE\nuniform vec2 vReflectanceInfos;\nuniform mat4 reflectanceMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#ifdef IRIDESCENCE\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;\nuniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;\nuniform mat4 translucencyIntensityMatrix;\n#endif\n#endif\n#ifdef NORMAL\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n#endif\n#endif\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";M.e.IncludesShadersStore.pbrVertexDeclaration=IW;L(94040),L(31377),L(54001),L(16554),L(63201),L(138),L(20142),L(49329),L(23654),L(65359),L(58003),L(36062),L(83700),L(63886),L(48767),L(50511),L(97202),L(48623),L(32875),L(3970),L(58878),L(70179),L(61906),L(32560),L(70323),L(35738),L(30242);var sW="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)\n#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#ifdef CLEARCOAT\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)\n#endif\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#ifdef CLEARCOAT\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)\n#endif\n#ifdef SHEEN\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.z)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";M.e.ShadersStore.pbrVertexShader=sW;var oW=L(54497),DW=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.CLEARCOAT=!1,i.CLEARCOAT_DEFAULTIOR=!1,i.CLEARCOAT_TEXTURE=!1,i.CLEARCOAT_TEXTURE_ROUGHNESS=!1,i.CLEARCOAT_TEXTUREDIRECTUV=0,i.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,i.CLEARCOAT_BUMP=!1,i.CLEARCOAT_BUMPDIRECTUV=0,i.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,i.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,i.CLEARCOAT_REMAP_F0=!1,i.CLEARCOAT_TINT=!1,i.CLEARCOAT_TINT_TEXTURE=!1,i.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,i.CLEARCOAT_TINT_GAMMATEXTURE=!1,i}return(0,h.n)(i,W),i}(N.b),SW=function(W){function i(L,h){void 0===h&&(h=!0);var l=W.call(this,L,"PBRClearCoat",100,new DW,h)||this;return l._isEnabled=!1,l.isEnabled=!1,l.intensity=1,l.roughness=0,l._indexOfRefraction=i._DefaultIndexOfRefraction,l.indexOfRefraction=i._DefaultIndexOfRefraction,l._texture=null,l.texture=null,l._useRoughnessFromMainTexture=!0,l.useRoughnessFromMainTexture=!0,l._textureRoughness=null,l.textureRoughness=null,l._remapF0OnInterfaceChange=!0,l.remapF0OnInterfaceChange=!0,l._bumpTexture=null,l.bumpTexture=null,l._isTintEnabled=!1,l.isTintEnabled=!1,l.tintColor=S.d.White(),l.tintColorAtDistance=1,l.tintThickness=1,l._tintTexture=null,l.tintTexture=null,l._internalMarkAllSubMeshesAsTexturesDirty=L._dirtyCallbacks[1],l}return(0,h.n)(i,W),i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(W,i,L){if(!this._isEnabled)return!0;var h=this._material._disableBumpMap;if(W._areTexturesDirty&&i.texturesEnabled){if(this._texture&&y.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&y.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(L.getCaps().standardDerivatives&&this._bumpTexture&&y.d.ClearCoatBumpTextureEnabled&&!h&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&y.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},i.prototype.prepareDefines=function(W,L){var h;this._isEnabled?(W.CLEARCOAT=!0,W.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,W.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(h=this._textureRoughness)||void 0===h?void 0:h._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),W.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,W._areTexturesDirty&&L.texturesEnabled&&(this._texture&&y.d.ClearCoatTextureEnabled?a.e.PrepareDefinesForMergedUV(this._texture,W,"CLEARCOAT_TEXTURE"):W.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&y.d.ClearCoatTextureEnabled?a.e.PrepareDefinesForMergedUV(this._textureRoughness,W,"CLEARCOAT_TEXTURE_ROUGHNESS"):W.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&y.d.ClearCoatBumpTextureEnabled?a.e.PrepareDefinesForMergedUV(this._bumpTexture,W,"CLEARCOAT_BUMP"):W.CLEARCOAT_BUMP=!1,W.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===i._DefaultIndexOfRefraction,this._isTintEnabled?(W.CLEARCOAT_TINT=!0,this._tintTexture&&y.d.ClearCoatTintTextureEnabled?(a.e.PrepareDefinesForMergedUV(this._tintTexture,W,"CLEARCOAT_TINT_TEXTURE"),W.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):W.CLEARCOAT_TINT_TEXTURE=!1):(W.CLEARCOAT_TINT=!1,W.CLEARCOAT_TINT_TEXTURE=!1))):(W.CLEARCOAT=!1,W.CLEARCOAT_TEXTURE=!1,W.CLEARCOAT_TEXTURE_ROUGHNESS=!1,W.CLEARCOAT_BUMP=!1,W.CLEARCOAT_TINT=!1,W.CLEARCOAT_TINT_TEXTURE=!1,W.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,W.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1)},i.prototype.bindForSubMesh=function(W,i,L,h){var l,t,p,x,R,z,r,N;if(this._isEnabled){var I=h.materialDefines,s=this._material.isFrozen,o=this._material._disableBumpMap,D=this._material._invertNormalMapX,S=this._material._invertNormalMapY,C=I.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!W.useUbo||!s||!W.isSync){C&&y.d.ClearCoatTextureEnabled?(W.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),a.e.BindTextureMatrix(this._texture,W,"clearCoat")):(this._texture||this._textureRoughness)&&y.d.ClearCoatTextureEnabled&&(W.updateFloat4("vClearCoatInfos",null!==(t=null===(l=this._texture)||void 0===l?void 0:l.coordinatesIndex)&&void 0!==t?t:0,null!==(x=null===(p=this._texture)||void 0===p?void 0:p.level)&&void 0!==x?x:0,null!==(z=null===(R=this._textureRoughness)||void 0===R?void 0:R.coordinatesIndex)&&void 0!==z?z:0,null!==(N=null===(r=this._textureRoughness)||void 0===r?void 0:r.level)&&void 0!==N?N:0),this._texture&&a.e.BindTextureMatrix(this._texture,W,"clearCoat"),!this._textureRoughness||C||I.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE||a.e.BindTextureMatrix(this._textureRoughness,W,"clearCoatRoughness")),this._bumpTexture&&L.getCaps().standardDerivatives&&y.d.ClearCoatTextureEnabled&&!o&&(W.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),a.e.BindTextureMatrix(this._bumpTexture,W,"clearCoatBump"),i._mirroredCameraPosition?W.updateFloat2("vClearCoatTangentSpaceParams",D?1:-1,S?1:-1):W.updateFloat2("vClearCoatTangentSpaceParams",D?-1:1,S?-1:1)),this._tintTexture&&y.d.ClearCoatTintTextureEnabled&&(W.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),a.e.BindTextureMatrix(this._tintTexture,W,"clearCoatTint")),W.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var e=1-this._indexOfRefraction,V=1+this._indexOfRefraction,c=Math.pow(-e/V,2),f=1/this._indexOfRefraction;W.updateFloat4("vClearCoatRefractionParams",c,f,e,V),this._isTintEnabled&&(W.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),W.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}i.texturesEnabled&&(this._texture&&y.d.ClearCoatTextureEnabled&&W.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!C&&!I.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&y.d.ClearCoatTextureEnabled&&W.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&L.getCaps().standardDerivatives&&y.d.ClearCoatBumpTextureEnabled&&!o&&W.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&y.d.ClearCoatTintTextureEnabled&&W.setTexture("clearCoatTintSampler",this._tintTexture))}},i.prototype.hasTexture=function(W){return this._texture===W||(this._textureRoughness===W||(this._bumpTexture===W||this._tintTexture===W))},i.prototype.getActiveTextures=function(W){this._texture&&W.push(this._texture),this._textureRoughness&&W.push(this._textureRoughness),this._bumpTexture&&W.push(this._bumpTexture),this._tintTexture&&W.push(this._tintTexture)},i.prototype.getAnimatables=function(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&W.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&W.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&W.push(this._tintTexture)},i.prototype.dispose=function(W){var i,L,h,l;W&&(null===(i=this._texture)||void 0===i||i.dispose(),null===(L=this._textureRoughness)||void 0===L||L.dispose(),null===(h=this._bumpTexture)||void 0===h||h.dispose(),null===(l=this._tintTexture)||void 0===l||l.dispose())},i.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},i.prototype.addFallbacks=function(W,i,L){return W.CLEARCOAT_BUMP&&i.addFallback(L++,"CLEARCOAT_BUMP"),W.CLEARCOAT_TINT&&i.addFallback(L++,"CLEARCOAT_TINT"),W.CLEARCOAT&&i.addFallback(L++,"CLEARCOAT"),L},i.prototype.getSamplers=function(W){W.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")},i.prototype.getUniforms=function(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}},i._DefaultIndexOfRefraction=1.5,(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,h.j)([(0,l.H)()],i.prototype,"intensity",void 0),(0,h.j)([(0,l.H)()],i.prototype,"roughness",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"remapF0OnInterfaceChange",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTintEnabled",void 0),(0,h.j)([(0,l.q)()],i.prototype,"tintColor",void 0),(0,h.j)([(0,l.H)()],i.prototype,"tintColorAtDistance",void 0),(0,h.j)([(0,l.H)()],i.prototype,"tintThickness",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"tintTexture",void 0),i}(I.e),CW=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.IRIDESCENCE=!1,i.IRIDESCENCE_TEXTURE=!1,i.IRIDESCENCE_TEXTUREDIRECTUV=0,i.IRIDESCENCE_THICKNESS_TEXTURE=!1,i.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0,i.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1,i}return(0,h.n)(i,W),i}(N.b),eW=function(W){function i(L,h){void 0===h&&(h=!0);var l=W.call(this,L,"PBRIridescence",110,new CW,h)||this;return l._isEnabled=!1,l.isEnabled=!1,l.intensity=1,l.minimumThickness=i._DefaultMinimumThickness,l.maximumThickness=i._DefaultMaximumThickness,l.indexOfRefraction=i._DefaultIndexOfRefraction,l._texture=null,l.texture=null,l._thicknessTexture=null,l.thicknessTexture=null,l._internalMarkAllSubMeshesAsTexturesDirty=L._dirtyCallbacks[1],l}return(0,h.n)(i,W),i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(W,i){if(!this._isEnabled)return!0;if(W._areTexturesDirty&&i.texturesEnabled){if(this._texture&&y.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&y.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0},i.prototype.prepareDefines=function(W,i){var L;this._isEnabled?(W.IRIDESCENCE=!0,W.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=null!==this._texture&&this._texture._texture===(null===(L=this._thicknessTexture)||void 0===L?void 0:L._texture)&&this._texture.checkTransformsAreIdentical(this._thicknessTexture),W._areTexturesDirty&&i.texturesEnabled&&(this._texture&&y.d.IridescenceTextureEnabled?a.e.PrepareDefinesForMergedUV(this._texture,W,"IRIDESCENCE_TEXTURE"):W.IRIDESCENCE_TEXTURE=!1,!W.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&this._thicknessTexture&&y.d.IridescenceTextureEnabled?a.e.PrepareDefinesForMergedUV(this._thicknessTexture,W,"IRIDESCENCE_THICKNESS_TEXTURE"):W.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(W.IRIDESCENCE=!1,W.IRIDESCENCE_TEXTURE=!1,W.IRIDESCENCE_THICKNESS_TEXTURE=!1,W.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1)},i.prototype.bindForSubMesh=function(W,i,L,h){var l,t,p,x,R,z,r,N;if(this._isEnabled){var I=h.materialDefines,s=this._material.isFrozen,o=I.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE;W.useUbo&&s&&W.isSync||(o&&y.d.IridescenceTextureEnabled?(W.updateFloat4("vIridescenceInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),a.e.BindTextureMatrix(this._texture,W,"iridescence")):(this._texture||this._thicknessTexture)&&y.d.IridescenceTextureEnabled&&(W.updateFloat4("vIridescenceInfos",null!==(t=null===(l=this._texture)||void 0===l?void 0:l.coordinatesIndex)&&void 0!==t?t:0,null!==(x=null===(p=this._texture)||void 0===p?void 0:p.level)&&void 0!==x?x:0,null!==(z=null===(R=this._thicknessTexture)||void 0===R?void 0:R.coordinatesIndex)&&void 0!==z?z:0,null!==(N=null===(r=this._thicknessTexture)||void 0===r?void 0:r.level)&&void 0!==N?N:0),this._texture&&a.e.BindTextureMatrix(this._texture,W,"iridescence"),!this._thicknessTexture||o||I.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE||a.e.BindTextureMatrix(this._thicknessTexture,W,"iridescenceThickness")),W.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),i.texturesEnabled&&(this._texture&&y.d.IridescenceTextureEnabled&&W.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&!o&&!I.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&y.d.IridescenceTextureEnabled&&W.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}},i.prototype.hasTexture=function(W){return this._texture===W||this._thicknessTexture===W},i.prototype.getActiveTextures=function(W){this._texture&&W.push(this._texture),this._thicknessTexture&&W.push(this._thicknessTexture)},i.prototype.getAnimatables=function(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&W.push(this._thicknessTexture)},i.prototype.dispose=function(W){var i,L;W&&(null===(i=this._texture)||void 0===i||i.dispose(),null===(L=this._thicknessTexture)||void 0===L||L.dispose())},i.prototype.getClassName=function(){return"PBRIridescenceConfiguration"},i.prototype.addFallbacks=function(W,i,L){return W.IRIDESCENCE&&i.addFallback(L++,"IRIDESCENCE"),L},i.prototype.getSamplers=function(W){W.push("iridescenceSampler","iridescenceThicknessSampler")},i.prototype.getUniforms=function(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}},i._DefaultMinimumThickness=100,i._DefaultMaximumThickness=400,i._DefaultIndexOfRefraction=1.3,(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,h.j)([(0,l.H)()],i.prototype,"intensity",void 0),(0,h.j)([(0,l.H)()],i.prototype,"minimumThickness",void 0),(0,h.j)([(0,l.H)()],i.prototype,"maximumThickness",void 0),(0,h.j)([(0,l.H)()],i.prototype,"indexOfRefraction",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"thicknessTexture",void 0),i}(I.e),VW=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.ANISOTROPIC=!1,i.ANISOTROPIC_TEXTURE=!1,i.ANISOTROPIC_TEXTUREDIRECTUV=0,i.MAINUV1=!1,i}return(0,h.n)(i,W),i}(N.b),cW=function(W){function i(i,L){void 0===L&&(L=!0);var h=W.call(this,i,"PBRAnisotropic",110,new VW,L)||this;return h._isEnabled=!1,h.isEnabled=!1,h.intensity=1,h.direction=new z.k(1,0),h._texture=null,h.texture=null,h._internalMarkAllSubMeshesAsTexturesDirty=i._dirtyCallbacks[1],h}return(0,h.n)(i,W),i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(W,i){return!this._isEnabled||!(W._areTexturesDirty&&i.texturesEnabled&&this._texture&&y.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},i.prototype.prepareDefinesBeforeAttributes=function(W,i,L){this._isEnabled?(W.ANISOTROPIC=this._isEnabled,this._isEnabled&&!L.isVerticesDataPresent(r.d.TangentKind)&&(W._needUVs=!0,W.MAINUV1=!0),W._areTexturesDirty&&i.texturesEnabled&&(this._texture&&y.d.AnisotropicTextureEnabled?a.e.PrepareDefinesForMergedUV(this._texture,W,"ANISOTROPIC_TEXTURE"):W.ANISOTROPIC_TEXTURE=!1)):(W.ANISOTROPIC=!1,W.ANISOTROPIC_TEXTURE=!1)},i.prototype.bindForSubMesh=function(W,i){if(this._isEnabled){var L=this._material.isFrozen;W.useUbo&&L&&W.isSync||(this._texture&&y.d.AnisotropicTextureEnabled&&(W.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),a.e.BindTextureMatrix(this._texture,W,"anisotropy")),W.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),i.texturesEnabled&&this._texture&&y.d.AnisotropicTextureEnabled&&W.setTexture("anisotropySampler",this._texture)}},i.prototype.hasTexture=function(W){return this._texture===W},i.prototype.getActiveTextures=function(W){this._texture&&W.push(this._texture)},i.prototype.getAnimatables=function(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture)},i.prototype.dispose=function(W){W&&this._texture&&this._texture.dispose()},i.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},i.prototype.addFallbacks=function(W,i,L){return W.ANISOTROPIC&&i.addFallback(L++,"ANISOTROPIC"),L},i.prototype.getSamplers=function(W){W.push("anisotropySampler")},i.prototype.getUniforms=function(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}},(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,h.j)([(0,l.H)()],i.prototype,"intensity",void 0),(0,h.j)([(0,l.F)()],i.prototype,"direction",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),i}(I.e),fW=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.SHEEN=!1,i.SHEEN_TEXTURE=!1,i.SHEEN_GAMMATEXTURE=!1,i.SHEEN_TEXTURE_ROUGHNESS=!1,i.SHEEN_TEXTUREDIRECTUV=0,i.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,i.SHEEN_LINKWITHALBEDO=!1,i.SHEEN_ROUGHNESS=!1,i.SHEEN_ALBEDOSCALING=!1,i.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,i.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,i}return(0,h.n)(i,W),i}(N.b),aW=function(W){function i(i,L){void 0===L&&(L=!0);var h=W.call(this,i,"Sheen",120,new fW,L)||this;return h._isEnabled=!1,h.isEnabled=!1,h._linkSheenWithAlbedo=!1,h.linkSheenWithAlbedo=!1,h.intensity=1,h.color=S.d.White(),h._texture=null,h.texture=null,h._useRoughnessFromMainTexture=!0,h.useRoughnessFromMainTexture=!0,h._roughness=null,h.roughness=null,h._textureRoughness=null,h.textureRoughness=null,h._albedoScaling=!1,h.albedoScaling=!1,h._internalMarkAllSubMeshesAsTexturesDirty=i._dirtyCallbacks[1],h}return(0,h.n)(i,W),i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(W,i){if(!this._isEnabled)return!0;if(W._areTexturesDirty&&i.texturesEnabled){if(this._texture&&y.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&y.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0},i.prototype.prepareDefines=function(W,i){var L;this._isEnabled?(W.SHEEN=!0,W.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,W.SHEEN_ROUGHNESS=null!==this._roughness,W.SHEEN_ALBEDOSCALING=this._albedoScaling,W.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,W.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(L=this._textureRoughness)||void 0===L?void 0:L._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),W._areTexturesDirty&&i.texturesEnabled&&(this._texture&&y.d.SheenTextureEnabled?(a.e.PrepareDefinesForMergedUV(this._texture,W,"SHEEN_TEXTURE"),W.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):W.SHEEN_TEXTURE=!1,this._textureRoughness&&y.d.SheenTextureEnabled?a.e.PrepareDefinesForMergedUV(this._textureRoughness,W,"SHEEN_TEXTURE_ROUGHNESS"):W.SHEEN_TEXTURE_ROUGHNESS=!1)):(W.SHEEN=!1,W.SHEEN_TEXTURE=!1,W.SHEEN_TEXTURE_ROUGHNESS=!1,W.SHEEN_LINKWITHALBEDO=!1,W.SHEEN_ROUGHNESS=!1,W.SHEEN_ALBEDOSCALING=!1,W.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,W.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1)},i.prototype.bindForSubMesh=function(W,i,L,h){var l,t,p,x,R,z,r,N;if(this._isEnabled){var I=h.materialDefines,s=this._material.isFrozen,o=I.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;W.useUbo&&s&&W.isSync||(o&&y.d.SheenTextureEnabled?(W.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),a.e.BindTextureMatrix(this._texture,W,"sheen")):(this._texture||this._textureRoughness)&&y.d.SheenTextureEnabled&&(W.updateFloat4("vSheenInfos",null!==(t=null===(l=this._texture)||void 0===l?void 0:l.coordinatesIndex)&&void 0!==t?t:0,null!==(x=null===(p=this._texture)||void 0===p?void 0:p.level)&&void 0!==x?x:0,null!==(z=null===(R=this._textureRoughness)||void 0===R?void 0:R.coordinatesIndex)&&void 0!==z?z:0,null!==(N=null===(r=this._textureRoughness)||void 0===r?void 0:r.level)&&void 0!==N?N:0),this._texture&&a.e.BindTextureMatrix(this._texture,W,"sheen"),!this._textureRoughness||o||I.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE||a.e.BindTextureMatrix(this._textureRoughness,W,"sheenRoughness")),W.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&W.updateFloat("vSheenRoughness",this._roughness)),i.texturesEnabled&&(this._texture&&y.d.SheenTextureEnabled&&W.setTexture("sheenSampler",this._texture),this._textureRoughness&&!o&&!I.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&y.d.SheenTextureEnabled&&W.setTexture("sheenRoughnessSampler",this._textureRoughness))}},i.prototype.hasTexture=function(W){return this._texture===W||this._textureRoughness===W},i.prototype.getActiveTextures=function(W){this._texture&&W.push(this._texture),this._textureRoughness&&W.push(this._textureRoughness)},i.prototype.getAnimatables=function(W){this._texture&&this._texture.animations&&this._texture.animations.length>0&&W.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&W.push(this._textureRoughness)},i.prototype.dispose=function(W){var i,L;W&&(null===(i=this._texture)||void 0===i||i.dispose(),null===(L=this._textureRoughness)||void 0===L||L.dispose())},i.prototype.getClassName=function(){return"PBRSheenConfiguration"},i.prototype.addFallbacks=function(W,i,L){return W.SHEEN&&i.addFallback(L++,"SHEEN"),L},i.prototype.getSamplers=function(W){W.push("sheenSampler","sheenRoughnessSampler")},i.prototype.getUniforms=function(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}},(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkSheenWithAlbedo",void 0),(0,h.j)([(0,l.H)()],i.prototype,"intensity",void 0),(0,h.j)([(0,l.q)()],i.prototype,"color",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoScaling",void 0),i}(I.e),PW=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.SUBSURFACE=!1,i.SS_REFRACTION=!1,i.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,i.SS_TRANSLUCENCY=!1,i.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,i.SS_SCATTERING=!1,i.SS_THICKNESSANDMASK_TEXTURE=!1,i.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,i.SS_HAS_THICKNESS=!1,i.SS_REFRACTIONINTENSITY_TEXTURE=!1,i.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,i.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,i.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,i.SS_REFRACTIONMAP_3D=!1,i.SS_REFRACTIONMAP_OPPOSITEZ=!1,i.SS_LODINREFRACTIONALPHA=!1,i.SS_GAMMAREFRACTION=!1,i.SS_RGBDREFRACTION=!1,i.SS_LINEARSPECULARREFRACTION=!1,i.SS_LINKREFRACTIONTOTRANSPARENCY=!1,i.SS_ALBEDOFORREFRACTIONTINT=!1,i.SS_ALBEDOFORTRANSLUCENCYTINT=!1,i.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,i.SS_USE_THICKNESS_AS_DEPTH=!1,i.SS_MASK_FROM_THICKNESS_TEXTURE=!1,i.SS_USE_GLTF_TEXTURES=!1,i}return(0,h.n)(i,W),i}(N.b),yW=function(W){function i(i,L){void 0===L&&(L=!0);var h=W.call(this,i,"PBRSubSurface",130,new PW,L)||this;return h._isRefractionEnabled=!1,h.isRefractionEnabled=!1,h._isTranslucencyEnabled=!1,h.isTranslucencyEnabled=!1,h._isScatteringEnabled=!1,h.isScatteringEnabled=!1,h._scatteringDiffusionProfileIndex=0,h.refractionIntensity=1,h.translucencyIntensity=1,h.useAlbedoToTintRefraction=!1,h.useAlbedoToTintTranslucency=!1,h._thicknessTexture=null,h.thicknessTexture=null,h._refractionTexture=null,h.refractionTexture=null,h._indexOfRefraction=1.5,h.indexOfRefraction=1.5,h._volumeIndexOfRefraction=-1,h._invertRefractionY=!1,h.invertRefractionY=!1,h._linkRefractionWithTransparency=!1,h.linkRefractionWithTransparency=!1,h.minimumThickness=0,h.maximumThickness=1,h.useThicknessAsDepth=!1,h.tintColor=S.d.White(),h.tintColorAtDistance=1,h.diffusionDistance=S.d.White(),h._useMaskFromThicknessTexture=!1,h.useMaskFromThicknessTexture=!1,h._refractionIntensityTexture=null,h.refractionIntensityTexture=null,h._translucencyIntensityTexture=null,h.translucencyIntensityTexture=null,h._useGltfStyleTextures=!1,h.useGltfStyleTextures=!1,h._scene=i.getScene(),h.registerForExtraEvents=!0,h._internalMarkAllSubMeshesAsTexturesDirty=i._dirtyCallbacks[1],h._internalMarkScenePrePassDirty=i._dirtyCallbacks[32],h}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"scatteringDiffusionProfile",{get:function(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null},set:function(W){this._scene.enableSubSurfaceForPrePass()&&W&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(W))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"volumeIndexOfRefraction",{get:function(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction},set:function(W){this._volumeIndexOfRefraction=W>=1?W:-1},enumerable:!1,configurable:!0}),i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype._markScenePrePassDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()},i.prototype.isReadyForSubMesh=function(W,i){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(W._areTexturesDirty&&i.texturesEnabled){if(this._thicknessTexture&&y.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var L=this._getRefractionTexture(i);if(L&&y.d.RefractionTextureEnabled&&!L.isReadyOrNotBlocking())return!1}return!0},i.prototype.prepareDefines=function(W,i){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return W.SUBSURFACE=!1,W.SS_TRANSLUCENCY=!1,W.SS_SCATTERING=!1,void(W.SS_REFRACTION=!1);if(W._areTexturesDirty){W.SUBSURFACE=!0,W.SS_TRANSLUCENCY=this._isTranslucencyEnabled,W.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,W.SS_SCATTERING=this._isScatteringEnabled,W.SS_THICKNESSANDMASK_TEXTURE=!1,W.SS_REFRACTIONINTENSITY_TEXTURE=!1,W.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,W.SS_HAS_THICKNESS=!1,W.SS_MASK_FROM_THICKNESS_TEXTURE=!1,W.SS_USE_GLTF_TEXTURES=!1,W.SS_REFRACTION=!1,W.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,W.SS_REFRACTIONMAP_3D=!1,W.SS_GAMMAREFRACTION=!1,W.SS_RGBDREFRACTION=!1,W.SS_LINEARSPECULARREFRACTION=!1,W.SS_REFRACTIONMAP_OPPOSITEZ=!1,W.SS_LODINREFRACTIONALPHA=!1,W.SS_LINKREFRACTIONTOTRANSPARENCY=!1,W.SS_ALBEDOFORREFRACTIONTINT=!1,W.SS_ALBEDOFORTRANSLUCENCYTINT=!1,W.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,W.SS_USE_THICKNESS_AS_DEPTH=!1;var L=!!this._thicknessTexture&&!!this._refractionIntensityTexture&&this._refractionIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._refractionIntensityTexture._texture===this._thicknessTexture._texture,h=!!this._thicknessTexture&&!!this._translucencyIntensityTexture&&this._translucencyIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._translucencyIntensityTexture._texture===this._thicknessTexture._texture,l=(L||!this._refractionIntensityTexture)&&(h||!this._translucencyIntensityTexture);if(W._areTexturesDirty&&i.texturesEnabled&&(this._thicknessTexture&&y.d.ThicknessTextureEnabled&&a.e.PrepareDefinesForMergedUV(this._thicknessTexture,W,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&y.d.RefractionIntensityTextureEnabled&&!l&&a.e.PrepareDefinesForMergedUV(this._refractionIntensityTexture,W,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&y.d.TranslucencyIntensityTextureEnabled&&!l&&a.e.PrepareDefinesForMergedUV(this._translucencyIntensityTexture,W,"SS_TRANSLUCENCYINTENSITY_TEXTURE")),W.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,W.SS_MASK_FROM_THICKNESS_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture||!!this._translucencyIntensityTexture)&&l,W.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,W.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture)&&l,W.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._translucencyIntensityTexture)&&l,this._isRefractionEnabled&&i.texturesEnabled){var t=this._getRefractionTexture(i);t&&y.d.RefractionTextureEnabled&&(W.SS_REFRACTION=!0,W.SS_REFRACTIONMAP_3D=t.isCube,W.SS_GAMMAREFRACTION=t.gammaSpace,W.SS_RGBDREFRACTION=t.isRGBD,W.SS_LINEARSPECULARREFRACTION=t.linearSpecularLOD,W.SS_REFRACTIONMAP_OPPOSITEZ=t.invertZ,W.SS_LODINREFRACTIONALPHA=t.lodLevelInAlpha,W.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,W.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,W.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=t.isCube&&t.boundingBoxSize,W.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(W.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}},i.prototype.hardBindForSubMesh=function(W,i,L,h){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled){h.getRenderingMesh().getWorldMatrix().decompose(z.h.Vector3[0]);var l=Math.max(Math.abs(z.h.Vector3[0].x),Math.abs(z.h.Vector3[0].y),Math.abs(z.h.Vector3[0].z));W.updateFloat2("vThicknessParam",this.minimumThickness*l,(this.maximumThickness-this.minimumThickness)*l)}},i.prototype.bindForSubMesh=function(W,i,L,h){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled){var l=h.materialDefines,t=this._material.isFrozen,p=this._material.realTimeFiltering,x=l.LODBASEDMICROSFURACE,R=this._getRefractionTexture(i);if(!W.useUbo||!t||!W.isSync){if(this._thicknessTexture&&y.d.ThicknessTextureEnabled&&(W.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),a.e.BindTextureMatrix(this._thicknessTexture,W,"thickness")),this._refractionIntensityTexture&&y.d.RefractionIntensityTextureEnabled&&l.SS_REFRACTIONINTENSITY_TEXTURE&&(W.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),a.e.BindTextureMatrix(this._refractionIntensityTexture,W,"refractionIntensity")),this._translucencyIntensityTexture&&y.d.TranslucencyIntensityTextureEnabled&&l.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(W.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),a.e.BindTextureMatrix(this._translucencyIntensityTexture,W,"translucencyIntensity")),R&&y.d.RefractionTextureEnabled){W.updateMatrix("refractionMatrix",R.getReflectionTextureMatrix());var z=1;R.isCube||R.depth&&(z=R.depth);var r=R.getSize().width,N=this.volumeIndexOfRefraction;if(W.updateFloat4("vRefractionInfos",R.level,1/N,z,this._invertRefractionY?-1:1),W.updateFloat4("vRefractionMicrosurfaceInfos",r,R.lodGenerationScale,R.lodGenerationOffset,1/this.indexOfRefraction),p&&W.updateFloat2("vRefractionFilteringInfo",r,C.d.Log2(r)),R.boundingBoxSize){var I=R;W.updateVector3("vRefractionPosition",I.boundingBoxPosition),W.updateVector3("vRefractionSize",I.boundingBoxSize)}}this._isScatteringEnabled&&W.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),W.updateColor3("vDiffusionDistance",this.diffusionDistance),W.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),W.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0)}i.texturesEnabled&&(this._thicknessTexture&&y.d.ThicknessTextureEnabled&&W.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&y.d.RefractionIntensityTextureEnabled&&l.SS_REFRACTIONINTENSITY_TEXTURE&&W.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&y.d.TranslucencyIntensityTextureEnabled&&l.SS_TRANSLUCENCYINTENSITY_TEXTURE&&W.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),R&&y.d.RefractionTextureEnabled&&(x?W.setTexture("refractionSampler",R):(W.setTexture("refractionSampler",R._lodTextureMid||R),W.setTexture("refractionSamplerLow",R._lodTextureLow||R),W.setTexture("refractionSamplerHigh",R._lodTextureHigh||R))))}},i.prototype._getRefractionTexture=function(W){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?W.environmentTexture:null},Object.defineProperty(i.prototype,"disableAlphaBlending",{get:function(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!1,configurable:!0}),i.prototype.fillRenderTargetTextures=function(W){y.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&W.push(this._refractionTexture)},i.prototype.hasTexture=function(W){return this._thicknessTexture===W||this._refractionTexture===W},i.prototype.hasRenderTargetTextures=function(){return!!(y.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},i.prototype.getActiveTextures=function(W){this._thicknessTexture&&W.push(this._thicknessTexture),this._refractionTexture&&W.push(this._refractionTexture)},i.prototype.getAnimatables=function(W){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&W.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&W.push(this._refractionTexture)},i.prototype.dispose=function(W){W&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},i.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},i.prototype.addFallbacks=function(W,i,L){return W.SS_SCATTERING&&i.addFallback(L++,"SS_SCATTERING"),W.SS_TRANSLUCENCY&&i.addFallback(L++,"SS_TRANSLUCENCY"),L},i.prototype.getSamplers=function(W){W.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},i.prototype.getUniforms=function(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"}]}},(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isRefractionEnabled",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTranslucencyEnabled",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markScenePrePassDirty")],i.prototype,"isScatteringEnabled",void 0),(0,h.j)([(0,l.H)()],i.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,h.j)([(0,l.H)()],i.prototype,"refractionIntensity",void 0),(0,h.j)([(0,l.H)()],i.prototype,"translucencyIntensity",void 0),(0,h.j)([(0,l.H)()],i.prototype,"useAlbedoToTintRefraction",void 0),(0,h.j)([(0,l.H)()],i.prototype,"useAlbedoToTintTranslucency",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"thicknessTexture",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionTexture",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),(0,h.j)([(0,l.H)()],i.prototype,"_volumeIndexOfRefraction",void 0),(0,h.j)([(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"volumeIndexOfRefraction",null),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertRefractionY",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkRefractionWithTransparency",void 0),(0,h.j)([(0,l.H)()],i.prototype,"minimumThickness",void 0),(0,h.j)([(0,l.H)()],i.prototype,"maximumThickness",void 0),(0,h.j)([(0,l.H)()],i.prototype,"useThicknessAsDepth",void 0),(0,h.j)([(0,l.q)()],i.prototype,"tintColor",void 0),(0,h.j)([(0,l.H)()],i.prototype,"tintColorAtDistance",void 0),(0,h.j)([(0,l.q)()],i.prototype,"diffusionDistance",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMaskFromThicknessTexture",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionIntensityTexture",void 0),(0,h.j)([(0,l.C)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"translucencyIntensityTexture",void 0),(0,h.j)([(0,l.H)(),(0,l.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useGltfStyleTextures",void 0),i}(I.e),MW=L(56513),bW={effect:null,subMesh:null},jW=function(W){function i(i){var L=W.call(this,i)||this;return L.PBR=!0,L.NUM_SAMPLES="0",L.REALTIME_FILTERING=!1,L.MAINUV1=!1,L.MAINUV2=!1,L.MAINUV3=!1,L.MAINUV4=!1,L.MAINUV5=!1,L.MAINUV6=!1,L.UV1=!1,L.UV2=!1,L.UV3=!1,L.UV4=!1,L.UV5=!1,L.UV6=!1,L.ALBEDO=!1,L.GAMMAALBEDO=!1,L.ALBEDODIRECTUV=0,L.VERTEXCOLOR=!1,L.BAKED_VERTEX_ANIMATION_TEXTURE=!1,L.AMBIENT=!1,L.AMBIENTDIRECTUV=0,L.AMBIENTINGRAYSCALE=!1,L.OPACITY=!1,L.VERTEXALPHA=!1,L.OPACITYDIRECTUV=0,L.OPACITYRGB=!1,L.ALPHATEST=!1,L.DEPTHPREPASS=!1,L.ALPHABLEND=!1,L.ALPHAFROMALBEDO=!1,L.ALPHATESTVALUE="0.5",L.SPECULAROVERALPHA=!1,L.RADIANCEOVERALPHA=!1,L.ALPHAFRESNEL=!1,L.LINEARALPHAFRESNEL=!1,L.PREMULTIPLYALPHA=!1,L.EMISSIVE=!1,L.EMISSIVEDIRECTUV=0,L.GAMMAEMISSIVE=!1,L.REFLECTIVITY=!1,L.REFLECTIVITY_GAMMA=!1,L.REFLECTIVITYDIRECTUV=0,L.SPECULARTERM=!1,L.MICROSURFACEFROMREFLECTIVITYMAP=!1,L.MICROSURFACEAUTOMATIC=!1,L.LODBASEDMICROSFURACE=!1,L.MICROSURFACEMAP=!1,L.MICROSURFACEMAPDIRECTUV=0,L.METALLICWORKFLOW=!1,L.ROUGHNESSSTOREINMETALMAPALPHA=!1,L.ROUGHNESSSTOREINMETALMAPGREEN=!1,L.METALLNESSSTOREINMETALMAPBLUE=!1,L.AOSTOREINMETALMAPRED=!1,L.METALLIC_REFLECTANCE=!1,L.METALLIC_REFLECTANCE_GAMMA=!1,L.METALLIC_REFLECTANCEDIRECTUV=0,L.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,L.REFLECTANCE=!1,L.REFLECTANCE_GAMMA=!1,L.REFLECTANCEDIRECTUV=0,L.ENVIRONMENTBRDF=!1,L.ENVIRONMENTBRDF_RGBD=!1,L.NORMAL=!1,L.TANGENT=!1,L.BUMP=!1,L.BUMPDIRECTUV=0,L.OBJECTSPACE_NORMALMAP=!1,L.PARALLAX=!1,L.PARALLAXOCCLUSION=!1,L.NORMALXYSCALE=!0,L.LIGHTMAP=!1,L.LIGHTMAPDIRECTUV=0,L.USELIGHTMAPASSHADOWMAP=!1,L.GAMMALIGHTMAP=!1,L.RGBDLIGHTMAP=!1,L.REFLECTION=!1,L.REFLECTIONMAP_3D=!1,L.REFLECTIONMAP_SPHERICAL=!1,L.REFLECTIONMAP_PLANAR=!1,L.REFLECTIONMAP_CUBIC=!1,L.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,L.REFLECTIONMAP_PROJECTION=!1,L.REFLECTIONMAP_SKYBOX=!1,L.REFLECTIONMAP_EXPLICIT=!1,L.REFLECTIONMAP_EQUIRECTANGULAR=!1,L.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,L.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,L.INVERTCUBICMAP=!1,L.USESPHERICALFROMREFLECTIONMAP=!1,L.USEIRRADIANCEMAP=!1,L.USESPHERICALINVERTEX=!1,L.REFLECTIONMAP_OPPOSITEZ=!1,L.LODINREFLECTIONALPHA=!1,L.GAMMAREFLECTION=!1,L.RGBDREFLECTION=!1,L.LINEARSPECULARREFLECTION=!1,L.RADIANCEOCCLUSION=!1,L.HORIZONOCCLUSION=!1,L.INSTANCES=!1,L.THIN_INSTANCES=!1,L.INSTANCESCOLOR=!1,L.PREPASS=!1,L.PREPASS_IRRADIANCE=!1,L.PREPASS_IRRADIANCE_INDEX=-1,L.PREPASS_ALBEDO_SQRT=!1,L.PREPASS_ALBEDO_SQRT_INDEX=-1,L.PREPASS_DEPTH=!1,L.PREPASS_DEPTH_INDEX=-1,L.PREPASS_NORMAL=!1,L.PREPASS_NORMAL_INDEX=-1,L.PREPASS_POSITION=!1,L.PREPASS_POSITION_INDEX=-1,L.PREPASS_VELOCITY=!1,L.PREPASS_VELOCITY_INDEX=-1,L.PREPASS_REFLECTIVITY=!1,L.PREPASS_REFLECTIVITY_INDEX=-1,L.SCENE_MRT_COUNT=0,L.NUM_BONE_INFLUENCERS=0,L.BonesPerMesh=0,L.BONETEXTURE=!1,L.BONES_VELOCITY_ENABLED=!1,L.NONUNIFORMSCALING=!1,L.MORPHTARGETS=!1,L.MORPHTARGETS_NORMAL=!1,L.MORPHTARGETS_TANGENT=!1,L.MORPHTARGETS_UV=!1,L.NUM_MORPH_INFLUENCERS=0,L.MORPHTARGETS_TEXTURE=!1,L.IMAGEPROCESSING=!1,L.VIGNETTE=!1,L.VIGNETTEBLENDMODEMULTIPLY=!1,L.VIGNETTEBLENDMODEOPAQUE=!1,L.TONEMAPPING=!1,L.TONEMAPPING_ACES=!1,L.CONTRAST=!1,L.COLORCURVES=!1,L.COLORGRADING=!1,L.COLORGRADING3D=!1,L.SAMPLER3DGREENDEPTH=!1,L.SAMPLER3DBGRMAP=!1,L.IMAGEPROCESSINGPOSTPROCESS=!1,L.SKIPFINALCOLORCLAMP=!1,L.EXPOSURE=!1,L.MULTIVIEW=!1,L.ORDER_INDEPENDENT_TRANSPARENCY=!1,L.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,L.USEPHYSICALLIGHTFALLOFF=!1,L.USEGLTFLIGHTFALLOFF=!1,L.TWOSIDEDLIGHTING=!1,L.SHADOWFLOAT=!1,L.CLIPPLANE=!1,L.CLIPPLANE2=!1,L.CLIPPLANE3=!1,L.CLIPPLANE4=!1,L.CLIPPLANE5=!1,L.CLIPPLANE6=!1,L.POINTSIZE=!1,L.FOG=!1,L.LOGARITHMICDEPTH=!1,L.FORCENORMALFORWARD=!1,L.SPECULARAA=!1,L.UNLIT=!1,L.DEBUGMODE=0,L.rebuild(),L}return(0,h.n)(i,W),i.prototype.reset=function(){W.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0},i}(N.b),ZW=function(W){function i(L,h){var l=W.call(this,L,h)||this;return l._directIntensity=1,l._emissiveIntensity=1,l._environmentIntensity=1,l._specularIntensity=1,l._lightingInfos=new z.n(l._directIntensity,l._emissiveIntensity,l._environmentIntensity,l._specularIntensity),l._disableBumpMap=!1,l._albedoTexture=null,l._ambientTexture=null,l._ambientTextureStrength=1,l._ambientTextureImpactOnAnalyticalLights=i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,l._opacityTexture=null,l._reflectionTexture=null,l._emissiveTexture=null,l._reflectivityTexture=null,l._metallicTexture=null,l._metallic=null,l._roughness=null,l._metallicF0Factor=1,l._metallicReflectanceColor=S.d.White(),l._useOnlyMetallicFromMetallicReflectanceTexture=!1,l._metallicReflectanceTexture=null,l._reflectanceTexture=null,l._microSurfaceTexture=null,l._bumpTexture=null,l._lightmapTexture=null,l._ambientColor=new S.d(0,0,0),l._albedoColor=new S.d(1,1,1),l._reflectivityColor=new S.d(1,1,1),l._reflectionColor=new S.d(1,1,1),l._emissiveColor=new S.d(0,0,0),l._microSurface=.9,l._useLightmapAsShadowmap=!1,l._useHorizonOcclusion=!0,l._useRadianceOcclusion=!0,l._useAlphaFromAlbedoTexture=!1,l._useSpecularOverAlpha=!0,l._useMicroSurfaceFromReflectivityMapAlpha=!1,l._useRoughnessFromMetallicTextureAlpha=!0,l._useRoughnessFromMetallicTextureGreen=!1,l._useMetallnessFromMetallicTextureBlue=!1,l._useAmbientOcclusionFromMetallicTextureRed=!1,l._useAmbientInGrayScale=!1,l._useAutoMicroSurfaceFromReflectivityMap=!1,l._lightFalloff=i.LIGHTFALLOFF_PHYSICAL,l._useRadianceOverAlpha=!0,l._useObjectSpaceNormalMap=!1,l._useParallax=!1,l._useParallaxOcclusion=!1,l._parallaxScaleBias=.05,l._disableLighting=!1,l._maxSimultaneousLights=4,l._invertNormalMapX=!1,l._invertNormalMapY=!1,l._twoSidedLighting=!1,l._alphaCutOff=.4,l._forceAlphaTest=!1,l._useAlphaFresnel=!1,l._useLinearAlphaFresnel=!1,l._environmentBRDFTexture=null,l._forceIrradianceInFragment=!1,l._realTimeFiltering=!1,l._realTimeFilteringQuality=8,l._forceNormalForward=!1,l._enableSpecularAntiAliasing=!1,l._imageProcessingObserver=null,l._renderTargets=new p.h(16),l._globalAmbientColor=new S.d(0,0,0),l._useLogarithmicDepth=!1,l._unlit=!1,l._debugMode=0,l.debugMode=0,l._debugLimit=-1,l._debugFactor=1,l._cacheHasRenderTargetTextures=!1,l.brdf=new o(l),l.clearCoat=new SW(l),l.iridescence=new eW(l),l.anisotropy=new cW(l),l.sheen=new aW(l),l.subSurface=new yW(l),l.detailMap=new MW.c(l),l._attachImageProcessingConfiguration(null),l.getRenderTargetTextures=function(){return l._renderTargets.reset(),y.d.ReflectionTextureEnabled&&l._reflectionTexture&&l._reflectionTexture.isRenderTarget&&l._renderTargets.push(l._reflectionTexture),l._eventInfo.renderTargets=l._renderTargets,l._callbackPluginEventFillRenderTargetTextures(l._eventInfo),l._renderTargets},l._environmentBRDFTexture=(0,x.c)(l.getScene()),l.prePassConfiguration=new D.e,l}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"realTimeFiltering",{get:function(){return this._realTimeFiltering},set:function(W){this._realTimeFiltering=W,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"realTimeFilteringQuality",{get:function(){return this._realTimeFilteringQuality},set:function(W){this._realTimeFilteringQuality=W,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(W){var i=this;W!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=W||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){i._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(i.prototype,"hasRenderTargetTextures",{get:function(){return!!(y.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPrePassCapable",{get:function(){return!this.disableDepthWrite},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(i.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(W){this._useLogarithmicDepth=W&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_disableAlphaBlending",{get:function(){var W;return this._transparencyMode===i.PBRMATERIAL_OPAQUE||this._transparencyMode===i.PBRMATERIAL_ALPHATEST||(null===(W=this.subSurface)||void 0===W?void 0:W.disableAlphaBlending)},enumerable:!1,configurable:!0}),i.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},i.prototype.needAlphaTesting=function(){var W;return!!this._forceAlphaTest||!(null===(W=this.subSurface)||void 0===W?void 0:W.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===i.PBRMATERIAL_ALPHATEST))},i.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==i.PBRMATERIAL_OPAQUE},i.prototype._hasAlphaChannel=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture},i.prototype.getAlphaTestTexture=function(){return this._albedoTexture},i.prototype.isReadyForSubMesh=function(W,i,L){if(this._uniformBufferLayoutBuilt||this.buildUniformLayout(),i.effect&&this.isFrozen&&i.effect._wasPreviouslyReady&&i.effect._wasPreviouslyUsingInstances===L)return!0;i.materialDefines||(this._callbackPluginEventGeneric(c.d.GetDefineNames,this._eventInfo),i.materialDefines=new jW(this._eventInfo.defineNames));var h=i.materialDefines;if(this._isReadyForSubMesh(i))return!0;var l=this.getScene(),p=l.getEngine();if(h._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,l.texturesEnabled)){if(this._albedoTexture&&y.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&y.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&y.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var x=this._getReflectionTexture();if(x&&y.d.ReflectionTextureEnabled){if(!x.isReadyOrNotBlocking())return!1;if(x.irradianceTexture&&!x.irradianceTexture.isReadyOrNotBlocking())return!1}if(this._lightmapTexture&&y.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&y.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(y.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(p.getCaps().standardDerivatives&&this._bumpTexture&&y.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&y.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=h,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(h._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;p.getCaps().standardDerivatives||W.isVerticesDataPresent(r.d.NormalKind)||(W.createNormals(!0),t.e.Warn("PBRMaterial: Normals have been created for the mesh: "+W.name));var R=i.effect,z=h._areLightsDisposed,N=this._prepareEffect(W,h,this.onCompiled,this.onError,L,null,i.getRenderingMesh().hasThinInstances);if(N)if(this._onEffectCreatedObservable&&(bW.effect=N,bW.subMesh=i,this._onEffectCreatedObservable.notifyObservers(bW)),this.allowShaderHotSwapping&&R&&!N.isReady()){if(N=R,h.markAsUnprocessed(),z)return h._areLightsDisposed=!0,!1}else l.resetCachedMaterial(),i.setEffect(N,h,this._materialContext);return!(!i.effect||!i.effect.isReady())&&(h._renderId=l.getRenderId(),i.effect._wasPreviouslyReady=!0,i.effect._wasPreviouslyUsingInstances=!!L,!0)},i.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},i.prototype._prepareEffect=function(W,i,L,h,l,t,p){if(void 0===L&&(L=null),void 0===h&&(h=null),void 0===l&&(l=null),void 0===t&&(t=null),this._prepareDefines(W,i,l,t,p),!i.isDirty)return null;i.markAsProcessed();var x=this.getScene().getEngine(),R=new oW.b,z=0;i.USESPHERICALINVERTEX&&R.addFallback(z++,"USESPHERICALINVERTEX"),i.FOG&&R.addFallback(z,"FOG"),i.SPECULARAA&&R.addFallback(z,"SPECULARAA"),i.POINTSIZE&&R.addFallback(z,"POINTSIZE"),i.LOGARITHMICDEPTH&&R.addFallback(z,"LOGARITHMICDEPTH"),i.PARALLAX&&R.addFallback(z,"PARALLAX"),i.PARALLAXOCCLUSION&&R.addFallback(z++,"PARALLAXOCCLUSION"),i.ENVIRONMENTBRDF&&R.addFallback(z++,"ENVIRONMENTBRDF"),i.TANGENT&&R.addFallback(z++,"TANGENT"),i.BUMP&&R.addFallback(z++,"BUMP"),z=a.e.HandleFallbacksForShadows(i,R,this._maxSimultaneousLights,z++),i.SPECULARTERM&&R.addFallback(z++,"SPECULARTERM"),i.USESPHERICALFROMREFLECTIONMAP&&R.addFallback(z++,"USESPHERICALFROMREFLECTIONMAP"),i.USEIRRADIANCEMAP&&R.addFallback(z++,"USEIRRADIANCEMAP"),i.LIGHTMAP&&R.addFallback(z++,"LIGHTMAP"),i.NORMAL&&R.addFallback(z++,"NORMAL"),i.AMBIENT&&R.addFallback(z++,"AMBIENT"),i.EMISSIVE&&R.addFallback(z++,"EMISSIVE"),i.VERTEXCOLOR&&R.addFallback(z++,"VERTEXCOLOR"),i.MORPHTARGETS&&R.addFallback(z++,"MORPHTARGETS"),i.MULTIVIEW&&R.addFallback(0,"MULTIVIEW");var N=[r.d.PositionKind];i.NORMAL&&N.push(r.d.NormalKind),i.TANGENT&&N.push(r.d.TangentKind);for(var I=1;I<=6;++I)i["UV"+I]&&N.push("uv".concat(1===I?"":I));i.VERTEXCOLOR&&N.push(r.d.ColorKind),i.INSTANCESCOLOR&&N.push(r.d.ColorInstanceKind),a.e.PrepareAttributesForBones(N,W,i,R),a.e.PrepareAttributesForInstances(N,i),a.e.PrepareAttributesForMorphTargets(N,W,i),a.e.PrepareAttributesForBakedVertexAnimation(N,W,i);var s="pbr",o=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],S=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],C=["Material","Scene","Mesh"];this._eventInfo.fallbacks=R,this._eventInfo.fallbackRank=z,this._eventInfo.defines=i,this._eventInfo.uniforms=o,this._eventInfo.attributes=N,this._eventInfo.samplers=S,this._eventInfo.uniformBuffersNames=C,this._eventInfo.customCode=void 0,this._eventInfo.mesh=W,this._callbackPluginEventGeneric(c.d.PrepareEffect,this._eventInfo),D.e.AddUniforms(o),D.e.AddSamplers(S),e.h&&(e.h.PrepareUniforms(o,i),e.h.PrepareSamplers(S,i)),a.e.PrepareUniformsAndSamplersList({uniformsNames:o,uniformBuffersNames:C,samplers:S,defines:i,maxSimultaneousLights:this._maxSimultaneousLights});var V={};this.customShaderNameResolve&&(s=this.customShaderNameResolve(s,o,C,S,i,N,V));var f=i.toString();return x.createEffect(s,{attributes:N,uniformsNames:o,uniformBuffersNames:C,samplers:S,defines:f,fallbacks:R,onCompiled:L,onError:h,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:i.NUM_MORPH_INFLUENCERS},processFinalCode:V.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:i.PREPASS},x)},i.prototype._prepareDefines=function(W,L,h,l,t){var p;void 0===h&&(h=null),void 0===l&&(l=null),void 0===t&&(t=!1);var x=this.getScene(),R=x.getEngine();a.e.PrepareDefinesForLights(x,W,L,!0,this._maxSimultaneousLights,this._disableLighting),L._needNormals=!0,a.e.PrepareDefinesForMultiview(x,L);var z=this.needAlphaBlendingForMesh(W)&&this.getScene().useOrderIndependentTransparency;if(a.e.PrepareDefinesForPrePass(x,L,this.canRenderToMRT&&!z),a.e.PrepareDefinesForOIT(x,L,z),L.METALLICWORKFLOW=this.isMetallicWorkflow(),L._areTexturesDirty){if(L._needUVs=!1,x.texturesEnabled){x.getEngine().getCaps().textureLOD&&(L.LODBASEDMICROSFURACE=!0),this._albedoTexture&&y.d.DiffuseTextureEnabled?(a.e.PrepareDefinesForMergedUV(this._albedoTexture,L,"ALBEDO"),L.GAMMAALBEDO=this._albedoTexture.gammaSpace):L.ALBEDO=!1,this._ambientTexture&&y.d.AmbientTextureEnabled?(a.e.PrepareDefinesForMergedUV(this._ambientTexture,L,"AMBIENT"),L.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):L.AMBIENT=!1,this._opacityTexture&&y.d.OpacityTextureEnabled?(a.e.PrepareDefinesForMergedUV(this._opacityTexture,L,"OPACITY"),L.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):L.OPACITY=!1;var N=this._getReflectionTexture();if(N&&y.d.ReflectionTextureEnabled){switch(L.REFLECTION=!0,L.GAMMAREFLECTION=N.gammaSpace,L.RGBDREFLECTION=N.isRGBD,L.LODINREFLECTIONALPHA=N.lodLevelInAlpha,L.LINEARSPECULARREFLECTION=N.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(L.NUM_SAMPLES=""+this.realTimeFilteringQuality,R._features.needTypeSuffixInShaderConstants&&(L.NUM_SAMPLES=L.NUM_SAMPLES+"u"),L.REALTIME_FILTERING=!0):L.REALTIME_FILTERING=!1,N.coordinatesMode===P.e.INVCUBIC_MODE&&(L.INVERTCUBICMAP=!0),L.REFLECTIONMAP_3D=N.isCube,L.REFLECTIONMAP_OPPOSITEZ=L.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!N.invertZ:N.invertZ,L.REFLECTIONMAP_CUBIC=!1,L.REFLECTIONMAP_EXPLICIT=!1,L.REFLECTIONMAP_PLANAR=!1,L.REFLECTIONMAP_PROJECTION=!1,L.REFLECTIONMAP_SKYBOX=!1,L.REFLECTIONMAP_SPHERICAL=!1,L.REFLECTIONMAP_EQUIRECTANGULAR=!1,L.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,L.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,N.coordinatesMode){case P.e.EXPLICIT_MODE:L.REFLECTIONMAP_EXPLICIT=!0;break;case P.e.PLANAR_MODE:L.REFLECTIONMAP_PLANAR=!0;break;case P.e.PROJECTION_MODE:L.REFLECTIONMAP_PROJECTION=!0;break;case P.e.SKYBOX_MODE:L.REFLECTIONMAP_SKYBOX=!0;break;case P.e.SPHERICAL_MODE:L.REFLECTIONMAP_SPHERICAL=!0;break;case P.e.EQUIRECTANGULAR_MODE:L.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case P.e.FIXED_EQUIRECTANGULAR_MODE:L.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case P.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:L.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case P.e.CUBIC_MODE:case P.e.INVCUBIC_MODE:default:L.REFLECTIONMAP_CUBIC=!0,L.USE_LOCAL_REFLECTIONMAP_CUBIC=!!N.boundingBoxSize}N.coordinatesMode!==P.e.SKYBOX_MODE&&(N.irradianceTexture?(L.USEIRRADIANCEMAP=!0,L.USESPHERICALFROMREFLECTIONMAP=!1):N.isCube&&(L.USESPHERICALFROMREFLECTIONMAP=!0,L.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||x.getEngine().getCaps().maxVaryingVectors<=8?L.USESPHERICALINVERTEX=!1:L.USESPHERICALINVERTEX=!0))}else L.REFLECTION=!1,L.REFLECTIONMAP_3D=!1,L.REFLECTIONMAP_SPHERICAL=!1,L.REFLECTIONMAP_PLANAR=!1,L.REFLECTIONMAP_CUBIC=!1,L.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,L.REFLECTIONMAP_PROJECTION=!1,L.REFLECTIONMAP_SKYBOX=!1,L.REFLECTIONMAP_EXPLICIT=!1,L.REFLECTIONMAP_EQUIRECTANGULAR=!1,L.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,L.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,L.INVERTCUBICMAP=!1,L.USESPHERICALFROMREFLECTIONMAP=!1,L.USEIRRADIANCEMAP=!1,L.USESPHERICALINVERTEX=!1,L.REFLECTIONMAP_OPPOSITEZ=!1,L.LODINREFLECTIONALPHA=!1,L.GAMMAREFLECTION=!1,L.RGBDREFLECTION=!1,L.LINEARSPECULARREFLECTION=!1;if(this._lightmapTexture&&y.d.LightmapTextureEnabled?(a.e.PrepareDefinesForMergedUV(this._lightmapTexture,L,"LIGHTMAP"),L.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,L.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,L.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):L.LIGHTMAP=!1,this._emissiveTexture&&y.d.EmissiveTextureEnabled?(a.e.PrepareDefinesForMergedUV(this._emissiveTexture,L,"EMISSIVE"),L.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):L.EMISSIVE=!1,y.d.SpecularTextureEnabled){if(this._metallicTexture?(a.e.PrepareDefinesForMergedUV(this._metallicTexture,L,"REFLECTIVITY"),L.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,L.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,L.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,L.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,L.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(a.e.PrepareDefinesForMergedUV(this._reflectivityTexture,L,"REFLECTIVITY"),L.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,L.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,L.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):L.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture){var I=null!==this._metallicReflectanceTexture&&this._metallicReflectanceTexture._texture===(null===(p=this._reflectanceTexture)||void 0===p?void 0:p._texture)&&this._metallicReflectanceTexture.checkTransformsAreIdentical(this._reflectanceTexture);L.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture&&!I,this._metallicReflectanceTexture?(a.e.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,L,"METALLIC_REFLECTANCE"),L.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):L.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&!I&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(a.e.PrepareDefinesForMergedUV(this._reflectanceTexture,L,"REFLECTANCE"),L.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):L.REFLECTANCE=!1}else L.METALLIC_REFLECTANCE=!1,L.REFLECTANCE=!1;this._microSurfaceTexture?a.e.PrepareDefinesForMergedUV(this._microSurfaceTexture,L,"MICROSURFACEMAP"):L.MICROSURFACEMAP=!1}else L.REFLECTIVITY=!1,L.MICROSURFACEMAP=!1;x.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&y.d.BumpTextureEnabled&&!this._disableBumpMap?(a.e.PrepareDefinesForMergedUV(this._bumpTexture,L,"BUMP"),this._useParallax&&this._albedoTexture&&y.d.DiffuseTextureEnabled?(L.PARALLAX=!0,L.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):L.PARALLAX=!1,L.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(L.BUMP=!1,L.PARALLAX=!1,L.PARALLAXOCCLUSION=!1,L.PARALLAOBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&y.d.ReflectionTextureEnabled?(L.ENVIRONMENTBRDF=!0,L.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(L.ENVIRONMENTBRDF=!1,L.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?L.ALPHAFROMALBEDO=!0:L.ALPHAFROMALBEDO=!1}L.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===i.LIGHTFALLOFF_STANDARD?(L.USEPHYSICALLIGHTFALLOFF=!1,L.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===i.LIGHTFALLOFF_GLTF?(L.USEPHYSICALLIGHTFALLOFF=!1,L.USEGLTFLIGHTFALLOFF=!0):(L.USEPHYSICALLIGHTFALLOFF=!0,L.USEGLTFLIGHTFALLOFF=!1),L.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?L.TWOSIDEDLIGHTING=!0:L.TWOSIDEDLIGHTING=!1,L.SPECULARAA=x.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(L._areTexturesDirty||L._areMiscDirty)&&(L.ALPHATESTVALUE="".concat(this._alphaCutOff).concat(this._alphaCutOff%1===0?".":""),L.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,L.ALPHABLEND=this.needAlphaBlendingForMesh(W),L.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,L.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),L._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(L),L.FORCENORMALFORWARD=this._forceNormalForward,L.RADIANCEOCCLUSION=this._useRadianceOcclusion,L.HORIZONOCCLUSION=this._useHorizonOcclusion,L._areMiscDirty&&(a.e.PrepareDefinesForMisc(W,x,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(W)||this._forceAlphaTest,L),L.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!W.isVerticesDataPresent(r.d.NormalKind),L.DEBUGMODE=this._debugMode),a.e.PrepareDefinesForFrameBoundValues(x,R,L,!!h,l,t),this._eventInfo.defines=L,this._eventInfo.mesh=W,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),a.e.PrepareDefinesForAttributes(W,L,!0,!0,!0,this._transparencyMode!==i.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)},i.prototype.forceCompilation=function(W,i,L){var l=this,t=(0,h.d)({clipPlane:!1,useInstances:!1},L);this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(c.d.GetDefineNames,this._eventInfo);var p=new jW(this._eventInfo.defineNames),x=this._prepareEffect(W,p,void 0,void 0,t.useInstances,t.clipPlane,W.hasThinInstances);this._onEffectCreatedObservable&&(bW.effect=x,bW.subMesh=null,this._onEffectCreatedObservable.notifyObservers(bW)),x.isReady()?i&&i(this):x.onCompileObservable.add((function(){i&&i(l)}))},i.prototype.buildUniformLayout=function(){var i=this._uniformBuffer;i.addUniform("vAlbedoInfos",2),i.addUniform("vAmbientInfos",4),i.addUniform("vOpacityInfos",2),i.addUniform("vEmissiveInfos",2),i.addUniform("vLightmapInfos",2),i.addUniform("vReflectivityInfos",3),i.addUniform("vMicroSurfaceSamplerInfos",2),i.addUniform("vReflectionInfos",2),i.addUniform("vReflectionFilteringInfo",2),i.addUniform("vReflectionPosition",3),i.addUniform("vReflectionSize",3),i.addUniform("vBumpInfos",3),i.addUniform("albedoMatrix",16),i.addUniform("ambientMatrix",16),i.addUniform("opacityMatrix",16),i.addUniform("emissiveMatrix",16),i.addUniform("lightmapMatrix",16),i.addUniform("reflectivityMatrix",16),i.addUniform("microSurfaceSamplerMatrix",16),i.addUniform("bumpMatrix",16),i.addUniform("vTangentSpaceParams",2),i.addUniform("reflectionMatrix",16),i.addUniform("vReflectionColor",3),i.addUniform("vAlbedoColor",4),i.addUniform("vLightingIntensity",4),i.addUniform("vReflectionMicrosurfaceInfos",3),i.addUniform("pointSize",1),i.addUniform("vReflectivityColor",4),i.addUniform("vEmissiveColor",3),i.addUniform("vAmbientColor",3),i.addUniform("vDebugMode",2),i.addUniform("vMetallicReflectanceFactors",4),i.addUniform("vMetallicReflectanceInfos",2),i.addUniform("metallicReflectanceMatrix",16),i.addUniform("vReflectanceInfos",2),i.addUniform("reflectanceMatrix",16),i.addUniform("vSphericalL00",3),i.addUniform("vSphericalL1_1",3),i.addUniform("vSphericalL10",3),i.addUniform("vSphericalL11",3),i.addUniform("vSphericalL2_2",3),i.addUniform("vSphericalL2_1",3),i.addUniform("vSphericalL20",3),i.addUniform("vSphericalL21",3),i.addUniform("vSphericalL22",3),i.addUniform("vSphericalX",3),i.addUniform("vSphericalY",3),i.addUniform("vSphericalZ",3),i.addUniform("vSphericalXX_ZZ",3),i.addUniform("vSphericalYY_ZZ",3),i.addUniform("vSphericalZZ",3),i.addUniform("vSphericalXY",3),i.addUniform("vSphericalYZ",3),i.addUniform("vSphericalZX",3),W.prototype.buildUniformLayout.call(this)},i.prototype.bindForSubMesh=function(W,i,L){var h,l,t,p,x=this.getScene(),z=L.materialDefines;if(z){var r=L.effect;if(r){this._activeEffect=r,i.getMeshUniformBuffer().bindToEffect(r,"Mesh"),i.transferToEffect(W);var N=x.getEngine();this._uniformBuffer.bindToEffect(r,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,x,i,W,this.isFrozen),this._eventInfo.subMesh=L,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),z.OBJECTSPACE_NORMALMAP&&(W.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var I=this._mustRebind(x,r,i.visibility);a.e.BindBonesParameters(i,this._activeEffect,this.prePassConfiguration);var s=null,o=this._uniformBuffer;if(I){if(this.bindViewProjection(r),s=this._getReflectionTexture(),!o.useUbo||!this.isFrozen||!o.isSync){if(x.texturesEnabled){if(this._albedoTexture&&y.d.DiffuseTextureEnabled&&(o.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),a.e.BindTextureMatrix(this._albedoTexture,o,"albedo")),this._ambientTexture&&y.d.AmbientTextureEnabled&&(o.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),a.e.BindTextureMatrix(this._ambientTexture,o,"ambient")),this._opacityTexture&&y.d.OpacityTextureEnabled&&(o.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),a.e.BindTextureMatrix(this._opacityTexture,o,"opacity")),s&&y.d.ReflectionTextureEnabled){if(o.updateMatrix("reflectionMatrix",s.getReflectionTextureMatrix()),o.updateFloat2("vReflectionInfos",s.level,0),s.boundingBoxSize){var D=s;o.updateVector3("vReflectionPosition",D.boundingBoxPosition),o.updateVector3("vReflectionSize",D.boundingBoxSize)}if(this.realTimeFiltering){var e=s.getSize().width;o.updateFloat2("vReflectionFilteringInfo",e,C.d.Log2(e))}if(!z.USEIRRADIANCEMAP){var V=s.sphericalPolynomial;if(z.USESPHERICALFROMREFLECTIONMAP&&V)if(z.SPHERICAL_HARMONICS){var c=V.preScaledHarmonics;o.updateVector3("vSphericalL00",c.l00),o.updateVector3("vSphericalL1_1",c.l1_1),o.updateVector3("vSphericalL10",c.l10),o.updateVector3("vSphericalL11",c.l11),o.updateVector3("vSphericalL2_2",c.l2_2),o.updateVector3("vSphericalL2_1",c.l2_1),o.updateVector3("vSphericalL20",c.l20),o.updateVector3("vSphericalL21",c.l21),o.updateVector3("vSphericalL22",c.l22)}else o.updateFloat3("vSphericalX",V.x.x,V.x.y,V.x.z),o.updateFloat3("vSphericalY",V.y.x,V.y.y,V.y.z),o.updateFloat3("vSphericalZ",V.z.x,V.z.y,V.z.z),o.updateFloat3("vSphericalXX_ZZ",V.xx.x-V.zz.x,V.xx.y-V.zz.y,V.xx.z-V.zz.z),o.updateFloat3("vSphericalYY_ZZ",V.yy.x-V.zz.x,V.yy.y-V.zz.y,V.yy.z-V.zz.z),o.updateFloat3("vSphericalZZ",V.zz.x,V.zz.y,V.zz.z),o.updateFloat3("vSphericalXY",V.xy.x,V.xy.y,V.xy.z),o.updateFloat3("vSphericalYZ",V.yz.x,V.yz.y,V.yz.z),o.updateFloat3("vSphericalZX",V.zx.x,V.zx.y,V.zx.z)}o.updateFloat3("vReflectionMicrosurfaceInfos",s.getSize().width,s.lodGenerationScale,s.lodGenerationOffset)}this._emissiveTexture&&y.d.EmissiveTextureEnabled&&(o.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),a.e.BindTextureMatrix(this._emissiveTexture,o,"emissive")),this._lightmapTexture&&y.d.LightmapTextureEnabled&&(o.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),a.e.BindTextureMatrix(this._lightmapTexture,o,"lightmap")),y.d.SpecularTextureEnabled&&(this._metallicTexture?(o.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),a.e.BindTextureMatrix(this._metallicTexture,o,"reflectivity")):this._reflectivityTexture&&(o.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),a.e.BindTextureMatrix(this._reflectivityTexture,o,"reflectivity")),this._metallicReflectanceTexture&&(o.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),a.e.BindTextureMatrix(this._metallicReflectanceTexture,o,"metallicReflectance")),this._reflectanceTexture&&z.REFLECTANCE&&(o.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),a.e.BindTextureMatrix(this._reflectanceTexture,o,"reflectance")),this._microSurfaceTexture&&(o.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),a.e.BindTextureMatrix(this._microSurfaceTexture,o,"microSurfaceSampler"))),this._bumpTexture&&N.getCaps().standardDerivatives&&y.d.BumpTextureEnabled&&!this._disableBumpMap&&(o.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),a.e.BindTextureMatrix(this._bumpTexture,o,"bump"),x._mirroredCameraPosition?o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&o.updateFloat("pointSize",this.pointSize),z.METALLICWORKFLOW){S.i.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,S.i.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,o.updateColor4("vReflectivityColor",S.i.Color3[0],1);var f=null!==(l=null===(h=this.subSurface)||void 0===h?void 0:h._indexOfRefraction)&&void 0!==l?l:1.5,P=Math.pow((f-1)/(f+1),2);this._metallicReflectanceColor.scaleToRef(P*this._metallicF0Factor,S.i.Color3[0]);var M=this._metallicF0Factor;o.updateColor4("vMetallicReflectanceFactors",S.i.Color3[0],M)}else o.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);o.updateColor3("vEmissiveColor",y.d.EmissiveTextureEnabled?this._emissiveColor:S.d.BlackReadOnly),o.updateColor3("vReflectionColor",this._reflectionColor),!z.SS_REFRACTION&&(null===(t=this.subSurface)||void 0===t?void 0:t._linkRefractionWithTransparency)?o.updateColor4("vAlbedoColor",this._albedoColor,1):o.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*x.environmentIntensity,this._lightingInfos.w=this._specularIntensity,o.updateVector4("vLightingIntensity",this._lightingInfos),x.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),o.updateColor3("vAmbientColor",this._globalAmbientColor),o.updateFloat2("vDebugMode",this._debugLimit,this._debugFactor)}x.texturesEnabled&&(this._albedoTexture&&y.d.DiffuseTextureEnabled&&o.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&y.d.AmbientTextureEnabled&&o.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&y.d.OpacityTextureEnabled&&o.setTexture("opacitySampler",this._opacityTexture),s&&y.d.ReflectionTextureEnabled&&(z.LODBASEDMICROSFURACE?o.setTexture("reflectionSampler",s):(o.setTexture("reflectionSampler",s._lodTextureMid||s),o.setTexture("reflectionSamplerLow",s._lodTextureLow||s),o.setTexture("reflectionSamplerHigh",s._lodTextureHigh||s)),z.USEIRRADIANCEMAP&&o.setTexture("irradianceSampler",s.irradianceTexture)),z.ENVIRONMENTBRDF&&o.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&y.d.EmissiveTextureEnabled&&o.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&y.d.LightmapTextureEnabled&&o.setTexture("lightmapSampler",this._lightmapTexture),y.d.SpecularTextureEnabled&&(this._metallicTexture?o.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&o.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&o.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&z.REFLECTANCE&&o.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&o.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&N.getCaps().standardDerivatives&&y.d.BumpTextureEnabled&&!this._disableBumpMap&&o.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(i)&&this.getScene().depthPeelingRenderer.bind(r),this._eventInfo.subMesh=L,this._callbackPluginEventBindForSubMesh(this._eventInfo),a.e.BindClipPlane(this._activeEffect,x),this.bindEyePosition(r)}else x.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!I&&this.isFrozen||(x.lightsEnabled&&!this._disableLighting&&a.e.BindLights(x,i,this._activeEffect,z,this._maxSimultaneousLights),(x.fogEnabled&&i.applyFog&&x.fogMode!==R.b.FOGMODE_NONE||s||i.receiveShadows||z.PREPASS)&&this.bindView(r),a.e.BindFogParameters(x,i,this._activeEffect,!0),z.NUM_MORPH_INFLUENCERS&&a.e.BindMorphTargetParameters(i,this._activeEffect),z.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(p=i.bakedVertexAnimationManager)||void 0===p||p.bind(r,z.INSTANCES)),this._imageProcessingConfiguration.bind(this._activeEffect),a.e.BindLogDepth(z,this._activeEffect,x)),this._afterBind(i,this._activeEffect),o.update()}}},i.prototype.getAnimatables=function(){var i=W.prototype.getAnimatables.call(this);return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&i.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&i.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&i.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&i.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&i.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?i.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&i.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&i.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&i.push(this._lightmapTexture),i},i.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},i.prototype.getActiveTextures=function(){var i=W.prototype.getActiveTextures.call(this);return this._albedoTexture&&i.push(this._albedoTexture),this._ambientTexture&&i.push(this._ambientTexture),this._opacityTexture&&i.push(this._opacityTexture),this._reflectionTexture&&i.push(this._reflectionTexture),this._emissiveTexture&&i.push(this._emissiveTexture),this._reflectivityTexture&&i.push(this._reflectivityTexture),this._metallicTexture&&i.push(this._metallicTexture),this._metallicReflectanceTexture&&i.push(this._metallicReflectanceTexture),this._reflectanceTexture&&i.push(this._reflectanceTexture),this._microSurfaceTexture&&i.push(this._microSurfaceTexture),this._bumpTexture&&i.push(this._bumpTexture),this._lightmapTexture&&i.push(this._lightmapTexture),i},i.prototype.hasTexture=function(i){return!!W.prototype.hasTexture.call(this,i)||(this._albedoTexture===i||(this._ambientTexture===i||(this._opacityTexture===i||(this._reflectionTexture===i||(this._reflectivityTexture===i||(this._metallicTexture===i||(this._metallicReflectanceTexture===i||(this._reflectanceTexture===i||(this._microSurfaceTexture===i||(this._bumpTexture===i||this._lightmapTexture===i))))))))))},i.prototype.setPrePassRenderer=function(){var W;if(null===(W=this.subSurface)||void 0===W?void 0:W.isScatteringEnabled){var i=this.getScene().enableSubSurfaceForPrePass();return i&&(i.enabled=!0),!0}return!1},i.prototype.dispose=function(i,L){var h,l,t,p,x,R,z,r,N,I,s,o;L&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(h=this._albedoTexture)||void 0===h||h.dispose(),null===(l=this._ambientTexture)||void 0===l||l.dispose(),null===(t=this._opacityTexture)||void 0===t||t.dispose(),null===(p=this._reflectionTexture)||void 0===p||p.dispose(),null===(x=this._emissiveTexture)||void 0===x||x.dispose(),null===(R=this._metallicTexture)||void 0===R||R.dispose(),null===(z=this._reflectivityTexture)||void 0===z||z.dispose(),null===(r=this._bumpTexture)||void 0===r||r.dispose(),null===(N=this._lightmapTexture)||void 0===N||N.dispose(),null===(I=this._metallicReflectanceTexture)||void 0===I||I.dispose(),null===(s=this._reflectanceTexture)||void 0===s||s.dispose(),null===(o=this._microSurfaceTexture)||void 0===o||o.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),W.prototype.dispose.call(this,i,L)},i.PBRMATERIAL_OPAQUE=V.b.MATERIAL_OPAQUE,i.PBRMATERIAL_ALPHATEST=V.b.MATERIAL_ALPHATEST,i.PBRMATERIAL_ALPHABLEND=V.b.MATERIAL_ALPHABLEND,i.PBRMATERIAL_ALPHATESTANDBLEND=V.b.MATERIAL_ALPHATESTANDBLEND,i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,i.LIGHTFALLOFF_PHYSICAL=0,i.LIGHTFALLOFF_GLTF=1,i.LIGHTFALLOFF_STANDARD=2,(0,h.j)([(0,l.u)()],i.prototype,"_imageProcessingConfiguration",void 0),(0,h.j)([(0,l.g)("_markAllSubMeshesAsMiscDirty")],i.prototype,"debugMode",void 0),(0,h.j)([(0,l.H)()],i.prototype,"useLogarithmicDepth",null),i}(f.d)},28689:function(W,i,L){"use strict";var h=L(80105),l=L(96658),t=L(37094),p=L(61686),x=L(9488),R=function(W,i,L,h){this.name=W,this.worldAxisForNormal=i,this.worldAxisForFileX=L,this.worldAxisForFileY=h},z=function(){function W(){}return W.ConvertCubeMapTextureToSphericalPolynomial=function(W){var i,L=this;if(!W.isCube)return null;null===(i=W.getScene())||void 0===i||i.getEngine().flushFramebuffer();var h,l,t=W.getSize().width,p=W.readPixels(0,void 0,void 0,!1),x=W.readPixels(1,void 0,void 0,!1);W.isRenderTarget?(h=W.readPixels(3,void 0,void 0,!1),l=W.readPixels(2,void 0,void 0,!1)):(h=W.readPixels(2,void 0,void 0,!1),l=W.readPixels(3,void 0,void 0,!1));var R=W.readPixels(4,void 0,void 0,!1),z=W.readPixels(5,void 0,void 0,!1),r=W.gammaSpace,N=0;return 1!=W.textureType&&2!=W.textureType||(N=1),new Promise((function(W){Promise.all([x,p,h,l,R,z]).then((function(i){var h=i[0],l=i[1],p=i[2],x=i[3],R=i[4],z=i[5],I={size:t,right:l,left:h,up:p,down:x,front:R,back:z,format:5,type:N,gammaSpace:r};W(L.ConvertCubeMapToSphericalPolynomial(I))}))}))},W._AreaElement=function(W,i){return Math.atan2(W*i,Math.sqrt(W*W+i*i+1))},W.ConvertCubeMapToSphericalPolynomial=function(W){for(var i=new t.e,L=0,h=2/W.size,R=h,z=.5*h,r=z-1,N=0;N<6;N++)for(var I=this._FileFaces[N],s=W[I.name],o=r,D=5===W.format?4:3,S=0;S<W.size;S++){for(var C=r,e=0;e<W.size;e++){var V=I.worldAxisForFileX.scale(C).add(I.worldAxisForFileY.scale(o)).add(I.worldAxisForNormal);V.normalize();var c=this._AreaElement(C-z,o-z)-this._AreaElement(C-z,o+z)-this._AreaElement(C+z,o-z)+this._AreaElement(C+z,o+z),f=s[S*W.size*D+e*D+0],a=s[S*W.size*D+e*D+1],P=s[S*W.size*D+e*D+2];isNaN(f)&&(f=0),isNaN(a)&&(a=0),isNaN(P)&&(P=0),0===W.type&&(f/=255,a/=255,P/=255),W.gammaSpace&&(f=Math.pow(l.d.Clamp(f),p.j),a=Math.pow(l.d.Clamp(a),p.j),P=Math.pow(l.d.Clamp(P),p.j));var y=4096;f=l.d.Clamp(f,0,y),a=l.d.Clamp(a,0,y),P=l.d.Clamp(P,0,y);var M=new x.d(f,a,P);i.addLight(V,M,c),L+=c,C+=h}o+=R}var b=6*(4*Math.PI)/6/L;return i.scaleInPlace(b),i.convertIncidentRadianceToIrradiance(),i.convertIrradianceToLambertianRadiance(),t.f.FromHarmonics(i)},W._FileFaces=[new R("right",new h.m(1,0,0),new h.m(0,0,-1),new h.m(0,-1,0)),new R("left",new h.m(-1,0,0),new h.m(0,0,1),new h.m(0,-1,0)),new R("up",new h.m(0,1,0),new h.m(1,0,0),new h.m(0,0,1)),new R("down",new h.m(0,-1,0),new h.m(1,0,0),new h.m(0,0,-1)),new R("front",new h.m(0,0,1),new h.m(1,0,0),new h.m(0,-1,0)),new R("back",new h.m(0,0,-1),new h.m(-1,0,0),new h.m(0,-1,0))],W}(),r=L(76384);r.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(r.d.prototype,"sphericalPolynomial",{get:function(){var W=this;if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=z.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((function(i){W._texture._sphericalPolynomial=i,W._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(W){this._texture&&(this._texture._sphericalPolynomial=W)},enumerable:!0,configurable:!0})},16708:function(W,i,L){"use strict";L.d(i,{e:function(){return S}});var h=L(40061),l=L(9892),t=L(9217),p=L(80105),x=L(76384),R=L(70937),z=L(31709),r=L(72284),N=L(60766),I=L(9127),s=L(82790),o=L(28372);r.e.prototype._createDepthStencilCubeTexture=function(W,i,L){var l=new N.e(this,N.b.DepthStencil);if(l.isCube=!0,1===this.webGLVersion)return I.e.Error("Depth cube texture is not supported by WebGL 1."),l;var t=(0,h.d)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},i),p=this._gl;this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,l,!0),this._setupDepthStencilTexture(l,W,t.generateStencil,t.bilinearFiltering,t.comparisonFunction),L._depthStencilTexture=l,L._depthStencilTextureWithStencil=t.generateStencil;for(var x=0;x<6;x++)t.generateStencil?p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,p.DEPTH24_STENCIL8,W,W,0,p.DEPTH_STENCIL,p.UNSIGNED_INT_24_8,null):p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,p.DEPTH_COMPONENT24,W,W,0,p.DEPTH_COMPONENT,p.UNSIGNED_INT,null);return this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(l),l},r.e.prototype._partialLoadFile=function(W,i,L,h,l){void 0===l&&(l=null);this._loadFile(W,(function(W){L[i]=W,L._internalCount++,6===L._internalCount&&h(L)}),void 0,void 0,!0,(function(W,i){l&&W&&l(W.status+" "+W.statusText,i)}))},r.e.prototype._cascadeLoadFiles=function(W,i,L,h){void 0===h&&(h=null);var l=[];l._internalCount=0;for(var t=0;t<6;t++)this._partialLoadFile(L[t],t,l,i,h)},r.e.prototype._cascadeLoadImgs=function(W,i,L,h,l,t){void 0===l&&(l=null);var p=[];p._internalCount=0;for(var x=0;x<6;x++)this._partialLoadImg(h[x],x,p,W,i,L,l,t)},r.e.prototype._partialLoadImg=function(W,i,L,h,l,t,p,x){void 0===p&&(p=null);var R=(0,o.e)();(0,s.p)(W,(function(W){L[i]=W,L._internalCount++,h&&h._removePendingData(R),6===L._internalCount&&t&&t(l,L)}),(function(W,i){h&&h._removePendingData(R),p&&p(W,i)}),h?h.offlineProvider:null,x),h&&h._addPendingData(R)},r.e.prototype._setCubeMapTextureParams=function(W,i,L){var h=this._gl;h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,i?h.LINEAR_MIPMAP_LINEAR:h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),W.samplingMode=i?3:2,i&&this.getCaps().textureMaxLevel&&void 0!==L&&L>0&&(h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAX_LEVEL,L),W._maxLodLevel=L),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null)},r.e.prototype.createCubeTextureBase=function(W,i,L,h,l,t,p,x,R,z,s,o,D,S,C){var e=this;void 0===l&&(l=null),void 0===t&&(t=null),void 0===x&&(x=null),void 0===R&&(R=!1),void 0===z&&(z=0),void 0===s&&(s=0),void 0===o&&(o=null),void 0===D&&(D=null),void 0===S&&(S=null),void 0===C&&(C=!1);var V=o||new N.e(this,N.b.Cube);V.isCube=!0,V.url=W,V.generateMipMaps=!h,V._lodGenerationScale=z,V._lodGenerationOffset=s,V._useSRGBBuffer=!!C&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||!!h),this._doNotHandleContextLost||(V._extension=x,V._files=L);var c=W;this._transformTextureUrl&&!o&&(W=this._transformTextureUrl(W));for(var f=W.lastIndexOf("."),a=x||(f>-1?W.substring(f).toLowerCase():""),P=null,y=0,M=r.e._TextureLoaders;y<M.length;y++){var b=M[y];if(b.canLoad(a)){P=b;break}}if(P){var j=function(W){D&&D(V,W),P.loadCubeData(W,V,R,l,t)};L&&6===L.length?P.supportCascades?this._cascadeLoadFiles(i,(function(W){return j(W.map((function(W){return new Uint8Array(W)})))}),L,t):t?t("Textures type does not support cascades."):I.e.Warn("Texture loader does not support cascades."):this._loadFile(W,(function(W){return j(new Uint8Array(W))}),void 0,void 0,!0,(function(r,N){W===c?t&&r&&t(r.status+" "+r.statusText,N):(I.e.Warn("Failed to load ".concat(W,", falling back to the ").concat(c)),e.createCubeTextureBase(c,i,L,!!h,l,t,p,x,R,z,s,V,D,S,C))}))}else{if(!L)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(i,V,(function(W,i){S&&S(W,i)}),L,t)}return this._internalTexturesCache.push(V),V},r.e.prototype.createCubeTexture=function(W,i,L,h,l,t,p,x,R,z,N,s,o,D){var S=this;void 0===l&&(l=null),void 0===t&&(t=null),void 0===x&&(x=null),void 0===R&&(R=!1),void 0===z&&(z=0),void 0===N&&(N=0),void 0===s&&(s=null),void 0===D&&(D=!1);var C=this._gl;return this.createCubeTextureBase(W,i,L,!!h,l,t,p,x,R,z,N,s,(function(W){return S._bindTextureDirectly(C.TEXTURE_CUBE_MAP,W,!0)}),(function(W,i){var L=S.needPOTTextures?r.e.GetExponentOfTwo(i[0].width,S._caps.maxCubemapTextureSize):i[0].width,t=L,x=[C.TEXTURE_CUBE_MAP_POSITIVE_X,C.TEXTURE_CUBE_MAP_POSITIVE_Y,C.TEXTURE_CUBE_MAP_POSITIVE_Z,C.TEXTURE_CUBE_MAP_NEGATIVE_X,C.TEXTURE_CUBE_MAP_NEGATIVE_Y,C.TEXTURE_CUBE_MAP_NEGATIVE_Z];S._bindTextureDirectly(C.TEXTURE_CUBE_MAP,W,!0),S._unpackFlipY(!1);var R=p?S._getInternalFormat(p,W._useSRGBBuffer):W._useSRGBBuffer?C.SRGB8_ALPHA8:C.RGBA,z=p?S._getInternalFormat(p):C.RGBA;W._useSRGBBuffer&&1===S.webGLVersion&&(z=R);for(var N=0;N<x.length;N++)if(i[N].width!==L||i[N].height!==t){if(S._prepareWorkingCanvas(),!S._workingCanvas||!S._workingContext)return void I.e.Warn("Cannot create canvas to resize texture.");S._workingCanvas.width=L,S._workingCanvas.height=t,S._workingContext.drawImage(i[N],0,0,i[N].width,i[N].height,0,0,L,t),C.texImage2D(x[N],0,R,z,C.UNSIGNED_BYTE,S._workingCanvas)}else C.texImage2D(x[N],0,R,z,C.UNSIGNED_BYTE,i[N]);h||C.generateMipmap(C.TEXTURE_CUBE_MAP),S._setCubeMapTextureParams(W,!h),W.width=L,W.height=t,W.isReady=!0,p&&(W.format=p),W.onLoadedObservable.notifyObservers(W),W.onLoadedObservable.clear(),l&&l()}),!!D)};var D=L(9271),S=function(W){function i(i,L,h,l,t,x,z,r,N,I,s,o,S,C,e){void 0===h&&(h=null),void 0===l&&(l=!1),void 0===t&&(t=null),void 0===x&&(x=null),void 0===z&&(z=null),void 0===r&&(r=5),void 0===N&&(N=!1),void 0===I&&(I=null),void 0===s&&(s=!1),void 0===o&&(o=.8),void 0===S&&(S=0);var V,c=this;return(c=W.call(this,L)||this)._lodScale=.8,c._lodOffset=0,c.onLoadObservable=new D.c,c.boundingBoxPosition=p.m.Zero(),c._rotationY=0,c._files=null,c._forcedExtension=null,c._extensions=null,c.name=i,c.url=i,c._noMipmap=l,c.hasAlpha=!1,c._format=r,c.isCube=!0,c._textureMatrix=p.d.Identity(),c._createPolynomials=s,c.coordinatesMode=R.e.CUBIC_MODE,c._extensions=h,c._files=t,c._forcedExtension=I,c._loaderOptions=C,c._useSRGBBuffer=e,c._lodScale=o,c._lodOffset=S,i||t?(c.updateURL(i,I,x,N,z,h,null===(V=c.getScene())||void 0===V?void 0:V.useDelayedTextureLoading,t),c):c}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(W){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(W)){this._boundingBoxSize=W;var i=this.getScene();i&&i.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rotationY},set:function(W){this._rotationY=W,this.setReflectionTextureMatrix(p.d.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"forcedExtension",{get:function(){return this._forcedExtension},enumerable:!1,configurable:!0}),i.CreateFromImages=function(W,L,h){var l="";return W.forEach((function(W){return l+=W})),new i(l,L,null,h,W)},i.CreateFromPrefilteredData=function(W,L,h,l){void 0===h&&(h=null),void 0===l&&(l=!0);var t=L.useDelayedTextureLoading;L.useDelayedTextureLoading=!1;var p=new i(W,L,null,!1,null,null,null,void 0,!0,h,l);return L.useDelayedTextureLoading=t,p},i.prototype.getClassName=function(){return"CubeTexture"},i.prototype.updateURL=function(W,i,L,h,l,t,p,x){void 0===L&&(L=null),void 0===h&&(h=!1),void 0===l&&(l=null),void 0===t&&(t=null),void 0===p&&(p=!1),void 0===x&&(x=null),this.name&&!this.name.startsWith("data:")||(this.name=W),this.url=W,i&&(this._forcedExtension=i);var R=W.lastIndexOf("."),z=i||(R>-1?W.substring(R).toLowerCase():""),r=0===z.indexOf(".dds"),N=0===z.indexOf(".env");if(N?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=h,h&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),x)this._files=x;else if(N||r||t||(t=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,t){for(var I=0;I<t.length;I++)this._files.push(W+t[I]);this._extensions=t}p?(this.delayLoadState=4,this._delayedOnLoad=L,this._delayedOnError=l):this._loadTexture(L,l)},i.prototype.delayLoad=function(W){4===this.delayLoadState&&(W&&(this._forcedExtension=W),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i.prototype.setReflectionTextureMatrix=function(W){var i,L=this;W.updateFlag!==this._textureMatrix.updateFlag&&(W.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(i=this.getScene())||void 0===i||i.markAllMaterialsAsDirty(1,(function(W){return-1!==W.getActiveTextures().indexOf(L)}))),this._textureMatrix=W)},i.prototype._loadTexture=function(W,i){var L,h=this;void 0===W&&(W=null),void 0===i&&(i=null);var l=this.getScene(),p=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);var x=function(){var i;h.onLoadObservable.notifyObservers(h),p&&(p.dispose(),null===(i=h.getScene())||void 0===i||i.markAllMaterialsAsDirty(1)),W&&W()},z=function(W,L){h._loadingError=!0,h._errorObject={message:W,exception:L},i&&i(W,L),R.e.OnTextureLoadErrorObservable.notifyObservers(h)};this._texture?this._texture.isReady?t.h.SetImmediate((function(){return x()})):this._texture.onLoadedObservable.add((function(){return x()})):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,l,this._lodScale,this._lodOffset,W,z,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,l,this._files,this._noMipmap,W,z,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer),null===(L=this._texture)||void 0===L||L.onLoadedObservable.add((function(){return h.onLoadObservable.notifyObservers(h)})))},i.Parse=function(W,L,h){var t=l.d.Parse((function(){var l=!1;return W.prefiltered&&(l=W.prefiltered),new i(h+W.name,L,W.extensions,!1,W.files||null,null,null,void 0,l,W.forcedExtension)}),W,L);if(W.boundingBoxPosition&&(t.boundingBoxPosition=p.m.FromArray(W.boundingBoxPosition)),W.boundingBoxSize&&(t.boundingBoxSize=p.m.FromArray(W.boundingBoxSize)),W.animations)for(var x=0;x<W.animations.length;x++){var R=W.animations[x],r=(0,z.b)("BABYLON.Animation");r&&t.animations.push(r.Parse(R))}return t},i.prototype.clone=function(){var W=this,L=0,h=l.d.Clone((function(){var h=new i(W.url,W.getScene()||W._getEngine(),W._extensions,W._noMipmap,W._files);return L=h.uniqueId,h}),this);return h.uniqueId=L,h},(0,h.j)([(0,l.H)()],i.prototype,"url",void 0),(0,h.j)([(0,l.H)("rotationY")],i.prototype,"rotationY",null),(0,h.j)([(0,l.H)("files")],i.prototype,"_files",void 0),(0,h.j)([(0,l.H)("forcedExtension")],i.prototype,"_forcedExtension",void 0),(0,h.j)([(0,l.H)("extensions")],i.prototype,"_extensions",void 0),(0,h.j)([(0,l.v)("textureMatrix")],i.prototype,"_textureMatrix",void 0),i}(x.d);R.e._CubeTextureParser=S.Parse,(0,z.c)("BABYLON.CubeTexture",S)},90673:function(W,i,L){"use strict";L.d(i,{d:function(){return R}});var h=L(40061),l=L(9127),t=L(70937),p=L(72284),x=L(60766);p.e.prototype.createDynamicTexture=function(W,i,L,h){var l=new x.e(this,x.b.Dynamic);return l.baseWidth=W,l.baseHeight=i,L&&(W=this.needPOTTextures?p.e.GetExponentOfTwo(W,this._caps.maxTextureSize):W,i=this.needPOTTextures?p.e.GetExponentOfTwo(i,this._caps.maxTextureSize):i),l.width=W,l.height=i,l.isReady=!1,l.generateMipMaps=L,l.samplingMode=h,this.updateTextureSamplingMode(h,l),this._internalTexturesCache.push(l),l},p.e.prototype.updateDynamicTexture=function(W,i,L,h,l,t,p){if(void 0===h&&(h=!1),void 0===t&&(t=!1),void 0===p&&(p=!1),W){var x=this._gl,R=x.TEXTURE_2D,z=this._bindTextureDirectly(R,W,!0,t);this._unpackFlipY(void 0===L?W.invertY:L),h&&x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var r=this._getWebGLTextureType(W.type),N=this._getInternalFormat(l||W.format),I=this._getRGBABufferInternalSizedFormat(W.type,N);x.texImage2D(R,0,I,N,r,i),W.generateMipMaps&&x.generateMipmap(R),z||this._bindTextureDirectly(R,null),h&&x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),W.isReady=!0}};var R=function(W){function i(i,L,h,l,p,x,R){void 0===h&&(h=null),void 0===l&&(l=!1),void 0===p&&(p=3),void 0===x&&(x=5);var z=W.call(this,null,h,!l,R,p,void 0,void 0,void 0,void 0,x)||this;z.name=i,z.wrapU=t.e.CLAMP_ADDRESSMODE,z.wrapV=t.e.CLAMP_ADDRESSMODE,z._generateMipMaps=l;var r=z._getEngine();if(!r)return z;L.getContext?(z._canvas=L,z._texture=r.createDynamicTexture(L.width,L.height,l,p)):(z._canvas=r.createCanvas(1,1),L.width||0===L.width?z._texture=r.createDynamicTexture(L.width,L.height,l,p):z._texture=r.createDynamicTexture(L,L,l,p));var N=z.getSize();return z._canvas.width!==N.width&&(z._canvas.width=N.width),z._canvas.height!==N.height&&(z._canvas.height=N.height),z._context=z._canvas.getContext("2d"),z}return(0,h.n)(i,W),i.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(i.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype._recreate=function(W){this._canvas.width=W.width,this._canvas.height=W.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(W.width,W.height,this._generateMipMaps,this.samplingMode)},i.prototype.scale=function(W){var i=this.getSize();i.width*=W,i.height*=W,this._recreate(i)},i.prototype.scaleTo=function(W,i){var L=this.getSize();L.width=W,L.height=i,this._recreate(L)},i.prototype.getContext=function(){return this._context},i.prototype.clear=function(){var W=this.getSize();this._context.fillRect(0,0,W.width,W.height)},i.prototype.update=function(W,i,L){void 0===i&&(i=!1),void 0===L&&(L=!1),this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===W||W,i,this._format||void 0,void 0,L)},i.prototype.drawText=function(W,i,L,h,l,t,p,x){void 0===x&&(x=!0);var R=this.getSize();if(t&&(this._context.fillStyle=t,this._context.fillRect(0,0,R.width,R.height)),this._context.font=h,null===i||void 0===i){var z=this._context.measureText(W);i=(R.width-z.width)/2}if(null===L||void 0===L){var r=parseInt(h.replace(/\D/g,""));L=R.height/2+r/3.65}this._context.fillStyle=l||"",this._context.fillText(W,i,L),x&&this.update(p)},i.prototype.clone=function(){var W=this.getScene();if(!W)return this;var L=this.getSize(),h=new i(this.name,L,W,this._generateMipMaps);return h.hasAlpha=this.hasAlpha,h.level=this.level,h.wrapU=this.wrapU,h.wrapV=this.wrapV,h},i.prototype.serialize=function(){var L=this.getScene();L&&!L.isReady()&&l.e.Warn("The scene must be ready before serializing the dynamic texture");var h=W.prototype.serialize.call(this);return i._IsCanvasElement(this._canvas)&&(h.base64String=this._canvas.toDataURL()),h.invertY=this._invertY,h.samplingMode=this.samplingMode,h},i._IsCanvasElement=function(W){return void 0!==W.toDataURL},i.prototype._rebuild=function(){this.update()},i}(t.e)},15099:function(W,i,L){"use strict";L.d(i,{b:function(){return t}});var h=L(40061),l=L(70937),t=(L(36125),function(W){function i(i,L,h,t,p,x,R,z,r,N,I){void 0===x&&(x=!0),void 0===R&&(R=!1),void 0===z&&(z=3),void 0===r&&(r=0);var s=W.call(this,null,p,!x,R,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,N)||this;return s.format=t,s._engine?(s._engine._caps.textureFloatLinearFiltering||1!==r||(z=1),s._engine._caps.textureHalfFloatLinearFiltering||2!==r||(z=1),s._texture=s._engine.createRawTexture(i,L,h,t,x,R,z,null,r,null!==N&&void 0!==N?N:0,null!==I&&void 0!==I&&I),s.wrapU=l.e.CLAMP_ADDRESSMODE,s.wrapV=l.e.CLAMP_ADDRESSMODE,s):s}return(0,h.n)(i,W),i.prototype.update=function(W){this._getEngine().updateRawTexture(this._texture,W,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)},i.CreateLuminanceTexture=function(W,L,h,l,t,p,x){return void 0===t&&(t=!0),void 0===p&&(p=!1),void 0===x&&(x=3),new i(W,L,h,1,l,t,p,x)},i.CreateLuminanceAlphaTexture=function(W,L,h,l,t,p,x){return void 0===t&&(t=!0),void 0===p&&(p=!1),void 0===x&&(x=3),new i(W,L,h,2,l,t,p,x)},i.CreateAlphaTexture=function(W,L,h,l,t,p,x){return void 0===t&&(t=!0),void 0===p&&(p=!1),void 0===x&&(x=3),new i(W,L,h,0,l,t,p,x)},i.CreateRGBTexture=function(W,L,h,l,t,p,x,R,z,r){return void 0===t&&(t=!0),void 0===p&&(p=!1),void 0===x&&(x=3),void 0===R&&(R=0),void 0===z&&(z=0),void 0===r&&(r=!1),new i(W,L,h,4,l,t,p,x,R,z,r)},i.CreateRGBATexture=function(W,L,h,l,t,p,x,R,z,r){return void 0===t&&(t=!0),void 0===p&&(p=!1),void 0===x&&(x=3),void 0===R&&(R=0),void 0===z&&(z=0),void 0===r&&(r=!1),new i(W,L,h,5,l,t,p,x,R,z,r)},i.CreateRGBAStorageTexture=function(W,L,h,l,t,p,x,R,z){return void 0===t&&(t=!0),void 0===p&&(p=!1),void 0===x&&(x=3),void 0===R&&(R=0),void 0===z&&(z=!1),new i(W,L,h,5,l,t,p,x,R,1,z)},i.CreateRTexture=function(W,L,h,t,p,x,R,z){return void 0===p&&(p=!0),void 0===x&&(x=!1),void 0===R&&(R=l.e.TRILINEAR_SAMPLINGMODE),void 0===z&&(z=1),new i(W,L,h,6,t,p,x,R,z)},i.CreateRStorageTexture=function(W,L,h,t,p,x,R,z){return void 0===p&&(p=!0),void 0===x&&(x=!1),void 0===R&&(R=l.e.TRILINEAR_SAMPLINGMODE),void 0===z&&(z=1),new i(W,L,h,6,t,p,x,R,z,1)},i}(l.e))},57194:function(W,i,L){"use strict";L.d(i,{d:function(){return t}});var h=L(40061),l=L(70937),t=(L(36125),function(W){function i(i,L,h,t,p,x,R,z,r,N){void 0===R&&(R=!0),void 0===z&&(z=!1),void 0===r&&(r=l.e.TRILINEAR_SAMPLINGMODE),void 0===N&&(N=0);var I=W.call(this,null,x,!R,z)||this;return I.format=p,I._texture=x.getEngine().createRawTexture2DArray(i,L,h,t,p,R,z,r,null,N),I._depth=t,I.is2DArray=!0,I}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"depth",{get:function(){return this._depth},enumerable:!1,configurable:!0}),i.prototype.update=function(W){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,W,this._texture.format,this._texture.invertY,null,this._texture.type)},i.CreateRGBATexture=function(W,L,h,l,t,p,x,R,z){return void 0===p&&(p=!0),void 0===x&&(x=!1),void 0===R&&(R=3),void 0===z&&(z=0),new i(W,L,h,l,5,t,p,x,R,z)},i}(l.e))},52128:function(W,i,L){"use strict";L.d(i,{b:function(){return N}});var h=L(40061),l=L(9271),t=L(9217),p=L(80105),x=L(70937),R=L(64833),z=L(16369),r=(L(84468),L(42373),L(90690)),N=function(W){function i(i,L,h,t,R,r,N,I,s,o,D,S,C,e,V,c,f){void 0===R&&(R=!0),void 0===r&&(r=0),void 0===N&&(N=!1),void 0===I&&(I=x.e.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=!0),void 0===o&&(o=!1),void 0===D&&(D=!1),void 0===S&&(S=5),void 0===C&&(C=!1),void 0===c&&(c=!1),void 0===f&&(f=!1);var a,P=this;if((P=W.call(this,null,h,!t,void 0,I,void 0,void 0,void 0,void 0,S)||this).renderParticles=!0,P.renderSprites=!1,P.ignoreCameraViewport=!1,P.onBeforeBindObservable=new l.c,P.onAfterUnbindObservable=new l.c,P.onBeforeRenderObservable=new l.c,P.onAfterRenderObservable=new l.c,P.onClearObservable=new l.c,P.onResizeObservable=new l.c,P._cleared=!1,P.skipInitialClear=!1,P._currentRefreshId=-1,P._refreshRate=1,P._samples=1,P._canRescale=!0,P._renderTarget=null,P.boundingBoxPosition=p.m.Zero(),!(h=P.getScene()))return P;var y=P.getScene().getEngine();return P._coordinatesMode=x.e.PROJECTION_MODE,P.renderList=new Array,P.name=i,P.isRenderTarget=!0,P._initialSizeParameter=L,P._renderPassIds=[],P._isCubeData=N,P._processSizeParameter(L),P.renderPassId=P._renderPassIds[0],P._resizeObserver=y.onResizeObservable.add((function(){})),P._generateMipMaps=!!t,P._doNotChangeAspectRatio=R,P._renderingManager=new z.b(h),P._renderingManager._useSceneAutoClearSetup=!0,D||(P._renderTargetOptions={generateMipMaps:t,type:r,format:null!==(a=P._format)&&void 0!==a?a:void 0,samplingMode:P.samplingMode,generateDepthBuffer:s,generateStencilBuffer:o,samples:e,creationFlags:V,noColorTarget:c,useSRGBBuffer:f},P.samplingMode===x.e.NEAREST_SAMPLINGMODE&&(P.wrapU=x.e.CLAMP_ADDRESSMODE,P.wrapV=x.e.CLAMP_ADDRESSMODE),C||(N?(P._renderTarget=h.getEngine().createRenderTargetCubeTexture(P.getRenderSize(),P._renderTargetOptions),P.coordinatesMode=x.e.INVCUBIC_MODE,P._textureMatrix=p.d.Identity()):P._renderTarget=h.getEngine().createRenderTargetTexture(P._size,P._renderTargetOptions),P._texture=P._renderTarget.texture,void 0!==e&&(P.samples=e))),P}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"renderList",{get:function(){return this._renderList},set:function(W){this._renderList=W,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),i.prototype._hookArray=function(W){var i=this,L=W.push;W.push=function(){for(var h,l=[],t=0;t<arguments.length;t++)l[t]=arguments[t];var p=0===W.length,x=L.apply(W,l);return p&&(null===(h=i.getScene())||void 0===h||h.meshes.forEach((function(W){W._markSubMeshesAsLightDirty()}))),x};var h=W.splice;W.splice=function(L,l){var t,p=h.apply(W,[L,l]);return 0===W.length&&(null===(t=i.getScene())||void 0===t||t.meshes.forEach((function(W){W._markSubMeshesAsLightDirty()}))),p}},Object.defineProperty(i.prototype,"postProcesses",{get:function(){return this._postProcesses},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_prePassEnabled",{get:function(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterUnbind",{set:function(W){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(W){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(W){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onClear",{set:function(W){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderPassIds",{get:function(){return this._renderPassIds},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentRefreshId",{get:function(){return this._currentRefreshId},enumerable:!1,configurable:!0}),i.prototype.setMaterialForRendering=function(W,i){var L;L=Array.isArray(W)?W:[W];for(var h=0;h<L.length;++h)for(var l=0;l<this._renderPassIds.length;++l)L[h].setMaterialForRenderPass(this._renderPassIds[l],void 0!==i?Array.isArray(i)?i[l]:i:void 0)},Object.defineProperty(i.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),i.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(i.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(W){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(W)){this._boundingBoxSize=W;var i=this.getScene();i&&i.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthStencilTexture",{get:function(){var W,i;return null!==(i=null===(W=this._renderTarget)||void 0===W?void 0:W._depthStencilTexture)&&void 0!==i?i:null},enumerable:!1,configurable:!0}),i.prototype.createDepthStencilTexture=function(W,i,L,h,l){var t;void 0===W&&(W=0),void 0===i&&(i=!0),void 0===L&&(L=!1),void 0===h&&(h=1),void 0===l&&(l=14),null===(t=this._renderTarget)||void 0===t||t.createDepthStencilTexture(W,i,L,h,l)},i.prototype._releaseRenderPassId=function(){if(this._scene)for(var W=this._scene.getEngine(),i=0;i<this._renderPassIds.length;++i)W.releaseRenderPassId(this._renderPassIds[i]);this._renderPassIds=[]},i.prototype._createRenderPassId=function(){this._releaseRenderPassId();for(var W=this._scene.getEngine(),i=this._isCubeData?6:this.getRenderLayers()||1,L=0;L<i;++L)this._renderPassIds[L]=W.createRenderPassId("RenderTargetTexture - ".concat(this.name,"#").concat(L))},i.prototype._processSizeParameter=function(W){if(W.ratio){this._sizeRatio=W.ratio;var i=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(i.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(i.getRenderHeight(),this._sizeRatio)}}else this._size=W;this._createRenderPassId()},Object.defineProperty(i.prototype,"samples",{get:function(){var W,i;return null!==(i=null===(W=this._renderTarget)||void 0===W?void 0:W.samples)&&void 0!==i?i:this._samples},set:function(W){this._renderTarget&&(this._samples=this._renderTarget.setSamples(W))},enumerable:!1,configurable:!0}),i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(W){this._refreshRate=W,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),i.prototype.addPostProcess=function(W){if(!this._postProcessManager){var i=this.getScene();if(!i)return;this._postProcessManager=new R.d(i),this._postProcesses=new Array}this._postProcesses.push(W),this._postProcesses[0].autoClear=!1},i.prototype.clearPostProcesses=function(W){if(void 0===W&&(W=!1),this._postProcesses){if(W)for(var i=0,L=this._postProcesses;i<L.length;i++){L[i].dispose()}this._postProcesses=[]}},i.prototype.removePostProcess=function(W){if(this._postProcesses){var i=this._postProcesses.indexOf(W);-1!==i&&(this._postProcesses.splice(i,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},i.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},i.prototype.getRenderSize=function(){return this.getRenderWidth()},i.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},i.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},i.prototype.getRenderLayers=function(){var W=this._size.layers;return W||0},i.prototype.disableRescaling=function(){this._canRescale=!1},Object.defineProperty(i.prototype,"canRescale",{get:function(){return this._canRescale},enumerable:!1,configurable:!0}),i.prototype.scale=function(W){var i=Math.max(1,this.getRenderSize()*W);this.resize(i)},i.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:W.prototype.getReflectionTextureMatrix.call(this)},i.prototype.resize=function(W){var i,L=this.isCube;null===(i=this._renderTarget)||void 0===i||i.dispose(),this._renderTarget=null;var h=this.getScene();h&&(this._processSizeParameter(W),this._renderTarget=L?h.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):h.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},i.prototype.render=function(W,i){void 0===W&&(W=!1),void 0===i&&(i=!1),this._render(W,i)},i.prototype.isReadyForRendering=function(){return this._render(!1,!1,!0)},i.prototype._render=function(W,i,L){var h;void 0===W&&(W=!1),void 0===i&&(i=!1),void 0===L&&(L=!1);var l=this.getScene();if(!l)return L;var t=l.getEngine();if(void 0!==this.useCameraPostProcesses&&(W=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var p=0;p<this._waitingRenderList.length;p++){var x=this._waitingRenderList[p];(r=l.getMeshById(x))&&this.renderList.push(r)}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];var R=this.getScene();if(!R)return L;var z=R.meshes;for(p=0;p<z.length;p++){var r=z[p];this.renderListPredicate(r)&&this.renderList.push(r)}}var N=t.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);var I=null!==(h=this.activeCamera)&&void 0!==h?h:l.activeCamera;I&&(I!==l.activeCamera&&l.setTransformMatrix(I.getViewMatrix(),I.getProjectionMatrix(!0)),t.setViewport(I.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;var s=L;if(L){l.getViewMatrix()||l.updateTransformMatrix();var o=this.is2DArray?this.getRenderLayers():this.isCube?6:1;for(V=0;V<o&&s;V++){var D=null,S=this.renderList?this.renderList:l.getActiveMeshes().data,C=this.renderList?this.renderList.length:l.getActiveMeshes().length;t.currentRenderPassId=this._renderPassIds[V],this.onBeforeRenderObservable.notifyObservers(V),this.getCustomRenderList&&(D=this.getCustomRenderList(V,S,C)),D||(D=S),this._doNotChangeAspectRatio||l.updateTransformMatrix(!0);for(var e=0;e<D.length&&s;++e){if((r=D[e]).isEnabled()&&!r.isBlocked&&r.isVisible&&r.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(r,this.refreshRate)){s=!1;break}}else if(!r.isReady(!0)){s=!1;break}}this.onAfterRenderObservable.notifyObservers(V)}}else if(this.is2DArray)for(var V=0;V<this.getRenderLayers();V++)this._renderToTarget(0,W,i,V,I),l.incrementRenderId(),l.resetCachedMaterial();else if(this.isCube)for(var c=0;c<6;c++)this._renderToTarget(c,W,i,void 0,I),l.incrementRenderId(),l.resetCachedMaterial();else this._renderToTarget(0,W,i,void 0,I);return this.onAfterUnbindObservable.notifyObservers(this),t.currentRenderPassId=N,l.activeCamera&&((l.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==l.activeCamera)&&l.setTransformMatrix(l.activeCamera.getViewMatrix(),l.activeCamera.getProjectionMatrix(!0)),t.setViewport(l.activeCamera.viewport)),l.resetCachedMaterial(),s},i.prototype._bestReflectionRenderTargetDimension=function(W,i){var L=W*i,h=r.c.NearestPOT(L+16384/(128+L));return Math.min(r.c.FloorPOT(W),h)},i.prototype._prepareRenderingManager=function(W,i,L,h){var l=this.getScene();if(l){this._renderingManager.reset();for(var t=l.getRenderId(),p=0;p<i;p++){var x=W[p];if(x&&!x.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(x,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!x.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!x._internalAbstractMeshDataInfo._currentLODIsUpToDate&&l.activeCamera&&(x._internalAbstractMeshDataInfo._currentLOD=l.customLODSelector?l.customLODSelector(x,this.activeCamera||l.activeCamera):x.getLOD(this.activeCamera||l.activeCamera),x._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!x._internalAbstractMeshDataInfo._currentLOD)continue;var R=x._internalAbstractMeshDataInfo._currentLOD;R._preActivateForIntermediateRendering(t);var z=void 0;if(z=!(!h||!L)&&0===(x.layerMask&L.layerMask),x.isEnabled()&&x.isVisible&&x.subMeshes&&!z&&(R!==x&&R._activate(t,!0),x._activate(t,!0)&&x.subMeshes.length)){x.isAnInstance?x._internalAbstractMeshDataInfo._actAsRegularMesh&&(R=x):R._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,R._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var r=0;r<R.subMeshes.length;r++){var N=R.subMeshes[r];this._renderingManager.dispatch(N,R)}}}}for(var I=0;I<l.particleSystems.length;I++){var s=l.particleSystems[I],o=s.emitter;s.isStarted()&&o&&o.position&&o.isEnabled()&&(W.indexOf(o)>=0&&this._renderingManager.dispatchParticles(s))}}},i.prototype._bindFrameBuffer=function(W,i){void 0===W&&(W=0),void 0===i&&(i=0);var L=this.getScene();if(L){var h=L.getEngine();this._renderTarget&&h.bindFramebuffer(this._renderTarget,this.isCube?W:void 0,void 0,void 0,this.ignoreCameraViewport,0,i)}},i.prototype._unbindFrameBuffer=function(W,i){var L=this;this._renderTarget&&W.unBindFramebuffer(this._renderTarget,this.isCube,(function(){L.onAfterRenderObservable.notifyObservers(i)}))},i.prototype._prepareFrame=function(W,i,L,h){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):h&&W.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(i,L)},i.prototype._renderToTarget=function(W,i,L,h,l){var p,x,R,z,r,N;void 0===h&&(h=0),void 0===l&&(l=null);var I=this.getScene();if(I){var s=I.getEngine();if(null===(p=s._debugPushGroup)||void 0===p||p.call(s,"render to face #".concat(W," layer #").concat(h),1),this._prepareFrame(I,W,h,i),this.is2DArray?(s.currentRenderPassId=this._renderPassIds[h],this.onBeforeRenderObservable.notifyObservers(h)):(s.currentRenderPassId=this._renderPassIds[W],this.onBeforeRenderObservable.notifyObservers(W)),s.snapshotRendering&&1===s.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(s):this.skipInitialClear||s.clear(this.clearColor||I.clearColor,!0,!0,!0);else{var o=null,D=this.renderList?this.renderList:I.getActiveMeshes().data,S=this.renderList?this.renderList.length:I.getActiveMeshes().length;this.getCustomRenderList&&(o=this.getCustomRenderList(this.is2DArray?h:W,D,S)),o?this._prepareRenderingManager(o,o.length,l,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(D,S,l,!this.renderList),this._defaultRenderListPrepared=!0),o=D);for(var C=0,e=I._beforeRenderTargetClearStage;C<e.length;C++){e[C].action(this,W,h)}this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(s):this.skipInitialClear||s.clear(this.clearColor||I.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||I.updateTransformMatrix(!0);for(var V=0,c=I._beforeRenderTargetDrawStage;V<c.length;V++){c[V].action(this,W,h)}this._renderingManager.render(this.customRenderFunction,o,this.renderParticles,this.renderSprites);for(var f=0,a=I._afterRenderTargetDrawStage;f<a.length;f++){a[f].action(this,W,h)}var P=null!==(R=null===(x=this._texture)||void 0===x?void 0:x.generateMipMaps)&&void 0!==R&&R;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,null!==(z=this._renderTarget)&&void 0!==z?z:void 0,W,this._postProcesses,this.ignoreCameraViewport):i&&I.postProcessManager._finalizeFrame(!1,null!==(r=this._renderTarget)&&void 0!==r?r:void 0,W),this._texture&&(this._texture.generateMipMaps=P),this._doNotChangeAspectRatio||I.updateTransformMatrix(!0),L&&t.h.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),s)}this._unbindFrameBuffer(s,W),this._texture&&this.isCube&&5===W&&s.generateMipMapsForCubemap(this._texture),null===(N=s._debugPopGroup)||void 0===N||N.call(s,1)}},i.prototype.setRenderingOrder=function(W,i,L,h){void 0===i&&(i=null),void 0===L&&(L=null),void 0===h&&(h=null),this._renderingManager.setRenderingOrder(W,i,L,h)},i.prototype.setRenderingAutoClearDepthStencil=function(W,i){this._renderingManager.setRenderingAutoClearDepthStencil(W,i),this._renderingManager._useSceneAutoClearSetup=!1},i.prototype.clone=function(){var W=this.getSize(),L=new i(this.name,W,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return L.hasAlpha=this.hasAlpha,L.level=this.level,L.coordinatesMode=this.coordinatesMode,this.renderList&&(L.renderList=this.renderList.slice(0)),L},i.prototype.serialize=function(){if(!this.name)return null;var i=W.prototype.serialize.call(this);if(i.renderTargetSize=this.getRenderSize(),i.renderList=[],this.renderList)for(var L=0;L<this.renderList.length;L++)i.renderList.push(this.renderList[L].id);return i},i.prototype.disposeFramebufferObjects=function(){var W;null===(W=this._renderTarget)||void 0===W||W.dispose(!0)},i.prototype.releaseInternalTexture=function(){var W;null===(W=this._renderTarget)||void 0===W||W.releaseTextures(),this._texture=null},i.prototype.dispose=function(){var i;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var L=this.getScene();if(L){var h=L.customRenderTargets.indexOf(this);h>=0&&L.customRenderTargets.splice(h,1);for(var l=0,t=L.cameras;l<t.length;l++){var p=t[l];(h=p.customRenderTargets.indexOf(this))>=0&&p.customRenderTargets.splice(h,1)}null===(i=this._renderTarget)||void 0===i||i.dispose(),this._renderTarget=null,this._texture=null,W.prototype.dispose.call(this)}},i.prototype._rebuild=function(){this.refreshRate===i.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=i.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},i.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},i.prototype.getViewCount=function(){return 1},i.REFRESHRATE_RENDER_ONCE=0,i.REFRESHRATE_RENDER_ONEVERYFRAME=1,i.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,i}(x.e);x.e._CreateRenderTargetTexture=function(W,i,L,h,l){return new N(W,i,L,h)}},49443:function(W,i,L){"use strict";L.d(i,{d:function(){return x}});var h=L(40061),l=L(46907),t=L(45883),p=L(31709),x=function(W){function i(i,L){var h=W.call(this,i,L,!0)||this;return h._waitingSubMaterialsUniqueIds=[],h.getScene().multiMaterials.push(h),h.subMaterials=new Array,h._storeEffectOnSubMeshes=!0,h}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(W){this._subMaterials=W,this._hookArray(W)},enumerable:!1,configurable:!0}),i.prototype.getChildren=function(){return this.subMaterials},i.prototype._hookArray=function(W){var i=this,L=W.push;W.push=function(){for(var h=[],l=0;l<arguments.length;l++)h[l]=arguments[l];var t=L.apply(W,h);return i._markAllSubMeshesAsTexturesDirty(),t};var h=W.splice;W.splice=function(L,l){var t=h.apply(W,[L,l]);return i._markAllSubMeshesAsTexturesDirty(),t}},i.prototype.getSubMaterial=function(W){return W<0||W>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[W]},i.prototype.getActiveTextures=function(){var i;return(i=W.prototype.getActiveTextures.call(this)).concat.apply(i,this.subMaterials.map((function(W){return W?W.getActiveTextures():[]})))},i.prototype.hasTexture=function(i){var L;if(W.prototype.hasTexture.call(this,i))return!0;for(var h=0;h<this.subMaterials.length;h++)if(null===(L=this.subMaterials[h])||void 0===L?void 0:L.hasTexture(i))return!0;return!1},i.prototype.getClassName=function(){return"MultiMaterial"},i.prototype.isReadyForSubMesh=function(W,i,L){for(var h=0;h<this.subMaterials.length;h++){var l=this.subMaterials[h];if(l){if(l._storeEffectOnSubMeshes){if(!l.isReadyForSubMesh(W,i,L))return!1;continue}if(!l.isReady(W))return!1}}return!0},i.prototype.clone=function(W,L){for(var h=new i(W,this.getScene()),l=0;l<this.subMaterials.length;l++){var t=null,p=this.subMaterials[l];t=L&&p?p.clone(W+"-"+p.name):this.subMaterials[l],h.subMaterials.push(t)}return h},i.prototype.serialize=function(){var W={};W.name=this.name,W.id=this.id,W.uniqueId=this.uniqueId,t.d&&(W.tags=t.d.GetTags(this)),W.materialsUniqueIds=[],W.materials=[];for(var i=0;i<this.subMaterials.length;i++){var L=this.subMaterials[i];L?(W.materialsUniqueIds.push(L.uniqueId),W.materials.push(L.id)):(W.materialsUniqueIds.push(null),W.materials.push(null))}return W},i.prototype.dispose=function(i,L,h){var l=this.getScene();if(l){if(h)for(var t=0;t<this.subMaterials.length;t++){var p=this.subMaterials[t];p&&p.dispose(i,L)}var x=l.multiMaterials.indexOf(this);x>=0&&l.multiMaterials.splice(x,1),W.prototype.dispose.call(this,i,L)}},i.ParseMultiMaterial=function(W,L){var h=new i(W.name,L);return h.id=W.id,h._loadedUniqueId=W.uniqueId,t.d&&t.d.AddTagsTo(h,W.tags),W.materialsUniqueIds?h._waitingSubMaterialsUniqueIds=W.materialsUniqueIds:W.materials.forEach((function(W){return h.subMaterials.push(L.getLastMaterialById(W))})),h},i}(l.b);(0,p.c)("BABYLON.MultiMaterial",x)},54044:function(W,i,L){"use strict";L.d(i,{e:function(){return p},i:function(){return t},l:function(){return h}});var h,l=L(80105);!function(W){W[W.LOCAL=0]="LOCAL",W[W.WORLD=1]="WORLD",W[W.BONE=2]="BONE"}(h||(h={}));var t,p=function(){function W(){}return W.X=new l.m(1,0,0),W.Y=new l.m(0,1,0),W.Z=new l.m(0,0,1),W}();!function(W){W[W.X=0]="X",W[W.Y=1]="Y",W[W.Z=2]="Z"}(t||(t={}))},39578:function(W,i,L){"use strict";L.d(i,{e:function(){return h.d},i:function(){return h.g},l:function(){return l.g},p:function(){return l.h},q:function(){return l.k},u:function(){return l.m}});L(54044);var h=L(9488),l=(L(61686),L(46647),L(12476),L(85567),L(2111),L(80105));L(52270),L(57278)},12476:function(W,i,L){"use strict";L.d(i,{c:function(){return x},d:function(){return r},h:function(){return N}});var h,l=L(96658),t=L(80105),p=L(61686);!function(W){W[W.CW=0]="CW",W[W.CCW=1]="CCW"}(h||(h={}));var x=function(){function W(){}return W.Interpolate=function(W,i,L,h,l){for(var t=1-3*h+3*i,p=3*h-6*i,x=3*i,R=W,z=0;z<5;z++){var r=R*R;R-=(t*(r*R)+p*r+x*R-W)*(1/(3*t*r+2*p*R+x)),R=Math.min(1,Math.max(0,R))}return 3*Math.pow(1-R,2)*R*L+3*(1-R)*Math.pow(R,2)*l+Math.pow(R,3)},W}(),R=function(){function W(W){this._radians=W,this._radians<0&&(this._radians+=2*Math.PI)}return W.prototype.degrees=function(){return 180*this._radians/Math.PI},W.prototype.radians=function(){return this._radians},W.BetweenTwoPoints=function(i,L){var h=L.subtract(i);return new W(Math.atan2(h.y,h.x))},W.FromRadians=function(i){return new W(i)},W.FromDegrees=function(i){return new W(i*Math.PI/180)},W}(),z=function(W,i,L){this.startPoint=W,this.midPoint=i,this.endPoint=L;var l=Math.pow(i.x,2)+Math.pow(i.y,2),p=(Math.pow(W.x,2)+Math.pow(W.y,2)-l)/2,x=(l-Math.pow(L.x,2)-Math.pow(L.y,2))/2,z=(W.x-i.x)*(i.y-L.y)-(i.x-L.x)*(W.y-i.y);this.centerPoint=new t.k((p*(i.y-L.y)-x*(W.y-i.y))/z,((W.x-i.x)*x-(i.x-L.x)*p)/z),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=R.BetweenTwoPoints(this.centerPoint,this.startPoint);var r=this.startAngle.degrees(),N=R.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),I=R.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();N-r>180&&(N-=360),N-r<-180&&(N+=360),I-N>180&&(I-=360),I-N<-180&&(I+=360),this.orientation=N-r<0?h.CW:h.CCW,this.angle=R.FromDegrees(this.orientation===h.CW?r-I:I-r)},r=function(){function W(W,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new t.k(W,i))}return W.prototype.addLineTo=function(W,i){if(this.closed)return this;var L=new t.k(W,i),h=this._points[this._points.length-1];return this._points.push(L),this._length+=L.subtract(h).length(),this},W.prototype.addArcTo=function(W,i,L,l,p){if(void 0===p&&(p=36),this.closed)return this;var x=this._points[this._points.length-1],R=new t.k(W,i),r=new t.k(L,l),N=new z(x,R,r),I=N.angle.radians()/p;N.orientation===h.CW&&(I*=-1);for(var s=N.startAngle.radians()+I,o=0;o<p;o++){var D=Math.cos(s)*N.radius+N.centerPoint.x,S=Math.sin(s)*N.radius+N.centerPoint.y;this.addLineTo(D,S),s+=I}return this},W.prototype.close=function(){return this.closed=!0,this},W.prototype.length=function(){var W=this._length;if(this.closed){var i=this._points[this._points.length-1];W+=this._points[0].subtract(i).length()}return W},W.prototype.getPoints=function(){return this._points},W.prototype.getPointAtLengthPosition=function(W){if(W<0||W>1)return t.k.Zero();for(var i=W*this.length(),L=0,h=0;h<this._points.length;h++){var l=(h+1)%this._points.length,p=this._points[h],x=this._points[l].subtract(p),R=x.length()+L;if(i>=L&&i<=R){var z=x.normalize(),r=i-L;return new t.k(p.x+z.x*r,p.y+z.y*r)}L=R}return t.k.Zero()},W.StartingAt=function(i,L){return new W(i,L)},W}(),N=function(){function W(W,i,L,h){void 0===i&&(i=null),void 0===h&&(h=!1),this.path=W,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:t.m.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:t.d.Identity()};for(var l=0;l<W.length;l++)this._curve[l]=W[l].clone();this._raw=L||!1,this._alignTangentsWithPath=h,this._compute(i,h)}return W.prototype.getCurve=function(){return this._curve},W.prototype.getPoints=function(){return this._curve},W.prototype.length=function(){return this._distances[this._distances.length-1]},W.prototype.getTangents=function(){return this._tangents},W.prototype.getNormals=function(){return this._normals},W.prototype.getBinormals=function(){return this._binormals},W.prototype.getDistances=function(){return this._distances},W.prototype.getPointAt=function(W){return this._updatePointAtData(W).point},W.prototype.getTangentAt=function(W,i){return void 0===i&&(i=!1),this._updatePointAtData(W,i),i?t.m.TransformCoordinates(t.m.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},W.prototype.getNormalAt=function(W,i){return void 0===i&&(i=!1),this._updatePointAtData(W,i),i?t.m.TransformCoordinates(t.m.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},W.prototype.getBinormalAt=function(W,i){return void 0===i&&(i=!1),this._updatePointAtData(W,i),i?t.m.TransformCoordinates(t.m.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},W.prototype.getDistanceAt=function(W){return this.length()*W},W.prototype.getPreviousPointIndexAt=function(W){return this._updatePointAtData(W),this._pointAtData.previousPointArrayIndex},W.prototype.getSubPositionAt=function(W){return this._updatePointAtData(W),this._pointAtData.subPosition},W.prototype.getClosestPositionTo=function(W){for(var i=Number.MAX_VALUE,L=0,h=0;h<this._curve.length-1;h++){var l=this._curve[h+0],p=this._curve[h+1].subtract(l).normalize(),x=this._distances[h+1]-this._distances[h+0],R=Math.min(Math.max(t.m.Dot(p,W.subtract(l).normalize()),0)*t.m.Distance(l,W)/x,1),z=t.m.Distance(l.add(p.scale(R*x)),W);z<i&&(i=z,L=(this._distances[h+0]+x*R)/this.length())}return L},W.prototype.slice=function(i,L){if(void 0===i&&(i=0),void 0===L&&(L=1),i<0&&(i=1- -1*i%1),L<0&&(L=1- -1*L%1),i>L){var h=i;i=L,L=h}var l=this.getCurve(),t=this.getPointAt(i),p=this.getPreviousPointIndexAt(i),x=this.getPointAt(L),R=this.getPreviousPointIndexAt(L)+1,z=[];return 0!==i&&(p++,z.push(t)),z.push.apply(z,l.slice(p,R)),1===L&&1!==i||z.push(x),new W(z,this.getNormalAt(i),this._raw,this._alignTangentsWithPath)},W.prototype.update=function(W,i,L){void 0===i&&(i=null),void 0===L&&(L=!1);for(var h=0;h<W.length;h++)this._curve[h].x=W[h].x,this._curve[h].y=W[h].y,this._curve[h].z=W[h].z;return this._compute(i,L),this},W.prototype._compute=function(W,i){void 0===i&&(i=!1);var L=this._curve.length;if(!(L<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[L-1]=this._curve[L-1].subtract(this._curve[L-2]),this._raw||this._tangents[L-1].normalize();var h,l,p,x,R,z=this._tangents[0],r=this._normalVector(z,W);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=t.m.Cross(z,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var N=1;N<L;N++)h=this._getLastNonNullVector(N),N<L-1&&(l=this._getFirstNonNullVector(N),this._tangents[N]=i?l:h.add(l),this._tangents[N].normalize()),this._distances[N]=this._distances[N-1]+this._curve[N].subtract(this._curve[N-1]).length(),p=this._tangents[N],R=this._binormals[N-1],this._normals[N]=t.m.Cross(R,p),this._raw||(0===this._normals[N].length()?(x=this._normals[N-1],this._normals[N]=x.clone()):this._normals[N].normalize()),this._binormals[N]=t.m.Cross(p,this._normals[N]),this._raw||this._binormals[N].normalize();this._pointAtData.id=NaN}},W.prototype._getFirstNonNullVector=function(W){for(var i=1,L=this._curve[W+i].subtract(this._curve[W]);0===L.length()&&W+i+1<this._curve.length;)i++,L=this._curve[W+i].subtract(this._curve[W]);return L},W.prototype._getLastNonNullVector=function(W){for(var i=1,L=this._curve[W].subtract(this._curve[W-i]);0===L.length()&&W>i+1;)i++,L=this._curve[W].subtract(this._curve[W-i]);return L},W.prototype._normalVector=function(W,i){var L,h=W.length();if(0===h&&(h=1),void 0===i||null===i){var x=void 0;x=l.d.WithinEpsilon(Math.abs(W.y)/h,1,p.e)?l.d.WithinEpsilon(Math.abs(W.x)/h,1,p.e)?l.d.WithinEpsilon(Math.abs(W.z)/h,1,p.e)?t.m.Zero():new t.m(0,0,1):new t.m(1,0,0):new t.m(0,-1,0),L=t.m.Cross(W,x)}else L=t.m.Cross(W,i),t.m.CrossToRef(L,W,L);return L.normalize(),L},W.prototype._updatePointAtData=function(W,i){if(void 0===i&&(i=!1),this._pointAtData.id===W)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=W;var L=this.getPoints();if(W<=0)return this._setPointAtData(0,0,L[0],0,i);if(W>=1)return this._setPointAtData(1,1,L[L.length-1],L.length-1,i);for(var h,l=L[0],p=0,x=W*this.length(),R=1;R<L.length;R++){h=L[R];var z=t.m.Distance(l,h);if((p+=z)===x)return this._setPointAtData(W,1,h,R,i);if(p>x){var r=(p-x)/z,N=l.subtract(h),I=h.add(N.scaleInPlace(r));return this._setPointAtData(W,1-r,I,R-1,i)}l=h}return this._pointAtData},W.prototype._setPointAtData=function(W,i,L,h,l){return this._pointAtData.point=L,this._pointAtData.position=W,this._pointAtData.subPosition=i,this._pointAtData.previousPointArrayIndex=h,this._pointAtData.interpolateReady=l,l&&this._updateInterpolationMatrix(),this._pointAtData},W.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=t.d.Identity();var W=this._pointAtData.previousPointArrayIndex;if(W!==this._tangents.length-1){var i=W+1,L=this._tangents[W].clone(),h=this._normals[W].clone(),l=this._binormals[W].clone(),p=this._tangents[i].clone(),x=this._normals[i].clone(),R=this._binormals[i].clone(),z=t.g.RotationQuaternionFromAxis(h,l,L),r=t.g.RotationQuaternionFromAxis(x,R,p);t.g.Slerp(z,r,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},W}();!function(){function W(W){this._length=0,this._points=W,this._length=this._computeLength(W)}W.CreateQuadraticBezier=function(i,L,h,l){l=l>2?l:3;for(var p=new Array,x=function(W,i,L,h){return(1-W)*(1-W)*i+2*W*(1-W)*L+W*W*h},R=0;R<=l;R++)p.push(new t.m(x(R/l,i.x,L.x,h.x),x(R/l,i.y,L.y,h.y),x(R/l,i.z,L.z,h.z)));return new W(p)},W.CreateCubicBezier=function(i,L,h,l,p){p=p>3?p:4;for(var x=new Array,R=function(W,i,L,h,l){return(1-W)*(1-W)*(1-W)*i+3*W*(1-W)*(1-W)*L+3*W*W*(1-W)*h+W*W*W*l},z=0;z<=p;z++)x.push(new t.m(R(z/p,i.x,L.x,h.x,l.x),R(z/p,i.y,L.y,h.y,l.y),R(z/p,i.z,L.z,h.z,l.z)));return new W(x)},W.CreateHermiteSpline=function(i,L,h,l,p){for(var x=new Array,R=1/p,z=0;z<=p;z++)x.push(t.m.Hermite(i,L,h,l,z*R));return new W(x)},W.CreateCatmullRomSpline=function(i,L,h){var l=new Array,p=1/L,x=0;if(h){for(var R=i.length,z=0;z<R;z++){x=0;for(var r=0;r<L;r++)l.push(t.m.CatmullRom(i[z%R],i[(z+1)%R],i[(z+2)%R],i[(z+3)%R],x)),x+=p}l.push(l[0])}else{var N=new Array;N.push(i[0].clone()),Array.prototype.push.apply(N,i),N.push(i[i.length-1].clone());for(z=0;z<N.length-3;z++){x=0;for(r=0;r<L;r++)l.push(t.m.CatmullRom(N[z],N[z+1],N[z+2],N[z+3],x)),x+=p}z--,l.push(t.m.CatmullRom(N[z],N[z+1],N[z+2],N[z+3],x))}return new W(l)},W.ArcThru3Points=function(i,L,h,l,p,x){void 0===l&&(l=32),void 0===p&&(p=!1),void 0===x&&(x=!1);var R=new Array,z=L.subtract(i),r=h.subtract(L),N=i.subtract(h),I=t.m.Cross(z,r),s=I.length();if(s<Math.pow(10,-8))return new W(R);var o=z.lengthSquared(),D=r.lengthSquared(),S=N.lengthSquared(),C=I.lengthSquared(),e=.5*z.length()*r.length()*N.length()/s,V=-.5*D*t.m.Dot(z,N)/C,c=-.5*S*t.m.Dot(z,r)/C,f=-.5*o*t.m.Dot(r,N)/C,a=i.scale(V).add(L.scale(c)).add(h.scale(f)),P=i.subtract(a).normalize(),y=t.m.Cross(I,P).normalize();if(x){for(var M=2*Math.PI/l,b=0;b<=2*Math.PI;b+=M)R.push(a.add(P.scale(e*Math.cos(b)).add(y.scale(e*Math.sin(b)))));R.push(i)}else{M=1/l,b=0;var j=t.m.Zero();do{j=a.add(P.scale(e*Math.cos(b)).add(y.scale(e*Math.sin(b)))),R.push(j),b+=M}while(!j.equalsWithEpsilon(h,e*M*1.1));R.push(h),p&&R.push(i)}return new W(R)},W.prototype.getPoints=function(){return this._points},W.prototype.length=function(){return this._length},W.prototype.continue=function(i){for(var L=this._points[this._points.length-1],h=this._points.slice(),l=i.getPoints(),t=1;t<l.length;t++)h.push(l[t].subtract(l[0]).add(L));return new W(h)},W.prototype._computeLength=function(W){for(var i=0,L=1;L<W.length;L++)i+=W[L].subtract(W[L-1]).length();return i}}()},52270:function(W,i,L){"use strict";L.d(i,{d:function(){return l}});var h=L(80105),l=(function(){function W(W,i){void 0===W&&(W=h.m.Zero()),void 0===i&&(i=h.m.Up()),this.position=W,this.normal=i}W.prototype.clone=function(){return new W(this.position.clone(),this.normal.clone())}}(),function(){function W(W,i,L){void 0===W&&(W=h.m.Zero()),void 0===i&&(i=h.m.Up()),void 0===L&&(L=h.k.Zero()),this.position=W,this.normal=i,this.uv=L}return W.prototype.clone=function(){return new W(this.position.clone(),this.normal.clone(),this.uv.clone())},W}())},37094:function(W,i,L){"use strict";L.d(i,{e:function(){return z},f:function(){return r}});var h=L(80105),l=L(39578),t=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],p=[function(){return 1},function(W){return W.y},function(W){return W.z},function(W){return W.x},function(W){return W.x*W.y},function(W){return W.y*W.z},function(W){return 3*W.z*W.z-1},function(W){return W.x*W.z},function(W){return W.x*W.x-W.y*W.y}],x=function(W,i){return t[W]*p[W](i)},R=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],z=function(){function W(){this.preScaled=!1,this.l00=h.m.Zero(),this.l1_1=h.m.Zero(),this.l10=h.m.Zero(),this.l11=h.m.Zero(),this.l2_2=h.m.Zero(),this.l2_1=h.m.Zero(),this.l20=h.m.Zero(),this.l21=h.m.Zero(),this.l22=h.m.Zero()}return W.prototype.addLight=function(W,i,L){l.p.Vector3[0].set(i.r,i.g,i.b);var h=l.p.Vector3[0],t=l.p.Vector3[1];h.scaleToRef(L,t),t.scaleToRef(x(0,W),l.p.Vector3[2]),this.l00.addInPlace(l.p.Vector3[2]),t.scaleToRef(x(1,W),l.p.Vector3[2]),this.l1_1.addInPlace(l.p.Vector3[2]),t.scaleToRef(x(2,W),l.p.Vector3[2]),this.l10.addInPlace(l.p.Vector3[2]),t.scaleToRef(x(3,W),l.p.Vector3[2]),this.l11.addInPlace(l.p.Vector3[2]),t.scaleToRef(x(4,W),l.p.Vector3[2]),this.l2_2.addInPlace(l.p.Vector3[2]),t.scaleToRef(x(5,W),l.p.Vector3[2]),this.l2_1.addInPlace(l.p.Vector3[2]),t.scaleToRef(x(6,W),l.p.Vector3[2]),this.l20.addInPlace(l.p.Vector3[2]),t.scaleToRef(x(7,W),l.p.Vector3[2]),this.l21.addInPlace(l.p.Vector3[2]),t.scaleToRef(x(8,W),l.p.Vector3[2]),this.l22.addInPlace(l.p.Vector3[2])},W.prototype.scaleInPlace=function(W){this.l00.scaleInPlace(W),this.l1_1.scaleInPlace(W),this.l10.scaleInPlace(W),this.l11.scaleInPlace(W),this.l2_2.scaleInPlace(W),this.l2_1.scaleInPlace(W),this.l20.scaleInPlace(W),this.l21.scaleInPlace(W),this.l22.scaleInPlace(W)},W.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(R[0]),this.l1_1.scaleInPlace(R[1]),this.l10.scaleInPlace(R[2]),this.l11.scaleInPlace(R[3]),this.l2_2.scaleInPlace(R[4]),this.l2_1.scaleInPlace(R[5]),this.l20.scaleInPlace(R[6]),this.l21.scaleInPlace(R[7]),this.l22.scaleInPlace(R[8])},W.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},W.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(t[0]),this.l1_1.scaleInPlace(t[1]),this.l10.scaleInPlace(t[2]),this.l11.scaleInPlace(t[3]),this.l2_2.scaleInPlace(t[4]),this.l2_1.scaleInPlace(t[5]),this.l20.scaleInPlace(t[6]),this.l21.scaleInPlace(t[7]),this.l22.scaleInPlace(t[8])},W.prototype.updateFromArray=function(W){return h.m.FromArrayToRef(W[0],0,this.l00),h.m.FromArrayToRef(W[1],0,this.l1_1),h.m.FromArrayToRef(W[2],0,this.l10),h.m.FromArrayToRef(W[3],0,this.l11),h.m.FromArrayToRef(W[4],0,this.l2_2),h.m.FromArrayToRef(W[5],0,this.l2_1),h.m.FromArrayToRef(W[6],0,this.l20),h.m.FromArrayToRef(W[7],0,this.l21),h.m.FromArrayToRef(W[8],0,this.l22),this},W.prototype.updateFromFloatsArray=function(W){return h.m.FromFloatsToRef(W[0],W[1],W[2],this.l00),h.m.FromFloatsToRef(W[3],W[4],W[5],this.l1_1),h.m.FromFloatsToRef(W[6],W[7],W[8],this.l10),h.m.FromFloatsToRef(W[9],W[10],W[11],this.l11),h.m.FromFloatsToRef(W[12],W[13],W[14],this.l2_2),h.m.FromFloatsToRef(W[15],W[16],W[17],this.l2_1),h.m.FromFloatsToRef(W[18],W[19],W[20],this.l20),h.m.FromFloatsToRef(W[21],W[22],W[23],this.l21),h.m.FromFloatsToRef(W[24],W[25],W[26],this.l22),this},W.FromArray=function(i){return(new W).updateFromArray(i)},W.FromPolynomial=function(i){var L=new W;return L.l00=i.xx.scale(.376127).add(i.yy.scale(.376127)).add(i.zz.scale(.376126)),L.l1_1=i.y.scale(.977204),L.l10=i.z.scale(.977204),L.l11=i.x.scale(.977204),L.l2_2=i.xy.scale(1.16538),L.l2_1=i.yz.scale(1.16538),L.l20=i.zz.scale(1.34567).subtract(i.xx.scale(.672834)).subtract(i.yy.scale(.672834)),L.l21=i.zx.scale(1.16538),L.l22=i.xx.scale(1.16538).subtract(i.yy.scale(1.16538)),L.l1_1.scaleInPlace(-1),L.l11.scaleInPlace(-1),L.l2_1.scaleInPlace(-1),L.l21.scaleInPlace(-1),L.scaleInPlace(Math.PI),L},W}(),r=function(){function W(){this.x=h.m.Zero(),this.y=h.m.Zero(),this.z=h.m.Zero(),this.xx=h.m.Zero(),this.yy=h.m.Zero(),this.zz=h.m.Zero(),this.xy=h.m.Zero(),this.yz=h.m.Zero(),this.zx=h.m.Zero()}return Object.defineProperty(W.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=z.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),W.prototype.addAmbient=function(W){l.p.Vector3[0].copyFromFloats(W.r,W.g,W.b);var i=l.p.Vector3[0];this.xx.addInPlace(i),this.yy.addInPlace(i),this.zz.addInPlace(i)},W.prototype.scaleInPlace=function(W){this.x.scaleInPlace(W),this.y.scaleInPlace(W),this.z.scaleInPlace(W),this.xx.scaleInPlace(W),this.yy.scaleInPlace(W),this.zz.scaleInPlace(W),this.yz.scaleInPlace(W),this.zx.scaleInPlace(W),this.xy.scaleInPlace(W)},W.prototype.updateFromHarmonics=function(W){return this._harmonics=W,this.x.copyFrom(W.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(W.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(W.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(W.l00),l.p.Vector3[0].copyFrom(W.l20).scaleInPlace(.247708),l.p.Vector3[1].copyFrom(W.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(l.p.Vector3[0]).addInPlace(l.p.Vector3[1]),this.yy.copyFrom(W.l00),this.yy.scaleInPlace(.886277).subtractInPlace(l.p.Vector3[0]).subtractInPlace(l.p.Vector3[1]),this.zz.copyFrom(W.l00),l.p.Vector3[0].copyFrom(W.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(l.p.Vector3[0]),this.yz.copyFrom(W.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(W.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(W.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this},W.FromHarmonics=function(i){return(new W).updateFromHarmonics(i)},W.FromArray=function(i){var L=new W;return h.m.FromArrayToRef(i[0],0,L.x),h.m.FromArrayToRef(i[1],0,L.y),h.m.FromArrayToRef(i[2],0,L.z),h.m.FromArrayToRef(i[3],0,L.xx),h.m.FromArrayToRef(i[4],0,L.yy),h.m.FromArrayToRef(i[5],0,L.zz),h.m.FromArrayToRef(i[6],0,L.yz),h.m.FromArrayToRef(i[7],0,L.zx),h.m.FromArrayToRef(i[8],0,L.xy),L},W}()},64400:function(W,i,L){"use strict";L.d(i,{d:function(){return r},f:function(){return z}});var h=L(80105),l=L(9488),t=L(65847),p=L(85779),x=L(20334);function R(W){var i,L=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],t=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],R=[],z=W.width||W.size||1,r=W.height||W.size||1,N=W.depth||W.size||1,I=W.wrap||!1,s=void 0===W.topBaseAt?1:W.topBaseAt,o=void 0===W.bottomBaseAt?0:W.bottomBaseAt,D=[2,0,3,1][s=(s+4)%4],S=[2,0,1,3][o=(o+4)%4],C=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(I){L=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],C=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],V=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],c=[17,18,19,16],f=[22,23,20,21];D>0;)e.unshift(e.pop()),c.unshift(c.pop()),D--;for(;S>0;)V.unshift(V.pop()),f.unshift(f.pop()),S--;e=e.flat(),V=V.flat(),C=C.concat(e).concat(V),L.push(c[0],c[2],c[3],c[0],c[1],c[2]),L.push(f[0],f[2],f[3],f[0],f[1],f[2])}var a=[z/2,r/2,N/2];i=C.reduce((function(W,i,L){return W.concat(i*a[L%3])}),[]);for(var P=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE,y=W.faceUV||new Array(6),M=W.faceColors,b=[],j=0;j<6;j++)void 0===y[j]&&(y[j]=new h.n(0,0,1,1)),M&&void 0===M[j]&&(M[j]=new l.g(1,1,1,1));for(var Z=0;Z<6;Z++)if(R.push(y[Z].z,x.d.UseOpenGLOrientationForUV?1-y[Z].w:y[Z].w),R.push(y[Z].x,x.d.UseOpenGLOrientationForUV?1-y[Z].w:y[Z].w),R.push(y[Z].x,x.d.UseOpenGLOrientationForUV?1-y[Z].y:y[Z].y),R.push(y[Z].z,x.d.UseOpenGLOrientationForUV?1-y[Z].y:y[Z].y),M)for(var X=0;X<4;X++)b.push(M[Z].r,M[Z].g,M[Z].b,M[Z].a);p.e._ComputeSides(P,i,L,t,R,W.frontUVs,W.backUVs);var T=new p.e;if(T.indices=L,T.positions=i,T.normals=t,T.uvs=R,M){var F=P===p.e.DOUBLESIDE?b.concat(b):b;T.colors=F}return T}function z(W,i,L){void 0===i&&(i={}),void 0===L&&(L=null);var h=new t.e(W,L);return i.sideOrientation=t.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,R(i).applyToMesh(h,i.updatable),h}var r={CreateBox:z};p.e.CreateBox=R,t.e.CreateBox=function(W,i,L,h,l){return void 0===L&&(L=null),z(W,{size:i,sideOrientation:l,updatable:h},L)}},60612:function(W,i,L){"use strict";L.d(i,{c:function(){return x}});var h=L(65847),l=L(85779),t=L(20334);function p(W){var i=new Array,L=new Array,h=new Array,p=new Array,x=W.radius||.5,R=W.tessellation||64,z=W.arc&&(W.arc<=0||W.arc>1)?1:W.arc||1,r=0===W.sideOrientation?0:W.sideOrientation||l.e.DEFAULTSIDE;i.push(0,0,0),p.push(.5,.5);for(var N=2*Math.PI*z,I=1===z?N/R:N/(R-1),s=0,o=0;o<R;o++){var D=Math.cos(s),S=Math.sin(s),C=(D+1)/2,e=(1-S)/2;i.push(x*D,x*S,0),p.push(C,t.d.UseOpenGLOrientationForUV?1-e:e),s+=I}1===z&&(i.push(i[3],i[4],i[5]),p.push(p[2],t.d.UseOpenGLOrientationForUV?1-p[3]:p[3]));for(var V=i.length/3,c=1;c<V-1;c++)L.push(c+1,0,c);l.e.ComputeNormals(i,L,h),l.e._ComputeSides(r,i,L,h,p,W.frontUVs,W.backUVs);var f=new l.e;return f.indices=L,f.positions=i,f.normals=h,f.uvs=p,f}function x(W,i,L){void 0===i&&(i={}),void 0===L&&(L=null);var l=new h.e(W,L);return i.sideOrientation=h.e._GetDefaultSideOrientation(i.sideOrientation),l._originalBuilderSideOrientation=i.sideOrientation,p(i).applyToMesh(l,i.updatable),l}l.e.CreateDisc=p,h.e.CreateDisc=function(W,i,L,h,l,t){return void 0===h&&(h=null),x(W,{radius:i,tessellation:L,sideOrientation:t,updatable:l},h)}},55706:function(W,i,L){"use strict";L.d(i,{c:function(){return F},e:function(){return X},g:function(){return T}});var h=L(80105),l=L(65847),t=L(85779),p=L(40061),x=L(9488),R=L(43251),z=L(35941),r=L(46907),N=L(9892),I=L(70937),s=L(33048),o=L(31709),D=L(54497),S=L(67935),C=L(29553),e=L(78588),V={effect:null,subMesh:null},c=function(W){function i(i,L,l,t,x){void 0===t&&(t={}),void 0===x&&(x=!0);var R=W.call(this,i,L,x)||this;return R._textures={},R._textureArrays={},R._externalTextures={},R._floats={},R._ints={},R._floatsArrays={},R._colors3={},R._colors3Arrays={},R._colors4={},R._colors4Arrays={},R._vectors2={},R._vectors3={},R._vectors4={},R._quaternions={},R._quaternionsArrays={},R._matrices={},R._matrixArrays={},R._matrices3x3={},R._matrices2x2={},R._vectors2Arrays={},R._vectors3Arrays={},R._vectors4Arrays={},R._uniformBuffers={},R._textureSamplers={},R._storageBuffers={},R._cachedWorldViewMatrix=new h.d,R._cachedWorldViewProjectionMatrix=new h.d,R._multiview=!1,R._shaderPath=l,R._options=(0,p.d)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1},t),R}return(0,p.n)(i,W),Object.defineProperty(i.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(W){this._shaderPath=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"ShaderMaterial"},i.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},i.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},i.prototype._checkUniform=function(W){-1===this._options.uniforms.indexOf(W)&&this._options.uniforms.push(W)},i.prototype.setTexture=function(W,i){return-1===this._options.samplers.indexOf(W)&&this._options.samplers.push(W),this._textures[W]=i,this},i.prototype.setTextureArray=function(W,i){return-1===this._options.samplers.indexOf(W)&&this._options.samplers.push(W),this._checkUniform(W),this._textureArrays[W]=i,this},i.prototype.setExternalTexture=function(W,i){return-1===this._options.externalTextures.indexOf(W)&&this._options.externalTextures.push(W),this._externalTextures[W]=i,this},i.prototype.setFloat=function(W,i){return this._checkUniform(W),this._floats[W]=i,this},i.prototype.setInt=function(W,i){return this._checkUniform(W),this._ints[W]=i,this},i.prototype.setFloats=function(W,i){return this._checkUniform(W),this._floatsArrays[W]=i,this},i.prototype.setColor3=function(W,i){return this._checkUniform(W),this._colors3[W]=i,this},i.prototype.setColor3Array=function(W,i){return this._checkUniform(W),this._colors3Arrays[W]=i.reduce((function(W,i){return i.toArray(W,W.length),W}),[]),this},i.prototype.setColor4=function(W,i){return this._checkUniform(W),this._colors4[W]=i,this},i.prototype.setColor4Array=function(W,i){return this._checkUniform(W),this._colors4Arrays[W]=i.reduce((function(W,i){return i.toArray(W,W.length),W}),[]),this},i.prototype.setVector2=function(W,i){return this._checkUniform(W),this._vectors2[W]=i,this},i.prototype.setVector3=function(W,i){return this._checkUniform(W),this._vectors3[W]=i,this},i.prototype.setVector4=function(W,i){return this._checkUniform(W),this._vectors4[W]=i,this},i.prototype.setQuaternion=function(W,i){return this._checkUniform(W),this._quaternions[W]=i,this},i.prototype.setQuaternionArray=function(W,i){return this._checkUniform(W),this._quaternionsArrays[W]=i.reduce((function(W,i){return i.toArray(W,W.length),W}),[]),this},i.prototype.setMatrix=function(W,i){return this._checkUniform(W),this._matrices[W]=i,this},i.prototype.setMatrices=function(W,i){this._checkUniform(W);for(var L=new Float32Array(16*i.length),h=0;h<i.length;h++){i[h].copyToArray(L,16*h)}return this._matrixArrays[W]=L,this},i.prototype.setMatrix3x3=function(W,i){return this._checkUniform(W),this._matrices3x3[W]=i,this},i.prototype.setMatrix2x2=function(W,i){return this._checkUniform(W),this._matrices2x2[W]=i,this},i.prototype.setArray2=function(W,i){return this._checkUniform(W),this._vectors2Arrays[W]=i,this},i.prototype.setArray3=function(W,i){return this._checkUniform(W),this._vectors3Arrays[W]=i,this},i.prototype.setArray4=function(W,i){return this._checkUniform(W),this._vectors4Arrays[W]=i,this},i.prototype.setUniformBuffer=function(W,i){return-1===this._options.uniformBuffers.indexOf(W)&&this._options.uniformBuffers.push(W),this._uniformBuffers[W]=i,this},i.prototype.setTextureSampler=function(W,i){return-1===this._options.samplerObjects.indexOf(W)&&this._options.samplerObjects.push(W),this._textureSamplers[W]=i,this},i.prototype.setStorageBuffer=function(W,i){return-1===this._options.storageBuffers.indexOf(W)&&this._options.storageBuffers.push(W),this._storageBuffers[W]=i,this},i.prototype.isReadyForSubMesh=function(W,i,L){return this.isReady(W,L,i)},i.prototype.isReady=function(W,i,L){var h,l,t,p,x=L&&this._storeEffectOnSubMeshes;if(this.isFrozen)if(x){if(L.effect&&L.effect._wasPreviouslyReady)return!0}else{var z=this._drawWrapper.effect;if(z&&z._wasPreviouslyReady&&z._wasPreviouslyUsingInstances===i)return!0}var r=this.getScene(),N=r.getEngine(),I=[],o=[],S=new D.b,C=this._shaderPath,e=this._options.uniforms,c=this._options.uniformBuffers,f=this._options.samplers;N.getCaps().multiview&&r.activeCamera&&r.activeCamera.outputRenderTarget&&r.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,I.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.indexOf("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var a=0;a<this._options.defines.length;a++){var P=0===this._options.defines[a].indexOf("#define")?this._options.defines[a]:"#define ".concat(this._options.defines[a]);I.push(P)}for(a=0;a<this._options.attributes.length;a++)o.push(this._options.attributes[a]);if(W&&W.isVerticesDataPresent(R.d.ColorKind)&&(o.push(R.d.ColorKind),I.push("#define VERTEXCOLOR")),i&&(I.push("#define INSTANCES"),s.e.PushAttributesForInstances(o),(null===W||void 0===W?void 0:W.hasThinInstances)&&(I.push("#define THIN_INSTANCES"),W&&W.isVerticesDataPresent(R.d.ColorInstanceKind)&&(o.push(R.d.ColorInstanceKind),I.push("#define INSTANCESCOLOR")))),W&&W.useBones&&W.computeBonesUsingShaders&&W.skeleton){o.push(R.d.MatricesIndicesKind),o.push(R.d.MatricesWeightsKind),W.numBoneInfluencers>4&&(o.push(R.d.MatricesIndicesExtraKind),o.push(R.d.MatricesWeightsExtraKind));var y=W.skeleton;I.push("#define NUM_BONE_INFLUENCERS "+W.numBoneInfluencers),S.addCPUSkinningFallback(0,W),y.isUsingTextureForMatrices?(I.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(I.push("#define BonesPerMesh "+(y.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else I.push("#define NUM_BONE_INFLUENCERS 0");var M=0,b=W?W.morphTargetManager:null;if(b){var j=b.supportsUVs&&-1!==I.indexOf("#define UV1"),Z=b.supportsTangents&&-1!==I.indexOf("#define TANGENT"),X=b.supportsNormals&&-1!==I.indexOf("#define NORMAL");M=b.numInfluencers,j&&I.push("#define MORPHTARGETS_UV"),Z&&I.push("#define MORPHTARGETS_TANGENT"),X&&I.push("#define MORPHTARGETS_NORMAL"),M>0&&I.push("#define MORPHTARGETS"),b.isUsingTextureForTargets&&(I.push("#define MORPHTARGETS_TEXTURE"),-1===this._options.uniforms.indexOf("morphTargetTextureIndices")&&this._options.uniforms.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),I.push("#define NUM_MORPH_INFLUENCERS "+M);for(a=0;a<M;a++)o.push(R.d.PositionKind+a),X&&o.push(R.d.NormalKind+a),Z&&o.push(R.d.TangentKind+a),j&&o.push(R.d.UVKind+"_"+a);M>0&&((e=e.slice()).push("morphTargetInfluences"),e.push("morphTargetTextureInfo"),e.push("morphTargetTextureIndices"))}else I.push("#define NUM_MORPH_INFLUENCERS 0");if(W){var T=W.bakedVertexAnimationManager;T&&T.isEnabled&&(I.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===this._options.uniforms.indexOf("bakedVertexAnimationSettings")&&this._options.uniforms.push("bakedVertexAnimationSettings"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTextureSizeInverted")&&this._options.uniforms.push("bakedVertexAnimationTextureSizeInverted"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTime")&&this._options.uniforms.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),s.e.PrepareAttributesForBakedVertexAnimation(o,W,I)}for(var F in this._textures)if(!this._textures[F].isReady())return!1;W&&this._shouldTurnAlphaTestOn(W)&&I.push("#define ALPHATEST"),(null===this._options.useClipPlane&&r.clipPlane||this._options.useClipPlane)&&(I.push("#define CLIPPLANE"),-1===e.indexOf("vClipPlane")&&e.push("vClipPlane")),(null===this._options.useClipPlane&&r.clipPlane2||this._options.useClipPlane)&&(I.push("#define CLIPPLANE2"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2")),(null===this._options.useClipPlane&&r.clipPlane3||this._options.useClipPlane)&&(I.push("#define CLIPPLANE3"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3")),(null===this._options.useClipPlane&&r.clipPlane4||this._options.useClipPlane)&&(I.push("#define CLIPPLANE4"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4")),(null===this._options.useClipPlane&&r.clipPlane5||this._options.useClipPlane)&&(I.push("#define CLIPPLANE5"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5")),(null===this._options.useClipPlane&&r.clipPlane6||this._options.useClipPlane)&&(I.push("#define CLIPPLANE6"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")),this.customShaderNameResolve&&(e=e.slice(),c=c.slice(),f=f.slice(),C=this.customShaderNameResolve(C,e,c,f,I,o));var q=x?L._getDrawWrapper():this._drawWrapper,H=null!==(h=null===q||void 0===q?void 0:q.effect)&&void 0!==h?h:null,k=null!==(l=null===q||void 0===q?void 0:q.defines)&&void 0!==l?l:null,U=I.join("\n"),d=H;return k!==U&&(d=N.createEffect(C,{attributes:o,uniformsNames:e,uniformBuffersNames:c,samplers:f,defines:U,fallbacks:S,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:M},shaderLanguage:this._options.shaderLanguage},N),x?L.setEffect(d,U,this._materialContext):q&&q.setEffect(d,U),this._onEffectCreatedObservable&&(V.effect=d,V.subMesh=null!==(t=null!==L&&void 0!==L?L:null===W||void 0===W?void 0:W.subMeshes[0])&&void 0!==t?t:null,this._onEffectCreatedObservable.notifyObservers(V))),d._wasPreviouslyUsingInstances=!!i,null!==(p=!(null===d||void 0===d?void 0:d.isReady()))&&void 0!==p&&!p&&(H!==d&&r.resetCachedMaterial(),d._wasPreviouslyReady=!0,!0)},i.prototype.bindOnlyWorldMatrix=function(W,i){var L=this.getScene(),h=null!==i&&void 0!==i?i:this.getEffect();h&&(-1!==this._options.uniforms.indexOf("world")&&h.setMatrix("world",W),-1!==this._options.uniforms.indexOf("worldView")&&(W.multiplyToRef(L.getViewMatrix(),this._cachedWorldViewMatrix),h.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(W.multiplyToRef(L.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),h.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},i.prototype.bindForSubMesh=function(W,i,L){var h;this.bind(W,i,null===(h=L._drawWrapperOverride)||void 0===h?void 0:h.effect,L)},i.prototype.bind=function(W,i,L,h){var l,t=h&&this._storeEffectOnSubMeshes,p=null!==L&&void 0!==L?L:t?h.effect:this.getEffect();if(p){this._activeEffect=p,this.bindOnlyWorldMatrix(W,L);var x=this._options.uniformBuffers,R=!1;if(p&&x&&x.length>0&&this.getScene().getEngine().supportsUniformBuffers)for(var z=0;z<x.length;++z){switch(x[z]){case"Mesh":i&&(i.getMeshUniformBuffer().bindToEffect(p,"Mesh"),i.transferToEffect(W));break;case"Scene":s.e.BindSceneUniformBuffer(p,this.getScene().getSceneUniformBuffer()),this.getScene().finalizeSceneUbo(),R=!0}}var r=i&&t?this._mustRebind(this.getScene(),p,i.visibility):this.getScene().getCachedMaterial()!==this;if(p&&r){var N;for(N in R||-1===this._options.uniforms.indexOf("view")||p.setMatrix("view",this.getScene().getViewMatrix()),R||-1===this._options.uniforms.indexOf("projection")||p.setMatrix("projection",this.getScene().getProjectionMatrix()),R||-1===this._options.uniforms.indexOf("viewProjection")||(p.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&p.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&p.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),s.e.BindBonesParameters(i,p),s.e.BindClipPlane(p,this.getScene()),this._textures)p.setTexture(N,this._textures[N]);for(N in this._textureArrays)p.setTextureArray(N,this._textureArrays[N]);for(N in this._externalTextures)p.setExternalTexture(N,this._externalTextures[N]);for(N in this._ints)p.setInt(N,this._ints[N]);for(N in this._floats)p.setFloat(N,this._floats[N]);for(N in this._floatsArrays)p.setArray(N,this._floatsArrays[N]);for(N in this._colors3)p.setColor3(N,this._colors3[N]);for(N in this._colors3Arrays)p.setArray3(N,this._colors3Arrays[N]);for(N in this._colors4){var I=this._colors4[N];p.setFloat4(N,I.r,I.g,I.b,I.a)}for(N in this._colors4Arrays)p.setArray4(N,this._colors4Arrays[N]);for(N in this._vectors2)p.setVector2(N,this._vectors2[N]);for(N in this._vectors3)p.setVector3(N,this._vectors3[N]);for(N in this._vectors4)p.setVector4(N,this._vectors4[N]);for(N in this._quaternions)p.setQuaternion(N,this._quaternions[N]);for(N in this._matrices)p.setMatrix(N,this._matrices[N]);for(N in this._matrixArrays)p.setMatrices(N,this._matrixArrays[N]);for(N in this._matrices3x3)p.setMatrix3x3(N,this._matrices3x3[N]);for(N in this._matrices2x2)p.setMatrix2x2(N,this._matrices2x2[N]);for(N in this._vectors2Arrays)p.setArray2(N,this._vectors2Arrays[N]);for(N in this._vectors3Arrays)p.setArray3(N,this._vectors3Arrays[N]);for(N in this._vectors4Arrays)p.setArray4(N,this._vectors4Arrays[N]);for(N in this._quaternionsArrays)p.setArray4(N,this._quaternionsArrays[N]);for(N in this._uniformBuffers){var o=this._uniformBuffers[N].getBuffer();o&&p.bindUniformBuffer(o,N)}for(N in this._textureSamplers)p.setTextureSampler(N,this._textureSamplers[N]);for(N in this._storageBuffers)p.setStorageBuffer(N,this._storageBuffers[N])}if(p&&i&&(r||!this.isFrozen)){var D=i.morphTargetManager;D&&D.numInfluencers>0&&s.e.BindMorphTargetParameters(i,p);var S=i.bakedVertexAnimationManager;S&&S.isEnabled&&(null===(l=i.bakedVertexAnimationManager)||void 0===l||l.bind(p,!!p._wasPreviouslyUsingInstances))}this._afterBind(i,p)}},i.prototype.getActiveTextures=function(){var i=W.prototype.getActiveTextures.call(this);for(var L in this._textures)i.push(this._textures[L]);for(var h in this._textureArrays)for(var l=this._textureArrays[h],t=0;t<l.length;t++)i.push(l[t]);return i},i.prototype.hasTexture=function(i){if(W.prototype.hasTexture.call(this,i))return!0;for(var L in this._textures)if(this._textures[L]===i)return!0;for(var h in this._textureArrays)for(var l=this._textureArrays[h],t=0;t<l.length;t++)if(l[t]===i)return!0;return!1},i.prototype.clone=function(W){var L=this,h=N.d.Clone((function(){return new i(W,L.getScene(),L._shaderPath,L._options,L._storeEffectOnSubMeshes)}),this);for(var l in h.name=W,h.id=W,"object"===typeof h._shaderPath&&(h._shaderPath=(0,p.d)({},h._shaderPath)),this._options=(0,p.d)({},this._options),Object.keys(this._options).forEach((function(W){var i=L._options[W];Array.isArray(i)&&(L._options[W]=i.slice(0))})),this.stencil.copyTo(h.stencil),this._textures)h.setTexture(l,this._textures[l]);for(var l in this._textureArrays)h.setTextureArray(l,this._textureArrays[l]);for(var l in this._externalTextures)h.setExternalTexture(l,this._externalTextures[l]);for(var l in this._ints)h.setInt(l,this._ints[l]);for(var l in this._floats)h.setFloat(l,this._floats[l]);for(var l in this._floatsArrays)h.setFloats(l,this._floatsArrays[l]);for(var l in this._colors3)h.setColor3(l,this._colors3[l]);for(var l in this._colors3Arrays)h._colors3Arrays[l]=this._colors3Arrays[l];for(var l in this._colors4)h.setColor4(l,this._colors4[l]);for(var l in this._colors4Arrays)h._colors4Arrays[l]=this._colors4Arrays[l];for(var l in this._vectors2)h.setVector2(l,this._vectors2[l]);for(var l in this._vectors3)h.setVector3(l,this._vectors3[l]);for(var l in this._vectors4)h.setVector4(l,this._vectors4[l]);for(var l in this._quaternions)h.setQuaternion(l,this._quaternions[l]);for(var l in this._quaternionsArrays)h._quaternionsArrays[l]=this._quaternionsArrays[l];for(var l in this._matrices)h.setMatrix(l,this._matrices[l]);for(var l in this._matrixArrays)h._matrixArrays[l]=this._matrixArrays[l].slice();for(var l in this._matrices3x3)h.setMatrix3x3(l,this._matrices3x3[l]);for(var l in this._matrices2x2)h.setMatrix2x2(l,this._matrices2x2[l]);for(var l in this._vectors2Arrays)h.setArray2(l,this._vectors2Arrays[l]);for(var l in this._vectors3Arrays)h.setArray3(l,this._vectors3Arrays[l]);for(var l in this._vectors4Arrays)h.setArray4(l,this._vectors4Arrays[l]);for(var l in this._uniformBuffers)h.setUniformBuffer(l,this._uniformBuffers[l]);for(var l in this._textureSamplers)h.setTextureSampler(l,this._textureSamplers[l]);for(var l in this._storageBuffers)h.setStorageBuffer(l,this._storageBuffers[l]);return h},i.prototype.dispose=function(i,L,h){if(L){var l;for(l in this._textures)this._textures[l].dispose();for(l in this._textureArrays)for(var t=this._textureArrays[l],p=0;p<t.length;p++)t[p].dispose()}this._textures={},W.prototype.dispose.call(this,i,L,h)},i.prototype.serialize=function(){var W,i=N.d.Serialize(this);for(W in i.customType="BABYLON.ShaderMaterial",i.uniqueId=this.uniqueId,i.options=this._options,i.shaderPath=this._shaderPath,i.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,i.stencil=this.stencil.serialize(),i.textures={},this._textures)i.textures[W]=this._textures[W].serialize();for(W in i.textureArrays={},this._textureArrays){i.textureArrays[W]=[];for(var L=this._textureArrays[W],h=0;h<L.length;h++)i.textureArrays[W].push(L[h].serialize())}for(W in i.ints={},this._ints)i.ints[W]=this._ints[W];for(W in i.floats={},this._floats)i.floats[W]=this._floats[W];for(W in i.FloatArrays={},this._floatsArrays)i.FloatArrays[W]=this._floatsArrays[W];for(W in i.colors3={},this._colors3)i.colors3[W]=this._colors3[W].asArray();for(W in i.colors3Arrays={},this._colors3Arrays)i.colors3Arrays[W]=this._colors3Arrays[W];for(W in i.colors4={},this._colors4)i.colors4[W]=this._colors4[W].asArray();for(W in i.colors4Arrays={},this._colors4Arrays)i.colors4Arrays[W]=this._colors4Arrays[W];for(W in i.vectors2={},this._vectors2)i.vectors2[W]=this._vectors2[W].asArray();for(W in i.vectors3={},this._vectors3)i.vectors3[W]=this._vectors3[W].asArray();for(W in i.vectors4={},this._vectors4)i.vectors4[W]=this._vectors4[W].asArray();for(W in i.quaternions={},this._quaternions)i.quaternions[W]=this._quaternions[W].asArray();for(W in i.matrices={},this._matrices)i.matrices[W]=this._matrices[W].asArray();for(W in i.matrixArray={},this._matrixArrays)i.matrixArray[W]=this._matrixArrays[W];for(W in i.matrices3x3={},this._matrices3x3)i.matrices3x3[W]=this._matrices3x3[W];for(W in i.matrices2x2={},this._matrices2x2)i.matrices2x2[W]=this._matrices2x2[W];for(W in i.vectors2Arrays={},this._vectors2Arrays)i.vectors2Arrays[W]=this._vectors2Arrays[W];for(W in i.vectors3Arrays={},this._vectors3Arrays)i.vectors3Arrays[W]=this._vectors3Arrays[W];for(W in i.vectors4Arrays={},this._vectors4Arrays)i.vectors4Arrays[W]=this._vectors4Arrays[W];for(W in i.quaternionsArrays={},this._quaternionsArrays)i.quaternionsArrays[W]=this._quaternionsArrays[W];return i},i.Parse=function(W,L,l){var t,p=N.d.Parse((function(){return new i(W.name,L,W.shaderPath,W.options,W.storeEffectOnSubMeshes)}),W,L,l);for(t in W.stencil&&p.stencil.parse(W.stencil,L,l),W.textures)p.setTexture(t,I.e.Parse(W.textures[t],L,l));for(t in W.textureArrays){for(var R=W.textureArrays[t],z=new Array,r=0;r<R.length;r++)z.push(I.e.Parse(R[r],L,l));p.setTextureArray(t,z)}for(t in W.ints)p.setInt(t,W.ints[t]);for(t in W.floats)p.setFloat(t,W.floats[t]);for(t in W.floatsArrays)p.setFloats(t,W.floatsArrays[t]);for(t in W.colors3)p.setColor3(t,x.d.FromArray(W.colors3[t]));for(t in W.colors3Arrays){var s=W.colors3Arrays[t].reduce((function(W,i,L){return L%3===0?W.push([i]):W[W.length-1].push(i),W}),[]).map((function(W){return x.d.FromArray(W)}));p.setColor3Array(t,s)}for(t in W.colors4)p.setColor4(t,x.g.FromArray(W.colors4[t]));for(t in W.colors4Arrays){s=W.colors4Arrays[t].reduce((function(W,i,L){return L%4===0?W.push([i]):W[W.length-1].push(i),W}),[]).map((function(W){return x.g.FromArray(W)}));p.setColor4Array(t,s)}for(t in W.vectors2)p.setVector2(t,h.k.FromArray(W.vectors2[t]));for(t in W.vectors3)p.setVector3(t,h.m.FromArray(W.vectors3[t]));for(t in W.vectors4)p.setVector4(t,h.n.FromArray(W.vectors4[t]));for(t in W.quaternions)p.setQuaternion(t,h.g.FromArray(W.quaternions[t]));for(t in W.matrices)p.setMatrix(t,h.d.FromArray(W.matrices[t]));for(t in W.matrixArray)p._matrixArrays[t]=new Float32Array(W.matrixArray[t]);for(t in W.matrices3x3)p.setMatrix3x3(t,W.matrices3x3[t]);for(t in W.matrices2x2)p.setMatrix2x2(t,W.matrices2x2[t]);for(t in W.vectors2Arrays)p.setArray2(t,W.vectors2Arrays[t]);for(t in W.vectors3Arrays)p.setArray3(t,W.vectors3Arrays[t]);for(t in W.vectors4Arrays)p.setArray4(t,W.vectors4Arrays[t]);for(t in W.quaternionsArrays)p.setArray4(t,W.quaternionsArrays[t]);return p},i.ParseFromFileAsync=function(W,i,L,h){var l=this;return void 0===h&&(h=""),new Promise((function(t,p){var x=new S.d;x.addEventListener("readystatechange",(function(){if(4==x.readyState)if(200==x.status){var i=JSON.parse(x.responseText),R=l.Parse(i,L||e.d.LastCreatedScene,h);W&&(R.name=W),t(R)}else p("Unable to load the ShaderMaterial")})),x.open("GET",i),x.send()}))},i.CreateFromSnippetAsync=function(W,i,L){var h=this;return void 0===L&&(L=""),new Promise((function(l,t){var p=new S.d;p.addEventListener("readystatechange",(function(){if(4==p.readyState)if(200==p.status){var x=JSON.parse(JSON.parse(p.responseText).jsonPayload),R=JSON.parse(x.shaderMaterial),z=h.Parse(R,i||e.d.LastCreatedScene,L);z.snippetId=W,l(z)}else t("Unable to load the snippet "+W)})),p.open("GET",h.SnippetUrl+"/"+W.replace(/#/g,"/")),p.send()}))},i.SnippetUrl="https://snippet.babylonjs.com",i}(C.d);(0,o.c)("BABYLON.ShaderMaterial",c);var f=L(16179),a=(L(76578),L(84098),"#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}");f.e.ShadersStore.colorPixelShader=a;L(31377),L(54001),L(49329),L(16554),L(50511),L(97202),L(48623),L(61906),L(35738);var P="attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#include<vertexColorMixing>\n#define CUSTOM_VERTEX_MAIN_END\n}";f.e.ShadersStore.colorVertexShader=P;l.e._LinesMeshParser=function(W,i){return y.Parse(W,i)};var y=function(W){function i(i,L,h,l,t,p,z,r){void 0===L&&(L=null),void 0===h&&(h=null),void 0===l&&(l=null);var N=W.call(this,i,L,h,l,t)||this;N.useVertexColor=p,N.useVertexAlpha=z,N.color=new x.d(1,1,1),N.alpha=1,l&&(N.color=l.color.clone(),N.alpha=l.alpha,N.useVertexColor=l.useVertexColor,N.useVertexAlpha=l.useVertexAlpha),N.intersectionThreshold=.1;var I={attributes:[R.d.PositionKind],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null};return!1===z?I.needAlphaBlending=!1:I.defines.push("#define VERTEXALPHA"),p?(I.defines.push("#define VERTEXCOLOR"),I.attributes.push(R.d.ColorKind)):(I.uniforms.push("color"),N._color4=new x.g),N.material=r||new c("colorShader",N.getScene(),"color",I,!1),N}return(0,p.n)(i,W),i.prototype._isShaderMaterial=function(W){return"ShaderMaterial"===W.getClassName()},i.prototype.isReady=function(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage)&&W.prototype.isReady.call(this)},i.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(i.prototype,"material",{get:function(){return this._lineMaterial},set:function(W){this._lineMaterial=W,this._lineMaterial.fillMode=r.b.LineListDrawMode},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return!1},set:function(W){},enumerable:!1,configurable:!0}),i.prototype._bind=function(){if(!this._geometry)return this;var W=this._lineMaterial.getEffect(),i=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._userInstancedBuffersStorage?this._geometry._bind(W,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(W,i),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){var L=this.color,h=L.r,l=L.g,t=L.b;this._color4.set(h,l,t,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this},i.prototype._draw=function(W,i,L){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var h=this.getScene().getEngine();return this._unIndexed?h.drawArraysType(r.b.LineListDrawMode,W.verticesStart,W.verticesCount,L):h.drawElementsType(r.b.LineListDrawMode,W.indexStart,W.indexCount,L),this},i.prototype.dispose=function(i){this._lineMaterial.dispose(!1,!1,!0),W.prototype.dispose.call(this,i)},i.prototype.clone=function(W,L,h){return void 0===L&&(L=null),new i(W,this.getScene(),L,this,h)},i.prototype.createInstance=function(W){var i=new M(W,this);if(this.instancedBuffers)for(var L in i.instancedBuffers={},this.instancedBuffers)i.instancedBuffers[L]=this.instancedBuffers[L];return i},i.prototype.serialize=function(i){W.prototype.serialize.call(this,i),i.color=this.color.asArray(),i.alpha=this.alpha},i.Parse=function(W,L){var h=new i(W.name,L);return h.color=x.d.FromArray(W.color),h.alpha=W.alpha,h},i}(l.e),M=function(W){function i(i,L){var h=W.call(this,i,L)||this;return h.intersectionThreshold=L.intersectionThreshold,h}return(0,p.n)(i,W),i.prototype.getClassName=function(){return"InstancedLinesMesh"},i}(z.b),b=L(9127);function j(W){for(var i=[],L=[],h=W.lines,l=W.colors,p=[],x=0,R=0;R<h.length;R++)for(var z=h[R],r=0;r<z.length;r++){if(L.push(z[r].x,z[r].y,z[r].z),l){var N=l[R];p.push(N[r].r,N[r].g,N[r].b,N[r].a)}r>0&&(i.push(x-1),i.push(x)),x++}var I=new t.e;return I.indices=i,I.positions=L,l&&(I.colors=p),I}function Z(W){var i,L,l=W.dashSize||3,p=W.gapSize||1,x=W.dashNb||200,R=W.points,z=new Array,r=new Array,N=h.m.Zero(),I=0,s=0,o=0,D=0,S=0;for(S=0;S<R.length-1;S++)R[S+1].subtractToRef(R[S],N),I+=N.length();for(L=l*(i=I/x)/(l+p),S=0;S<R.length-1;S++){R[S+1].subtractToRef(R[S],N),s=Math.floor(N.length()/i),N.normalize();for(var C=0;C<s;C++)o=i*C,z.push(R[S].x+o*N.x,R[S].y+o*N.y,R[S].z+o*N.z),z.push(R[S].x+(o+L)*N.x,R[S].y+(o+L)*N.y,R[S].z+(o+L)*N.z),r.push(D,D+1),D+=2}var e=new t.e;return e.positions=z,e.indices=r,e}function X(W,i,L){var h=i.instance,l=i.lines,t=i.colors;if(h){var p=h.getVerticesData(R.d.PositionKind),x=void 0,z=void 0;t&&(x=h.getVerticesData(R.d.ColorKind));for(var r=0,N=0,I=0;I<l.length;I++)for(var s=l[I],o=0;o<s.length;o++)p[r]=s[o].x,p[r+1]=s[o].y,p[r+2]=s[o].z,t&&x&&(z=t[I],x[N]=z[o].r,x[N+1]=z[o].g,x[N+2]=z[o].b,x[N+3]=z[o].a,N+=4),r+=3;return h.updateVerticesData(R.d.PositionKind,p,!1,!1),t&&x&&h.updateVerticesData(R.d.ColorKind,x,!1,!1),h}var D=new y(W,L,null,void 0,void 0,!!t,i.useVertexAlpha,i.material);return j(i).applyToMesh(D,i.updatable),D}function T(W,i,L){void 0===L&&(L=null);var h=i.colors?[i.colors]:null;return X(W,{lines:[i.points],updatable:i.updatable,instance:i.instance,colors:h,useVertexAlpha:i.useVertexAlpha,material:i.material},L)}function F(W,i,L){void 0===L&&(L=null);var t=i.points,p=i.instance,x=i.gapSize||1,R=i.dashSize||3;if(p){return(i.dashNb||i.dashSize||i.gapSize||i.useVertexAlpha||i.material)&&b.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),p.updateMeshPositions((function(W){var i,L,l=h.m.Zero(),x=W.length/6,R=0,z=0,r=0,N=0,I=0,s=0;for(I=0;I<t.length-1;I++)t[I+1].subtractToRef(t[I],l),R+=l.length();i=R/x;var o=p._creationDataStorage.dashSize;for(L=o*i/(o+p._creationDataStorage.gapSize),I=0;I<t.length-1;I++)for(t[I+1].subtractToRef(t[I],l),z=Math.floor(l.length()/i),l.normalize(),s=0;s<z&&N<W.length;)r=i*s,W[N]=t[I].x+r*l.x,W[N+1]=t[I].y+r*l.y,W[N+2]=t[I].z+r*l.z,W[N+3]=t[I].x+(r+L)*l.x,W[N+4]=t[I].y+(r+L)*l.y,W[N+5]=t[I].z+(r+L)*l.z,N+=6,s++;for(;N<W.length;)W[N]=t[I].x,W[N+1]=t[I].y,W[N+2]=t[I].z,N+=3}),!1),p}var z=new y(W,L,null,void 0,void 0,void 0,i.useVertexAlpha,i.material);return Z(i).applyToMesh(z,i.updatable),z._creationDataStorage=new l.i,z._creationDataStorage.dashSize=R,z._creationDataStorage.gapSize=x,z}t.e.CreateLineSystem=j,t.e.CreateDashedLines=Z,l.e.CreateLines=function(W,i,L,h,l){return void 0===L&&(L=null),void 0===h&&(h=!1),void 0===l&&(l=null),T(W,{points:i,updatable:h,instance:l},L)},l.e.CreateDashedLines=function(W,i,L,h,l,t,p,x){return void 0===t&&(t=null),F(W,{points:i,dashSize:L,gapSize:h,dashNb:l,updatable:p,instance:x},t)}},49620:function(W,i,L){"use strict";L.d(i,{b:function(){return x},d:function(){return R}});var h=L(65847),l=L(85779),t=L(20334);function p(W){var i=[],L=[],h=[],p=[],x=W.width||W.size||1,R=W.height||W.size||1,z=0===W.sideOrientation?0:W.sideOrientation||l.e.DEFAULTSIDE,r=x/2,N=R/2;L.push(-r,-N,0),h.push(0,0,-1),p.push(0,t.d.UseOpenGLOrientationForUV?1:0),L.push(r,-N,0),h.push(0,0,-1),p.push(1,t.d.UseOpenGLOrientationForUV?1:0),L.push(r,N,0),h.push(0,0,-1),p.push(1,t.d.UseOpenGLOrientationForUV?0:1),L.push(-r,N,0),h.push(0,0,-1),p.push(0,t.d.UseOpenGLOrientationForUV?0:1),i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),l.e._ComputeSides(z,L,i,h,p,W.frontUVs,W.backUVs);var I=new l.e;return I.indices=i,I.positions=L,I.normals=h,I.uvs=p,I}function x(W,i,L){void 0===i&&(i={}),void 0===L&&(L=null);var l=new h.e(W,L);return i.sideOrientation=h.e._GetDefaultSideOrientation(i.sideOrientation),l._originalBuilderSideOrientation=i.sideOrientation,p(i).applyToMesh(l,i.updatable),i.sourcePlane&&(l.translate(i.sourcePlane.normal,-i.sourcePlane.d),l.setDirection(i.sourcePlane.normal.scale(-1))),l}var R={CreatePlane:x};l.e.CreatePlane=p,h.e.CreatePlane=function(W,i,L,h,l){return x(W,{size:i,width:i,height:i,sideOrientation:l,updatable:h},L)}},71898:function(W,i,L){"use strict";L.d(i,{b:function(){return R}});var h=L(80105),l=L(65847),t=L(85779),p=L(20334);function x(W){for(var i=W.segments||32,L=W.diameterX||W.diameter||1,l=W.diameterY||W.diameter||1,x=W.diameterZ||W.diameter||1,R=W.arc&&(W.arc<=0||W.arc>1)?1:W.arc||1,z=W.slice&&W.slice<=0?1:W.slice||1,r=0===W.sideOrientation?0:W.sideOrientation||t.e.DEFAULTSIDE,N=!!W.dedupTopBottomIndices,I=new h.m(L/2,l/2,x/2),s=2+i,o=2*s,D=[],S=[],C=[],e=[],V=0;V<=s;V++){for(var c=V/s,f=c*Math.PI*z,a=0;a<=o;a++){var P=a/o,y=P*Math.PI*2*R,M=h.d.RotationZ(-f),b=h.d.RotationY(y),j=h.m.TransformCoordinates(h.m.Up(),M),Z=h.m.TransformCoordinates(j,b),X=Z.multiply(I),T=Z.divide(I).normalize();S.push(X.x,X.y,X.z),C.push(T.x,T.y,T.z),e.push(P,p.d.UseOpenGLOrientationForUV?1-c:c)}if(V>0)for(var F=S.length/3,q=F-2*(o+1);q+o+2<F;q++)N?(V>1&&(D.push(q),D.push(q+1),D.push(q+o+1)),(V<s||z<1)&&(D.push(q+o+1),D.push(q+1),D.push(q+o+2))):(D.push(q),D.push(q+1),D.push(q+o+1),D.push(q+o+1),D.push(q+1),D.push(q+o+2))}t.e._ComputeSides(r,S,D,C,e,W.frontUVs,W.backUVs);var H=new t.e;return H.indices=D,H.positions=S,H.normals=C,H.uvs=e,H}function R(W,i,L){void 0===i&&(i={}),void 0===L&&(L=null);var h=new l.e(W,L);return i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,x(i).applyToMesh(h,i.updatable),h}t.e.CreateSphere=x,l.e.CreateSphere=function(W,i,L,h,l,t){return R(W,{segments:i,diameterX:L,diameterY:L,diameterZ:L,sideOrientation:t,updatable:l},h)}},40689:function(W,i,L){"use strict";L.d(i,{e:function(){return r}});var h=L(9217),l=L(40061),t=function(){function W(W){this._pendingActions=new Array,this._workerInfos=W.map((function(W){return{workerPromise:Promise.resolve(W),idle:!0}}))}return W.prototype.dispose=function(){for(var W=0,i=this._workerInfos;W<i.length;W++){i[W].workerPromise.then((function(W){W.terminate()}))}this._workerInfos.length=0,this._pendingActions.length=0},W.prototype.push=function(W){this._executeOnIdleWorker(W)||this._pendingActions.push(W)},W.prototype._executeOnIdleWorker=function(W){for(var i=0,L=this._workerInfos;i<L.length;i++){var h=L[i];if(h.idle)return this._execute(h,W),!0}return!1},W.prototype._execute=function(W,i){var L=this;W.idle=!1,W.workerPromise.then((function(h){i(h,(function(){var i=L._pendingActions.shift();i?L._execute(W,i):W.idle=!0}))}))},W}(),p=function(W){function i(L,h,l){void 0===l&&(l=i.DefaultOptions);var t=W.call(this,[])||this;return t._maxWorkers=L,t._createWorkerAsync=h,t._options=l,t}return(0,l.n)(i,W),i.prototype.push=function(W){if(!this._executeOnIdleWorker(W))if(this._workerInfos.length<this._maxWorkers){var i={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(i),this._execute(i,W)}else this._pendingActions.push(W)},i.prototype._execute=function(i,L){var h=this;i.timeoutId&&(clearTimeout(i.timeoutId),delete i.timeoutId),W.prototype._execute.call(this,i,(function(W,l){L(W,(function(){l(),i.idle&&(i.timeoutId=setTimeout((function(){i.workerPromise.then((function(W){W.terminate()}));var W=h._workerInfos.indexOf(i);-1!==W&&h._workerInfos.splice(W,1)}),h._options.idleTimeElapsedBeforeRelease))}))}))},i.DefaultOptions={idleTimeElapsedBeforeRelease:1e3},i}(t),x=L(85779);function R(W,i,L,h,l,t){var p=new W.DecoderBuffer;p.Init(i,i.byteLength);var x,R,z=new W.Decoder;try{var r=z.GetEncodedGeometryType(p);switch(r){case W.TRIANGULAR_MESH:x=new W.Mesh,R=z.DecodeBufferToMesh(p,x);break;case W.POINT_CLOUD:x=new W.PointCloud,R=z.DecodeBufferToPointCloud(p,x);break;default:throw new Error("Invalid geometry type ".concat(r))}if(!R.ok()||!x.ptr)throw new Error(R.error_msg());if(r===W.TRIANGULAR_MESH){var N=3*x.num_faces(),I=4*N,s=W._malloc(I);try{z.GetTrianglesUInt32Array(x,I,s);var o=new Uint32Array(N);o.set(new Uint32Array(W.HEAPF32.buffer,s,N)),h(o)}finally{W._free(s)}}var D=function(i,L,h){void 0===h&&(h=1);var t=L.num_components(),p=x.num_points(),R=p*t,r=R*Float32Array.BYTES_PER_ELEMENT,N=W._malloc(r);try{z.GetAttributeDataArrayForAllPoints(x,L,W.DT_FLOAT32,r,N);var I=new Float32Array(W.HEAPF32.buffer,N,R);if("color"===i&&3===t){for(var s=new Float32Array(4*p),o=0,D=0;o<s.length;o+=4,D+=t)s[o+0]=I[D+0],s[o+1]=I[D+1],s[o+2]=I[D+2],s[o+3]=1;l(i,s)}else{if((s=new Float32Array(R)).set(new Float32Array(W.HEAPF32.buffer,N,R)),1!==h)for(o=0;o<s.length;o++)s[o]=s[o]/h;l(i,s)}}finally{W._free(N)}};if(L)for(var S in L){var C=L[S];D(S,z.GetAttributeByUniqueId(x,C),t&&t[S]||1)}else{var e={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var S in e){if(-1!==(C=z.GetAttributeId(x,W[e[S]])))D(S,z.GetAttribute(x,C))}}}finally{x&&W.destroy(x),W.destroy(z),W.destroy(p)}}function z(){var W;onmessage=function(i){var L=i.data;switch(L.id){case"init":var h=L.decoder;h.url&&(importScripts(h.url),W=DracoDecoderModule({wasmBinary:h.wasmBinary})),postMessage("done");break;case"decodeMesh":if(!W)throw new Error("Draco decoder module is not available");W.then((function(W){R(W,L.dataView,L.attributes,(function(W){postMessage({id:"indices",value:W},[W.buffer])}),(function(W,i){postMessage({id:W,value:i},[i.buffer])})),postMessage("done")}))}}}var r=function(){function W(i){void 0===i&&(i=W.DefaultNumWorkers);var L=W.Configuration.decoder,l=L.wasmUrl&&L.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:h.h.GetAbsoluteUrl(L.wasmUrl),wasmBinaryPromise:h.h.LoadFileAsync(h.h.GetAbsoluteUrl(L.wasmBinaryUrl))}:{url:h.h.GetAbsoluteUrl(L.fallbackUrl),wasmBinaryPromise:Promise.resolve(void 0)};i&&"function"===typeof Worker?this._workerPoolPromise=l.wasmBinaryPromise.then((function(W){var L="".concat(R,"(").concat(z,")()"),h=URL.createObjectURL(new Blob([L],{type:"application/javascript"}));return new p(i,(function(){return new Promise((function(i,L){var t=new Worker(h),p=function W(i){t.removeEventListener("error",W),t.removeEventListener("message",x),L(i)},x=function W(L){"done"===L.data&&(t.removeEventListener("error",p),t.removeEventListener("message",W),i(t))};t.addEventListener("error",p),t.addEventListener("message",x),t.postMessage({id:"init",decoder:{url:l.url,wasmBinary:W}})}))}))})):this._decoderModulePromise=l.wasmBinaryPromise.then((function(W){if(!l.url)throw new Error("Draco decoder module is not available");return h.h.LoadScriptAsync(l.url).then((function(){return i=W,new Promise((function(W){DracoDecoderModule({wasmBinary:i}).then((function(i){W({module:i})}))}));var i}))}))}return Object.defineProperty(W,"DecoderAvailable",{get:function(){var i=W.Configuration.decoder;return!!(i.wasmUrl&&i.wasmBinaryUrl&&"object"===typeof WebAssembly||i.fallbackUrl)},enumerable:!1,configurable:!0}),W.GetDefaultNumWorkers=function(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(W,"Default",{get:function(){return W._Default||(W._Default=new W),W._Default},enumerable:!1,configurable:!0}),W.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then((function(W){W.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise},W.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then((function(){})):this._decoderModulePromise?this._decoderModulePromise.then((function(){})):Promise.resolve()},W.prototype.decodeMeshAsync=function(W,i,L){var h=W instanceof ArrayBuffer?new Uint8Array(W):W;if(this._workerPoolPromise)return this._workerPoolPromise.then((function(W){return new Promise((function(l,t){W.push((function(W,p){var R=new x.e,z=function i(L){W.removeEventListener("error",i),W.removeEventListener("message",r),t(L),p()},r=function i(h){if("done"===h.data)W.removeEventListener("error",z),W.removeEventListener("message",i),l(R),p();else if("indices"===h.data.id)R.indices=h.data.value;else{var t=L&&L[h.data.id]?L[h.data.id]:1;if(1!==t)for(var x=0;x<h.data.value.length;x++)h.data.value[x]=h.data.value[x]/t;R.set(h.data.value,h.data.id)}};W.addEventListener("error",z),W.addEventListener("message",r);var N=new Uint8Array(h.byteLength);N.set(new Uint8Array(h.buffer,h.byteOffset,h.byteLength)),W.postMessage({id:"decodeMesh",dataView:N,attributes:i},[N.buffer])}))}))}));if(this._decoderModulePromise)return this._decoderModulePromise.then((function(W){var l=new x.e;return R(W.module,h,i,(function(W){l.indices=W}),(function(W,i){l.set(i,W)}),L),l}));throw new Error("Draco decoder module is not available")},W.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},W.DefaultNumWorkers=W.GetDefaultNumWorkers(),W._Default=null,W}()},52644:function(W,i,L){"use strict";L.d(i,{e:function(){return a}});var h=L(40061),l=L(9271),t=L(80105),p=L(90690),x=L(43251),R=L(85779),z=L(77129),r=L(44904),N=L(97918),I=L(90534),s=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new t.m(0,0,0),this._diffPositionForCollisions=new t.m(0,0,0),this._collisionResponse=!0},o=L(50504),D=L(18445),S=L(9488),C=L(61686),e=L(54044),V=L(31709),c=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=t.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},f=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new c,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._meshCollisionData=new s,this._enableDistantPicking=!1},a=function(W){function i(L,h){void 0===h&&(h=null);var x=W.call(this,L,h,!1)||this;return x._internalAbstractMeshDataInfo=new f,x._waitingMaterialId=null,x.cullingStrategy=i.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,x.onCollideObservable=new l.c,x.onCollisionPositionChangeObservable=new l.c,x.onMaterialChangedObservable=new l.c,x.definedFacingForward=!0,x._occlusionQuery=null,x._renderingGroup=null,x.alphaIndex=Number.MAX_VALUE,x.isVisible=!0,x.isPickable=!0,x.isNearPickable=!1,x.isNearGrabbable=!1,x.showSubMeshesBoundingBox=!1,x.isBlocker=!1,x.enablePointerMoveEvents=!1,x.outlineColor=S.d.Red(),x.outlineWidth=.02,x.overlayColor=S.d.Red(),x.overlayAlpha=.5,x.useOctreeForRenderingSelection=!0,x.useOctreeForPicking=!0,x.useOctreeForCollisions=!0,x.alwaysSelectAsActiveMesh=!1,x.doNotSyncBoundingInfo=!1,x.actionManager=null,x.ellipsoid=new t.m(.5,1,.5),x.ellipsoidOffset=new t.m(0,0,0),x.edgesWidth=1,x.edgesColor=new S.g(1,0,0,1),x._edgesRenderer=null,x._masterMesh=null,x._boundingInfo=null,x._boundingInfoIsDirty=!0,x._renderId=0,x._intersectionsInProgress=new Array,x._unIndexed=!1,x._lightSources=new Array,x._waitingData={lods:null,actions:null,freezeWorldMatrix:null},x._bonesTransformMatrices=null,x._transformMatrixTexture=null,x.onRebuildObservable=new l.c,x._onCollisionPositionChange=function(W,i,L){void 0===L&&(L=null),i.subtractToRef(x._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,x._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),x._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>p.c.CollisionsEpsilon&&x.position.addInPlace(x._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),L&&x.onCollideObservable.notifyObservers(L),x.onCollisionPositionChangeObservable.notifyObservers(x.position)},x.getScene().addMesh(x),x._resyncLightSources(),x._uniformBuffer=new I.c(x.getScene().getEngine(),void 0,void 0,L,!x.getScene().getEngine().isWebGPU),x._buildUniformLayout(),x}return(0,h.n)(i,W),Object.defineProperty(i,"BILLBOARDMODE_NONE",{get:function(){return z.e.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_X",{get:function(){return z.e.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Y",{get:function(){return z.e.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Z",{get:function(){return z.e.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_ALL",{get:function(){return z.e.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_USE_POSITION",{get:function(){return z.e.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(W){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(W){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(W){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(W){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collisionRetryCount",{get:function(){return this._internalAbstractMeshDataInfo._collisionRetryCount},set:function(W){this._internalAbstractMeshDataInfo._collisionRetryCount=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"morphTargetManager",{get:function(){return this._internalAbstractMeshDataInfo._morphTargetManager},set:function(W){this._internalAbstractMeshDataInfo._morphTargetManager!==W&&(this._internalAbstractMeshDataInfo._morphTargetManager=W,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bakedVertexAnimationManager",{get:function(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager},set:function(W){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==W&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),i.prototype._syncGeometryWithMorphTargetManager=function(){},i.prototype._updateNonUniformScalingState=function(i){return!!W.prototype._updateNonUniformScalingState.call(this,i)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(i.prototype,"onCollide",{set:function(W){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onCollisionPositionChange",{set:function(W){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(W){if(this._internalAbstractMeshDataInfo._visibility!==W){var i=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=W,(1===i&&1!==W||1!==i&&1===W)&&this._markSubMeshesAsMiscDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._internalAbstractMeshDataInfo._renderingGroupId},set:function(W){this._internalAbstractMeshDataInfo._renderingGroupId=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._internalAbstractMeshDataInfo._material},set:function(W){this._internalAbstractMeshDataInfo._material!==W&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=W,W&&W.meshMap&&(W.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))},enumerable:!1,configurable:!0}),i.prototype.getMaterialForRenderPass=function(W){var i;return null===(i=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===i?void 0:i[W]},i.prototype.setMaterialForRenderPass=function(W,i){this.resetDrawCache(W),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[W]=i},Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(W){this._internalAbstractMeshDataInfo._receiveShadows!==W&&(this._internalAbstractMeshDataInfo._receiveShadows=W,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(W){this._internalAbstractMeshDataInfo._hasVertexAlpha!==W&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=W,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(W){this._internalAbstractMeshDataInfo._useVertexColors!==W&&(this._internalAbstractMeshDataInfo._useVertexColors=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(W){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==W&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(W){this._internalAbstractMeshDataInfo._numBoneInfluencers!==W&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(W){this._internalAbstractMeshDataInfo._applyFog!==W&&(this._internalAbstractMeshDataInfo._applyFog=W,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableDistantPicking",{get:function(){return this._internalAbstractMeshDataInfo._enableDistantPicking},set:function(W){this._internalAbstractMeshDataInfo._enableDistantPicking=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(W){W!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=W,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask},set:function(W){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(W)?-1:W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collisionResponse",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse},set:function(W){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collisionGroup",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup},set:function(W){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(W)?-1:W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"surroundingMeshes",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes},set:function(W){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(W){var i=this._internalAbstractMeshDataInfo._skeleton;i&&i.needInitialSkinMatrix&&i._unregisterMeshWithPoseMatrix(this),W&&W.needInitialSkinMatrix&&W._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=W,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()},i.prototype.transferToEffect=function(W){var i=this._uniformBuffer;i.updateMatrix("world",W),i.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),i.update()},i.prototype.getMeshUniformBuffer=function(){return this._uniformBuffer},i.prototype.getClassName=function(){return"AbstractMesh"},i.prototype.toString=function(W){var i="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var L=this._internalAbstractMeshDataInfo._skeleton;return L&&(i+=", skeleton: "+L.name),W&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],i+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),i},i.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==z.e.BILLBOARDMODE_NONE?this._masterMesh:W.prototype._getEffectiveParent.call(this)},i.prototype._getActionManagerForTrigger=function(W,i){if(void 0===i&&(i=!0),this.actionManager&&(i||this.actionManager.isRecursive)){if(!W)return this.actionManager;if(this.actionManager.hasSpecificTrigger(W))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(W,!1):null},i.prototype._rebuild=function(W){if(void 0===W&&(W=!1),this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var i=0,L=this.subMeshes;i<L.length;i++){L[i]._rebuild()}},i.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var W=0,i=this.getScene().lights;W<i.length;W++){var L=i[W];L.isEnabled()&&(L.canAffectMesh(this)&&this._lightSources.push(L))}this._markSubMeshesAsLightDirty()},i.prototype._resyncLightSource=function(W){var i=W.isEnabled()&&W.canAffectMesh(this),L=this._lightSources.indexOf(W),h=!1;if(-1===L){if(!i)return;this._lightSources.push(W)}else{if(i)return;h=!0,this._lightSources.splice(L,1)}this._markSubMeshesAsLightDirty(h)},i.prototype._unBindEffect=function(){for(var W=0,i=this.subMeshes;W<i.length;W++){i[W].setEffect(null)}},i.prototype._removeLightSource=function(W,i){var L=this._lightSources.indexOf(W);-1!==L&&(this._lightSources.splice(L,1),this._markSubMeshesAsLightDirty(i))},i.prototype._markSubMeshesAsDirty=function(W){if(this.subMeshes)for(var i=0,L=this.subMeshes;i<L.length;i++)for(var h=L[i],l=0;l<h._drawWrappers.length;++l){var t=h._drawWrappers[l];t&&t.defines&&t.defines.markAllAsDirty&&W(t.defines)}},i.prototype._markSubMeshesAsLightDirty=function(W){void 0===W&&(W=!1),this._markSubMeshesAsDirty((function(i){return i.markAsLightDirty(W)}))},i.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty((function(W){return W.markAsAttributesDirty()}))},i.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty((function(W){return W.markAsMiscDirty()}))},i.prototype.markAsDirty=function(W){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},i.prototype.resetDrawCache=function(W){if(this.subMeshes)for(var i=0,L=this.subMeshes;i<L.length;i++){L[i].resetDrawCache(W)}},Object.defineProperty(i.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.getLOD=function(W){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getTotalIndices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(W){return null},i.prototype.setVerticesData=function(W,i,L,h){return this},i.prototype.updateVerticesData=function(W,i,L,h){return this},i.prototype.setIndices=function(W,i){return this},i.prototype.isVerticesDataPresent=function(W){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)},i.prototype.setBoundingInfo=function(W){return this._boundingInfo=W,this},Object.defineProperty(i.prototype,"hasBoundingInfo",{get:function(){return null!==this._boundingInfo},enumerable:!1,configurable:!0}),i.prototype.buildBoundingInfo=function(W,i,L){return this._boundingInfo=new N.b(W,i,L),this._boundingInfo},i.prototype.normalizeToUnitCube=function(i,L,h){return void 0===i&&(i=!0),void 0===L&&(L=!1),W.prototype.normalizeToUnitCube.call(this,i,L,h)},Object.defineProperty(i.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(x.d.MatricesIndicesKind)&&this.isVerticesDataPresent(x.d.MatricesWeightsKind)},enumerable:!1,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._preActivateForIntermediateRendering=function(W){},i.prototype._activate=function(W,i){return this._renderId=W,!0},i.prototype._postActivate=function(){},i.prototype._freeze=function(){},i.prototype._unFreeze=function(){},i.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===z.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():W.prototype.getWorldMatrix.call(this)},i.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():W.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(i.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.movePOV=function(W,i,L){return this.position.addInPlace(this.calcMovePOV(W,i,L)),this},i.prototype.calcMovePOV=function(W,i,L){var h=new t.d;(this.rotationQuaternion?this.rotationQuaternion:t.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(h);var l=t.m.Zero(),p=this.definedFacingForward?-1:1;return t.m.TransformCoordinatesFromFloatsToRef(W*p,i,L*p,h,l),l},i.prototype.rotatePOV=function(W,i,L){return this.rotation.addInPlace(this.calcRotatePOV(W,i,L)),this},i.prototype.calcRotatePOV=function(W,i,L){var h=this.definedFacingForward?1:-1;return new t.m(W*h,i,L*h)},i.prototype.refreshBoundingInfo=function(W,i){return void 0===W&&(W=!1),void 0===i&&(i=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(W,i),null),this},i.prototype._refreshBoundingInfo=function(W,i){if(W){var L=(0,D.g)(W,0,this.getTotalVertices(),i);this._boundingInfo?this._boundingInfo.reConstruct(L.minimum,L.maximum):this._boundingInfo=new N.b(L.minimum,L.maximum)}if(this.subMeshes)for(var h=0;h<this.subMeshes.length;h++)this.subMeshes[h].refreshBoundingInfo(W);this._updateBoundingInfo()},i.prototype._getData=function(W,i,L,h){if(void 0===W&&(W=!1),void 0===i&&(i=!1),void 0===h&&(h=x.d.PositionKind),(L=null!==L&&void 0!==L?L:this.getVerticesData(h).slice())&&i&&this.morphTargetManager)for(var l=0,p=0,R=0;R<L.length;R++){for(var z=0;z<this.morphTargetManager.numTargets;z++){var r=this.morphTargetManager.getTarget(z),N=r.influence;if(N>0){var I=r.getPositions();I&&(L[R]+=(I[R]-L[R])*N)}}if(l++,h===x.d.PositionKind&&this._positions&&3===l){l=0;var s=3*p;this._positions[p++].copyFromFloats(L[s],L[s+1],L[s+2])}}if(L&&W&&this.skeleton){var o=this.getVerticesData(x.d.MatricesIndicesKind),D=this.getVerticesData(x.d.MatricesWeightsKind);if(D&&o){var S=this.numBoneInfluencers>4,C=S?this.getVerticesData(x.d.MatricesIndicesExtraKind):null,e=S?this.getVerticesData(x.d.MatricesWeightsExtraKind):null,V=this.skeleton.getTransformMatrices(this),c=t.h.Vector3[0],f=t.h.Matrix[0],a=t.h.Matrix[1],P=0;for(s=0;s<L.length;s+=3,P+=4){f.reset();var y=void 0,M=void 0;for(y=0;y<4;y++)(M=D[P+y])>0&&(t.d.FromFloat32ArrayToRefScaled(V,Math.floor(16*o[P+y]),M,a),f.addToSelf(a));if(S)for(y=0;y<4;y++)(M=e[P+y])>0&&(t.d.FromFloat32ArrayToRefScaled(V,Math.floor(16*C[P+y]),M,a),f.addToSelf(a));h===x.d.NormalKind?t.m.TransformNormalFromFloatsToRef(L[s],L[s+1],L[s+2],f,c):t.m.TransformCoordinatesFromFloatsToRef(L[s],L[s+1],L[s+2],f,c),c.toArray(L,s),h===x.d.PositionKind&&this._positions&&this._positions[s/3].copyFrom(c)}}}return L},i.prototype.getNormalsData=function(W,i){return void 0===W&&(W=!1),void 0===i&&(i=!1),this._getData(W,i,null,x.d.NormalKind)},i.prototype.getPositionData=function(W,i,L){return void 0===W&&(W=!1),void 0===i&&(i=!1),this._getData(W,i,L,x.d.PositionKind)},i.prototype._getPositionData=function(W,i){var L,h=this.getVerticesData(x.d.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),h&&(W&&this.skeleton||i&&this.morphTargetManager)){if(h=h.slice(),this._generatePointsArray(),this._positions){var l=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(l.length);for(var p=0;p<l.length;p++)this._internalAbstractMeshDataInfo._positions[p]=(null===(L=l[p])||void 0===L?void 0:L.clone())||new t.m}return this.getPositionData(W,i,h)}return h},i.prototype._updateBoundingInfo=function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new N.b(t.m.Zero(),t.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},i.prototype._updateSubMeshesBoundingInfo=function(W){if(!this.subMeshes)return this;for(var i=this.subMeshes.length,L=0;L<i;L++){var h=this.subMeshes[L];(i>1||!h.IsGlobal)&&h.updateBoundingInfo(W)}return this},i.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)},i.prototype.isInFrustum=function(W){return this.getBoundingInfo().isInFrustum(W,this.cullingStrategy)},i.prototype.isCompletelyInFrustum=function(W){return this.getBoundingInfo().isCompletelyInFrustum(W)},i.prototype.intersectsMesh=function(W,i,L){void 0===i&&(i=!1);var h=this.getBoundingInfo(),l=W.getBoundingInfo();if(h.intersects(l,i))return!0;if(L)for(var t=0,p=this.getChildMeshes();t<p.length;t++){if(p[t].intersectsMesh(W,i,!0))return!0}return!1},i.prototype.intersectsPoint=function(W){return this.getBoundingInfo().intersectsPoint(W)},Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions},set:function(W){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collider",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider},enumerable:!1,configurable:!0}),i.prototype.moveWithCollisions=function(W){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);var i=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=i.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,i.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,W,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this},i.prototype._collideForSubMesh=function(W,i,L){var h;if(this._generatePointsArray(),!this._positions)return this;if(!W._lastColliderWorldVertices||!W._lastColliderTransformMatrix.equals(i)){W._lastColliderTransformMatrix=i.clone(),W._lastColliderWorldVertices=[],W._trianglePlanes=[];for(var l=W.verticesStart,p=W.verticesStart+W.verticesCount,x=l;x<p;x++)W._lastColliderWorldVertices.push(t.m.TransformCoordinates(this._positions[x],i))}return L._collide(W._trianglePlanes,W._lastColliderWorldVertices,this.getIndices(),W.indexStart,W.indexStart+W.indexCount,W.verticesStart,!!W.getMaterial(),this,this._shouldConvertRHS(),7===(null===(h=W.getMaterial())||void 0===h?void 0:h.fillMode)),this},i.prototype._processCollisionsForSubMeshes=function(W,i){for(var L=this._scene.getCollidingSubMeshCandidates(this,W),h=L.length,l=0;l<h;l++){var t=L.data[l];h>1&&!t._checkCollision(W)||this._collideForSubMesh(t,i,W)}return this},i.prototype._shouldConvertRHS=function(){return!1},i.prototype._checkCollision=function(W){if(!this.getBoundingInfo()._checkCollision(W))return this;var i=t.h.Matrix[0],L=t.h.Matrix[1];return t.d.ScalingToRef(1/W._radius.x,1/W._radius.y,1/W._radius.z,i),this.worldMatrixFromCache.multiplyToRef(i,L),this._processCollisionsForSubMeshes(W,L),this},i.prototype._generatePointsArray=function(){return!1},i.prototype.intersects=function(W,i,L,h,l,p){void 0===h&&(h=!1),void 0===p&&(p=!1);var x=new r.e,R="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,z=this.getBoundingInfo();if(!this.subMeshes)return x;if(!p&&(!W.intersectsSphere(z.boundingSphere,R)||!W.intersectsBox(z.boundingBox,R)))return x;if(h)return x.hit=!p,x.pickedMesh=p?null:this,x.distance=p?0:t.m.Distance(W.origin,z.boundingSphere.center),x.subMeshId=0,x;if(!this._generatePointsArray())return x;for(var N=null,I=this._scene.getIntersectingSubMeshCandidates(this,W),s=I.length,o=!1,D=0;D<s;D++){var S=(C=I.data[D]).getMaterial();if(S&&(7==S.fillMode||0==S.fillMode||1==S.fillMode||2==S.fillMode||4==S.fillMode)){o=!0;break}}if(!o)return x.hit=!0,x.pickedMesh=this,x.distance=t.m.Distance(W.origin,z.boundingSphere.center),x.subMeshId=-1,x;for(D=0;D<s;D++){var C=I.data[D];if(!(s>1)||C.canIntersects(W)){var e=C.intersects(W,this._positions,this.getIndices(),i,L);if(e&&(i||!N||e.distance<N.distance)&&((N=e).subMeshId=D,i))break}}if(N){var V=null!==l&&void 0!==l?l:this.getWorldMatrix(),c=t.h.Vector3[0],f=t.h.Vector3[1];t.m.TransformCoordinatesToRef(W.origin,V,c),W.direction.scaleToRef(N.distance,f);var a=t.m.TransformNormal(f,V).addInPlace(c);return x.hit=!0,x.distance=t.m.Distance(c,a),x.pickedPoint=a,x.pickedMesh=this,x.bu=N.bu||0,x.bv=N.bv||0,x.subMeshFaceId=N.faceId,x.faceId=N.faceId+I.data[N.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),x.subMeshId=N.subMeshId,x}return x},i.prototype.clone=function(W,i,L){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},i.prototype.dispose=function(i,L){var h,l=this;for(void 0===L&&(L=!1),this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),h=0;h<this._intersectionsInProgress.length;h++){var t=this._intersectionsInProgress[h],p=t._intersectionsInProgress.indexOf(this);t._intersectionsInProgress.splice(p,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach((function(W){var i=W.includedOnlyMeshes.indexOf(l);-1!==i&&W.includedOnlyMeshes.splice(i,1),-1!==(i=W.excludedMeshes.indexOf(l))&&W.excludedMeshes.splice(i,1);var L=W.getShadowGenerator();if(L){var h=L.getShadowMap();h&&h.renderList&&-1!==(i=h.renderList.indexOf(l))&&h.renderList.splice(i,1)}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var x=this.getScene().getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,x.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),x.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){var R=this._parentContainer.meshes.indexOf(this);R>-1&&this._parentContainer.meshes.splice(R,1),this._parentContainer=null}if(L&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!i)for(h=0;h<this.getScene().particleSystems.length;h++)this.getScene().particleSystems[h].emitter===this&&(this.getScene().particleSystems[h].dispose(),h--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),W.prototype.dispose.call(this,i,L)},i.prototype.addChild=function(W,i){return void 0===i&&(i=!1),W.setParent(this,i),this},i.prototype.removeChild=function(W,i){return void 0===i&&(i=!1),W.setParent(null,i),this},i.prototype._initFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;W.facetNormals||(W.facetNormals=new Array),W.facetPositions||(W.facetPositions=new Array),W.facetPartitioning||(W.facetPartitioning=new Array),W.facetNb=this.getIndices().length/3|0,W.partitioningSubdivisions=W.partitioningSubdivisions?W.partitioningSubdivisions:10,W.partitioningBBoxRatio=W.partitioningBBoxRatio?W.partitioningBBoxRatio:1.01;for(var i=0;i<W.facetNb;i++)W.facetNormals[i]=t.m.Zero(),W.facetPositions[i]=t.m.Zero();return W.facetDataEnabled=!0,this},i.prototype.updateFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;W.facetDataEnabled||this._initFacetData();var i=this.getVerticesData(x.d.PositionKind),L=this.getIndices(),h=this.getVerticesData(x.d.NormalKind),l=this.getBoundingInfo();if(W.facetDepthSort&&!W.facetDepthSortEnabled){if(W.facetDepthSortEnabled=!0,L instanceof Uint16Array)W.depthSortedIndices=new Uint16Array(L);else if(L instanceof Uint32Array)W.depthSortedIndices=new Uint32Array(L);else{for(var p=!1,z=0;z<L.length;z++)if(L[z]>65535){p=!0;break}W.depthSortedIndices=p?new Uint32Array(L):new Uint16Array(L)}if(W.facetDepthSortFunction=function(W,i){return i.sqDistance-W.sqDistance},!W.facetDepthSortFrom){var r=this.getScene().activeCamera;W.facetDepthSortFrom=r?r.position:t.m.Zero()}W.depthSortedFacets=[];for(var N=0;N<W.facetNb;N++){var I={ind:3*N,sqDistance:0};W.depthSortedFacets.push(I)}W.invertedMatrix=t.d.Identity(),W.facetDepthSortOrigin=t.m.Zero()}W.bbSize.x=l.maximum.x-l.minimum.x>C.e?l.maximum.x-l.minimum.x:C.e,W.bbSize.y=l.maximum.y-l.minimum.y>C.e?l.maximum.y-l.minimum.y:C.e,W.bbSize.z=l.maximum.z-l.minimum.z>C.e?l.maximum.z-l.minimum.z:C.e;var s=W.bbSize.x>W.bbSize.y?W.bbSize.x:W.bbSize.y;if(s=s>W.bbSize.z?s:W.bbSize.z,W.subDiv.max=W.partitioningSubdivisions,W.subDiv.X=Math.floor(W.subDiv.max*W.bbSize.x/s),W.subDiv.Y=Math.floor(W.subDiv.max*W.bbSize.y/s),W.subDiv.Z=Math.floor(W.subDiv.max*W.bbSize.z/s),W.subDiv.X=W.subDiv.X<1?1:W.subDiv.X,W.subDiv.Y=W.subDiv.Y<1?1:W.subDiv.Y,W.subDiv.Z=W.subDiv.Z<1?1:W.subDiv.Z,W.facetParameters.facetNormals=this.getFacetLocalNormals(),W.facetParameters.facetPositions=this.getFacetLocalPositions(),W.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),W.facetParameters.bInfo=l,W.facetParameters.bbSize=W.bbSize,W.facetParameters.subDiv=W.subDiv,W.facetParameters.ratio=this.partitioningBBoxRatio,W.facetParameters.depthSort=W.facetDepthSort,W.facetDepthSort&&W.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(W.invertedMatrix),t.m.TransformCoordinatesToRef(W.facetDepthSortFrom,W.invertedMatrix,W.facetDepthSortOrigin),W.facetParameters.distanceTo=W.facetDepthSortOrigin),W.facetParameters.depthSortedFacets=W.depthSortedFacets,h&&R.e.ComputeNormals(i,L,h,W.facetParameters),W.facetDepthSort&&W.facetDepthSortEnabled){W.depthSortedFacets.sort(W.facetDepthSortFunction);var o=W.depthSortedIndices.length/3|0;for(N=0;N<o;N++){var D=W.depthSortedFacets[N].ind;W.depthSortedIndices[3*N]=L[D],W.depthSortedIndices[3*N+1]=L[D+1],W.depthSortedIndices[3*N+2]=L[D+2]}this.updateIndices(W.depthSortedIndices,void 0,!0)}return this},i.prototype.getFacetLocalNormals=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetNormals||this.updateFacetData(),W.facetNormals},i.prototype.getFacetLocalPositions=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetPositions||this.updateFacetData(),W.facetPositions},i.prototype.getFacetLocalPartitioning=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetPartitioning||this.updateFacetData(),W.facetPartitioning},i.prototype.getFacetPosition=function(W){var i=t.m.Zero();return this.getFacetPositionToRef(W,i),i},i.prototype.getFacetPositionToRef=function(W,i){var L=this.getFacetLocalPositions()[W],h=this.getWorldMatrix();return t.m.TransformCoordinatesToRef(L,h,i),this},i.prototype.getFacetNormal=function(W){var i=t.m.Zero();return this.getFacetNormalToRef(W,i),i},i.prototype.getFacetNormalToRef=function(W,i){var L=this.getFacetLocalNormals()[W];return t.m.TransformNormalToRef(L,this.getWorldMatrix(),i),this},i.prototype.getFacetsAtLocalCoordinates=function(W,i,L){var h=this.getBoundingInfo(),l=this._internalAbstractMeshDataInfo._facetData,t=Math.floor((W-h.minimum.x*l.partitioningBBoxRatio)*l.subDiv.X*l.partitioningBBoxRatio/l.bbSize.x),p=Math.floor((i-h.minimum.y*l.partitioningBBoxRatio)*l.subDiv.Y*l.partitioningBBoxRatio/l.bbSize.y),x=Math.floor((L-h.minimum.z*l.partitioningBBoxRatio)*l.subDiv.Z*l.partitioningBBoxRatio/l.bbSize.z);return t<0||t>l.subDiv.max||p<0||p>l.subDiv.max||x<0||x>l.subDiv.max?null:l.facetPartitioning[t+l.subDiv.max*p+l.subDiv.max*l.subDiv.max*x]},i.prototype.getClosestFacetAtCoordinates=function(W,i,L,h,l,p){void 0===l&&(l=!1),void 0===p&&(p=!0);var x=this.getWorldMatrix(),R=t.h.Matrix[5];x.invertToRef(R);var z=t.h.Vector3[8];t.m.TransformCoordinatesFromFloatsToRef(W,i,L,R,z);var r=this.getClosestFacetAtLocalCoordinates(z.x,z.y,z.z,h,l,p);return h&&t.m.TransformCoordinatesFromFloatsToRef(h.x,h.y,h.z,x,h),r},i.prototype.getClosestFacetAtLocalCoordinates=function(W,i,L,h,l,t){void 0===l&&(l=!1),void 0===t&&(t=!0);var p=null,x=0,R=0,z=0,r=0,N=0,I=0,s=0,o=0,D=this.getFacetLocalPositions(),S=this.getFacetLocalNormals(),C=this.getFacetsAtLocalCoordinates(W,i,L);if(!C)return null;for(var e,V,c,f=Number.MAX_VALUE,a=f,P=0;P<C.length;P++)V=S[e=C[P]],r=(W-(c=D[e]).x)*V.x+(i-c.y)*V.y+(L-c.z)*V.z,(!l||l&&t&&r>=0||l&&!t&&r<=0)&&(r=V.x*c.x+V.y*c.y+V.z*c.z,N=-(V.x*W+V.y*i+V.z*L-r)/(V.x*V.x+V.y*V.y+V.z*V.z),(a=(x=(I=W+V.x*N)-W)*x+(R=(s=i+V.y*N)-i)*R+(z=(o=L+V.z*N)-L)*z)<f&&(f=a,p=e,h&&(h.x=I,h.y=s,h.z=o)));return p},i.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},i.prototype.disableFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetDataEnabled&&(W.facetDataEnabled=!1,W.facetPositions=new Array,W.facetNormals=new Array,W.facetPartitioning=new Array,W.facetParameters=null,W.depthSortedIndices=new Uint32Array(0)),this},i.prototype.updateIndices=function(W,i,L){return void 0===L&&(L=!1),this},i.prototype.createNormals=function(W){var i,L=this.getVerticesData(x.d.PositionKind),h=this.getIndices();return i=this.isVerticesDataPresent(x.d.NormalKind)?this.getVerticesData(x.d.NormalKind):[],R.e.ComputeNormals(L,h,i,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(x.d.NormalKind,i,W),this},i.prototype.alignWithNormal=function(W,i){i||(i=e.e.Y);var L=t.h.Vector3[0],h=t.h.Vector3[1];return t.m.CrossToRef(i,W,h),t.m.CrossToRef(W,h,L),this.rotationQuaternion?t.g.RotationQuaternionFromAxisToRef(L,W,h,this.rotationQuaternion):t.m.RotationFromAxisToRef(L,W,h,this.rotation),this},i.prototype._checkOcclusionQuery=function(){return!1},i.prototype.disableEdgesRendering=function(){throw(0,o.b)("EdgesRenderer")},i.prototype.enableEdgesRendering=function(W,i,L){throw(0,o.b)("EdgesRenderer")},i.prototype.getConnectedParticleSystems=function(){var W=this;return this._scene.particleSystems.filter((function(i){return i.emitter===W}))},i.OCCLUSION_TYPE_NONE=0,i.OCCLUSION_TYPE_OPTIMISTIC=1,i.OCCLUSION_TYPE_STRICT=2,i.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,i.CULLINGSTRATEGY_STANDARD=0,i.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,i.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,i.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,i}(z.e);(0,V.c)("BABYLON.AbstractMesh",a)},3579:function(W,i,L){"use strict";L.d(i,{b:function(){return D}});var h=L(80105),l=L(9488),t=L(85779),p=L(43251),x=L(50384),R=L(97964),z=L(97918),r=L(9217),N=L(45883),I=L(18445),s=L(78588),o=L(20334),D=function(){function W(W,i,L,h,l){void 0===h&&(h=!1),void 0===l&&(l=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=i||s.d.LastCreatedScene,this._scene&&(this.id=W,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=h,L?this.setAllVerticesData(L,h):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),l&&(this.applyToMesh(l),l.computeWorldMatrix(!0)))}return Object.defineProperty(W.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(W){this._boundingBias?this._boundingBias.copyFrom(W):this._boundingBias=W.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),W.CreateGeometryForMesh=function(i){var L=new W(W.RandomId(),i.getScene());return L.applyToMesh(i),L},Object.defineProperty(W.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),W.prototype.getScene=function(){return this._scene},W.prototype.getEngine=function(){return this._engine},W.prototype.isReady=function(){return 1===this.delayLoadState||0===this.delayLoadState},Object.defineProperty(W.prototype,"doNotSerialize",{get:function(){for(var W=0;W<this._meshes.length;W++)if(!this._meshes[W].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),W.prototype._rebuild=function(){for(var W in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),this._vertexBuffers){this._vertexBuffers[W]._rebuild()}},W.prototype.setAllVerticesData=function(W,i){W.applyToGeometry(this,i),this._notifyUpdate()},W.prototype.setVerticesData=function(W,i,L,h){void 0===L&&(L=!1),L&&Array.isArray(i)&&(i=new Float32Array(i));var l=new p.d(this._engine,i,W,L,0===this._meshes.length,h);this.setVerticesBuffer(l)},W.prototype.removeVerticesData=function(W){this._vertexBuffers[W]&&(this._vertexBuffers[W].dispose(),delete this._vertexBuffers[W]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()},W.prototype.setVerticesBuffer=function(W,i,L){void 0===i&&(i=null),void 0===L&&(L=!0);var h=W.getKind();this._vertexBuffers[h]&&L&&this._vertexBuffers[h].dispose(),W._buffer&&W._buffer._increaseReferences(),this._vertexBuffers[h]=W;var l=this._meshes,t=l.length;if(h===p.d.PositionKind){var x=W.getData();null!=i?this._totalVertices=i:null!=x&&(this._totalVertices=x.length/(W.type===p.d.BYTE?W.byteStride:W.byteStride/4)),this._updateExtend(x),this._resetPointsArrayCache();for(var R=0;R<t;R++){var z=l[R];z.buildBoundingInfo(this._extend.minimum,this._extend.maximum),z._createGlobalSubMesh(z.isUnIndexed),z.computeWorldMatrix(!0),z.synchronizeInstances()}}this._notifyUpdate(h)},W.prototype.updateVerticesDataDirectly=function(W,i,L,h){void 0===h&&(h=!1);var l=this.getVertexBuffer(W);l&&(l.updateDirectly(i,L,h),this._notifyUpdate(W))},W.prototype.updateVerticesData=function(W,i,L){void 0===L&&(L=!1);var h=this.getVertexBuffer(W);h&&(h.update(i),W===p.d.PositionKind&&this._updateBoundingInfo(L,i),this._notifyUpdate(W))},W.prototype._updateBoundingInfo=function(W,i){if(W&&this._updateExtend(i),this._resetPointsArrayCache(),W)for(var L=0,h=this._meshes;L<h.length;L++){var l=h[L];l.hasBoundingInfo?l.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):l.buildBoundingInfo(this._extend.minimum,this._extend.maximum);for(var t=0,p=l.subMeshes;t<p.length;t++){p[t].refreshBoundingInfo()}}},W.prototype._bind=function(W,i,L,h){if(W){void 0===i&&(i=this._indexBuffer);var l=this.getVertexBuffers();if(l)if(i==this._indexBuffer&&(this._vertexArrayObjects||h)){var t=h||this._vertexArrayObjects;t[W.key]||(t[W.key]=this._engine.recordVertexArrayObject(l,i,W,L)),this._engine.bindVertexArrayObject(t[W.key],i)}else this._engine.bindBuffers(l,i,W,L)}},W.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},W.prototype.getVerticesData=function(W,i,L){var h=this.getVertexBuffer(W);return h?h.getFloatData(this._totalVertices,L||i&&1!==this._meshes.length):null},W.prototype.isVertexBufferUpdatable=function(W){var i=this._vertexBuffers[W];return!!i&&i.isUpdatable()},W.prototype.getVertexBuffer=function(W){return this.isReady()?this._vertexBuffers[W]:null},W.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},W.prototype.isVerticesDataPresent=function(W){return this._vertexBuffers?void 0!==this._vertexBuffers[W]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(W)},W.prototype.getVerticesDataKinds=function(){var W,i=[];if(!this._vertexBuffers&&this._delayInfo)for(W in this._delayInfo)i.push(W);else for(W in this._vertexBuffers)i.push(W);return i},W.prototype.updateIndices=function(W,i,L){if(void 0===L&&(L=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var h=W.length!==this._indices.length;if(L||(this._indices=W.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,W,i),h)for(var l=0,t=this._meshes;l<t.length;l++){t[l]._createGlobalSubMesh(!0)}}else this.setIndices(W,null,!0)},W.prototype.setIndices=function(W,i,L){void 0===i&&(i=null),void 0===L&&(L=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=W,this._indexBufferIsUpdatable=L,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,L)),void 0!=i&&(this._totalVertices=i);for(var h=0,l=this._meshes;h<l.length;h++){var t=l[h];t._createGlobalSubMesh(!0),t.synchronizeInstances()}this._notifyUpdate()},W.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},W.prototype.getIndices=function(W,i){if(!this.isReady())return null;var L=this._indices;return i||W&&1!==this._meshes.length?L.slice():L},W.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},W.prototype._releaseVertexArrayObject=function(W){void 0===W&&(W=null),W&&this._vertexArrayObjects&&this._vertexArrayObjects[W.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[W.key]),delete this._vertexArrayObjects[W.key])},W.prototype.releaseForMesh=function(W,i){var L=this._meshes,h=L.indexOf(W);-1!==h&&(L.splice(h,1),this._vertexArrayObjects&&W._invalidateInstanceVertexArrayObject(),W._geometry=null,0===L.length&&i&&this.dispose())},W.prototype.applyToMesh=function(W){if(W._geometry!==this){var i=W._geometry;i&&i.releaseForMesh(W),this._vertexArrayObjects&&W._invalidateInstanceVertexArrayObject();var L=this._meshes;W._geometry=this,W._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),L.push(W),this.isReady()?this._applyToMesh(W):this._boundingInfo&&W.setBoundingInfo(this._boundingInfo)}},W.prototype._updateExtend=function(W){if(void 0===W&&(W=null),this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!W&&!(W=this.getVerticesData(p.d.PositionKind)))return;this._extend=(0,I.g)(W,0,this._totalVertices,this.boundingBias,3)}},W.prototype._applyToMesh=function(W){var i=this._meshes.length;for(var L in this._vertexBuffers)1===i&&this._vertexBuffers[L].create(),L===p.d.PositionKind&&(this._extend||this._updateExtend(),W.buildBoundingInfo(this._extend.minimum,this._extend.maximum),W._createGlobalSubMesh(W.isUnIndexed),W._updateBoundingInfo());1===i&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),W._syncGeometryWithMorphTargetManager(),W.synchronizeInstances()},W.prototype._notifyUpdate=function(W){this.onGeometryUpdated&&this.onGeometryUpdated(this,W),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(var i=0,L=this._meshes;i<L.length;i++){L[i]._markSubMeshesAsAttributesDirty()}},W.prototype.load=function(W,i){2!==this.delayLoadState&&(this.isReady()?i&&i():(this.delayLoadState=2,this._queueLoad(W,i)))},W.prototype._queueLoad=function(W,i){var L=this;this.delayLoadingFile&&(W._addPendingData(this),W._loadFile(this.delayLoadingFile,(function(h){if(L._delayLoadingFunction){L._delayLoadingFunction(JSON.parse(h),L),L.delayLoadState=1,L._delayInfo=[],W._removePendingData(L);for(var l=L._meshes,t=l.length,p=0;p<t;p++)L._applyToMesh(l[p]);i&&i()}}),void 0,!0))},W.prototype.toLeftHanded=function(){var W=this.getIndices(!1);if(null!=W&&W.length>0){for(var i=0;i<W.length;i+=3){var L=W[i+0];W[i+0]=W[i+2],W[i+2]=L}this.setIndices(W)}var h=this.getVerticesData(p.d.PositionKind,!1);if(null!=h&&h.length>0){for(i=0;i<h.length;i+=3)h[i+2]=-h[i+2];this.setVerticesData(p.d.PositionKind,h,!1)}var l=this.getVerticesData(p.d.NormalKind,!1);if(null!=l&&l.length>0){for(i=0;i<l.length;i+=3)l[i+2]=-l[i+2];this.setVerticesData(p.d.NormalKind,l,!1)}},W.prototype._resetPointsArrayCache=function(){this._positions=null},W.prototype._generatePointsArray=function(){if(this._positions)return!0;var W=this.getVerticesData(p.d.PositionKind);if(!W||0===W.length)return!1;for(var i=3*this._positionsCache.length,L=this._positionsCache.length;i<W.length;i+=3,++L)this._positionsCache[L]=h.m.FromArray(W,i);for(i=0,L=0;i<W.length;i+=3,++L)this._positionsCache[L].set(W[0+i],W[1+i],W[2+i]);return this._positionsCache.length=W.length/3,this._positions=this._positionsCache,!0},W.prototype.isDisposed=function(){return this._isDisposed},W.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var W in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[W]);this._vertexArrayObjects={};for(var i=this._meshes,L=i.length,h=0;h<L;h++)i[h]._invalidateInstanceVertexArrayObject()}},W.prototype.dispose=function(){var W,i=this._meshes,L=i.length;for(W=0;W<L;W++)this.releaseForMesh(i[W]);for(var h in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[h].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){var l=this._parentContainer.geometries.indexOf(this);l>-1&&this._parentContainer.geometries.splice(l,1),this._parentContainer=null}this._isDisposed=!0},W.prototype.copy=function(i){var L=new t.e;L.indices=[];var h=this.getIndices();if(h)for(var l=0;l<h.length;l++)L.indices.push(h[l]);var p,x=!1,R=!1;for(p in this._vertexBuffers){var r=this.getVerticesData(p);if(r&&(r instanceof Float32Array?L.set(new Float32Array(r),p):L.set(r.slice(0),p),!R)){var N=this.getVertexBuffer(p);N&&(R=!(x=N.isUpdatable()))}}var I=new W(i,this._scene,L,x);for(p in I.delayLoadState=this.delayLoadState,I.delayLoadingFile=this.delayLoadingFile,I._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)I._delayInfo=I._delayInfo||[],I._delayInfo.push(p);return I._boundingInfo=new z.b(this._extend.minimum,this._extend.maximum),I},W.prototype.serialize=function(){var W={};return W.id=this.id,W.uniqueId=this.uniqueId,W.updatable=this._updatable,N.d&&N.d.HasTags(this)&&(W.tags=N.d.GetTags(this)),W},W.prototype._toNumberArray=function(W){return Array.isArray(W)?W:Array.prototype.slice.call(W)},W.prototype.clearCachedData=function(){for(var W in this._indices=[],this._resetPointsArrayCache(),this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,W)&&(this._vertexBuffers[W]._buffer._data=null)},W.prototype.serializeVerticeData=function(){var W=this.serialize();return this.isVerticesDataPresent(p.d.PositionKind)&&(W.positions=this._toNumberArray(this.getVerticesData(p.d.PositionKind)),this.isVertexBufferUpdatable(p.d.PositionKind)&&(W.positions._updatable=!0)),this.isVerticesDataPresent(p.d.NormalKind)&&(W.normals=this._toNumberArray(this.getVerticesData(p.d.NormalKind)),this.isVertexBufferUpdatable(p.d.NormalKind)&&(W.normals._updatable=!0)),this.isVerticesDataPresent(p.d.TangentKind)&&(W.tangents=this._toNumberArray(this.getVerticesData(p.d.TangentKind)),this.isVertexBufferUpdatable(p.d.TangentKind)&&(W.tangents._updatable=!0)),this.isVerticesDataPresent(p.d.UVKind)&&(W.uvs=this._toNumberArray(this.getVerticesData(p.d.UVKind)),this.isVertexBufferUpdatable(p.d.UVKind)&&(W.uvs._updatable=!0)),this.isVerticesDataPresent(p.d.UV2Kind)&&(W.uv2s=this._toNumberArray(this.getVerticesData(p.d.UV2Kind)),this.isVertexBufferUpdatable(p.d.UV2Kind)&&(W.uv2s._updatable=!0)),this.isVerticesDataPresent(p.d.UV3Kind)&&(W.uv3s=this._toNumberArray(this.getVerticesData(p.d.UV3Kind)),this.isVertexBufferUpdatable(p.d.UV3Kind)&&(W.uv3s._updatable=!0)),this.isVerticesDataPresent(p.d.UV4Kind)&&(W.uv4s=this._toNumberArray(this.getVerticesData(p.d.UV4Kind)),this.isVertexBufferUpdatable(p.d.UV4Kind)&&(W.uv4s._updatable=!0)),this.isVerticesDataPresent(p.d.UV5Kind)&&(W.uv5s=this._toNumberArray(this.getVerticesData(p.d.UV5Kind)),this.isVertexBufferUpdatable(p.d.UV5Kind)&&(W.uv5s._updatable=!0)),this.isVerticesDataPresent(p.d.UV6Kind)&&(W.uv6s=this._toNumberArray(this.getVerticesData(p.d.UV6Kind)),this.isVertexBufferUpdatable(p.d.UV6Kind)&&(W.uv6s._updatable=!0)),this.isVerticesDataPresent(p.d.ColorKind)&&(W.colors=this._toNumberArray(this.getVerticesData(p.d.ColorKind)),this.isVertexBufferUpdatable(p.d.ColorKind)&&(W.colors._updatable=!0)),this.isVerticesDataPresent(p.d.MatricesIndicesKind)&&(W.matricesIndices=this._toNumberArray(this.getVerticesData(p.d.MatricesIndicesKind)),W.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(p.d.MatricesIndicesKind)&&(W.matricesIndices._updatable=!0)),this.isVerticesDataPresent(p.d.MatricesWeightsKind)&&(W.matricesWeights=this._toNumberArray(this.getVerticesData(p.d.MatricesWeightsKind)),this.isVertexBufferUpdatable(p.d.MatricesWeightsKind)&&(W.matricesWeights._updatable=!0)),W.indices=this._toNumberArray(this.getIndices()),W},W.ExtractFromMesh=function(W,i){var L=W._geometry;return L?L.copy(i):null},W.RandomId=function(){return r.h.RandomId()},W._GetGeometryByLoadedUniqueId=function(W,i){for(var L=0;L<i.geometries.length;L++)if(i.geometries[L]._loadedUniqueId===W)return i.geometries[L];return null},W._ImportGeometry=function(i,L){var h=L.getScene(),t=i.geometryUniqueId,R=i.geometryId;if(t||R){var z=t?this._GetGeometryByLoadedUniqueId(t,h):h.getGeometryById(R);z&&z.applyToMesh(L)}else if(i instanceof ArrayBuffer){var r=L._binaryInfo;if(r.positionsAttrDesc&&r.positionsAttrDesc.count>0){var N=new Float32Array(i,r.positionsAttrDesc.offset,r.positionsAttrDesc.count);L.setVerticesData(p.d.PositionKind,N,!1)}if(r.normalsAttrDesc&&r.normalsAttrDesc.count>0){var I=new Float32Array(i,r.normalsAttrDesc.offset,r.normalsAttrDesc.count);L.setVerticesData(p.d.NormalKind,I,!1)}if(r.tangetsAttrDesc&&r.tangetsAttrDesc.count>0){var s=new Float32Array(i,r.tangetsAttrDesc.offset,r.tangetsAttrDesc.count);L.setVerticesData(p.d.TangentKind,s,!1)}if(r.uvsAttrDesc&&r.uvsAttrDesc.count>0){var D=new Float32Array(i,r.uvsAttrDesc.offset,r.uvsAttrDesc.count);if(o.d.UseOpenGLOrientationForUV)for(var S=1;S<D.length;S+=2)D[S]=1-D[S];L.setVerticesData(p.d.UVKind,D,!1)}if(r.uvs2AttrDesc&&r.uvs2AttrDesc.count>0){var C=new Float32Array(i,r.uvs2AttrDesc.offset,r.uvs2AttrDesc.count);if(o.d.UseOpenGLOrientationForUV)for(S=1;S<C.length;S+=2)C[S]=1-C[S];L.setVerticesData(p.d.UV2Kind,C,!1)}if(r.uvs3AttrDesc&&r.uvs3AttrDesc.count>0){var e=new Float32Array(i,r.uvs3AttrDesc.offset,r.uvs3AttrDesc.count);if(o.d.UseOpenGLOrientationForUV)for(S=1;S<e.length;S+=2)e[S]=1-e[S];L.setVerticesData(p.d.UV3Kind,e,!1)}if(r.uvs4AttrDesc&&r.uvs4AttrDesc.count>0){var V=new Float32Array(i,r.uvs4AttrDesc.offset,r.uvs4AttrDesc.count);if(o.d.UseOpenGLOrientationForUV)for(S=1;S<V.length;S+=2)V[S]=1-V[S];L.setVerticesData(p.d.UV4Kind,V,!1)}if(r.uvs5AttrDesc&&r.uvs5AttrDesc.count>0){var c=new Float32Array(i,r.uvs5AttrDesc.offset,r.uvs5AttrDesc.count);if(o.d.UseOpenGLOrientationForUV)for(S=1;S<c.length;S+=2)c[S]=1-c[S];L.setVerticesData(p.d.UV5Kind,c,!1)}if(r.uvs6AttrDesc&&r.uvs6AttrDesc.count>0){var f=new Float32Array(i,r.uvs6AttrDesc.offset,r.uvs6AttrDesc.count);if(o.d.UseOpenGLOrientationForUV)for(S=1;S<f.length;S+=2)f[S]=1-f[S];L.setVerticesData(p.d.UV6Kind,f,!1)}if(r.colorsAttrDesc&&r.colorsAttrDesc.count>0){var a=new Float32Array(i,r.colorsAttrDesc.offset,r.colorsAttrDesc.count);L.setVerticesData(p.d.ColorKind,a,!1,r.colorsAttrDesc.stride)}if(r.matricesIndicesAttrDesc&&r.matricesIndicesAttrDesc.count>0){for(var P=new Int32Array(i,r.matricesIndicesAttrDesc.offset,r.matricesIndicesAttrDesc.count),y=[],M=0;M<P.length;M++){S=P[M];y.push(255&S),y.push((65280&S)>>8),y.push((16711680&S)>>16),y.push(S>>24&255)}L.setVerticesData(p.d.MatricesIndicesKind,y,!1)}if(r.matricesIndicesExtraAttrDesc&&r.matricesIndicesExtraAttrDesc.count>0){for(P=new Int32Array(i,r.matricesIndicesExtraAttrDesc.offset,r.matricesIndicesExtraAttrDesc.count),y=[],M=0;M<P.length;M++){S=P[M];y.push(255&S),y.push((65280&S)>>8),y.push((16711680&S)>>16),y.push(S>>24&255)}L.setVerticesData(p.d.MatricesIndicesExtraKind,y,!1)}if(r.matricesWeightsAttrDesc&&r.matricesWeightsAttrDesc.count>0){var b=new Float32Array(i,r.matricesWeightsAttrDesc.offset,r.matricesWeightsAttrDesc.count);L.setVerticesData(p.d.MatricesWeightsKind,b,!1)}if(r.indicesAttrDesc&&r.indicesAttrDesc.count>0){var j=new Int32Array(i,r.indicesAttrDesc.offset,r.indicesAttrDesc.count);L.setIndices(j,null)}if(r.subMeshesAttrDesc&&r.subMeshesAttrDesc.count>0){var Z=new Int32Array(i,r.subMeshesAttrDesc.offset,5*r.subMeshesAttrDesc.count);L.subMeshes=[];for(M=0;M<r.subMeshesAttrDesc.count;M++){var X=Z[5*M+0],T=Z[5*M+1],F=Z[5*M+2],q=Z[5*M+3],H=Z[5*M+4];x.d.AddToMesh(X,T,F,q,H,L)}}}else if(i.positions&&i.normals&&i.indices){if(L.setVerticesData(p.d.PositionKind,i.positions,i.positions._updatable),L.setVerticesData(p.d.NormalKind,i.normals,i.normals._updatable),i.tangents&&L.setVerticesData(p.d.TangentKind,i.tangents,i.tangents._updatable),i.uvs&&L.setVerticesData(p.d.UVKind,i.uvs,i.uvs._updatable),i.uvs2&&L.setVerticesData(p.d.UV2Kind,i.uvs2,i.uvs2._updatable),i.uvs3&&L.setVerticesData(p.d.UV3Kind,i.uvs3,i.uvs3._updatable),i.uvs4&&L.setVerticesData(p.d.UV4Kind,i.uvs4,i.uvs4._updatable),i.uvs5&&L.setVerticesData(p.d.UV5Kind,i.uvs5,i.uvs5._updatable),i.uvs6&&L.setVerticesData(p.d.UV6Kind,i.uvs6,i.uvs6._updatable),i.colors&&L.setVerticesData(p.d.ColorKind,l.g.CheckColors4(i.colors,i.positions.length/3),i.colors._updatable),i.matricesIndices)if(i.matricesIndices._isExpanded)delete i.matricesIndices._isExpanded,L.setVerticesData(p.d.MatricesIndicesKind,i.matricesIndices,i.matricesIndices._updatable);else{for(y=[],M=0;M<i.matricesIndices.length;M++){var k=i.matricesIndices[M];y.push(255&k),y.push((65280&k)>>8),y.push((16711680&k)>>16),y.push(k>>24&255)}L.setVerticesData(p.d.MatricesIndicesKind,y,i.matricesIndices._updatable)}if(i.matricesIndicesExtra)if(i.matricesIndicesExtra._isExpanded)delete i.matricesIndices._isExpanded,L.setVerticesData(p.d.MatricesIndicesExtraKind,i.matricesIndicesExtra,i.matricesIndicesExtra._updatable);else{for(y=[],M=0;M<i.matricesIndicesExtra.length;M++){k=i.matricesIndicesExtra[M];y.push(255&k),y.push((65280&k)>>8),y.push((16711680&k)>>16),y.push(k>>24&255)}L.setVerticesData(p.d.MatricesIndicesExtraKind,y,i.matricesIndicesExtra._updatable)}i.matricesWeights&&(W._CleanMatricesWeights(i,L),L.setVerticesData(p.d.MatricesWeightsKind,i.matricesWeights,i.matricesWeights._updatable)),i.matricesWeightsExtra&&L.setVerticesData(p.d.MatricesWeightsExtraKind,i.matricesWeightsExtra,i.matricesWeights._updatable),L.setIndices(i.indices,null)}if(i.subMeshes){L.subMeshes=[];for(var U=0;U<i.subMeshes.length;U++){var d=i.subMeshes[U];x.d.AddToMesh(d.materialIndex,d.verticesStart,d.verticesCount,d.indexStart,d.indexCount,L)}}L._shouldGenerateFlatShading&&(L.convertToFlatShadedMesh(),L._shouldGenerateFlatShading=!1),L.computeWorldMatrix(!0),h.onMeshImportedObservable.notifyObservers(L)},W._CleanMatricesWeights=function(W,i){var L=.001;if(R.e.CleanBoneMatrixWeights){var h=0;if(W.skeletonId>-1){var l=i.getScene().getLastSkeletonById(W.skeletonId);if(l){h=l.bones.length;for(var t=i.getVerticesData(p.d.MatricesIndicesKind),x=i.getVerticesData(p.d.MatricesIndicesExtraKind),z=W.matricesWeights,r=W.matricesWeightsExtra,N=W.numBoneInfluencer,I=z.length,s=0;s<I;s+=4){for(var o=0,D=-1,S=0;S<4;S++){o+=C=z[s+S],C<L&&D<0&&(D=S)}if(r)for(S=0;S<4;S++){var C;o+=C=r[s+S],C<L&&D<0&&(D=S+4)}if((D<0||D>N-1)&&(D=N-1),o>L){var e=1/o;for(S=0;S<4;S++)z[s+S]*=e;if(r)for(S=0;S<4;S++)r[s+S]*=e}else D>=4?(r[s+D-4]=1-o,x[s+D-4]=h):(z[s+D]=1-o,t[s+D]=h)}i.setVerticesData(p.d.MatricesIndicesKind,t),W.matricesWeightsExtra&&i.setVerticesData(p.d.MatricesIndicesExtraKind,x)}}}},W.Parse=function(i,L,l){var x=new W(i.id,L,void 0,i.updatable);return x._loadedUniqueId=i.uniqueId,N.d&&N.d.AddTagsTo(x,i.tags),i.delayLoadingFile?(x.delayLoadState=4,x.delayLoadingFile=l+i.delayLoadingFile,x._boundingInfo=new z.b(h.m.FromArray(i.boundingBoxMinimum),h.m.FromArray(i.boundingBoxMaximum)),x._delayInfo=[],i.hasUVs&&x._delayInfo.push(p.d.UVKind),i.hasUVs2&&x._delayInfo.push(p.d.UV2Kind),i.hasUVs3&&x._delayInfo.push(p.d.UV3Kind),i.hasUVs4&&x._delayInfo.push(p.d.UV4Kind),i.hasUVs5&&x._delayInfo.push(p.d.UV5Kind),i.hasUVs6&&x._delayInfo.push(p.d.UV6Kind),i.hasColors&&x._delayInfo.push(p.d.ColorKind),i.hasMatricesIndices&&x._delayInfo.push(p.d.MatricesIndicesKind),i.hasMatricesWeights&&x._delayInfo.push(p.d.MatricesWeightsKind),x._delayLoadingFunction=t.e.ImportVertexData):t.e.ImportVertexData(i,x),L.pushGeometry(x,!0),x},W}()},35941:function(W,i,L){"use strict";L.d(i,{b:function(){return N}});var h=L(40061),l=L(80105),t=L(9127),p=L(52644),x=L(65847),R=L(51004),z=L(77129),r=L(43251);x.e._instancedMeshFactory=function(W,i){var L=new N(W,i);if(i.instancedBuffers)for(var h in L.instancedBuffers={},i.instancedBuffers)L.instancedBuffers[h]=i.instancedBuffers[h];return L};var N=function(W){function i(i,L){var h=W.call(this,i,L.getScene())||this;h._indexInSourceMeshInstanceArray=-1,h._distanceToCamera=0,L.addInstance(h),h._sourceMesh=L,h._unIndexed=L._unIndexed,h.position.copyFrom(L.position),h.rotation.copyFrom(L.rotation),h.scaling.copyFrom(L.scaling),L.rotationQuaternion&&(h.rotationQuaternion=L.rotationQuaternion.clone()),h.animations=L.animations.slice();for(var l=0,t=L.getAnimationRanges();l<t.length;l++){var p=t[l];null!=p&&h.createAnimationRange(p.name,p.from,p.to)}return h.infiniteDistance=L.infiniteDistance,h.setPivotMatrix(L.getPivotMatrix()),h.refreshBoundingInfo(!0,!0),h._syncSubMeshes(),h}return(0,h.n)(i,W),i.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(i.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),i.prototype._resyncLightSources=function(){},i.prototype._resyncLightSource=function(){},i.prototype._removeLightSource=function(){},Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(W){this._sourceMesh&&W!==this._sourceMesh.renderingGroupId&&t.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},i.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(i.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),i.prototype.createInstance=function(W){return this._sourceMesh.createInstance(W)},i.prototype.isReady=function(W){return void 0===W&&(W=!1),this._sourceMesh.isReady(W,!0)},i.prototype.getVerticesData=function(W,i){return this._sourceMesh.getVerticesData(W,i)},i.prototype.setVerticesData=function(W,i,L,h){return this.sourceMesh&&this.sourceMesh.setVerticesData(W,i,L,h),this.sourceMesh},i.prototype.updateVerticesData=function(W,i,L,h){return this.sourceMesh&&this.sourceMesh.updateVerticesData(W,i,L,h),this.sourceMesh},i.prototype.setIndices=function(W,i){return void 0===i&&(i=null),this.sourceMesh&&this.sourceMesh.setIndices(W,i),this.sourceMesh},i.prototype.isVerticesDataPresent=function(W){return this._sourceMesh.isVerticesDataPresent(W)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),i.prototype.refreshBoundingInfo=function(W,i){if(void 0===W&&(W=!1),void 0===i&&(i=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var L=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(W,i),L),this},i.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},i.prototype._activate=function(i,L){if(W.prototype._activate.call(this,i,L),this._sourceMesh.subMeshes||t.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,i),L){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},i.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},i.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==z.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new l.d);var i=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,l.h.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(l.h.Vector3[7]),this._currentLOD._masterMesh=i,this._billboardWorldMatrix}return W.prototype.getWorldMatrix.call(this)},Object.defineProperty(i.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype.getLOD=function(W){if(!W)return this;var i=this.sourceMesh.getLODLevels();if(i&&0!==i.length){var L=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(W,L.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD},i.prototype._preActivateForIntermediateRendering=function(W){return this.sourceMesh._preActivateForIntermediateRendering(W)},i.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var W=0;W<this._sourceMesh.subMeshes.length;W++)this._sourceMesh.subMeshes[W].clone(this,this._sourceMesh);return this},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype._updateBoundingInfo=function(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},i.prototype.clone=function(W,i,L){void 0===i&&(i=null);var h=this._sourceMesh.createInstance(W);if(R.e.DeepCopy(this,h,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),i&&(h.parent=i),!L)for(var l=0;l<this.getScene().meshes.length;l++){var t=this.getScene().meshes[l];t.parent===this&&t.clone(t.name,h)}return h.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(h),h},i.prototype.dispose=function(i,L){void 0===L&&(L=!1),this._sourceMesh.removeInstance(this),W.prototype.dispose.call(this,i,L)},i.prototype._serializeAsParent=function(i){W.prototype._serializeAsParent.call(this,i),i.parentId=this._sourceMesh.uniqueId,i.parentInstanceIndex=this._indexInSourceMeshInstanceArray},i}(p.e);x.e.prototype.registerInstancedBuffer=function(W,i){var L,h;if(null===(h=null===(L=this._userInstancedBuffersStorage)||void 0===L?void 0:L.vertexBuffers[W])||void 0===h||h.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(var l=0,t=this.instances;l<t.length;l++){t[l].instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0})}this.instancedBuffers[W]=null,this._userInstancedBuffersStorage.strides[W]=i,this._userInstancedBuffersStorage.sizes[W]=32*i,this._userInstancedBuffersStorage.data[W]=new Float32Array(this._userInstancedBuffersStorage.sizes[W]),this._userInstancedBuffersStorage.vertexBuffers[W]=new r.d(this.getEngine(),this._userInstancedBuffersStorage.data[W],W,!0,!1,i,!0);for(var p=0,x=this.instances;p<x.length;p++){x[p].instancedBuffers[W]=null}this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},x.e.prototype._processInstancedBuffers=function(W,i){var L=W.length;for(var h in this.instancedBuffers){for(var l=this._userInstancedBuffersStorage.sizes[h],t=this._userInstancedBuffersStorage.strides[h],p=(L+1)*t;l<p;)l*=2;this._userInstancedBuffersStorage.data[h].length!=l&&(this._userInstancedBuffersStorage.data[h]=new Float32Array(l),this._userInstancedBuffersStorage.sizes[h]=l,this._userInstancedBuffersStorage.vertexBuffers[h]&&(this._userInstancedBuffersStorage.vertexBuffers[h].dispose(),this._userInstancedBuffersStorage.vertexBuffers[h]=null));var x=this._userInstancedBuffersStorage.data[h],R=0;if(i)(N=this.instancedBuffers[h]).toArray?N.toArray(x,R):N.copyToArray?N.copyToArray(x,R):x[R]=N,R+=t;for(var z=0;z<L;z++){var N;(N=W[z].instancedBuffers[h]).toArray?N.toArray(x,R):N.copyToArray?N.copyToArray(x,R):x[R]=N,R+=t}this._userInstancedBuffersStorage.vertexBuffers[h]?this._userInstancedBuffersStorage.vertexBuffers[h].updateDirectly(x,0):(this._userInstancedBuffersStorage.vertexBuffers[h]=new r.d(this.getEngine(),this._userInstancedBuffersStorage.data[h],h,!0,!1,t,!0),this._invalidateInstanceVertexArrayObject())}},x.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(var W in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[W]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},x.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var W in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[W]&&this._userInstancedBuffersStorage.vertexBuffers[W].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}}},65847:function(W,i,L){"use strict";L.d(i,{e:function(){return F},i:function(){return b}});var h=L(40061),l=L(9271),t=L(9217),p=L(51004),x=L(45883),R=L(61633),z=L(80105),r=L(9488),N=L(74134),I=L(43251),s=L(85779),o=L(3579),D=L(52644),S=L(50384),C=L(46907),e=L(49443),V=L(97964),c=L(9892),f=L(9127),a=L(31709),P=L(50504),y=L(21693),M=function(W,i){this.distanceOrScreenCoverage=W,this.mesh=i},b=function(){},j=function(){this.visibleInstances={},this.batchCache=new Z,this.batchCacheReplacementModeInFrozenMode=new Z,this.instancesBufferSize=2048},Z=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},X=function(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null},T=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0},F=function(W){function i(L,h,t,R,z,r){void 0===h&&(h=null),void 0===t&&(t=null),void 0===R&&(R=null),void 0===r&&(r=!0);var N=W.call(this,L,h)||this;if(N._internalMeshDataInfo=new T,N.delayLoadState=0,N.instances=new Array,N._creationDataStorage=null,N._geometry=null,N._instanceDataStorage=new j,N._thinInstanceDataStorage=new X,N._shouldGenerateFlatShading=!1,N._originalBuilderSideOrientation=i.DEFAULTSIDE,N.overrideMaterialSideOrientation=null,N.ignoreCameraMaxZ=!1,h=N.getScene(),N._onBeforeDraw=function(W,i,L){W&&L&&(N._uniformBuffer?N.transferToEffect(i):L.bindOnlyWorldMatrix(i))},R){if(R._geometry&&R._geometry.applyToMesh(N),p.e.DeepCopy(R,N,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo"],["_poseMatrix"]),N._internalMeshDataInfo._source=R,h.useClonedMeshMap&&(R._internalMeshDataInfo.meshMap||(R._internalMeshDataInfo.meshMap={}),R._internalMeshDataInfo.meshMap[N.uniqueId]=N),N._originalBuilderSideOrientation=R._originalBuilderSideOrientation,N._creationDataStorage=R._creationDataStorage,R._ranges){var I=R._ranges;for(var s in I)Object.prototype.hasOwnProperty.call(I,s)&&I[s]&&N.createAnimationRange(s,I[s].from,I[s].to)}if(R.metadata&&R.metadata.clone?N.metadata=R.metadata.clone():N.metadata=R.metadata,x.d&&x.d.HasTags(R)&&x.d.AddTagsTo(N,x.d.GetTags(R,!0)),N.setEnabled(R.isEnabled()),N.parent=R.parent,N.setPivotMatrix(R.getPivotMatrix()),N.id=L+"."+R.id,N.material=R.material,!z)for(var o=R.getDescendants(!0),D=0;D<o.length;D++){var S=o[D];S.clone&&S.clone(L+"."+S.name,N)}if(R.morphTargetManager&&(N.morphTargetManager=R.morphTargetManager),h.getPhysicsEngine){var C=h.getPhysicsEngine();if(r&&C){var e=C.getImpostorForPhysicsObject(R);e&&(N.physicsImpostor=e.clone(N))}}for(D=0;D<h.particleSystems.length;D++){var V=h.particleSystems[D];V.emitter===R&&V.clone(V.name,N)}N.skeleton=R.skeleton,N.refreshBoundingInfo(!0,!0),N.computeWorldMatrix(!0)}return null!==t&&(N.parent=t),N._instanceDataStorage.hardwareInstancedRendering=N.getEngine().getCaps().instancedArrays,N._internalMeshDataInfo._onMeshReadyObserverAdded=function(W){W.unregisterOnNextCall=!0,N.isReady(!0)?N.onMeshReadyObservable.notifyObservers(N):N._internalMeshDataInfo._checkReadinessObserver||(N._internalMeshDataInfo._checkReadinessObserver=N._scene.onBeforeRenderObservable.add((function(){N.isReady(!0)&&(N._scene.onBeforeRenderObservable.remove(N._internalMeshDataInfo._checkReadinessObserver),N._internalMeshDataInfo._checkReadinessObserver=null,N.onMeshReadyObservable.notifyObservers(N))})))},N.onMeshReadyObservable=new l.c(N._internalMeshDataInfo._onMeshReadyObserverAdded),R&&R.onClonedObservable.notifyObservers(N),N}return(0,h.n)(i,W),i._GetDefaultSideOrientation=function(W){return W||i.FRONTSIDE},Object.defineProperty(i.prototype,"useLODScreenCoverage",{get:function(){return this._internalMeshDataInfo._useLODScreenCoverage},set:function(W){this._internalMeshDataInfo._useLODScreenCoverage=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(W){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==W&&(W&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(I.d.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(I.d.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new l.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new l.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new l.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBetweenPassObservable",{get:function(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new l.c),this._internalMeshDataInfo._onBetweenPassObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new l.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeDraw",{set:function(W){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasThinInstances",{get:function(){var W;return(null!==(W=this._thinInstanceDataStorage.instancesCount)&&void 0!==W?W:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"forcedInstanceCount",{get:function(){return this._internalMeshDataInfo._forcedInstanceCount},set:function(W){this._internalMeshDataInfo._forcedInstanceCount=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(W){this._unIndexed!==W&&(this._unIndexed=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"previousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesPreviousData},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(W){this._instanceDataStorage.manualUpdate=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"manualUpdateOfPreviousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.previousManualUpdate},set:function(W){this._instanceDataStorage.previousManualUpdate=W},enumerable:!1,configurable:!0}),i.prototype.instantiateHierarchy=function(W,i,L){void 0===W&&(W=null);var h=!(this.getTotalVertices()>0)||i&&i.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),W||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));h.parent=W||this.parent,h.position=this.position.clone(),h.scaling=this.scaling.clone(),this.rotationQuaternion?h.rotationQuaternion=this.rotationQuaternion.clone():h.rotation=this.rotation.clone(),L&&L(this,h);for(var l=0,t=this.getChildTransformNodes(!0);l<t.length;l++){t[l].instantiateHierarchy(h,i,L)}return h},i.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(i.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype.toString=function(i){var L=W.prototype.toString.call(this,i);if(L+=", n vertices: "+this.getTotalVertices(),L+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var h=0;h<this.animations.length;h++)L+=", animation[0]: "+this.animations[h].toString(i);if(i)if(this._geometry){var l=this.getIndices(),t=this.getVerticesData(I.d.PositionKind);t&&l&&(L+=", flat shading: "+(t.length/3===l.length?"YES":"NO"))}else L+=", flat shading: UNKNOWN";return L},i.prototype._unBindEffect=function(){W.prototype._unBindEffect.call(this);for(var i=0,L=this.instances;i<L.length;i++){L[i]._unBindEffect()}},Object.defineProperty(i.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),i.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},i.prototype._sortLODLevels=function(){var W=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((function(i,L){return i.distanceOrScreenCoverage<L.distanceOrScreenCoverage?W:i.distanceOrScreenCoverage>L.distanceOrScreenCoverage?-W:0}))},i.prototype.addLODLevel=function(W,i){if(i&&i._masterMesh)return f.e.Warn("You cannot use a mesh as LOD level twice"),this;var L=new M(W,i);return this._internalMeshDataInfo._LODLevels.push(L),i&&(i._masterMesh=this),this._sortLODLevels(),this},i.prototype.getLODLevelAtDistance=function(W){for(var i=this._internalMeshDataInfo,L=0;L<i._LODLevels.length;L++){var h=i._LODLevels[L];if(h.distanceOrScreenCoverage===W)return h.mesh}return null},i.prototype.removeLODLevel=function(W){for(var i=this._internalMeshDataInfo,L=0;L<i._LODLevels.length;L++)i._LODLevels[L].mesh===W&&(i._LODLevels.splice(L,1),W&&(W._masterMesh=null));return this._sortLODLevels(),this},i.prototype.getLOD=function(W,i){var L,h=this._internalMeshDataInfo;if(!h._LODLevels||0===h._LODLevels.length)return this;i?L=i:L=this.getBoundingInfo().boundingSphere;var l=L.centerWorld.subtract(W.globalPosition).length(),t=l,p=1;if(h._useLODScreenCoverage){var x=W.screenArea,R=L.radiusWorld*W.minZ/l;t=(R=R*R*Math.PI)/x,p=-1}if(p*h._LODLevels[h._LODLevels.length-1].distanceOrScreenCoverage>p*t)return this.onLODLevelSelection&&this.onLODLevelSelection(t,this,this),this;for(var z=0;z<h._LODLevels.length;z++){var r=h._LODLevels[z];if(p*r.distanceOrScreenCoverage<p*t){if(r.mesh){if(4===r.mesh.delayLoadState)return r.mesh._checkDelayState(),this;if(2===r.mesh.delayLoadState)return this;r.mesh._preActivate(),r.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(t,this,r.mesh),r.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(t,this,this),this},Object.defineProperty(i.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),i.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},i.prototype.getVerticesData=function(W,i,L){var h,l;if(!this._geometry)return null;var t=null===(l=null===(h=this._userInstancedBuffersStorage)||void 0===h?void 0:h.vertexBuffers[W])||void 0===l?void 0:l.getFloatData(this._geometry.getTotalVertices(),L||i&&1!==this._geometry.meshes.length);return t||(t=this._geometry.getVerticesData(W,i,L)),t},i.prototype.getVertexBuffer=function(W){var i,L;return this._geometry?null!==(L=null===(i=this._userInstancedBuffersStorage)||void 0===i?void 0:i.vertexBuffers[W])&&void 0!==L?L:this._geometry.getVertexBuffer(W):null},i.prototype.isVerticesDataPresent=function(W){var i;return this._geometry?void 0!==(null===(i=this._userInstancedBuffersStorage)||void 0===i?void 0:i.vertexBuffers[W])||this._geometry.isVerticesDataPresent(W):!!this._delayInfo&&-1!==this._delayInfo.indexOf(W)},i.prototype.isVertexBufferUpdatable=function(W){var i,L;return this._geometry?(null===(L=null===(i=this._userInstancedBuffersStorage)||void 0===i?void 0:i.vertexBuffers[W])||void 0===L?void 0:L.isUpdatable())||this._geometry.isVertexBufferUpdatable(W):!!this._delayInfo&&-1!==this._delayInfo.indexOf(W)},i.prototype.getVerticesDataKinds=function(){if(!this._geometry){var W=new Array;return this._delayInfo&&this._delayInfo.forEach((function(i){W.push(i)})),W}var i=this._geometry.getVerticesDataKinds();if(this._userInstancedBuffersStorage)for(var L in this._userInstancedBuffersStorage.vertexBuffers)i.push(L);return i},i.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},i.prototype.getIndices=function(W,i){return this._geometry?this._geometry.getIndices(W,i):[]},Object.defineProperty(i.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!1,configurable:!0}),i.prototype.isReady=function(i,L){var h,l,t,p,x,R;if(void 0===i&&(i=!1),void 0===L&&(L=!1),2===this.delayLoadState)return!1;if(!W.prototype.isReady.call(this,i))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!i)return!0;var z=this.getEngine(),r=this.getScene(),N=L||z.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var I=this.material||r.defaultMaterial;if(I)if(I._storeEffectOnSubMeshes)for(var s=0,o=this.subMeshes;s<o.length;s++){var D=(a=o[s]).getMaterial();if(D)if(D._storeEffectOnSubMeshes){if(!D.isReadyForSubMesh(this,a,N))return!1}else if(!D.isReady(this,N))return!1}else if(!I.isReady(this,N))return!1;for(var S=z.currentRenderPassId,C=0,e=this.lightSources;C<e.length;C++){var V=e[C].getShadowGenerator();if(V&&(!(null===(h=V.getShadowMap())||void 0===h?void 0:h.renderList)||(null===(l=V.getShadowMap())||void 0===l?void 0:l.renderList)&&-1!==(null===(p=null===(t=V.getShadowMap())||void 0===t?void 0:t.renderList)||void 0===p?void 0:p.indexOf(this)))){V.getShadowMap()&&(z.currentRenderPassId=V.getShadowMap().renderPassId);for(var c=0,f=this.subMeshes;c<f.length;c++){var a=f[c];if(!V.isReady(a,N,null!==(R=null===(x=a.getMaterial())||void 0===x?void 0:x.needAlphaBlendingForMesh(this))&&void 0!==R&&R))return z.currentRenderPassId=S,!1}z.currentRenderPassId=S}}for(var P=0,y=this._internalMeshDataInfo._LODLevels;P<y.length;P++){var M=y[P];if(M.mesh&&!M.mesh.isReady(N))return!1}return!0},Object.defineProperty(i.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),i.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},i.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(i.prototype,"overridenInstanceCount",{set:function(W){this._instanceDataStorage.overridenInstanceCount=W},enumerable:!1,configurable:!0}),i.prototype._preActivate=function(){var W=this._internalMeshDataInfo,i=this.getScene().getRenderId();return W._preActivateId===i||(W._preActivateId=i,this._instanceDataStorage.visibleInstances=null),this},i.prototype._preActivateForIntermediateRendering=function(W){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=W),this},i.prototype._registerInstanceForRenderId=function(W,i){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:i,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[i]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=i,this._instanceDataStorage.visibleInstances[i]=new Array),this._instanceDataStorage.visibleInstances[i].push(W),this},i.prototype._afterComputeWorldMatrix=function(){W.prototype._afterComputeWorldMatrix.call(this),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},i.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},i.prototype.refreshBoundingInfo=function(W,i){if(void 0===W&&(W=!1),void 0===i&&(i=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var L=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(W,i),L),this},i.prototype._createGlobalSubMesh=function(W){var i=this.getTotalVertices();if(!i||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var L=this.getIndices();if(!L)return null;var h=L.length,l=!1;if(W)l=!0;else for(var t=0,p=this.subMeshes;t<p.length;t++){var x=p[t];if(x.indexStart+x.indexCount>h){l=!0;break}if(x.verticesStart+x.verticesCount>i){l=!0;break}}if(!l)return this.subMeshes[0]}return this.releaseSubMeshes(),new S.d(0,0,i,0,this.getTotalIndices(),this)},i.prototype.subdivide=function(W){if(!(W<1)){for(var i=this.getTotalIndices(),L=i/W|0,h=0;L%3!==0;)L++;this.releaseSubMeshes();for(var l=0;l<W&&!(h>=i);l++)S.d.CreateFromIndices(0,h,l===W-1?i-h:L,this),h+=L;this.synchronizeInstances()}},i.prototype.setVerticesData=function(W,i,L,h){if(void 0===L&&(L=!1),this._geometry)this._geometry.setVerticesData(W,i,L,h);else{var l=new s.e;l.set(i,W);var t=this.getScene();new o.b(o.b.RandomId(),t,l,L,this)}return this},i.prototype.removeVerticesData=function(W){this._geometry&&this._geometry.removeVerticesData(W)},i.prototype.markVerticesDataAsUpdatable=function(W,i){void 0===i&&(i=!0);var L=this.getVertexBuffer(W);L&&L.isUpdatable()!==i&&this.setVerticesData(W,this.getVerticesData(W),i)},i.prototype.setVerticesBuffer=function(W,i){return void 0===i&&(i=!0),this._geometry||(this._geometry=o.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(W,null,i),this},i.prototype.updateVerticesData=function(W,i,L,h){return this._geometry?(h?(this.makeGeometryUnique(),this.updateVerticesData(W,i,L,!1)):this._geometry.updateVerticesData(W,i,L),this):this},i.prototype.updateMeshPositions=function(W,i){void 0===i&&(i=!0);var L=this.getVerticesData(I.d.PositionKind);if(!L)return this;if(W(L),this.updateVerticesData(I.d.PositionKind,L,!1,!1),i){var h=this.getIndices(),l=this.getVerticesData(I.d.NormalKind);if(!l)return this;s.e.ComputeNormals(L,h,l),this.updateVerticesData(I.d.NormalKind,l,!1,!1)}return this},i.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;var W=this._geometry,i=this._geometry.copy(o.b.RandomId());return W.releaseForMesh(this,!0),i.applyToMesh(this),this},i.prototype.setIndices=function(W,i,L){if(void 0===i&&(i=null),void 0===L&&(L=!1),this._geometry)this._geometry.setIndices(W,i,L);else{var h=new s.e;h.indices=W;var l=this.getScene();new o.b(o.b.RandomId(),l,h,L,this)}return this},i.prototype.updateIndices=function(W,i,L){return void 0===L&&(L=!1),this._geometry?(this._geometry.updateIndices(W,i,L),this):this},i.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},i.prototype._bind=function(W,i,L){if(!this._geometry)return this;var h,l=this.getScene().getEngine();if(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(i),this._unIndexed)h=null;else switch(L){case C.b.PointFillMode:h=null;break;case C.b.WireFrameFillMode:h=W._getLinesIndexBuffer(this.getIndices(),l);break;default:case C.b.TriangleFillMode:h=this._geometry.getIndexBuffer()}return!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(i,h):this._geometry._bind(i,h,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),this},i.prototype._draw=function(W,i,L){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var h=this.getScene().getEngine();return this._unIndexed||i==C.b.PointFillMode?h.drawArraysType(i,W.verticesStart,W.verticesCount,this.forcedInstanceCount||L):i==C.b.WireFrameFillMode?h.drawElementsType(i,0,W._linesIndexCount,this.forcedInstanceCount||L):h.drawElementsType(i,W.indexStart,W.indexCount,this.forcedInstanceCount||L),this},i.prototype.registerBeforeRender=function(W){return this.onBeforeRenderObservable.add(W),this},i.prototype.unregisterBeforeRender=function(W){return this.onBeforeRenderObservable.removeCallback(W),this},i.prototype.registerAfterRender=function(W){return this.onAfterRenderObservable.add(W),this},i.prototype.unregisterAfterRender=function(W){return this.onAfterRenderObservable.removeCallback(W),this},i.prototype._getInstancesRenderList=function(W,i){if(void 0===i&&(i=!1),this._instanceDataStorage.isFrozen){if(i)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[W]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[W]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}var L=this.getScene(),h=L._isInIntermediateRendering(),l=h?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,t=this._instanceDataStorage.batchCache;if(t.mustReturn=!1,t.renderSelf[W]=i||!l&&this.isEnabled()&&this.isVisible,t.visibleInstances[W]=null,this._instanceDataStorage.visibleInstances&&!i){var p=this._instanceDataStorage.visibleInstances,x=L.getRenderId(),R=h?p.intermediateDefaultRenderId:p.defaultRenderId;t.visibleInstances[W]=p[x],!t.visibleInstances[W]&&R&&(t.visibleInstances[W]=p[R])}return t.hardwareInstancedRendering[W]=!i&&this._instanceDataStorage.hardwareInstancedRendering&&null!==t.visibleInstances[W]&&void 0!==t.visibleInstances[W],this._instanceDataStorage.previousBatch=t,t},i.prototype._renderWithInstances=function(W,L,h,l,t){var p,x=h.visibleInstances[W._id];if(!x)return this;for(var R=this._instanceDataStorage,r=R.instancesBufferSize,N=R.instancesBuffer,s=R.instancesPreviousBuffer,o=16*(x.length+1)*4;R.instancesBufferSize<o;)R.instancesBufferSize*=2;R.instancesData&&r==R.instancesBufferSize||(R.instancesData=new Float32Array(R.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!R.instancesPreviousData||r!=R.instancesBufferSize)&&(R.instancesPreviousData=new Float32Array(R.instancesBufferSize/4));var D=0,S=0,C=h.renderSelf[W._id],e=!N||r!==R.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!R.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||R.isFrozen&&!e)S=(C?1:0)+x.length;else{var V=this.getWorldMatrix();if(C&&(this._scene.needsPreviousWorldMatrices&&(R.masterMeshPreviousWorldMatrix?(R.masterMeshPreviousWorldMatrix.copyToArray(R.instancesPreviousData,D),R.masterMeshPreviousWorldMatrix.copyFrom(V)):(R.masterMeshPreviousWorldMatrix=V.clone(),R.masterMeshPreviousWorldMatrix.copyToArray(R.instancesPreviousData,D))),V.copyToArray(R.instancesData,D),D+=16,S++),x){if(i.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&(null===(p=W.getMaterial())||void 0===p?void 0:p.needAlphaBlendingForMesh(W.getRenderingMesh()))){for(var c=this._scene.activeCamera.globalPosition,f=0;f<x.length;f++){var a=x[f];a._distanceToCamera=z.m.Distance(a.getBoundingInfo().boundingSphere.centerWorld,c)}x.sort((function(W,i){return W._distanceToCamera>i._distanceToCamera?-1:W._distanceToCamera<i._distanceToCamera?1:0}))}for(f=0;f<x.length;f++){var P=x[f],y=P.getWorldMatrix();y.copyToArray(R.instancesData,D),this._scene.needsPreviousWorldMatrices&&(P._previousWorldMatrix?(P._previousWorldMatrix.copyToArray(R.instancesPreviousData,D),P._previousWorldMatrix.copyFrom(y)):(P._previousWorldMatrix=y.clone(),P._previousWorldMatrix.copyToArray(R.instancesPreviousData,D))),D+=16,S++}}}return e?(N&&N.dispose(),s&&s.dispose(),N=new I.c(t,R.instancesData,!0,16,!1,!0),R.instancesBuffer=N,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=N.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=N.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=N.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=N.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(s=new I.c(t,R.instancesPreviousData,!0,16,!1,!0),R.instancesPreviousBuffer=s,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=s.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=s.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=s.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=s.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen||(N.updateDirectly(R.instancesData,0,S),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||s.updateDirectly(R.instancesPreviousData,0,S)),this._processInstancedBuffers(x,C),this.getScene()._activeIndices.addCount(W.indexCount*S,!1),t._currentDrawContext&&(t._currentDrawContext.useInstancing=!0),this._bind(W,l,L),this._draw(W,L,S),!this._scene.needsPreviousWorldMatrices||e||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen||this._instanceDataStorage.previousManualUpdate||s.updateDirectly(R.instancesData,0,S),t.unbindInstanceAttributes(),this},i.prototype._renderWithThinInstances=function(W,i,L,h){var l,t,p=null!==(t=null===(l=this._thinInstanceDataStorage)||void 0===l?void 0:l.instancesCount)&&void 0!==t?t:0;this.getScene()._activeIndices.addCount(W.indexCount*p,!1),h._currentDrawContext&&(h._currentDrawContext.useInstancing=!0),this._bind(W,L,i),this._draw(W,i,p),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,p):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),h.unbindInstanceAttributes()},i.prototype._processInstancedBuffers=function(W,i){},i.prototype._processRendering=function(W,i,L,h,l,t,p,x){var R=this.getScene(),z=R.getEngine();if(t&&i.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(i,h,L,z),this;if(t)this._renderWithInstances(i,h,l,L,z);else{z._currentDrawContext&&(z._currentDrawContext.useInstancing=!1);var r=0;l.renderSelf[i._id]&&(p&&p(!1,W.getWorldMatrix(),x),r++,this._draw(i,h,this._instanceDataStorage.overridenInstanceCount));var N=l.visibleInstances[i._id];if(N){var I=N.length;r+=I;for(var s=0;s<I;s++){var o=N[s].getWorldMatrix();p&&p(!0,o,x),this._draw(i,h)}}R._activeIndices.addCount(i.indexCount*r,!1)}return this},i.prototype._rebuild=function(i){if(void 0===i&&(i=!1),this._instanceDataStorage.instancesBuffer&&(i&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(var L in this._userInstancedBuffersStorage.vertexBuffers){var h=this._userInstancedBuffersStorage.vertexBuffers[L];h&&(i&&h.dispose(),this._userInstancedBuffersStorage.vertexBuffers[L]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,W.prototype._rebuild.call(this,i)},i.prototype._freeze=function(){if(this.subMeshes){for(var W=0;W<this.subMeshes.length;W++)this._getInstancesRenderList(W);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},i.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},i.prototype.render=function(W,i,L){var h,l,t,p=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;var x=this._getInstancesRenderList(W._id,!!L);if(x.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var R=p.getEngine(),z=0,r=null;this.ignoreCameraMaxZ&&p.activeCamera&&!p._isInIntermediateRendering()&&(z=p.activeCamera.maxZ,r=p.activeCamera,p.activeCamera.maxZ=0,p.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var N,I=x.hardwareInstancedRendering[W._id]||W.getRenderingMesh().hasThinInstances,s=this._instanceDataStorage,o=W.getMaterial();if(!o)return r&&(r.maxZ=z,p.updateTransformMatrix(!0)),this;if(s.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===o){if(o._storeEffectOnSubMeshes&&!(null===(h=W.effect)||void 0===h?void 0:h._wasPreviouslyReady)||!o._storeEffectOnSubMeshes&&!(null===(l=o.getEffect())||void 0===l?void 0:l._wasPreviouslyReady))return r&&(r.maxZ=z,p.updateTransformMatrix(!0)),this}else{if(o._storeEffectOnSubMeshes){if(!o.isReadyForSubMesh(this,W,I))return r&&(r.maxZ=z,p.updateTransformMatrix(!0)),this}else if(!o.isReady(this,I))return r&&(r.maxZ=z,p.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=o}i&&R.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode);for(var D=null!==(t=null===(N=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?W._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper())||void 0===N?void 0:N.effect)&&void 0!==t?t:null,S=0,e=p._beforeRenderingMeshStage;S<e.length;S++){e[S].action(this,W,x,D)}if(!N||!D)return r&&(r.maxZ=z,p.updateTransformMatrix(!0)),this;var V,c=L||this;if(s.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this.overrideMaterialSideOrientation)V=s.sideOrientation;else{var f=c._getWorldMatrixDeterminant();null==(V=this.overrideMaterialSideOrientation)&&(V=this._internalMeshDataInfo._effectiveMaterial.sideOrientation),f<0&&(V=V===C.b.ClockWiseSideOrientation?C.b.CounterClockWiseSideOrientation:C.b.ClockWiseSideOrientation),s.sideOrientation=V}var a=this._internalMeshDataInfo._effectiveMaterial._preBind(N,V);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&R.setDepthWrite(!0);var P=p.forcePointsCloud?C.b.PointFillMode:p.forceWireframe?C.b.WireFrameFillMode:this._internalMeshDataInfo._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),I||this._bind(W,D,P);var y=this._internalMeshDataInfo._effectiveMaterial,M=c.getWorldMatrix();y._storeEffectOnSubMeshes?y.bindForSubMesh(M,this,W):y.bind(M,this),!y.backFaceCulling&&y.separateCullingPass&&(R.setState(!0,y.zOffset,!1,!a,y.cullBackFaces,y.stencil,y.zOffsetUnits),this._processRendering(this,W,D,P,x,I,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),R.setState(!0,y.zOffset,!1,a,y.cullBackFaces,y.stencil,y.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(W)),this._processRendering(this,W,D,P,x,I,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(var b=0,j=p._afterRenderingMeshStage;b<j.length;b++){j[b].action(this,W,x,D)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),r&&(r.maxZ=z,p.updateTransformMatrix(!0)),this},i.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(I.d.MatricesWeightsKind)&&(this.isVerticesDataPresent(I.d.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())},i.prototype._normalizeSkinFourWeights=function(){for(var W=this.getVerticesData(I.d.MatricesWeightsKind),i=W.length,L=0;L<i;L+=4){var h=W[L]+W[L+1]+W[L+2]+W[L+3];if(0===h)W[L]=1;else{var l=1/h;W[L]*=l,W[L+1]*=l,W[L+2]*=l,W[L+3]*=l}}this.setVerticesData(I.d.MatricesWeightsKind,W)},i.prototype._normalizeSkinWeightsAndExtra=function(){for(var W=this.getVerticesData(I.d.MatricesWeightsExtraKind),i=this.getVerticesData(I.d.MatricesWeightsKind),L=i.length,h=0;h<L;h+=4){var l=i[h]+i[h+1]+i[h+2]+i[h+3];if(0===(l+=W[h]+W[h+1]+W[h+2]+W[h+3]))i[h]=1;else{var t=1/l;i[h]*=t,i[h+1]*=t,i[h+2]*=t,i[h+3]*=t,W[h]*=t,W[h+1]*=t,W[h+2]*=t,W[h+3]*=t}}this.setVerticesData(I.d.MatricesWeightsKind,i),this.setVerticesData(I.d.MatricesWeightsKind,W)},i.prototype.validateSkinning=function(){var W=this.getVerticesData(I.d.MatricesWeightsExtraKind),i=this.getVerticesData(I.d.MatricesWeightsKind);if(null===i||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var L=i.length,h=0,l=0,t=0,p=0,x=null===W?4:8,R=new Array,z=0;z<=x;z++)R[z]=0;for(z=0;z<L;z+=4){for(var r=i[z],N=r,s=0===N?0:1,o=1;o<x;o++){var D=o<4?i[z+o]:W[z+o-4];D>r&&h++,0!==D&&s++,N+=D,r=D}if(R[s]++,s>t&&(t=s),0===N)l++;else{var S=1/N,C=0;for(o=0;o<x;o++)C+=o<4?Math.abs(i[z+o]-i[z+o]*S):Math.abs(W[z+o-4]-W[z+o-4]*S);C>.001&&p++}}var e=this.skeleton.bones.length,V=this.getVerticesData(I.d.MatricesIndicesKind),c=this.getVerticesData(I.d.MatricesIndicesExtraKind),f=0;for(z=0;z<L;z+=4)for(o=0;o<x;o++){var a=o<4?V[z+o]:c[z+o-4];(a>=e||a<0)&&f++}return{skinned:!0,valid:0===l&&0===p&&0===f,report:"Number of Weights = "+L/4+"\nMaximum influences = "+t+"\nMissing Weights = "+l+"\nNot Sorted = "+h+"\nNot Normalized = "+p+"\nWeightCounts = ["+R+"]\nNumber of bones = "+e+"\nBad Bone Indices = "+f}},i.prototype._checkDelayState=function(){var W=this.getScene();return this._geometry?this._geometry.load(W):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(W)),this},i.prototype._queueLoad=function(W){var i=this;W._addPendingData(this);var L=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return t.h.LoadFile(this.delayLoadingFile,(function(L){L instanceof ArrayBuffer?i._delayLoadingFunction(L,i):i._delayLoadingFunction(JSON.parse(L),i),i.instances.forEach((function(W){W.refreshBoundingInfo(),W._syncSubMeshes()})),i.delayLoadState=1,W._removePendingData(i)}),(function(){}),W.offlineProvider,L),this},i.prototype.isInFrustum=function(i){return 2!==this.delayLoadState&&(!!W.prototype.isInFrustum.call(this,i)&&(this._checkDelayState(),!0))},i.prototype.setMaterialById=function(W){var i,L=this.getScene().materials;for(i=L.length-1;i>-1;i--)if(L[i].id===W)return this.material=L[i],this;var h=this.getScene().multiMaterials;for(i=h.length-1;i>-1;i--)if(h[i].id===W)return this.material=h[i],this;return this},i.prototype.getAnimatables=function(){var W=new Array;return this.material&&W.push(this.material),this.skeleton&&W.push(this.skeleton),W},i.prototype.bakeTransformIntoVertices=function(W){if(!this.isVerticesDataPresent(I.d.PositionKind))return this;var i=this.subMeshes.splice(0);this._resetPointsArrayCache();var L,h=this.getVerticesData(I.d.PositionKind),l=new Array;for(L=0;L<h.length;L+=3)z.m.TransformCoordinates(z.m.FromArray(h,L),W).toArray(l,L);if(this.setVerticesData(I.d.PositionKind,l,this.getVertexBuffer(I.d.PositionKind).isUpdatable()),this.isVerticesDataPresent(I.d.NormalKind)){for(h=this.getVerticesData(I.d.NormalKind),l=[],L=0;L<h.length;L+=3)z.m.TransformNormal(z.m.FromArray(h,L),W).normalize().toArray(l,L);this.setVerticesData(I.d.NormalKind,l,this.getVertexBuffer(I.d.NormalKind).isUpdatable())}return W.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=i,this},i.prototype.bakeCurrentTransformIntoVertices=function(W){return void 0===W&&(W=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(W),this},Object.defineProperty(i.prototype,"_positions",{get:function(){return this._internalAbstractMeshDataInfo._positions?this._internalAbstractMeshDataInfo._positions:this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),i.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},i.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},i.prototype.clone=function(W,L,h,l){return void 0===W&&(W=""),void 0===L&&(L=null),void 0===l&&(l=!0),new i(W,this.getScene(),L,this,h,l)},i.prototype.dispose=function(i,L){void 0===L&&(L=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var h=this._internalMeshDataInfo;if(h._onBeforeDrawObservable&&h._onBeforeDrawObservable.clear(),h._onBeforeBindObservable&&h._onBeforeBindObservable.clear(),h._onBeforeRenderObservable&&h._onBeforeRenderObservable.clear(),h._onAfterRenderObservable&&h._onAfterRenderObservable.clear(),h._onBetweenPassObservable&&h._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(h.meshMap)for(var l in h.meshMap){(x=h.meshMap[l])&&(x._internalMeshDataInfo._source=null,h.meshMap[l]=void 0)}h._source&&h._source._internalMeshDataInfo.meshMap&&(h._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var t=0,p=this.getScene().meshes;t<p.length;t++){var x;(x=p[t])._internalMeshDataInfo&&x._internalMeshDataInfo._source&&x._internalMeshDataInfo._source===this&&(x._internalMeshDataInfo._source=null)}h._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),W.prototype.dispose.call(this,i,L)},i.prototype._disposeInstanceSpecificData=function(){},i.prototype._disposeThinInstanceSpecificData=function(){},i.prototype._invalidateInstanceVertexArrayObject=function(){},i.prototype.applyDisplacementMap=function(W,i,L,h,l,p,x){var R=this;void 0===x&&(x=!1);var z=this.getScene();return t.h.LoadImage(W,(function(W){var t=W.width,z=W.height,r=R.getEngine().createCanvas(t,z).getContext("2d");r.drawImage(W,0,0);var N=r.getImageData(0,0,t,z).data;R.applyDisplacementMapFromBuffer(N,t,z,i,L,l,p,x),h&&h(R)}),(function(){}),z.offlineProvider),this},i.prototype.applyDisplacementMapFromBuffer=function(W,i,L,h,l,t,p,x){if(void 0===x&&(x=!1),!this.isVerticesDataPresent(I.d.PositionKind)||!this.isVerticesDataPresent(I.d.NormalKind)||!this.isVerticesDataPresent(I.d.UVKind))return f.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var R=this.getVerticesData(I.d.PositionKind,!0,!0),r=this.getVerticesData(I.d.NormalKind),N=this.getVerticesData(I.d.UVKind),o=z.m.Zero(),D=z.m.Zero(),S=z.k.Zero();t=t||z.k.Zero(),p=p||new z.k(1,1);for(var C=0;C<R.length;C+=3){z.m.FromArrayToRef(R,C,o),z.m.FromArrayToRef(r,C,D),z.k.FromArrayToRef(N,C/3*2,S);var e=4*((Math.abs(S.x*p.x+t.x%1)*(i-1)%i|0)+(Math.abs(S.y*p.y+t.y%1)*(L-1)%L|0)*i),V=.3*(W[e]/255)+.59*(W[e+1]/255)+.11*(W[e+2]/255);D.normalize(),D.scaleInPlace(h+(l-h)*V),(o=o.add(D)).toArray(R,C)}return s.e.ComputeNormals(R,this.getIndices(),r),x?(this.setVerticesData(I.d.PositionKind,R),this.setVerticesData(I.d.NormalKind,r),this.setVerticesData(I.d.UVKind,N)):(this.updateVerticesData(I.d.PositionKind,R),this.updateVerticesData(I.d.NormalKind,r)),this},i.prototype.convertToFlatShadedMesh=function(){var W,i,L=this.getVerticesDataKinds(),h={},l={},t={},p=!1;for(W=0;W<L.length;W++){i=L[W];var x=this.getVertexBuffer(i),R=x.getData();(R instanceof Array||R instanceof Float32Array)&&0===R.length||(i!==I.d.NormalKind?(h[i]=x,l[i]=this.getVerticesData(i),t[i]=[]):(p=x.isUpdatable(),L.splice(W,1),W--))}var r,N=this.subMeshes.slice(0),s=this.getIndices(),o=this.getTotalIndices();for(r=0;r<o;r++){var D=s[r];for(W=0;W<L.length;W++)if(h[i=L[W]])for(var C=h[i].getStrideSize(),e=0;e<C;e++)t[i].push(l[i][D*C+e])}var V,c=[],f=t[I.d.PositionKind];for(V=this.getScene().useRightHandedSystem?1===this.overrideMaterialSideOrientation:0===this.overrideMaterialSideOrientation,r=0;r<o;r+=3){s[r]=r,s[r+1]=r+1,s[r+2]=r+2;var a=z.m.FromArray(f,3*r),P=z.m.FromArray(f,3*(r+1)),y=z.m.FromArray(f,3*(r+2)),M=a.subtract(P),b=y.subtract(P),j=z.m.Normalize(z.m.Cross(M,b));V&&j.scaleInPlace(-1);for(var Z=0;Z<3;Z++)c.push(j.x),c.push(j.y),c.push(j.z)}for(this.setIndices(s),this.setVerticesData(I.d.NormalKind,c,p),W=0;W<L.length;W++)t[i=L[W]]&&this.setVerticesData(i,t[i],h[i].isUpdatable());this.releaseSubMeshes();for(var X=0;X<N.length;X++){var T=N[X];S.d.AddToMesh(T.materialIndex,T.indexStart,T.indexCount,T.indexStart,T.indexCount,this)}return this.synchronizeInstances(),this},i.prototype.convertToUnIndexedMesh=function(){var W,i,L=this.getVerticesDataKinds(),h={},l={},t={};for(W=0;W<L.length;W++){i=L[W];var p=this.getVertexBuffer(i);h[i]=p,l[i]=h[i].getData(),t[i]=[]}var x,R=this.subMeshes.slice(0),z=this.getIndices(),r=this.getTotalIndices();for(x=0;x<r;x++){var N=z[x];for(W=0;W<L.length;W++)for(var I=h[i=L[W]].getStrideSize(),s=0;s<I;s++)t[i].push(l[i][N*I+s])}for(x=0;x<r;x+=3)z[x]=x,z[x+1]=x+1,z[x+2]=x+2;for(this.setIndices(z),W=0;W<L.length;W++)i=L[W],this.setVerticesData(i,t[i],h[i].isUpdatable(),h[i].getStrideSize());this.releaseSubMeshes();for(var o=0;o<R.length;o++){var D=R[o];S.d.AddToMesh(D.materialIndex,D.indexStart,D.indexCount,D.indexStart,D.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},i.prototype.flipFaces=function(W){void 0===W&&(W=!1);var i,L=s.e.ExtractFromMesh(this);if(W&&this.isVerticesDataPresent(I.d.NormalKind)&&L.normals)for(i=0;i<L.normals.length;i++)L.normals[i]*=-1;if(L.indices){var h=void 0;for(i=0;i<L.indices.length;i+=3)h=L.indices[i+1],L.indices[i+1]=L.indices[i+2],L.indices[i+2]=h}return L.applyToMesh(this,this.isVertexBufferUpdatable(I.d.PositionKind)),this},i.prototype.increaseVertices=function(W){void 0===W&&(W=1);var i=s.e.ExtractFromMesh(this),L=i.indices&&!Array.isArray(i.indices)&&Array.from?Array.from(i.indices):i.indices,h=i.positions&&!Array.isArray(i.positions)&&Array.from?Array.from(i.positions):i.positions,l=i.uvs&&!Array.isArray(i.uvs)&&Array.from?Array.from(i.uvs):i.uvs,t=i.normals&&!Array.isArray(i.normals)&&Array.from?Array.from(i.normals):i.normals;if(L&&h){i.indices=L,i.positions=h,l&&(i.uvs=l),t&&(i.normals=t);for(var p=W+1,x=new Array,R=0;R<p+1;R++)x[R]=new Array;var r=void 0,N=void 0,o=new z.m(0,0,0),D=new z.m(0,0,0),S=new z.k(0,0),C=new Array,e=new Array,V=new Array,c=void 0,a=h.length,P=void 0;l&&(P=l.length);var y=void 0;t&&(y=t.length);for(R=0;R<L.length;R+=3){e[0]=L[R],e[1]=L[R+1],e[2]=L[R+2];for(var M=0;M<3;M++)if(r=e[M],N=e[(M+1)%3],void 0===V[r]&&void 0===V[N]?(V[r]=new Array,V[N]=new Array):(void 0===V[r]&&(V[r]=new Array),void 0===V[N]&&(V[N]=new Array)),void 0===V[r][N]&&void 0===V[N][r]){V[r][N]=[],o.x=(h[3*N]-h[3*r])/p,o.y=(h[3*N+1]-h[3*r+1])/p,o.z=(h[3*N+2]-h[3*r+2])/p,t&&(D.x=(t[3*N]-t[3*r])/p,D.y=(t[3*N+1]-t[3*r+1])/p,D.z=(t[3*N+2]-t[3*r+2])/p),l&&(S.x=(l[2*N]-l[2*r])/p,S.y=(l[2*N+1]-l[2*r+1])/p),V[r][N].push(r);for(var b=1;b<p;b++)V[r][N].push(h.length/3),h[a++]=h[3*r]+b*o.x,h[a++]=h[3*r+1]+b*o.y,h[a++]=h[3*r+2]+b*o.z,t&&(t[y++]=t[3*r]+b*D.x,t[y++]=t[3*r+1]+b*D.y,t[y++]=t[3*r+2]+b*D.z),l&&(l[P++]=l[2*r]+b*S.x,l[P++]=l[2*r+1]+b*S.y);V[r][N].push(N),V[N][r]=new Array,c=V[r][N].length;for(var j=0;j<c;j++)V[N][r][j]=V[r][N][c-1-j]}x[0][0]=L[R],x[1][0]=V[L[R]][L[R+1]][1],x[1][1]=V[L[R]][L[R+2]][1];for(b=2;b<p;b++){x[b][0]=V[L[R]][L[R+1]][b],x[b][b]=V[L[R]][L[R+2]][b],o.x=(h[3*x[b][b]]-h[3*x[b][0]])/b,o.y=(h[3*x[b][b]+1]-h[3*x[b][0]+1])/b,o.z=(h[3*x[b][b]+2]-h[3*x[b][0]+2])/b,t&&(D.x=(t[3*x[b][b]]-t[3*x[b][0]])/b,D.y=(t[3*x[b][b]+1]-t[3*x[b][0]+1])/b,D.z=(t[3*x[b][b]+2]-t[3*x[b][0]+2])/b),l&&(S.x=(l[2*x[b][b]]-l[2*x[b][0]])/b,S.y=(l[2*x[b][b]+1]-l[2*x[b][0]+1])/b);for(M=1;M<b;M++)x[b][M]=h.length/3,h[a++]=h[3*x[b][0]]+M*o.x,h[a++]=h[3*x[b][0]+1]+M*o.y,h[a++]=h[3*x[b][0]+2]+M*o.z,t&&(t[y++]=t[3*x[b][0]]+M*D.x,t[y++]=t[3*x[b][0]+1]+M*D.y,t[y++]=t[3*x[b][0]+2]+M*D.z),l&&(l[P++]=l[2*x[b][0]]+M*S.x,l[P++]=l[2*x[b][0]+1]+M*S.y)}x[p]=V[L[R+1]][L[R+2]],C.push(x[0][0],x[1][0],x[1][1]);for(b=1;b<p;b++){M=void 0;for(M=0;M<b;M++)C.push(x[b][M],x[b+1][M],x[b+1][M+1]),C.push(x[b][M],x[b+1][M+1],x[b][M+1]);C.push(x[b][M],x[b+1][M],x[b+1][M+1])}}i.indices=C,i.applyToMesh(this,this.isVertexBufferUpdatable(I.d.PositionKind))}else f.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")},i.prototype.forceSharedVertices=function(){var W=s.e.ExtractFromMesh(this),i=W.uvs,L=W.indices,h=W.positions,l=W.colors;if(void 0===L||void 0===h||null===L||null===h)f.e.Warn("VertexData contains empty entries");else{for(var t=new Array,p=new Array,x=new Array,R=new Array,z=new Array,r=0,N={},o=void 0,D=void 0,S=0;S<L.length;S+=3){D=[L[S],L[S+1],L[S+2]],z=new Array;for(var C=0;C<3;C++){z[C]="";for(var e=0;e<3;e++)Math.abs(h[3*D[C]+e])<1e-8&&(h[3*D[C]+e]=0),z[C]+=h[3*D[C]+e]+"|"}if(z[0]!=z[1]&&z[0]!=z[2]&&z[1]!=z[2])for(C=0;C<3;C++){if(void 0===(o=N[z[C]])){N[z[C]]=r,o=r++;for(e=0;e<3;e++)t.push(h[3*D[C]+e]);if(null!==l&&void 0!==l)for(e=0;e<4;e++)R.push(l[4*D[C]+e]);if(null!==i&&void 0!==i)for(e=0;e<2;e++)x.push(i[2*D[C]+e])}p.push(o)}}var V=new Array;s.e.ComputeNormals(t,p,V),W.positions=t,W.indices=p,W.normals=V,null!==i&&void 0!==i&&(W.uvs=x),null!==l&&void 0!==l&&(W.colors=R),W.applyToMesh(this,this.isVertexBufferUpdatable(I.d.PositionKind))}},i._instancedMeshFactory=function(W,i){throw(0,P.b)("InstancedMesh")},i._PhysicsImpostorParser=function(W,i,L){throw(0,P.b)("PhysicsImpostor")},i.prototype.createInstance=function(W){return i._instancedMeshFactory(W,this)},i.prototype.synchronizeInstances=function(){for(var W=0;W<this.instances.length;W++){this.instances[W]._syncSubMeshes()}return this},i.prototype.optimizeIndices=function(W){var i=this,L=this.getIndices(),h=this.getVerticesData(I.d.PositionKind);if(!h||!L)return this;for(var l=new Array,p=0;p<h.length;p+=3)l.push(z.m.FromArray(h,p));var x=new Array;return t.e.SyncAsyncForLoop(l.length,40,(function(W){for(var i=l.length-1-W,L=l[i],h=0;h<i;++h){var t=l[h];if(L.equals(t)){x[i]=h;break}}}),(function(){for(var h=0;h<L.length;++h)L[h]=x[L[h]]||L[h];var l=i.subMeshes.slice(0);i.setIndices(L),i.subMeshes=l,W&&W(i)})),this},i.prototype.serialize=function(W){W.name=this.name,W.id=this.id,W.uniqueId=this.uniqueId,W.type=this.getClassName(),x.d&&x.d.HasTags(this)&&(W.tags=x.d.GetTags(this)),W.position=this.position.asArray(),this.rotationQuaternion?W.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(W.rotation=this.rotation.asArray()),W.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?W.pivotMatrix=this.getPivotMatrix().asArray():W.localMatrix=this.getPivotMatrix().asArray(),W.isEnabled=this.isEnabled(!1),W.isVisible=this.isVisible,W.infiniteDistance=this.infiniteDistance,W.pickable=this.isPickable,W.receiveShadows=this.receiveShadows,W.billboardMode=this.billboardMode,W.visibility=this.visibility,W.checkCollisions=this.checkCollisions,W.isBlocker=this.isBlocker,W.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&this.parent._serializeAsParent(W),W.isUnIndexed=this.isUnIndexed;var i=this._geometry;if(i&&this.subMeshes){W.geometryUniqueId=i.uniqueId,W.geometryId=i.id,W.subMeshes=[];for(var L=0;L<this.subMeshes.length;L++){var h=this.subMeshes[L];W.subMeshes.push({materialIndex:h.materialIndex,verticesStart:h.verticesStart,verticesCount:h.verticesCount,indexStart:h.indexStart,indexCount:h.indexCount})}}(this.material?this.material.doNotSerialize||(W.materialUniqueId=this.material.uniqueId,W.materialId=this.material.id):(this.material=null,W.materialUniqueId=this._scene.defaultMaterial.uniqueId,W.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(W.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(W.skeletonId=this.skeleton.id,W.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(y.e.NAME_PHYSICSENGINE))&&((p=this.getPhysicsImpostor())&&(W.physicsMass=p.getParam("mass"),W.physicsFriction=p.getParam("friction"),W.physicsRestitution=p.getParam("mass"),W.physicsImpostor=p.type));this.metadata&&(W.metadata=this.metadata),W.instances=[];for(var l=0;l<this.instances.length;l++){var t=this.instances[l];if(!t.doNotSerialize){var p,R={name:t.name,id:t.id,isEnabled:t.isEnabled(!1),isVisible:t.isVisible,isPickable:t.isPickable,checkCollisions:t.checkCollisions,position:t.position.asArray(),scaling:t.scaling.asArray()};if(t.parent&&t.parent._serializeAsParent(R),t.rotationQuaternion?R.rotationQuaternion=t.rotationQuaternion.asArray():t.rotation&&(R.rotation=t.rotation.asArray()),this.getScene()._getComponent(y.e.NAME_PHYSICSENGINE))(p=t.getPhysicsImpostor())&&(R.physicsMass=p.getParam("mass"),R.physicsFriction=p.getParam("friction"),R.physicsRestitution=p.getParam("mass"),R.physicsImpostor=p.type);t.metadata&&(R.metadata=t.metadata),W.instances.push(R),c.d.AppendSerializedAnimations(t,R),R.ranges=t.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(W.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){var z={data:{},sizes:{},strides:{}};for(var r in this._userThinInstanceBuffersStorage.data)z.data[r]=Array.from(this._userThinInstanceBuffersStorage.data[r]),z.sizes[r]=this._userThinInstanceBuffersStorage.sizes[r],z.strides[r]=this._userThinInstanceBuffersStorage.strides[r];W.thinInstances.userThinInstance=z}c.d.AppendSerializedAnimations(this,W),W.ranges=this.serializeAnimationRanges(),W.layerMask=this.layerMask,W.alphaIndex=this.alphaIndex,W.hasVertexAlpha=this.hasVertexAlpha,W.overlayAlpha=this.overlayAlpha,W.overlayColor=this.overlayColor.asArray(),W.renderOverlay=this.renderOverlay,W.applyFog=this.applyFog,this.actionManager&&(W.actions=this.actionManager.serialize(this.name))},i.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var W=this._internalAbstractMeshDataInfo._morphTargetManager;if(W&&W.vertexCount){if(W.vertexCount!==this.getTotalVertices())return f.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(W.isUsingTextureForTargets)return;for(var i=0;i<W.numInfluencers;i++){var L=W.getActiveTarget(i),h=L.getPositions();if(!h)return void f.e.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(I.d.PositionKind+i,h,!1,3);var l=L.getNormals();l&&this.geometry.setVerticesData(I.d.NormalKind+i,l,!1,3);var t=L.getTangents();t&&this.geometry.setVerticesData(I.d.TangentKind+i,t,!1,3);var p=L.getUVs();p&&this.geometry.setVerticesData(I.d.UVKind+"_"+i,p,!1,2)}}else for(i=0;this.geometry.isVerticesDataPresent(I.d.PositionKind+i);)this.geometry.removeVerticesData(I.d.PositionKind+i),this.geometry.isVerticesDataPresent(I.d.NormalKind+i)&&this.geometry.removeVerticesData(I.d.NormalKind+i),this.geometry.isVerticesDataPresent(I.d.TangentKind+i)&&this.geometry.removeVerticesData(I.d.TangentKind+i),this.geometry.isVerticesDataPresent(I.d.UVKind+i)&&this.geometry.removeVerticesData(I.d.UVKind+"_"+i),i++}},i.Parse=function(W,L,h){var l;if((l=W.type&&"LinesMesh"===W.type?i._LinesMeshParser(W,L):W.type&&"GroundMesh"===W.type?i._GroundMeshParser(W,L):W.type&&"GoldbergMesh"===W.type?i._GoldbergMeshParser(W,L):new i(W.name,L)).id=W.id,x.d&&x.d.AddTagsTo(l,W.tags),l.position=z.m.FromArray(W.position),void 0!==W.metadata&&(l.metadata=W.metadata),W.rotationQuaternion?l.rotationQuaternion=z.g.FromArray(W.rotationQuaternion):W.rotation&&(l.rotation=z.m.FromArray(W.rotation)),l.scaling=z.m.FromArray(W.scaling),W.localMatrix?l.setPreTransformMatrix(z.d.FromArray(W.localMatrix)):W.pivotMatrix&&l.setPivotMatrix(z.d.FromArray(W.pivotMatrix)),l.setEnabled(W.isEnabled),l.isVisible=W.isVisible,l.infiniteDistance=W.infiniteDistance,l.showBoundingBox=W.showBoundingBox,l.showSubMeshesBoundingBox=W.showSubMeshesBoundingBox,void 0!==W.applyFog&&(l.applyFog=W.applyFog),void 0!==W.pickable&&(l.isPickable=W.pickable),void 0!==W.alphaIndex&&(l.alphaIndex=W.alphaIndex),l.receiveShadows=W.receiveShadows,l.billboardMode=W.billboardMode,void 0!==W.visibility&&(l.visibility=W.visibility),l.checkCollisions=W.checkCollisions,l.overrideMaterialSideOrientation=W.overrideMaterialSideOrientation,void 0!==W.isBlocker&&(l.isBlocker=W.isBlocker),l._shouldGenerateFlatShading=W.useFlatShading,W.freezeWorldMatrix&&(l._waitingData.freezeWorldMatrix=W.freezeWorldMatrix),void 0!==W.parentId&&(l._waitingParentId=W.parentId),void 0!==W.parentInstanceIndex&&(l._waitingParentInstanceIndex=W.parentInstanceIndex),void 0!==W.actions&&(l._waitingData.actions=W.actions),void 0!==W.overlayAlpha&&(l.overlayAlpha=W.overlayAlpha),void 0!==W.overlayColor&&(l.overlayColor=r.d.FromArray(W.overlayColor)),void 0!==W.renderOverlay&&(l.renderOverlay=W.renderOverlay),l.isUnIndexed=!!W.isUnIndexed,l.hasVertexAlpha=W.hasVertexAlpha,W.delayLoadingFile?(l.delayLoadState=4,l.delayLoadingFile=h+W.delayLoadingFile,l.buildBoundingInfo(z.m.FromArray(W.boundingBoxMinimum),z.m.FromArray(W.boundingBoxMaximum)),W._binaryInfo&&(l._binaryInfo=W._binaryInfo),l._delayInfo=[],W.hasUVs&&l._delayInfo.push(I.d.UVKind),W.hasUVs2&&l._delayInfo.push(I.d.UV2Kind),W.hasUVs3&&l._delayInfo.push(I.d.UV3Kind),W.hasUVs4&&l._delayInfo.push(I.d.UV4Kind),W.hasUVs5&&l._delayInfo.push(I.d.UV5Kind),W.hasUVs6&&l._delayInfo.push(I.d.UV6Kind),W.hasColors&&l._delayInfo.push(I.d.ColorKind),W.hasMatricesIndices&&l._delayInfo.push(I.d.MatricesIndicesKind),W.hasMatricesWeights&&l._delayInfo.push(I.d.MatricesWeightsKind),l._delayLoadingFunction=o.b._ImportGeometry,V.e.ForceFullSceneLoadingForIncremental&&l._checkDelayState()):o.b._ImportGeometry(W,l),W.materialUniqueId?l._waitingMaterialId=W.materialUniqueId:W.materialId&&(l._waitingMaterialId=W.materialId),W.morphTargetManagerId>-1&&(l.morphTargetManager=L.getMorphTargetManagerById(W.morphTargetManagerId)),void 0!==W.skeletonId&&null!==W.skeletonId&&(l.skeleton=L.getLastSkeletonById(W.skeletonId),W.numBoneInfluencers&&(l.numBoneInfluencers=W.numBoneInfluencers)),W.animations){for(var t=0;t<W.animations.length;t++){var p=W.animations[t];(S=(0,a.b)("BABYLON.Animation"))&&l.animations.push(S.Parse(p))}N.b.ParseAnimationRanges(l,W,L)}if(W.autoAnimate&&L.beginAnimation(l,W.autoAnimateFrom,W.autoAnimateTo,W.autoAnimateLoop,W.autoAnimateSpeed||1),W.layerMask&&!isNaN(W.layerMask)?l.layerMask=Math.abs(parseInt(W.layerMask)):l.layerMask=268435455,W.physicsImpostor&&i._PhysicsImpostorParser(L,l,W),W.lodMeshIds&&(l._waitingData.lods={ids:W.lodMeshIds,distances:W.lodDistances?W.lodDistances:null,coverages:W.lodCoverages?W.lodCoverages:null}),W.instances)for(var R=0;R<W.instances.length;R++){var s=W.instances[R],D=l.createInstance(s.name);if(s.id&&(D.id=s.id),x.d&&(s.tags?x.d.AddTagsTo(D,s.tags):x.d.AddTagsTo(D,W.tags)),D.position=z.m.FromArray(s.position),void 0!==s.metadata&&(D.metadata=s.metadata),void 0!==s.parentId&&(D._waitingParentId=s.parentId),void 0!==s.parentInstanceIndex&&(D._waitingParentInstanceIndex=s.parentInstanceIndex),void 0!==s.isEnabled&&null!==s.isEnabled&&D.setEnabled(s.isEnabled),void 0!==s.isVisible&&null!==s.isVisible&&(D.isVisible=s.isVisible),void 0!==s.isPickable&&null!==s.isPickable&&(D.isPickable=s.isPickable),s.rotationQuaternion?D.rotationQuaternion=z.g.FromArray(s.rotationQuaternion):s.rotation&&(D.rotation=z.m.FromArray(s.rotation)),D.scaling=z.m.FromArray(s.scaling),void 0!=s.checkCollisions&&null!=s.checkCollisions&&(D.checkCollisions=s.checkCollisions),void 0!=s.pickable&&null!=s.pickable&&(D.isPickable=s.pickable),void 0!=s.showBoundingBox&&null!=s.showBoundingBox&&(D.showBoundingBox=s.showBoundingBox),void 0!=s.showSubMeshesBoundingBox&&null!=s.showSubMeshesBoundingBox&&(D.showSubMeshesBoundingBox=s.showSubMeshesBoundingBox),void 0!=s.alphaIndex&&null!=s.showSubMeshesBoundingBox&&(D.alphaIndex=s.alphaIndex),s.physicsImpostor&&i._PhysicsImpostorParser(L,D,s),s.animations){for(t=0;t<s.animations.length;t++){var S;p=s.animations[t];(S=(0,a.b)("BABYLON.Animation"))&&D.animations.push(S.Parse(p))}N.b.ParseAnimationRanges(D,s,L),s.autoAnimate&&L.beginAnimation(D,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1)}}if(W.thinInstances){var C=W.thinInstances;if(l.thinInstanceEnablePicking=!!C.enablePicking,C.matrixData?(l.thinInstanceSetBuffer("matrix",new Float32Array(C.matrixData),16,!1),l._thinInstanceDataStorage.matrixBufferSize=C.matrixBufferSize,l._thinInstanceDataStorage.instancesCount=C.instancesCount):l._thinInstanceDataStorage.matrixBufferSize=C.matrixBufferSize,W.thinInstances.userThinInstance){var e=W.thinInstances.userThinInstance;for(var c in e.data)l.thinInstanceSetBuffer(c,new Float32Array(e.data[c]),e.strides[c],!1),l._userThinInstanceBuffersStorage.sizes[c]=e.sizes[c]}}return l},i.prototype.setPositionsForCPUSkinning=function(){var W=this._internalMeshDataInfo;if(!W._sourcePositions){var i=this.getVerticesData(I.d.PositionKind);if(!i)return W._sourcePositions;W._sourcePositions=new Float32Array(i),this.isVertexBufferUpdatable(I.d.PositionKind)||this.setVerticesData(I.d.PositionKind,i,!0)}return W._sourcePositions},i.prototype.setNormalsForCPUSkinning=function(){var W=this._internalMeshDataInfo;if(!W._sourceNormals){var i=this.getVerticesData(I.d.NormalKind);if(!i)return W._sourceNormals;W._sourceNormals=new Float32Array(i),this.isVertexBufferUpdatable(I.d.NormalKind)||this.setVerticesData(I.d.NormalKind,i,!0)}return W._sourceNormals},i.prototype.applySkeleton=function(W){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(I.d.PositionKind))return this;if(!this.isVerticesDataPresent(I.d.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(I.d.MatricesWeightsKind))return this;var i=this.isVerticesDataPresent(I.d.NormalKind),L=this._internalMeshDataInfo;if(!L._sourcePositions){var h=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=h}i&&!L._sourceNormals&&this.setNormalsForCPUSkinning();var l=this.getVerticesData(I.d.PositionKind);if(!l)return this;l instanceof Float32Array||(l=new Float32Array(l));var t=this.getVerticesData(I.d.NormalKind);if(i){if(!t)return this;t instanceof Float32Array||(t=new Float32Array(t))}var p=this.getVerticesData(I.d.MatricesIndicesKind),x=this.getVerticesData(I.d.MatricesWeightsKind);if(!x||!p)return this;for(var R,r=this.numBoneInfluencers>4,N=r?this.getVerticesData(I.d.MatricesIndicesExtraKind):null,s=r?this.getVerticesData(I.d.MatricesWeightsExtraKind):null,o=W.getTransformMatrices(this),D=z.m.Zero(),S=new z.d,C=new z.d,e=0,V=0;V<l.length;V+=3,e+=4){var c=void 0;for(R=0;R<4;R++)(c=x[e+R])>0&&(z.d.FromFloat32ArrayToRefScaled(o,Math.floor(16*p[e+R]),c,C),S.addToSelf(C));if(r)for(R=0;R<4;R++)(c=s[e+R])>0&&(z.d.FromFloat32ArrayToRefScaled(o,Math.floor(16*N[e+R]),c,C),S.addToSelf(C));z.m.TransformCoordinatesFromFloatsToRef(L._sourcePositions[V],L._sourcePositions[V+1],L._sourcePositions[V+2],S,D),D.toArray(l,V),i&&(z.m.TransformNormalFromFloatsToRef(L._sourceNormals[V],L._sourceNormals[V+1],L._sourceNormals[V+2],S,D),D.toArray(t,V)),S.reset()}return this.updateVerticesData(I.d.PositionKind,l),i&&this.updateVerticesData(I.d.NormalKind,t),this},i.MinMax=function(W){var i=null,L=null;return W.forEach((function(W){var h=W.getBoundingInfo().boundingBox;i&&L?(i.minimizeInPlace(h.minimumWorld),L.maximizeInPlace(h.maximumWorld)):(i=h.minimumWorld,L=h.maximumWorld)})),i&&L?{min:i,max:L}:{min:z.m.Zero(),max:z.m.Zero()}},i.Center=function(W){var L=W instanceof Array?i.MinMax(W):W;return z.m.Center(L.min,L.max)},i.MergeMeshes=function(W,L,h,l,t,p){return void 0===L&&(L=!0),(0,R.k)(i._MergeMeshesCoroutine(W,L,h,l,t,p,!1))},i.MergeMeshesAsync=function(W,L,h,l,t,p){return void 0===L&&(L=!0),(0,R.h)(i._MergeMeshesCoroutine(W,L,h,l,t,p,!0),(0,R.d)())},i._MergeMeshesCoroutine=function(W,L,l,t,p,x,R){var z,r,N,I,o,D,C,V,c,a,P,y,M,b,j,Z,X,T,F,q,H,k,U,d,B,w;return void 0===L&&(L=!0),(0,h.p)(this,(function(h){switch(h.label){case 0:if(0===(W=W.filter(Boolean)).length)return[2,null];if(!l)for(r=0,z=0;z<W.length;z++)if((r+=W[z].getTotalVertices())>=65536)return f.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),[2,null];for(x&&(p=!1),N=new Array,I=new Array,o=new Array,D=W[0].overrideMaterialSideOrientation,z=0;z<W.length;z++){if((C=W[z]).isAnInstance)return f.e.Warn("Cannot merge instance meshes."),[2,null];if(D!==C.overrideMaterialSideOrientation)return f.e.Warn("Cannot merge meshes with different overrideMaterialSideOrientation values."),[2,null];if(p&&o.push(C.getTotalIndices()),x)if(C.material)if((V=C.material)instanceof e.d){for(c=0;c<V.subMaterials.length;c++)N.indexOf(V.subMaterials[c])<0&&N.push(V.subMaterials[c]);for(w=0;w<C.subMeshes.length;w++)I.push(N.indexOf(V.subMaterials[C.subMeshes[w].materialIndex])),o.push(C.subMeshes[w].indexCount)}else for(N.indexOf(V)<0&&N.push(V),w=0;w<C.subMeshes.length;w++)I.push(N.indexOf(V)),o.push(C.subMeshes[w].indexCount);else for(w=0;w<C.subMeshes.length;w++)I.push(0),o.push(C.subMeshes[w].indexCount)}return a=W[0],P=function(W){var i=W.computeWorldMatrix(!0);return[s.e.ExtractFromMesh(W,!1,!1),i]},y=P(a),M=y[0],b=y[1],R?[4]:[3,2];case 1:h.sent(),h.label=2;case 2:j=new Array(W.length-1),Z=1,h.label=3;case 3:return Z<W.length?(j[Z-1]=P(W[Z]),R?[4]:[3,5]):[3,6];case 4:h.sent(),h.label=5;case 5:return Z++,[3,3];case 6:X=M._mergeCoroutine(b,j,l,R,!L),T=X.next(),h.label=7;case 7:return T.done?[3,10]:R?[4]:[3,9];case 8:h.sent(),h.label=9;case 9:return T=X.next(),[3,7];case 10:F=T.value,t||(t=new i(a.name+"_merged",a.getScene())),q=F._applyToCoroutine(t,void 0,R),H=q.next(),h.label=11;case 11:return H.done?[3,14]:R?[4]:[3,13];case 12:h.sent(),h.label=13;case 13:return H=q.next(),[3,11];case 14:if(t.checkCollisions=a.checkCollisions,t.overrideMaterialSideOrientation=a.overrideMaterialSideOrientation,L)for(z=0;z<W.length;z++)W[z].dispose();if(p||x){for(t.releaseSubMeshes(),z=0,k=0;z<o.length;)S.d.CreateFromIndices(0,k,o[z],t,void 0,!1),k+=o[z],z++;for(U=0,d=t.subMeshes;U<d.length;U++)d[U].refreshBoundingInfo();t.computeWorldMatrix(!0)}if(x){for((B=new e.d(a.name+"_merged",a.getScene())).subMaterials=N,w=0;w<t.subMeshes.length;w++)t.subMeshes[w].materialIndex=I[w];t.material=B}else t.material=a.material;return[2,t]}}))},i.prototype.addInstance=function(W){W._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(W)},i.prototype.removeInstance=function(W){var i=W._indexInSourceMeshInstanceArray;if(-1!=i){if(i!==this.instances.length-1){var L=this.instances[this.instances.length-1];this.instances[i]=L,L._indexInSourceMeshInstanceArray=i}W._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},i.prototype._shouldConvertRHS=function(){return this.overrideMaterialSideOrientation===C.b.CounterClockWiseSideOrientation},i.FRONTSIDE=s.e.FRONTSIDE,i.BACKSIDE=s.e.BACKSIDE,i.DOUBLESIDE=s.e.DOUBLESIDE,i.DEFAULTSIDE=s.e.DEFAULTSIDE,i.NO_CAP=0,i.CAP_START=1,i.CAP_END=2,i.CAP_ALL=3,i.NO_FLIP=0,i.FLIP_TILE=1,i.ROTATE_TILE=2,i.FLIP_ROW=3,i.ROTATE_ROW=4,i.FLIP_N_ROTATE_TILE=5,i.FLIP_N_ROTATE_ROW=6,i.CENTER=0,i.LEFT=1,i.RIGHT=2,i.TOP=3,i.BOTTOM=4,i.INSTANCEDMESH_SORT_TRANSPARENT=!1,i._GroundMeshParser=function(W,i){throw(0,P.b)("GroundMesh")},i._GoldbergMeshParser=function(W,i){throw(0,P.b)("GoldbergMesh")},i._LinesMeshParser=function(W,i){throw(0,P.b)("LinesMesh")},i}(D.e);(0,a.c)("BABYLON.Mesh",F),F.prototype.setMaterialByID=function(W){return this.setMaterialById(W)},F.CreateDisc=F.CreateDisc||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateBox=F.CreateBox||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateSphere=F.CreateSphere||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateCylinder=F.CreateCylinder||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateTorusKnot=F.CreateTorusKnot||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateTorus=F.CreateTorus||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreatePlane=F.CreatePlane||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateGround=F.CreateGround||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateTiledGround=F.CreateTiledGround||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateGroundFromHeightMap=F.CreateGroundFromHeightMap||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateTube=F.CreateTube||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreatePolyhedron=F.CreatePolyhedron||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateIcoSphere=F.CreateIcoSphere||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateDecal=F.CreateDecal||function(){throw new Error("Import MeshBuilder to populate this function")},F.CreateCapsule=F.CreateCapsule||function(){throw new Error("Import MeshBuilder to populate this function")},F.ExtendToGoldberg=F.ExtendToGoldberg||function(){throw new Error("Import MeshBuilder to populate this function")}},85779:function(W,i,L){"use strict";L.d(i,{e:function(){return I}});var h=L(40061),l=L(80105),t=L(43251),p=L(50504),x=L(9488),R=L(9127),z=L(9892),r=L(61633),N=L(33224),I=function(){function W(){this._applyTo=(0,r.g)(this._applyToCoroutine.bind(this))}return W.prototype.set=function(W,i){switch(W.length||R.e.Warn("Setting vertex data kind '".concat(i,"' with an empty array")),i){case t.d.PositionKind:this.positions=W;break;case t.d.NormalKind:this.normals=W;break;case t.d.TangentKind:this.tangents=W;break;case t.d.UVKind:this.uvs=W;break;case t.d.UV2Kind:this.uvs2=W;break;case t.d.UV3Kind:this.uvs3=W;break;case t.d.UV4Kind:this.uvs4=W;break;case t.d.UV5Kind:this.uvs5=W;break;case t.d.UV6Kind:this.uvs6=W;break;case t.d.ColorKind:this.colors=W;break;case t.d.MatricesIndicesKind:this.matricesIndices=W;break;case t.d.MatricesWeightsKind:this.matricesWeights=W;break;case t.d.MatricesIndicesExtraKind:this.matricesIndicesExtra=W;break;case t.d.MatricesWeightsExtraKind:this.matricesWeightsExtra=W}},W.prototype.applyToMesh=function(W,i){return this._applyTo(W,i,!1),this},W.prototype.applyToGeometry=function(W,i){return this._applyTo(W,i,!1),this},W.prototype.updateMesh=function(W){return this._update(W),this},W.prototype.updateGeometry=function(W){return this._update(W),this},W.prototype._applyToCoroutine=function(W,i,L){return void 0===i&&(i=!1),(0,h.p)(this,(function(h){switch(h.label){case 0:return this.positions?(W.setVerticesData(t.d.PositionKind,this.positions,i),L?[4]:[3,2]):[3,2];case 1:h.sent(),h.label=2;case 2:return this.normals?(W.setVerticesData(t.d.NormalKind,this.normals,i),L?[4]:[3,4]):[3,4];case 3:h.sent(),h.label=4;case 4:return this.tangents?(W.setVerticesData(t.d.TangentKind,this.tangents,i),L?[4]:[3,6]):[3,6];case 5:h.sent(),h.label=6;case 6:return this.uvs?(W.setVerticesData(t.d.UVKind,this.uvs,i),L?[4]:[3,8]):[3,8];case 7:h.sent(),h.label=8;case 8:return this.uvs2?(W.setVerticesData(t.d.UV2Kind,this.uvs2,i),L?[4]:[3,10]):[3,10];case 9:h.sent(),h.label=10;case 10:return this.uvs3?(W.setVerticesData(t.d.UV3Kind,this.uvs3,i),L?[4]:[3,12]):[3,12];case 11:h.sent(),h.label=12;case 12:return this.uvs4?(W.setVerticesData(t.d.UV4Kind,this.uvs4,i),L?[4]:[3,14]):[3,14];case 13:h.sent(),h.label=14;case 14:return this.uvs5?(W.setVerticesData(t.d.UV5Kind,this.uvs5,i),L?[4]:[3,16]):[3,16];case 15:h.sent(),h.label=16;case 16:return this.uvs6?(W.setVerticesData(t.d.UV6Kind,this.uvs6,i),L?[4]:[3,18]):[3,18];case 17:h.sent(),h.label=18;case 18:return this.colors?(W.setVerticesData(t.d.ColorKind,this.colors,i),L?[4]:[3,20]):[3,20];case 19:h.sent(),h.label=20;case 20:return this.matricesIndices?(W.setVerticesData(t.d.MatricesIndicesKind,this.matricesIndices,i),L?[4]:[3,22]):[3,22];case 21:h.sent(),h.label=22;case 22:return this.matricesWeights?(W.setVerticesData(t.d.MatricesWeightsKind,this.matricesWeights,i),L?[4]:[3,24]):[3,24];case 23:h.sent(),h.label=24;case 24:return this.matricesIndicesExtra?(W.setVerticesData(t.d.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),L?[4]:[3,26]):[3,26];case 25:h.sent(),h.label=26;case 26:return this.matricesWeightsExtra?(W.setVerticesData(t.d.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),L?[4]:[3,28]):[3,28];case 27:h.sent(),h.label=28;case 28:return this.indices?(W.setIndices(this.indices,null,i),L?[4]:[3,30]):[3,31];case 29:h.sent(),h.label=30;case 30:return[3,32];case 31:W.setIndices([],null),h.label=32;case 32:return[2,this]}}))},W.prototype._update=function(W,i,L){return this.positions&&W.updateVerticesData(t.d.PositionKind,this.positions,i,L),this.normals&&W.updateVerticesData(t.d.NormalKind,this.normals,i,L),this.tangents&&W.updateVerticesData(t.d.TangentKind,this.tangents,i,L),this.uvs&&W.updateVerticesData(t.d.UVKind,this.uvs,i,L),this.uvs2&&W.updateVerticesData(t.d.UV2Kind,this.uvs2,i,L),this.uvs3&&W.updateVerticesData(t.d.UV3Kind,this.uvs3,i,L),this.uvs4&&W.updateVerticesData(t.d.UV4Kind,this.uvs4,i,L),this.uvs5&&W.updateVerticesData(t.d.UV5Kind,this.uvs5,i,L),this.uvs6&&W.updateVerticesData(t.d.UV6Kind,this.uvs6,i,L),this.colors&&W.updateVerticesData(t.d.ColorKind,this.colors,i,L),this.matricesIndices&&W.updateVerticesData(t.d.MatricesIndicesKind,this.matricesIndices,i,L),this.matricesWeights&&W.updateVerticesData(t.d.MatricesWeightsKind,this.matricesWeights,i,L),this.matricesIndicesExtra&&W.updateVerticesData(t.d.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,L),this.matricesWeightsExtra&&W.updateVerticesData(t.d.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,L),this.indices&&W.setIndices(this.indices,null),this},W._TransformVector3Coordinates=function(W,i,L,h){void 0===L&&(L=0),void 0===h&&(h=W.length);for(var t=l.h.Vector3[0],p=l.h.Vector3[1],x=L;x<L+h;x+=3)l.m.FromArrayToRef(W,x,t),l.m.TransformCoordinatesToRef(t,i,p),W[x]=p.x,W[x+1]=p.y,W[x+2]=p.z},W._TransformVector3Normals=function(W,i,L,h){void 0===L&&(L=0),void 0===h&&(h=W.length);for(var t=l.h.Vector3[0],p=l.h.Vector3[1],x=L;x<L+h;x+=3)l.m.FromArrayToRef(W,x,t),l.m.TransformNormalToRef(t,i,p),W[x]=p.x,W[x+1]=p.y,W[x+2]=p.z},W._TransformVector4Normals=function(W,i,L,h){void 0===L&&(L=0),void 0===h&&(h=W.length);for(var t=l.h.Vector4[0],p=l.h.Vector4[1],x=L;x<L+h;x+=4)l.n.FromArrayToRef(W,x,t),l.n.TransformNormalToRef(t,i,p),W[x]=p.x,W[x+1]=p.y,W[x+2]=p.z,W[x+3]=p.w},W._FlipFaces=function(W,i,L){void 0===i&&(i=0),void 0===L&&(L=W.length);for(var h=i;h<i+L;h+=3){var l=W[h+1];W[h+1]=W[h+2],W[h+2]=l}},W.prototype.transform=function(i){var L=i.determinant()<0;return this.positions&&W._TransformVector3Coordinates(this.positions,i),this.normals&&W._TransformVector3Normals(this.normals,i),this.tangents&&W._TransformVector4Normals(this.tangents,i),L&&this.indices&&W._FlipFaces(this.indices),this},W.prototype.merge=function(W,i,L){void 0===i&&(i=!1),void 0===L&&(L=!1);var h=Array.isArray(W)?W.map((function(W){return[W,void 0]})):[[W,void 0]];return(0,r.k)(this._mergeCoroutine(void 0,h,i,!1,L))},W.prototype._mergeCoroutine=function(i,L,l,p,x){var R,z,r,N,I,s,o,D,S,C,e,V,c,f,a,P,y,M,b,j=this;return void 0===l&&(l=!1),(0,h.p)(this,(function(h){switch(h.label){case 0:for(this._validate(),R=L.map((function(W){return W[0]})),z=0,r=R;z<r.length;z++)if((c=r[z])._validate(),!this.normals!==!c.normals||!this.tangents!==!c.tangents||!this.uvs!==!c.uvs||!this.uvs2!==!c.uvs2||!this.uvs3!==!c.uvs3||!this.uvs4!==!c.uvs4||!this.uvs5!==!c.uvs5||!this.uvs6!==!c.uvs6||!this.colors!==!c.colors||!this.matricesIndices!==!c.matricesIndices||!this.matricesWeights!==!c.matricesWeights||!this.matricesIndicesExtra!==!c.matricesIndicesExtra||!this.matricesWeightsExtra!==!c.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(N=R.reduce((function(W,i){var L,h;return W+(null!==(h=null===(L=i.indices)||void 0===L?void 0:L.length)&&void 0!==h?h:0)}),null!==(y=null===(P=this.indices)||void 0===P?void 0:P.length)&&void 0!==y?y:0),I=x||R.some((function(W){return W.indices===j.indices})),s=I?null===(M=this.indices)||void 0===M?void 0:M.slice():this.indices,!(N>0))return[3,4];o=null!==(b=null===s||void 0===s?void 0:s.length)&&void 0!==b?b:0,s||(s=new Array(N)),s.length!==N&&(Array.isArray(s)?s.length=N:((D=l||s instanceof Uint32Array?new Uint32Array(N):new Uint16Array(N)).set(s),s=D),i&&i.determinant()<0&&W._FlipFaces(s,0,o)),S=this.positions?this.positions.length/3:0,C=0,e=L,h.label=1;case 1:if(!(C<e.length))return[3,4];if(V=e[C],c=V[0],f=V[1],!c.indices)return[3,3];for(a=0;a<c.indices.length;a++)s[o+a]=c.indices[a]+S;return f&&f.determinant()<0&&W._FlipFaces(s,o,c.indices.length),S+=c.positions.length/3,o+=c.indices.length,p?[4]:[3,3];case 2:h.sent(),h.label=3;case 3:return C++,[3,1];case 4:return this.indices=s,this.positions=W._MergeElement(t.d.PositionKind,this.positions,i,L.map((function(W){return[W[0].positions,W[1]]}))),p?[4]:[3,6];case 5:h.sent(),h.label=6;case 6:return this.normals=W._MergeElement(t.d.NormalKind,this.normals,i,L.map((function(W){return[W[0].normals,W[1]]}))),p?[4]:[3,8];case 7:h.sent(),h.label=8;case 8:return this.tangents=W._MergeElement(t.d.TangentKind,this.tangents,i,L.map((function(W){return[W[0].tangents,W[1]]}))),p?[4]:[3,10];case 9:h.sent(),h.label=10;case 10:return this.uvs=W._MergeElement(t.d.UVKind,this.uvs,i,L.map((function(W){return[W[0].uvs,W[1]]}))),p?[4]:[3,12];case 11:h.sent(),h.label=12;case 12:return this.uvs2=W._MergeElement(t.d.UV2Kind,this.uvs2,i,L.map((function(W){return[W[0].uvs2,W[1]]}))),p?[4]:[3,14];case 13:h.sent(),h.label=14;case 14:return this.uvs3=W._MergeElement(t.d.UV3Kind,this.uvs3,i,L.map((function(W){return[W[0].uvs3,W[1]]}))),p?[4]:[3,16];case 15:h.sent(),h.label=16;case 16:return this.uvs4=W._MergeElement(t.d.UV4Kind,this.uvs4,i,L.map((function(W){return[W[0].uvs4,W[1]]}))),p?[4]:[3,18];case 17:h.sent(),h.label=18;case 18:return this.uvs5=W._MergeElement(t.d.UV5Kind,this.uvs5,i,L.map((function(W){return[W[0].uvs5,W[1]]}))),p?[4]:[3,20];case 19:h.sent(),h.label=20;case 20:return this.uvs6=W._MergeElement(t.d.UV6Kind,this.uvs6,i,L.map((function(W){return[W[0].uvs6,W[1]]}))),p?[4]:[3,22];case 21:h.sent(),h.label=22;case 22:return this.colors=W._MergeElement(t.d.ColorKind,this.colors,i,L.map((function(W){return[W[0].colors,W[1]]}))),p?[4]:[3,24];case 23:h.sent(),h.label=24;case 24:return this.matricesIndices=W._MergeElement(t.d.MatricesIndicesKind,this.matricesIndices,i,L.map((function(W){return[W[0].matricesIndices,W[1]]}))),p?[4]:[3,26];case 25:h.sent(),h.label=26;case 26:return this.matricesWeights=W._MergeElement(t.d.MatricesWeightsKind,this.matricesWeights,i,L.map((function(W){return[W[0].matricesWeights,W[1]]}))),p?[4]:[3,28];case 27:h.sent(),h.label=28;case 28:return this.matricesIndicesExtra=W._MergeElement(t.d.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,L.map((function(W){return[W[0].matricesIndicesExtra,W[1]]}))),p?[4]:[3,30];case 29:h.sent(),h.label=30;case 30:return this.matricesWeightsExtra=W._MergeElement(t.d.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,L.map((function(W){return[W[0].matricesWeightsExtra,W[1]]}))),[2,this]}}))},W._MergeElement=function(i,L,h,l){var p=l.filter((function(W){return null!==W[0]&&void 0!==W[0]}));if(!L&&0==p.length)return L;if(!L)return this._MergeElement(i,p[0][0],p[0][1],p.slice(1));var x=p.reduce((function(W,i){return W+i[0].length}),L.length),R=i===t.d.PositionKind?W._TransformVector3Coordinates:i===t.d.NormalKind?W._TransformVector3Normals:i===t.d.TangentKind?W._TransformVector4Normals:function(){};if(L instanceof Float32Array){var z=new Float32Array(x);z.set(L),h&&R(z,h,0,L.length);for(var r=L.length,N=0,I=p;N<I.length;N++){var s=I[N],o=s[0],D=s[1];z.set(o,r),D&&R(z,D,r,o.length),r+=o.length}return z}for(var S=new Array(x),C=0;C<L.length;C++)S[C]=L[C];h&&R(S,h,0,L.length);r=L.length;for(var e=0,V=p;e<V.length;e++){var c=V[e],f=(o=c[0],c[1]);for(C=0;C<o.length;C++)S[r+C]=o[C];f&&R(S,f,r,o.length),r+=o.length}return S},W.prototype._validate=function(){if(!this.positions)throw new N.j("Positions are required",N.f.MeshInvalidPositionsError);var W=function(W,i){var L=t.d.DeduceStride(W);if(i.length%L!==0)throw new Error("The "+W+"s array count must be a multiple of "+L);return i.length/L},i=W(t.d.PositionKind,this.positions),L=function(L,h){var l=W(L,h);if(l!==i)throw new Error("The "+L+"s element count ("+l+") does not match the positions count ("+i+")")};this.normals&&L(t.d.NormalKind,this.normals),this.tangents&&L(t.d.TangentKind,this.tangents),this.uvs&&L(t.d.UVKind,this.uvs),this.uvs2&&L(t.d.UV2Kind,this.uvs2),this.uvs3&&L(t.d.UV3Kind,this.uvs3),this.uvs4&&L(t.d.UV4Kind,this.uvs4),this.uvs5&&L(t.d.UV5Kind,this.uvs5),this.uvs6&&L(t.d.UV6Kind,this.uvs6),this.colors&&L(t.d.ColorKind,this.colors),this.matricesIndices&&L(t.d.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&L(t.d.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&L(t.d.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&L(t.d.MatricesWeightsExtraKind,this.matricesWeightsExtra)},W.prototype.serialize=function(){var W={};return this.positions&&(W.positions=this.positions),this.normals&&(W.normals=this.normals),this.tangents&&(W.tangents=this.tangents),this.uvs&&(W.uvs=this.uvs),this.uvs2&&(W.uvs2=this.uvs2),this.uvs3&&(W.uvs3=this.uvs3),this.uvs4&&(W.uvs4=this.uvs4),this.uvs5&&(W.uvs5=this.uvs5),this.uvs6&&(W.uvs6=this.uvs6),this.colors&&(W.colors=this.colors),this.matricesIndices&&(W.matricesIndices=this.matricesIndices,W.matricesIndices._isExpanded=!0),this.matricesWeights&&(W.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(W.matricesIndicesExtra=this.matricesIndicesExtra,W.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(W.matricesWeightsExtra=this.matricesWeightsExtra),W.indices=this.indices,W},W.ExtractFromMesh=function(i,L,h){return W._ExtractFrom(i,L,h)},W.ExtractFromGeometry=function(i,L,h){return W._ExtractFrom(i,L,h)},W._ExtractFrom=function(i,L,h){var l=new W;return i.isVerticesDataPresent(t.d.PositionKind)&&(l.positions=i.getVerticesData(t.d.PositionKind,L,h)),i.isVerticesDataPresent(t.d.NormalKind)&&(l.normals=i.getVerticesData(t.d.NormalKind,L,h)),i.isVerticesDataPresent(t.d.TangentKind)&&(l.tangents=i.getVerticesData(t.d.TangentKind,L,h)),i.isVerticesDataPresent(t.d.UVKind)&&(l.uvs=i.getVerticesData(t.d.UVKind,L,h)),i.isVerticesDataPresent(t.d.UV2Kind)&&(l.uvs2=i.getVerticesData(t.d.UV2Kind,L,h)),i.isVerticesDataPresent(t.d.UV3Kind)&&(l.uvs3=i.getVerticesData(t.d.UV3Kind,L,h)),i.isVerticesDataPresent(t.d.UV4Kind)&&(l.uvs4=i.getVerticesData(t.d.UV4Kind,L,h)),i.isVerticesDataPresent(t.d.UV5Kind)&&(l.uvs5=i.getVerticesData(t.d.UV5Kind,L,h)),i.isVerticesDataPresent(t.d.UV6Kind)&&(l.uvs6=i.getVerticesData(t.d.UV6Kind,L,h)),i.isVerticesDataPresent(t.d.ColorKind)&&(l.colors=i.getVerticesData(t.d.ColorKind,L,h)),i.isVerticesDataPresent(t.d.MatricesIndicesKind)&&(l.matricesIndices=i.getVerticesData(t.d.MatricesIndicesKind,L,h)),i.isVerticesDataPresent(t.d.MatricesWeightsKind)&&(l.matricesWeights=i.getVerticesData(t.d.MatricesWeightsKind,L,h)),i.isVerticesDataPresent(t.d.MatricesIndicesExtraKind)&&(l.matricesIndicesExtra=i.getVerticesData(t.d.MatricesIndicesExtraKind,L,h)),i.isVerticesDataPresent(t.d.MatricesWeightsExtraKind)&&(l.matricesWeightsExtra=i.getVerticesData(t.d.MatricesWeightsExtraKind,L,h)),l.indices=i.getIndices(L,h),l},W.CreateRibbon=function(W){throw(0,p.b)("ribbonBuilder")},W.CreateBox=function(W){throw(0,p.b)("boxBuilder")},W.CreateTiledBox=function(W){throw(0,p.b)("tiledBoxBuilder")},W.CreateTiledPlane=function(W){throw(0,p.b)("tiledPlaneBuilder")},W.CreateSphere=function(W){throw(0,p.b)("sphereBuilder")},W.CreateCylinder=function(W){throw(0,p.b)("cylinderBuilder")},W.CreateTorus=function(W){throw(0,p.b)("torusBuilder")},W.CreateLineSystem=function(W){throw(0,p.b)("linesBuilder")},W.CreateDashedLines=function(W){throw(0,p.b)("linesBuilder")},W.CreateGround=function(W){throw(0,p.b)("groundBuilder")},W.CreateTiledGround=function(W){throw(0,p.b)("groundBuilder")},W.CreateGroundFromHeightMap=function(W){throw(0,p.b)("groundBuilder")},W.CreatePlane=function(W){throw(0,p.b)("planeBuilder")},W.CreateDisc=function(W){throw(0,p.b)("discBuilder")},W.CreatePolygon=function(W,i,L,h,l,t,x){throw(0,p.b)("polygonBuilder")},W.CreateIcoSphere=function(W){throw(0,p.b)("icoSphereBuilder")},W.CreatePolyhedron=function(W){throw(0,p.b)("polyhedronBuilder")},W.CreateCapsule=function(W){throw void 0===W&&(W={orientation:l.m.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),(0,p.b)("capsuleBuilder")},W.CreateTorusKnot=function(W){throw(0,p.b)("torusKnotBuilder")},W.ComputeNormals=function(W,i,L,h){var t=0,p=0,x=0,R=0,z=0,r=0,N=0,I=0,s=0,o=0,D=0,S=0,C=0,e=0,V=0,c=0,f=0,a=0,P=0,y=0,M=!1,b=!1,j=!1,Z=!1,X=1,T=0,F=null;h&&(M=!!h.facetNormals,b=!!h.facetPositions,j=!!h.facetPartitioning,X=!0===h.useRightHandedSystem?-1:1,T=h.ratio||0,Z=!!h.depthSort,F=h.distanceTo,Z&&void 0===F&&(F=l.m.Zero()));var q=0,H=0,k=0,U=0;for(j&&h&&h.bbSize&&(q=h.subDiv.X*T/h.bbSize.x,H=h.subDiv.Y*T/h.bbSize.y,k=h.subDiv.Z*T/h.bbSize.z,U=h.subDiv.max*h.subDiv.max,h.facetPartitioning.length=0),t=0;t<W.length;t++)L[t]=0;var d=i.length/3|0;for(t=0;t<d;t++){if(C=(S=3*i[3*t])+1,e=S+2,c=(V=3*i[3*t+1])+1,f=V+2,P=(a=3*i[3*t+2])+1,y=a+2,p=W[S]-W[V],x=W[C]-W[c],R=W[e]-W[f],z=W[a]-W[V],r=W[P]-W[c],I=X*(x*(N=W[y]-W[f])-R*r),s=X*(R*z-p*N),o=X*(p*r-x*z),I/=D=0===(D=Math.sqrt(I*I+s*s+o*o))?1:D,s/=D,o/=D,M&&h&&(h.facetNormals[t].x=I,h.facetNormals[t].y=s,h.facetNormals[t].z=o),b&&h&&(h.facetPositions[t].x=(W[S]+W[V]+W[a])/3,h.facetPositions[t].y=(W[C]+W[c]+W[P])/3,h.facetPositions[t].z=(W[e]+W[f]+W[y])/3),j&&h){var B=Math.floor((h.facetPositions[t].x-h.bInfo.minimum.x*T)*q),w=Math.floor((h.facetPositions[t].y-h.bInfo.minimum.y*T)*H),g=Math.floor((h.facetPositions[t].z-h.bInfo.minimum.z*T)*k),n=Math.floor((W[S]-h.bInfo.minimum.x*T)*q),m=Math.floor((W[C]-h.bInfo.minimum.y*T)*H),E=Math.floor((W[e]-h.bInfo.minimum.z*T)*k),K=Math.floor((W[V]-h.bInfo.minimum.x*T)*q),G=Math.floor((W[c]-h.bInfo.minimum.y*T)*H),u=Math.floor((W[f]-h.bInfo.minimum.z*T)*k),J=Math.floor((W[a]-h.bInfo.minimum.x*T)*q),A=Math.floor((W[P]-h.bInfo.minimum.y*T)*H),v=Math.floor((W[y]-h.bInfo.minimum.z*T)*k),Q=n+h.subDiv.max*m+U*E,O=K+h.subDiv.max*G+U*u,Y=J+h.subDiv.max*A+U*v,WW=B+h.subDiv.max*w+U*g;h.facetPartitioning[WW]=h.facetPartitioning[WW]?h.facetPartitioning[WW]:new Array,h.facetPartitioning[Q]=h.facetPartitioning[Q]?h.facetPartitioning[Q]:new Array,h.facetPartitioning[O]=h.facetPartitioning[O]?h.facetPartitioning[O]:new Array,h.facetPartitioning[Y]=h.facetPartitioning[Y]?h.facetPartitioning[Y]:new Array,h.facetPartitioning[Q].push(t),O!=Q&&h.facetPartitioning[O].push(t),Y!=O&&Y!=Q&&h.facetPartitioning[Y].push(t),WW!=Q&&WW!=O&&WW!=Y&&h.facetPartitioning[WW].push(t)}if(Z&&h&&h.facetPositions){var iW=h.depthSortedFacets[t];iW.ind=3*t,iW.sqDistance=l.m.DistanceSquared(h.facetPositions[t],F)}L[S]+=I,L[C]+=s,L[e]+=o,L[V]+=I,L[c]+=s,L[f]+=o,L[a]+=I,L[P]+=s,L[y]+=o}for(t=0;t<L.length/3;t++)I=L[3*t],s=L[3*t+1],o=L[3*t+2],I/=D=0===(D=Math.sqrt(I*I+s*s+o*o))?1:D,s/=D,o/=D,L[3*t]=I,L[3*t+1]=s,L[3*t+2]=o},W._ComputeSides=function(i,L,h,t,p,x,R){var z,r,N=h.length,I=t.length;switch(i=i||W.DEFAULTSIDE){case W.FRONTSIDE:break;case W.BACKSIDE:for(z=0;z<N;z+=3){var s=h[z];h[z]=h[z+2],h[z+2]=s}for(r=0;r<I;r++)t[r]=-t[r];break;case W.DOUBLESIDE:for(var o=L.length,D=o/3,S=0;S<o;S++)L[o+S]=L[S];for(z=0;z<N;z+=3)h[z+N]=h[z+2]+D,h[z+1+N]=h[z+1]+D,h[z+2+N]=h[z]+D;for(r=0;r<I;r++)t[I+r]=-t[r];var C=p.length,e=0;for(e=0;e<C;e++)p[e+C]=p[e];for(x=x||new l.n(0,0,1,1),R=R||new l.n(0,0,1,1),e=0,z=0;z<C/2;z++)p[e]=x.x+(x.z-x.x)*p[e],p[e+1]=x.y+(x.w-x.y)*p[e+1],p[e+C]=R.x+(R.z-R.x)*p[e+C],p[e+C+1]=R.y+(R.w-R.y)*p[e+C+1],e+=2}},W.ImportVertexData=function(i,L){var h=new W,l=i.positions;l&&h.set(l,t.d.PositionKind);var p=i.normals;p&&h.set(p,t.d.NormalKind);var R=i.tangents;R&&h.set(R,t.d.TangentKind);var z=i.uvs;z&&h.set(z,t.d.UVKind);var r=i.uv2s;r&&h.set(r,t.d.UV2Kind);var N=i.uv3s;N&&h.set(N,t.d.UV3Kind);var I=i.uv4s;I&&h.set(I,t.d.UV4Kind);var s=i.uv5s;s&&h.set(s,t.d.UV5Kind);var o=i.uv6s;o&&h.set(o,t.d.UV6Kind);var D=i.colors;D&&h.set(x.g.CheckColors4(D,l.length/3),t.d.ColorKind);var S=i.matricesIndices;S&&h.set(S,t.d.MatricesIndicesKind);var C=i.matricesWeights;C&&h.set(C,t.d.MatricesWeightsKind);var e=i.indices;e&&(h.indices=e),L.setAllVerticesData(h,i.updatable)},W.FRONTSIDE=0,W.BACKSIDE=1,W.DOUBLESIDE=2,W.DEFAULTSIDE=0,(0,h.j)([z.k.filter((function(){for(var W=[],i=0;i<arguments.length;i++)W[i]=arguments[i];var L=W[0];return!Array.isArray(L)}))],W,"_TransformVector3Coordinates",null),(0,h.j)([z.k.filter((function(){for(var W=[],i=0;i<arguments.length;i++)W[i]=arguments[i];var L=W[0];return!Array.isArray(L)}))],W,"_TransformVector3Normals",null),(0,h.j)([z.k.filter((function(){for(var W=[],i=0;i<arguments.length;i++)W[i]=arguments[i];var L=W[0];return!Array.isArray(L)}))],W,"_TransformVector4Normals",null),(0,h.j)([z.k.filter((function(){for(var W=[],i=0;i<arguments.length;i++)W[i]=arguments[i];var L=W[0];return!Array.isArray(L)}))],W,"_FlipFaces",null),W}()},54588:function(W,i,L){"use strict";L.d(i,{e:function(){return DW}});var h=L(80105),l=L(65847),t=L(43251),p=L(85779),x=L(20334);function R(W){var i=W.pathArray,L=W.closeArray||!1,h=W.closePath||!1,l=W.invertUV||!1,R=Math.floor(i[0].length/2),z=W.offset||R;z=z>R?R:Math.floor(z);var r,N,I,s,o=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE,D=W.uvs,S=W.colors,C=[],e=[],V=[],c=[],f=[],a=[],P=[],y=[],M=[],b=[];if(i.length<2){var j=[],Z=[];for(I=0;I<i[0].length-z;I++)j.push(i[0][I]),Z.push(i[0][I+z]);i=[j,Z]}var X,T,F,q,H,k=0,U=h?1:0;for(r=i[0].length,N=0;N<i.length;N++){for(P[N]=0,f[N]=[0],r=r<(T=(X=i[N]).length)?r:T,s=0;s<T;)C.push(X[s].x,X[s].y,X[s].z),s>0&&(F=X[s].subtract(X[s-1]).length()+P[N],f[N].push(F),P[N]=F),s++;h&&(s--,C.push(X[0].x,X[0].y,X[0].z),F=X[s].subtract(X[0]).length()+P[N],f[N].push(F),P[N]=F),M[N]=T+U,b[N]=k,k+=T+U}var d,B,w=null,g=null;for(I=0;I<r+U;I++){for(y[I]=0,a[I]=[0],N=0;N<i.length-1;N++)q=i[N],H=i[N+1],I===r?(w=q[0],g=H[0]):(w=q[I],g=H[I]),F=g.subtract(w).length()+y[I],a[I].push(F),y[I]=F;L&&g&&w&&(q=i[N],H=i[0],I===r&&(g=H[0]),F=g.subtract(w).length()+y[I],y[I]=F)}if(D)for(N=0;N<D.length;N++)c.push(D[N].x,x.d.UseOpenGLOrientationForUV?1-D[N].y:D[N].y);else for(N=0;N<i.length;N++)for(I=0;I<r+U;I++)d=0!=P[N]?f[N][I]/P[N]:0,B=0!=y[I]?a[I][N]/y[I]:0,l?c.push(B,d):c.push(d,x.d.UseOpenGLOrientationForUV?1-B:B);for(var n=0,m=M[N=0]-1,E=M[N+1]-1,K=m<E?m:E,G=b[1]-b[0],u=L?M.length:M.length-1;n<=K&&N<u;)e.push(n,n+G,n+1),e.push(n+G+1,n+1,n+G),(n+=1)===K&&(++N===M.length-1?(G=b[0]-b[N],m=M[N]-1,E=M[0]-1):(G=b[N+1]-b[N],m=M[N]-1,E=M[N+1]-1),n=b[N],K=m<E?m+n:E+n);if(p.e.ComputeNormals(C,e,V),h){var J=0,A=0;for(N=0;N<i.length;N++)J=3*b[N],A=N+1<i.length?3*(b[N+1]-1):V.length-3,V[J]=.5*(V[J]+V[A]),V[J+1]=.5*(V[J+1]+V[A+1]),V[J+2]=.5*(V[J+2]+V[A+2]),V[A]=V[J],V[A+1]=V[J+1],V[A+2]=V[J+2]}p.e._ComputeSides(o,C,e,V,c,W.frontUVs,W.backUVs);var v=null;if(S){v=new Float32Array(4*S.length);for(var Q=0;Q<S.length;Q++)v[4*Q]=S[Q].r,v[4*Q+1]=S[Q].g,v[4*Q+2]=S[Q].b,v[4*Q+3]=S[Q].a}var O=new p.e,Y=new Float32Array(C),WW=new Float32Array(V),iW=new Float32Array(c);return O.indices=e,O.positions=Y,O.normals=WW,O.uvs=iW,v&&O.set(v,t.d.ColorKind),h&&(O._idx=b),O}function z(W,i,L){void 0===L&&(L=null);var z=i.pathArray,r=i.closeArray,N=i.closePath,I=l.e._GetDefaultSideOrientation(i.sideOrientation),s=i.instance,o=i.updatable;if(s){var D=h.h.Vector3[0].setAll(Number.MAX_VALUE),S=h.h.Vector3[1].setAll(-Number.MAX_VALUE),C=s.getVerticesData(t.d.PositionKind);if(function(W){for(var i=z[0].length,L=s,h=0,t=L._originalBuilderSideOrientation===l.e.DOUBLESIDE?2:1,p=1;p<=t;++p)for(var x=0;x<z.length;++x){var R=z[x],r=R.length;i=i<r?i:r;for(var N=0;N<i;++N){var I=R[N];W[h]=I.x,W[h+1]=I.y,W[h+2]=I.z,D.minimizeInPlaceFromFloats(I.x,I.y,I.z),S.maximizeInPlaceFromFloats(I.x,I.y,I.z),h+=3}if(L._creationDataStorage&&L._creationDataStorage.closePath){I=R[0];W[h]=I.x,W[h+1]=I.y,W[h+2]=I.z,h+=3}}}(C),s.hasBoundingInfo?s.getBoundingInfo().reConstruct(D,S,s._worldMatrix):s.buildBoundingInfo(D,S,s._worldMatrix),s.updateVerticesData(t.d.PositionKind,C,!1,!1),i.colors){for(var e=s.getVerticesData(t.d.ColorKind),V=0,c=0;V<i.colors.length;V++,c+=4){var f=i.colors[V];e[c]=f.r,e[c+1]=f.g,e[c+2]=f.b,e[c+3]=f.a}s.updateVerticesData(t.d.ColorKind,e,!1,!1)}if(i.uvs){for(var a=s.getVerticesData(t.d.UVKind),P=0;P<i.uvs.length;P++)a[2*P]=i.uvs[P].x,a[2*P+1]=x.d.UseOpenGLOrientationForUV?1-i.uvs[P].y:i.uvs[P].y;s.updateVerticesData(t.d.UVKind,a,!1,!1)}if(!s.areNormalsFrozen||s.isFacetDataEnabled){var y=s.getIndices(),M=s.getVerticesData(t.d.NormalKind),b=s.isFacetDataEnabled?s.getFacetDataParameters():null;if(p.e.ComputeNormals(C,y,M,b),s._creationDataStorage&&s._creationDataStorage.closePath)for(var j=0,Z=0,X=0;X<z.length;X++)j=3*s._creationDataStorage.idx[X],Z=X+1<z.length?3*(s._creationDataStorage.idx[X+1]-1):M.length-3,M[j]=.5*(M[j]+M[Z]),M[j+1]=.5*(M[j+1]+M[Z+1]),M[j+2]=.5*(M[j+2]+M[Z+2]),M[Z]=M[j],M[Z+1]=M[j+1],M[Z+2]=M[j+2];s.areNormalsFrozen||s.updateVerticesData(t.d.NormalKind,M,!1,!1)}return s}var T=new l.e(W,L);T._originalBuilderSideOrientation=I,T._creationDataStorage=new l.i;var F=R(i);return N&&(T._creationDataStorage.idx=F._idx),T._creationDataStorage.closePath=N,T._creationDataStorage.closeArray=r,F.applyToMesh(T,o),T}p.e.CreateRibbon=R,l.e.CreateRibbon=function(W,i,L,h,l,t,p,x,R){return void 0===L&&(L=!1),void 0===p&&(p=!1),z(W,{pathArray:i,closeArray:L,closePath:h,offset:l,updatable:p,sideOrientation:x,instance:R},t)};var r=L(60612),N=L(64400),I=L(9488);function s(W){var i=W.pattern||l.e.NO_FLIP,L=W.tileWidth||W.tileSize||1,h=W.tileHeight||W.tileSize||1,t=W.alignHorizontal||0,x=W.alignVertical||0,R=W.width||W.size||1,z=Math.floor(R/L),r=R-z*L,N=W.height||W.size||1,I=Math.floor(N/h),s=N-I*h,o=L*z/2,D=h*I/2,S=0,C=0,e=0,V=0,c=0,f=0;if(r>0||s>0){switch(e=-o,V=-D,c=o,f=D,t){case l.e.CENTER:e-=r/=2,c+=r;break;case l.e.LEFT:c+=r,S=-r/2;break;case l.e.RIGHT:e-=r,S=r/2}switch(x){case l.e.CENTER:V-=s/=2,f+=s;break;case l.e.BOTTOM:f+=s,C=-s/2;break;case l.e.TOP:V-=s,C=s/2}}var a=[],P=[],y=[];y[0]=[0,0,1,0,1,1,0,1],y[1]=[0,0,1,0,1,1,0,1],i!==l.e.ROTATE_TILE&&i!==l.e.ROTATE_ROW||(y[1]=[1,1,0,1,0,0,1,0]),i!==l.e.FLIP_TILE&&i!==l.e.FLIP_ROW||(y[1]=[1,0,0,0,0,1,1,1]),i!==l.e.FLIP_N_ROTATE_TILE&&i!==l.e.FLIP_N_ROTATE_ROW||(y[1]=[0,1,1,1,1,0,0,0]);for(var M=[],b=[],j=[],Z=0,X=0;X<I;X++)for(var T=0;T<z;T++)a.push(T*L-o+S,X*h-D+C,0),a.push((T+1)*L-o+S,X*h-D+C,0),a.push((T+1)*L-o+S,(X+1)*h-D+C,0),a.push(T*L-o+S,(X+1)*h-D+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),M=i===l.e.FLIP_TILE||i===l.e.ROTATE_TILE||i===l.e.FLIP_N_ROTATE_TILE?M.concat(y[(T%2+X%2)%2]):i===l.e.FLIP_ROW||i===l.e.ROTATE_ROW||i===l.e.FLIP_N_ROTATE_ROW?M.concat(y[X%2]):M.concat(y[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Z+=4;if(r>0||s>0){var F=s>0&&(x===l.e.CENTER||x===l.e.TOP),q=s>0&&(x===l.e.CENTER||x===l.e.BOTTOM),H=r>0&&(t===l.e.CENTER||t===l.e.RIGHT),k=r>0&&(t===l.e.CENTER||t===l.e.LEFT),U=[],d=void 0,B=void 0,w=void 0,g=void 0;if(F&&H&&(a.push(e+S,V+C,0),a.push(-o+S,V+C,0),a.push(-o+S,V+s+C,0),a.push(e+S,V+s+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,U=[d=1-r/L,B=1-s/h,w=1,B,w,g=1,d,g],i===l.e.ROTATE_ROW&&(U=[1-d,1-B,1-w,1-B,1-w,1-g,1-d,1-g]),i===l.e.FLIP_ROW&&(U=[1-d,B,1-w,B,1-w,g,1-d,g]),i===l.e.FLIP_N_ROTATE_ROW&&(U=[d,1-B,w,1-B,w,1-g,d,1-g]),M=M.concat(U),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&k&&(a.push(o+S,V+C,0),a.push(c+S,V+C,0),a.push(c+S,V+s+C,0),a.push(o+S,V+s+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,U=[d=0,B=1-s/h,w=r/L,B,w,g=1,d,g],(i===l.e.ROTATE_ROW||i===l.e.ROTATE_TILE&&z%2===0)&&(U=[1-d,1-B,1-w,1-B,1-w,1-g,1-d,1-g]),(i===l.e.FLIP_ROW||i===l.e.FLIP_TILE&&z%2===0)&&(U=[1-d,B,1-w,B,1-w,g,1-d,g]),(i===l.e.FLIP_N_ROTATE_ROW||i===l.e.FLIP_N_ROTATE_TILE&&z%2===0)&&(U=[d,1-B,w,1-B,w,1-g,d,1-g]),M=M.concat(U),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&H&&(a.push(e+S,D+C,0),a.push(-o+S,D+C,0),a.push(-o+S,f+C,0),a.push(e+S,f+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,U=[d=1-r/L,B=0,w=1,B,w,g=s/h,d,g],(i===l.e.ROTATE_ROW&&I%2===1||i===l.e.ROTATE_TILE&&I%1===0)&&(U=[1-d,1-B,1-w,1-B,1-w,1-g,1-d,1-g]),(i===l.e.FLIP_ROW&&I%2===1||i===l.e.FLIP_TILE&&I%2===0)&&(U=[1-d,B,1-w,B,1-w,g,1-d,g]),(i===l.e.FLIP_N_ROTATE_ROW&&I%2===1||i===l.e.FLIP_N_ROTATE_TILE&&I%2===0)&&(U=[d,1-B,w,1-B,w,1-g,d,1-g]),M=M.concat(U),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&k&&(a.push(o+S,D+C,0),a.push(c+S,D+C,0),a.push(c+S,f+C,0),a.push(o+S,f+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,U=[d=0,B=0,w=r/L,B,w,g=s/h,d,g],(i===l.e.ROTATE_ROW&&I%2===1||i===l.e.ROTATE_TILE&&(I+z)%2===1)&&(U=[1-d,1-B,1-w,1-B,1-w,1-g,1-d,1-g]),(i===l.e.FLIP_ROW&&I%2===1||i===l.e.FLIP_TILE&&(I+z)%2===1)&&(U=[1-d,B,1-w,B,1-w,g,1-d,g]),(i===l.e.FLIP_N_ROTATE_ROW&&I%2===1||i===l.e.FLIP_N_ROTATE_TILE&&(I+z)%2===1)&&(U=[d,1-B,w,1-B,w,1-g,d,1-g]),M=M.concat(U),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F){var n=[];d=0,B=1-s/h,w=1,g=1,n[0]=[d,B,w,B,w,g,d,g],n[1]=[d,B,w,B,w,g,d,g],i!==l.e.ROTATE_TILE&&i!==l.e.ROTATE_ROW||(n[1]=[1-d,1-B,1-w,1-B,1-w,1-g,1-d,1-g]),i!==l.e.FLIP_TILE&&i!==l.e.FLIP_ROW||(n[1]=[1-d,B,1-w,B,1-w,g,1-d,g]),i!==l.e.FLIP_N_ROTATE_TILE&&i!==l.e.FLIP_N_ROTATE_ROW||(n[1]=[d,1-B,w,1-B,w,1-g,d,1-g]);for(T=0;T<z;T++)a.push(T*L-o+S,V+C,0),a.push((T+1)*L-o+S,V+C,0),a.push((T+1)*L-o+S,V+s+C,0),a.push(T*L-o+S,V+s+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,M=i===l.e.FLIP_TILE||i===l.e.ROTATE_TILE||i===l.e.FLIP_N_ROTATE_TILE?M.concat(n[(T+1)%2]):i===l.e.FLIP_ROW||i===l.e.ROTATE_ROW||i===l.e.FLIP_N_ROTATE_ROW?M.concat(n[1]):M.concat(n[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){var m=[];d=0,B=0,w=1,g=s/h,m[0]=[d,B,w,B,w,g,d,g],m[1]=[d,B,w,B,w,g,d,g],i!==l.e.ROTATE_TILE&&i!==l.e.ROTATE_ROW||(m[1]=[1-d,1-B,1-w,1-B,1-w,1-g,1-d,1-g]),i!==l.e.FLIP_TILE&&i!==l.e.FLIP_ROW||(m[1]=[1-d,B,1-w,B,1-w,g,1-d,g]),i!==l.e.FLIP_N_ROTATE_TILE&&i!==l.e.FLIP_N_ROTATE_ROW||(m[1]=[d,1-B,w,1-B,w,1-g,d,1-g]);for(T=0;T<z;T++)a.push(T*L-o+S,f-s+C,0),a.push((T+1)*L-o+S,f-s+C,0),a.push((T+1)*L-o+S,f+C,0),a.push(T*L-o+S,f+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,M=i===l.e.FLIP_TILE||i===l.e.ROTATE_TILE||i===l.e.FLIP_N_ROTATE_TILE?M.concat(m[(T+I)%2]):i===l.e.FLIP_ROW||i===l.e.ROTATE_ROW||i===l.e.FLIP_N_ROTATE_ROW?M.concat(m[I%2]):M.concat(m[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){var E=[];d=1-r/L,B=0,w=1,g=1,E[0]=[d,B,w,B,w,g,d,g],E[1]=[d,B,w,B,w,g,d,g],i!==l.e.ROTATE_TILE&&i!==l.e.ROTATE_ROW||(E[1]=[1-d,1-B,1-w,1-B,1-w,1-g,1-d,1-g]),i!==l.e.FLIP_TILE&&i!==l.e.FLIP_ROW||(E[1]=[1-d,B,1-w,B,1-w,g,1-d,g]),i!==l.e.FLIP_N_ROTATE_TILE&&i!==l.e.FLIP_N_ROTATE_ROW||(E[1]=[d,1-B,w,1-B,w,1-g,d,1-g]);for(X=0;X<I;X++)a.push(e+S,X*h-D+C,0),a.push(e+r+S,X*h-D+C,0),a.push(e+r+S,(X+1)*h-D+C,0),a.push(e+S,(X+1)*h-D+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,M=i===l.e.FLIP_TILE||i===l.e.ROTATE_TILE||i===l.e.FLIP_N_ROTATE_TILE?M.concat(E[(X+1)%2]):i===l.e.FLIP_ROW||i===l.e.ROTATE_ROW||i===l.e.FLIP_N_ROTATE_ROW?M.concat(E[X%2]):M.concat(E[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){var K=[];d=0,B=0,w=r/h,g=1,K[0]=[d,B,w,B,w,g,d,g],K[1]=[d,B,w,B,w,g,d,g],i!==l.e.ROTATE_TILE&&i!==l.e.ROTATE_ROW||(K[1]=[1-d,1-B,1-w,1-B,1-w,1-g,1-d,1-g]),i!==l.e.FLIP_TILE&&i!==l.e.FLIP_ROW||(K[1]=[1-d,B,1-w,B,1-w,g,1-d,g]),i!==l.e.FLIP_N_ROTATE_TILE&&i!==l.e.FLIP_N_ROTATE_ROW||(K[1]=[d,1-B,w,1-B,w,1-g,d,1-g]);for(X=0;X<I;X++)a.push(c-r+S,X*h-D+C,0),a.push(c+S,X*h-D+C,0),a.push(c+S,(X+1)*h-D+C,0),a.push(c-r+S,(X+1)*h-D+C,0),j.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,M=i===l.e.FLIP_TILE||i===l.e.ROTATE_TILE||i===l.e.FLIP_N_ROTATE_TILE?M.concat(K[(X+z)%2]):i===l.e.FLIP_ROW||i===l.e.ROTATE_ROW||i===l.e.FLIP_N_ROTATE_ROW?M.concat(K[X%2]):M.concat(K[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var G=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE;p.e._ComputeSides(G,a,j,P,M,W.frontUVs,W.backUVs);var u=new p.e;u.indices=j,u.positions=a,u.normals=P,u.uvs=M;var J=G===p.e.DOUBLESIDE?b.concat(b):b;return u.colors=J,u}function o(W,i,L){void 0===L&&(L=null);var h=new l.e(W,L);return i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,s(i).applyToMesh(h,i.updatable),h}function D(W){for(var i=W.faceUV||new Array(6),L=W.faceColors,t=W.pattern||l.e.NO_FLIP,R=W.width||W.size||1,z=W.height||W.size||1,r=W.depth||W.size||1,N=W.tileWidth||W.tileSize||1,o=W.tileHeight||W.tileSize||1,D=W.alignHorizontal||0,S=W.alignVertical||0,C=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE,e=0;e<6;e++)void 0===i[e]&&(i[e]=new h.n(0,0,1,1)),L&&void 0===L[e]&&(L[e]=new I.g(1,1,1,1));var V=R/2,c=z/2,f=r/2,a=[];for(e=0;e<2;e++)a[e]=s({pattern:t,tileWidth:N,tileHeight:o,width:R,height:z,alignVertical:S,alignHorizontal:D,sideOrientation:C});for(e=2;e<4;e++)a[e]=s({pattern:t,tileWidth:N,tileHeight:o,width:r,height:z,alignVertical:S,alignHorizontal:D,sideOrientation:C});var P=S;S===l.e.BOTTOM?P=l.e.TOP:S===l.e.TOP&&(P=l.e.BOTTOM);for(e=4;e<6;e++)a[e]=s({pattern:t,tileWidth:N,tileHeight:o,width:R,height:r,alignVertical:P,alignHorizontal:D,sideOrientation:C});var y=[],M=[],b=[],j=[],Z=[],X=[],T=[],F=[],q=0,H=0;for(e=0;e<6;e++){var k=a[e].positions.length;X[e]=[],T[e]=[];for(var U=0;U<k/3;U++)X[e].push(new h.m(a[e].positions[3*U],a[e].positions[3*U+1],a[e].positions[3*U+2])),T[e].push(new h.m(a[e].normals[3*U],a[e].normals[3*U+1],a[e].normals[3*U+2]));q=a[e].uvs.length,F[e]=[];for(var d=0;d<q;d+=2)F[e][d]=i[e].x+(i[e].z-i[e].x)*a[e].uvs[d],F[e][d+1]=i[e].y+(i[e].w-i[e].y)*a[e].uvs[d+1],x.d.UseOpenGLOrientationForUV&&(F[e][d+1]=1-F[e][d+1]);if(b=b.concat(F[e]),j=j.concat(a[e].indices.map((function(W){return W+H}))),H+=X[e].length,L)for(var B=0;B<4;B++)Z.push(L[e].r,L[e].g,L[e].b,L[e].a)}var w=new h.m(0,0,f),g=h.d.RotationY(Math.PI);y=X[0].map((function(W){return h.m.TransformNormal(W,g).add(w)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[]),M=T[0].map((function(W){return h.m.TransformNormal(W,g)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[]),y=y.concat(X[1].map((function(W){return W.subtract(w)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[])),M=M.concat(T[1].map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[]));var n=new h.m(V,0,0),m=h.d.RotationY(-Math.PI/2);y=y.concat(X[2].map((function(W){return h.m.TransformNormal(W,m).add(n)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[])),M=M.concat(T[2].map((function(W){return h.m.TransformNormal(W,m)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[]));var E=h.d.RotationY(Math.PI/2);y=y.concat(X[3].map((function(W){return h.m.TransformNormal(W,E).subtract(n)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[])),M=M.concat(T[3].map((function(W){return h.m.TransformNormal(W,E)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[]));var K=new h.m(0,c,0),G=h.d.RotationX(Math.PI/2);y=y.concat(X[4].map((function(W){return h.m.TransformNormal(W,G).add(K)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[])),M=M.concat(T[4].map((function(W){return h.m.TransformNormal(W,G)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[]));var u=h.d.RotationX(-Math.PI/2);y=y.concat(X[5].map((function(W){return h.m.TransformNormal(W,u).subtract(K)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[])),M=M.concat(T[5].map((function(W){return h.m.TransformNormal(W,u)})).map((function(W){return[W.x,W.y,W.z]})).reduce((function(W,i){return W.concat(i)}),[])),p.e._ComputeSides(C,y,j,M,b);var J=new p.e;if(J.indices=j,J.positions=y,J.normals=M,J.uvs=b,L){var A=C===p.e.DOUBLESIDE?Z.concat(Z):Z;J.colors=A}return J}function S(W,i,L){void 0===L&&(L=null);var h=new l.e(W,L);return i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,D(i).applyToMesh(h,i.updatable),h}p.e.CreateTiledPlane=s;p.e.CreateTiledBox=D;var C=L(71898),e=L(37105),V=L(54044);function c(W){var i=W.height||2,L=0===W.diameterTop?0:W.diameterTop||W.diameter||1,t=0===W.diameterBottom?0:W.diameterBottom||W.diameter||1;L=L||1e-5,t=t||1e-5;var R,z=W.tessellation||24,r=W.subdivisions||1,N=!!W.hasRings,s=!!W.enclose,o=0===W.cap?0:W.cap||l.e.CAP_ALL,D=W.arc&&(W.arc<=0||W.arc>1)?1:W.arc||1,S=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE,C=W.faceUV||new Array(3),e=W.faceColors,c=2+(1+(1!==D&&s?2:0))*(N?r:1);for(R=0;R<c;R++)e&&void 0===e[R]&&(e[R]=new I.g(1,1,1,1));for(R=0;R<c;R++)C&&void 0===C[R]&&(C[R]=new h.n(0,0,1,1));var f,a,P,y,M,b,j=new Array,Z=new Array,X=new Array,T=new Array,F=new Array,q=2*Math.PI*D/z,H=(t-L)/2/i,k=h.m.Zero(),U=h.m.Zero(),d=h.m.Zero(),B=h.m.Zero(),w=h.m.Zero(),g=V.e.Y,n=1,m=1,E=0,K=0;for(y=0;y<=r;y++)for(P=((a=y/r)*(L-t)+t)/2,n=N&&0!==y&&y!==r?2:1,b=0;b<n;b++){for(N&&(m+=b),s&&(m+=2*b),M=0;M<=z;M++)f=M*q,k.x=Math.cos(-f)*P,k.y=-i/2+a*i,k.z=Math.sin(-f)*P,0===L&&y===r?(U.x=X[X.length-3*(z+1)],U.y=X[X.length-3*(z+1)+1],U.z=X[X.length-3*(z+1)+2]):(U.x=k.x,U.z=k.z,U.y=Math.sqrt(U.x*U.x+U.z*U.z)*H,U.normalize()),0===M&&(d.copyFrom(k),B.copyFrom(U)),Z.push(k.x,k.y,k.z),X.push(U.x,U.y,U.z),K=N?E!==m?C[m].y:C[m].w:C[m].y+(C[m].w-C[m].y)*a,T.push(C[m].x+(C[m].z-C[m].x)*M/z,x.d.UseOpenGLOrientationForUV?1-K:K),e&&F.push(e[m].r,e[m].g,e[m].b,e[m].a);1!==D&&s&&(Z.push(k.x,k.y,k.z),Z.push(0,k.y,0),Z.push(0,k.y,0),Z.push(d.x,d.y,d.z),h.m.CrossToRef(g,U,w),w.normalize(),X.push(w.x,w.y,w.z,w.x,w.y,w.z),h.m.CrossToRef(B,g,w),w.normalize(),X.push(w.x,w.y,w.z,w.x,w.y,w.z),K=N?E!==m?C[m+1].y:C[m+1].w:C[m+1].y+(C[m+1].w-C[m+1].y)*a,T.push(C[m+1].x,x.d.UseOpenGLOrientationForUV?1-K:K),T.push(C[m+1].z,x.d.UseOpenGLOrientationForUV?1-K:K),K=N?E!==m?C[m+2].y:C[m+2].w:C[m+2].y+(C[m+2].w-C[m+2].y)*a,T.push(C[m+2].x,x.d.UseOpenGLOrientationForUV?1-K:K),T.push(C[m+2].z,x.d.UseOpenGLOrientationForUV?1-K:K),e&&(F.push(e[m+1].r,e[m+1].g,e[m+1].b,e[m+1].a),F.push(e[m+1].r,e[m+1].g,e[m+1].b,e[m+1].a),F.push(e[m+2].r,e[m+2].g,e[m+2].b,e[m+2].a),F.push(e[m+2].r,e[m+2].g,e[m+2].b,e[m+2].a))),E!==m&&(E=m)}var G=1!==D&&s?z+4:z;for(y=0,m=0;m<r;m++){var u=0,J=0,A=0,v=0;for(M=0;M<z;M++)u=y*(G+1)+M,J=(y+1)*(G+1)+M,A=y*(G+1)+(M+1),v=(y+1)*(G+1)+(M+1),j.push(u,J,A),j.push(v,A,J);1!==D&&s&&(j.push(u+2,J+2,A+2),j.push(v+2,A+2,J+2),j.push(u+4,J+4,A+4),j.push(v+4,A+4,J+4)),y=N?y+2:y+1}var Q=function(W){var l=W?L/2:t/2;if(0!==l){var p,R,r,N=W?C[c-1]:C[0],I=null;e&&(I=W?e[c-1]:e[0]);var s=Z.length/3,o=W?i/2:-i/2,S=new h.m(0,o,0);Z.push(S.x,S.y,S.z),X.push(0,W?1:-1,0);var V=N.y+.5*(N.w-N.y);T.push(N.x+.5*(N.z-N.x),x.d.UseOpenGLOrientationForUV?1-V:V),I&&F.push(I.r,I.g,I.b,I.a);var f=new h.k(.5,.5);for(r=0;r<=z;r++){p=2*Math.PI*r*D/z;var a=Math.cos(-p),P=Math.sin(-p);R=new h.m(a*l,o,P*l);var y=new h.k(a*f.x+.5,P*f.y+.5);Z.push(R.x,R.y,R.z),X.push(0,W?1:-1,0);var M=N.y+(N.w-N.y)*y.y;T.push(N.x+(N.z-N.x)*y.x,x.d.UseOpenGLOrientationForUV?1-M:M),I&&F.push(I.r,I.g,I.b,I.a)}for(r=0;r<z;r++)W?(j.push(s),j.push(s+(r+2)),j.push(s+(r+1))):(j.push(s),j.push(s+(r+1)),j.push(s+(r+2)))}};o!==l.e.CAP_START&&o!==l.e.CAP_ALL||Q(!1),o!==l.e.CAP_END&&o!==l.e.CAP_ALL||Q(!0),p.e._ComputeSides(S,Z,j,X,T,W.frontUVs,W.backUVs);var O=new p.e;return O.indices=j,O.positions=Z,O.normals=X,O.uvs=T,e&&(O.colors=F),O}function f(W,i,L){void 0===i&&(i={});var h=new l.e(W,L);return i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,c(i).applyToMesh(h,i.updatable),h}function a(W){for(var i=[],L=[],l=[],t=[],R=W.diameter||1,z=W.thickness||.5,r=W.tessellation||16,N=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE,I=r+1,s=0;s<=r;s++)for(var o=s/r,D=s*Math.PI*2/r-Math.PI/2,S=h.d.Translation(R/2,0,0).multiply(h.d.RotationY(D)),C=0;C<=r;C++){var e=1-C/r,V=C*Math.PI*2/r+Math.PI,c=Math.cos(V),f=Math.sin(V),a=new h.m(c,f,0),P=a.scale(z/2),y=new h.k(o,e);P=h.m.TransformCoordinates(P,S),a=h.m.TransformNormal(a,S),L.push(P.x,P.y,P.z),l.push(a.x,a.y,a.z),t.push(y.x,x.d.UseOpenGLOrientationForUV?1-y.y:y.y);var M=(s+1)%I,b=(C+1)%I;i.push(s*I+C),i.push(s*I+b),i.push(M*I+C),i.push(s*I+b),i.push(M*I+b),i.push(M*I+C)}p.e._ComputeSides(N,L,i,l,t,W.frontUVs,W.backUVs);var j=new p.e;return j.indices=i,j.positions=L,j.normals=l,j.uvs=t,j}function P(W,i,L){void 0===i&&(i={});var h=new l.e(W,L);return i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,a(i).applyToMesh(h,i.updatable),h}p.e.CreateCylinder=c,l.e.CreateCylinder=function(W,i,L,h,t,p,x,R,z){return void 0!==x&&x instanceof e.b||(void 0!==x&&(z=R||l.e.DEFAULTSIDE,R=x),x=p,p=1),f(W,{height:i,diameterTop:L,diameterBottom:h,tessellation:t,subdivisions:p,sideOrientation:z,updatable:R},x)};function y(W){var i,L,l=new Array,t=new Array,R=new Array,z=new Array,r=W.radius||2,N=W.tube||.5,I=W.radialSegments||32,s=W.tubularSegments||32,o=W.p||2,D=W.q||3,S=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE,C=function(W){var i=Math.cos(W),L=Math.sin(W),l=D/o*W,t=Math.cos(l),p=r*(2+t)*.5*i,x=r*(2+t)*L*.5,R=r*Math.sin(l)*.5;return new h.m(p,x,R)};for(i=0;i<=I;i++){var e=i%I/I*2*o*Math.PI,V=C(e),c=C(e+.01),f=c.subtract(V),a=c.add(V),P=h.m.Cross(f,a);for(a=h.m.Cross(P,f),P.normalize(),a.normalize(),L=0;L<s;L++){var y=L%s/s*2*Math.PI,M=-N*Math.cos(y),b=N*Math.sin(y);t.push(V.x+M*a.x+b*P.x),t.push(V.y+M*a.y+b*P.y),t.push(V.z+M*a.z+b*P.z),z.push(i/I),z.push(x.d.UseOpenGLOrientationForUV?1-L/s:L/s)}}for(i=0;i<I;i++)for(L=0;L<s;L++){var j=(L+1)%s,Z=i*s+L,X=(i+1)*s+L,T=(i+1)*s+j,F=i*s+j;l.push(F),l.push(X),l.push(Z),l.push(F),l.push(T),l.push(X)}p.e.ComputeNormals(t,l,R),p.e._ComputeSides(S,t,l,R,z,W.frontUVs,W.backUVs);var q=new p.e;return q.indices=l,q.positions=t,q.normals=R,q.uvs=z,q}function M(W,i,L){void 0===i&&(i={});var h=new l.e(W,L);return i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,y(i).applyToMesh(h,i.updatable),h}p.e.CreateTorus=a,l.e.CreateTorus=function(W,i,L,h,l,t,p){return P(W,{diameter:i,thickness:L,tessellation:h,sideOrientation:p,updatable:t},l)};p.e.CreateTorusKnot=y,l.e.CreateTorusKnot=function(W,i,L,h,l,t,p,x,R,z){return M(W,{radius:i,tube:L,radialSegments:h,tubularSegments:l,p:t,q:p,sideOrientation:z,updatable:R},x)};var b=L(55706),j=L(40061),Z=L(9127),X=L(12476),T=L(61686),F=L(78588),q=function(W){function i(i,L){var h=W.call(this,i.x,i.y)||this;return h.index=L,h}return(0,j.n)(i,W),i}(h.k),H=function(){function W(){this.elements=new Array}return W.prototype.add=function(W){var i=this,L=new Array;return W.forEach((function(W){var h=new q(W,i.elements.length);L.push(h),i.elements.push(h)})),L},W.prototype.computeBounds=function(){var W=new h.k(this.elements[0].x,this.elements[0].y),i=new h.k(this.elements[0].x,this.elements[0].y);return this.elements.forEach((function(L){L.x<W.x?W.x=L.x:L.x>i.x&&(i.x=L.x),L.y<W.y?W.y=L.y:L.y>i.y&&(i.y=L.y)})),{min:W,max:i,width:i.x-W.x,height:i.y-W.y}},W}(),k=(function(){function W(){}W.Rectangle=function(W,i,L,l){return[new h.k(W,i),new h.k(L,i),new h.k(L,l),new h.k(W,l)]},W.Circle=function(W,i,L,l){void 0===i&&(i=0),void 0===L&&(L=0),void 0===l&&(l=32);for(var t=new Array,p=0,x=2*Math.PI/l,R=0;R<l;R++)t.push(new h.k(i+Math.cos(p)*W,L+Math.sin(p)*W)),p-=x;return t},W.Parse=function(W){var i,L=W.split(/[^-+eE.\d]+/).map(parseFloat).filter((function(W){return!isNaN(W)})),l=[];for(i=0;i<(2147483646&L.length);i+=2)l.push(new h.k(L[i],L[i+1]));return l},W.StartingAt=function(W,i){return X.d.StartingAt(W,i)}}(),function(){function W(W,i,L,h){var l;void 0===h&&(h=earcut),this._points=new H,this._outlinepoints=new H,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=h,this._name=W,this._scene=L||F.d.LastCreatedScene,l=i instanceof X.d?i.getPoints():i,this._addToepoint(l),this._points.add(l),this._outlinepoints.add(l),"undefined"===typeof this.bjsEarcut&&Z.e.Warn("Earcut was not found, the polygon will not be built.")}return W.prototype._addToepoint=function(W){for(var i=0,L=W;i<L.length;i++){var h=L[i];this._epoints.push(h.x,h.y)}},W.prototype.addHole=function(W){this._points.add(W);var i=new H;return i.add(W),this._holes.push(i),this._eholes.push(this._epoints.length/2),this._addToepoint(W),this},W.prototype.build=function(W,i,L){void 0===W&&(W=!1),void 0===i&&(i=0),void 0===L&&(L=2);var h=new l.e(this._name,this._scene),p=this.buildVertexData(i,L);return h.setVerticesData(t.d.PositionKind,p.positions,W),h.setVerticesData(t.d.NormalKind,p.normals,W),h.setVerticesData(t.d.UVKind,p.uvs,W),h.setIndices(p.indices),h},W.prototype.buildVertexData=function(W,i){var L=this;void 0===W&&(W=0),void 0===i&&(i=2);var h=new p.e,l=new Array,t=new Array,x=new Array,R=this._points.computeBounds();this._points.elements.forEach((function(W){l.push(0,1,0),t.push(W.x,0,W.y),x.push((W.x-R.min.x)/R.width,(W.y-R.min.y)/R.height)}));for(var z=new Array,r=this.bjsEarcut(this._epoints,this._eholes,2),N=0;N<r.length;N++)z.push(r[N]);if(W>0){var I=t.length/3;this._points.elements.forEach((function(i){l.push(0,-1,0),t.push(i.x,-W,i.y),x.push(1-(i.x-R.min.x)/R.width,1-(i.y-R.min.y)/R.height)}));var s=z.length;for(N=0;N<s;N+=3){var o=z[N+0],D=z[N+1],S=z[N+2];z.push(S+I),z.push(D+I),z.push(o+I)}this._addSide(t,l,x,z,R,this._outlinepoints,W,!1,i),this._holes.forEach((function(h){L._addSide(t,l,x,z,R,h,W,!0,i)}))}return h.indices=z,h.positions=t,h.normals=l,h.uvs=x,h},W.prototype._addSide=function(W,i,L,l,t,p,x,R,z){for(var r=W.length/3,N=0,I=0;I<p.elements.length;I++){var s=p.elements[I],o=p.elements[(I+1)%p.elements.length];W.push(s.x,0,s.y),W.push(s.x,-x,s.y),W.push(o.x,0,o.y),W.push(o.x,-x,o.y);var D=p.elements[(I+p.elements.length-1)%p.elements.length],S=p.elements[(I+2)%p.elements.length],C=new h.m(-(o.y-s.y),0,o.x-s.x),e=new h.m(-(s.y-D.y),0,s.x-D.x),V=new h.m(-(S.y-o.y),0,S.x-o.x);R||(C=C.scale(-1),e=e.scale(-1),V=V.scale(-1));var c=C.normalizeToNew(),f=e.normalizeToNew(),a=V.normalizeToNew(),P=h.m.Dot(f,c);f=P>z?P<T.e-1?new h.m(s.x,0,s.y).subtract(new h.m(o.x,0,o.y)).normalize():e.add(C).normalize():c;var y=h.m.Dot(V,C);a=y>z?y<T.e-1?new h.m(o.x,0,o.y).subtract(new h.m(s.x,0,s.y)).normalize():V.add(C).normalize():c,L.push(N/t.width,0),L.push(N/t.width,1),N+=C.length(),L.push(N/t.width,0),L.push(N/t.width,1),i.push(f.x,f.y,f.z),i.push(f.x,f.y,f.z),i.push(a.x,a.y,a.z),i.push(a.x,a.y,a.z),R?(l.push(r),l.push(r+2),l.push(r+1),l.push(r+1),l.push(r+2),l.push(r+3)):(l.push(r),l.push(r+1),l.push(r+2),l.push(r+1),l.push(r+3),l.push(r+2)),r+=4}},W}());function U(W,i,L,l,R,z,r){for(var N=L||new Array(3),s=l,o=[],D=r||!1,S=0;S<3;S++)void 0===N[S]&&(N[S]=new h.n(0,0,1,1)),s&&void 0===s[S]&&(s[S]=new I.g(1,1,1,1));var C=W.getVerticesData(t.d.PositionKind),e=W.getVerticesData(t.d.NormalKind),V=W.getVerticesData(t.d.UVKind),c=W.getIndices(),f=C.length/9,a=0,P=0,y=0,M=0,b=[0];if(D)for(var j=f;j<C.length/3;j+=4)P=C[3*(j+2)]-C[3*j],y=C[3*(j+2)+2]-C[3*j+2],M+=Math.sqrt(P*P+y*y),b.push(M);for(var Z=0,X=0,T=0;T<e.length;T+=3)Math.abs(e[T+1])<.001&&(X=1),Math.abs(e[T+1]-1)<.001&&(X=0),Math.abs(e[T+1]+1)<.001&&(X=2),Z=T/3,1===X?(a=Z-f,V[2*Z]=a%4<1.5?D?N[X].x+(N[X].z-N[X].x)*b[Math.floor(a/4)]/M:N[X].x:D?N[X].x+(N[X].z-N[X].x)*b[Math.floor(a/4)+1]/M:N[X].z,V[2*Z+1]=a%2===0?x.d.UseOpenGLOrientationForUV?1-N[X].w:N[X].w:x.d.UseOpenGLOrientationForUV?1-N[X].y:N[X].y):(V[2*Z]=(1-V[2*Z])*N[X].x+V[2*Z]*N[X].z,V[2*Z+1]=(1-V[2*Z+1])*N[X].y+V[2*Z+1]*N[X].w,x.d.UseOpenGLOrientationForUV&&(V[2*Z+1]=1-V[2*Z+1])),s&&o.push(s[X].r,s[X].g,s[X].b,s[X].a);p.e._ComputeSides(i,C,c,e,V,R,z);var F=new p.e;if(F.indices=c,F.positions=C,F.normals=e,F.uvs=V,s){var q=i===p.e.DOUBLESIDE?o.concat(o):o;F.colors=q}return F}function d(W,i,L,t){void 0===L&&(L=null),void 0===t&&(t=earcut),i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation);for(var p=i.shape,x=i.holes||[],R=i.depth||0,z=i.smoothingThreshold||2,r=[],N=[],I=0;I<p.length;I++)r[I]=new h.k(p[I].x,p[I].z);r[0].equalsWithEpsilon(r[r.length-1],1e-8)&&r.pop();for(var s=new k(W,r,L||F.d.LastCreatedScene,t),o=0;o<x.length;o++){N=[];for(var D=0;D<x[o].length;D++)N.push(new h.k(x[o][D].x,x[o][D].z));s.addHole(N)}var S=s.build(!1,R,z);return S._originalBuilderSideOrientation=i.sideOrientation,U(S,i.sideOrientation,i.faceUV,i.faceColors,i.frontUVs,i.backUVs,i.wrap).applyToMesh(S,i.updatable),S}function B(W,i,L,h){return void 0===L&&(L=null),void 0===h&&(h=earcut),d(W,i,L,h)}function w(W,i,L){void 0===L&&(L=null);var h=i.path,t=i.shape,p=i.scale||1,x=i.rotation||0,R=0===i.cap?0:i.cap||l.e.NO_CAP,z=i.updatable,r=l.e._GetDefaultSideOrientation(i.sideOrientation),N=i.instance||null,I=i.invertUV||!1,s=i.closeShape||!1;return n(W,t,h,p,x,null,null,i.closePath||!1,s,R,!1,L,!!z,r,N,I,i.frontUVs||null,i.backUVs||null,i.firstNormal||null,!!i.adjustFrame)}function g(W,i,L){void 0===L&&(L=null);var h=i.path,t=i.shape,p=i.scaleFunction||function(){return 1},x=i.rotationFunction||function(){return 0},R=i.closePath||i.ribbonCloseArray||!1,z=i.closeShape||i.ribbonClosePath||!1,r=0===i.cap?0:i.cap||l.e.NO_CAP,N=i.updatable,I=i.firstNormal||null,s=i.adjustFrame||!1;return n(W,t,h,null,null,p,x,R,z,r,!0,L,!!N,l.e._GetDefaultSideOrientation(i.sideOrientation),i.instance||null,i.invertUV||!1,i.frontUVs||null,i.backUVs||null,I,s)}function n(W,i,L,t,p,x,R,r,N,I,s,o,D,S,C,e,V,c,f,a){var P,y,M=function(W,i,L,t,p,x,R,z,r,N,I){var s=L.getTangents(),o=L.getNormals(),D=L.getBinormals(),S=L.getDistances();if(I)for(var C=0;C<s.length;C++)if(0==s[C].x&&0==s[C].y&&0==s[C].z&&s[C].copyFrom(s[C-1]),0==o[C].x&&0==o[C].y&&0==o[C].z&&o[C].copyFrom(o[C-1]),0==D[C].x&&0==D[C].y&&0==D[C].z&&D[C].copyFrom(D[C-1]),C>0){var e=s[C-1];h.m.Dot(e,s[C])<0&&s[C].scaleInPlace(-1),e=o[C-1],h.m.Dot(e,o[C])<0&&o[C].scaleInPlace(-1),e=D[C-1],h.m.Dot(e,D[C])<0&&D[C].scaleInPlace(-1)}var V=0,c=N&&z?z:function(){return null!==x?x:0},f=N&&R?R:function(){return null!==p?p:1},a=r===l.e.NO_CAP||r===l.e.CAP_END?0:2,P=h.h.Matrix[0];for(C=0;C<i.length;C++){var y=new Array,M=c(C,S[C]),b=f(C,S[C]);h.d.RotationAxisToRef(s[C],V,P);for(var j=0;j<W.length;j++){var Z=s[C].scale(W[j].z).add(o[C].scale(W[j].x)).add(D[C].scale(W[j].y)),X=h.m.Zero();h.m.TransformCoordinatesToRef(Z,P,X),X.scaleInPlace(b).addInPlace(i[C]),y[j]=X}t[a]=y,V+=M,a++}var T=function(W){var i,L=Array(),l=h.m.Zero();for(i=0;i<W.length;i++)l.addInPlace(W[i]);for(l.scaleInPlace(1/W.length),i=0;i<W.length;i++)L.push(l);return L};switch(r){case l.e.NO_CAP:break;case l.e.CAP_START:t[0]=T(t[2]),t[1]=t[2];break;case l.e.CAP_END:t[a]=t[a-1],t[a+1]=T(t[a-1]);break;case l.e.CAP_ALL:t[0]=T(t[2]),t[1]=t[2],t[a]=t[a-1],t[a+1]=T(t[a-1])}return t};if(C){var b=C._creationDataStorage;return P=f?b.path3D.update(L,f):b.path3D.update(L),C=z("",{pathArray:y=M(i,L,b.path3D,b.pathArray,t,p,x,R,b.cap,s,a),closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:C},o||void 0)}I=I<0||I>3?0:I;var j=z(W,{pathArray:y=M(i,L,P=f?new X.h(L,f):new X.h(L),new Array,t,p,x,R,I,s,a),closeArray:r,closePath:N,updatable:D,sideOrientation:S,invertUV:e,frontUVs:V||void 0,backUVs:c||void 0},o);return j._creationDataStorage.pathArray=y,j._creationDataStorage.path3D=P,j._creationDataStorage.cap=I,j}p.e.CreatePolygon=U,l.e.CreatePolygon=function(W,i,L,h,l,t,p){return void 0===p&&(p=earcut),d(W,{shape:i,holes:h,updatable:l,sideOrientation:t},L,p)},l.e.ExtrudePolygon=function(W,i,L,h,l,t,p,x){return void 0===x&&(x=earcut),B(W,{shape:i,holes:l,depth:L,updatable:t,sideOrientation:p},h,x)};function m(W,i,L){void 0===L&&(L=null);var t,p,x=i.arc?i.arc<=0||i.arc>1?1:i.arc:1,R=void 0===i.closed||i.closed,r=i.shape,N=i.radius||1,I=i.tessellation||64,s=i.clip||0,o=i.updatable,D=l.e._GetDefaultSideOrientation(i.sideOrientation),S=i.cap||l.e.NO_CAP,C=2*Math.PI,e=new Array,V=i.invertUV||!1,c=0,f=0,a=C/I*x;for(c=0;c<=I-s;c++){for(p=[],S!=l.e.CAP_START&&S!=l.e.CAP_ALL||(p.push(new h.m(0,r[0].y,0)),p.push(new h.m(Math.cos(c*a)*r[0].x*N,r[0].y,Math.sin(c*a)*r[0].x*N))),f=0;f<r.length;f++)t=new h.m(Math.cos(c*a)*r[f].x*N,r[f].y,Math.sin(c*a)*r[f].x*N),p.push(t);S!=l.e.CAP_END&&S!=l.e.CAP_ALL||(p.push(new h.m(Math.cos(c*a)*r[r.length-1].x*N,r[r.length-1].y,Math.sin(c*a)*r[r.length-1].x*N)),p.push(new h.m(0,r[r.length-1].y,0))),e.push(p)}return z(W,{pathArray:e,closeArray:R,sideOrientation:D,updatable:o,invertUV:V,frontUVs:i.frontUVs,backUVs:i.backUVs},L)}l.e.ExtrudeShape=function(W,i,L,h,t,p,x,R,z,r){return void 0===x&&(x=null),w(W,{shape:i,path:L,scale:h,rotation:t,cap:0===p?0:p||l.e.NO_CAP,sideOrientation:z,instance:r,updatable:R},x)},l.e.ExtrudeShapeCustom=function(W,i,L,h,t,p,x,R,z,r,N,I){return g(W,{shape:i,path:L,scaleFunction:h,rotationFunction:t,ribbonCloseArray:p,ribbonClosePath:x,cap:0===R?0:R||l.e.NO_CAP,sideOrientation:N,instance:I,updatable:r},z)};l.e.CreateLathe=function(W,i,L,h,l,t,p){return m(W,{shape:i,radius:L,tessellation:h,sideOrientation:p,updatable:t},l)};var E=L(49620);l.e._GroundMeshParser=function(W,i){return K.Parse(W,i)};var K=function(W){function i(i,L){var h=W.call(this,i,L)||this;return h.generateOctree=!1,h}return(0,j.n)(i,W),i.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(i.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),i.prototype.optimize=function(W,i){void 0===i&&(i=32),this._subdivisionsX=W,this._subdivisionsY=W,this.subdivide(W);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(i)},i.prototype.getHeightAtCoordinates=function(W,i){var L=this.getWorldMatrix(),l=h.h.Matrix[5];L.invertToRef(l);var t=h.h.Vector3[8];if(h.m.TransformCoordinatesFromFloatsToRef(W,0,i,l,t),W=t.x,i=t.z,W<this._minX||W>this._maxX||i<this._minZ||i>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var p=this._getFacetAt(W,i),x=-(p.x*W+p.z*i+p.w)/p.y;return h.m.TransformCoordinatesFromFloatsToRef(0,x,0,L,t),t.y},i.prototype.getNormalAtCoordinates=function(W,i){var L=new h.m(0,1,0);return this.getNormalAtCoordinatesToRef(W,i,L),L},i.prototype.getNormalAtCoordinatesToRef=function(W,i,L){var l=this.getWorldMatrix(),t=h.h.Matrix[5];l.invertToRef(t);var p=h.h.Vector3[8];if(h.m.TransformCoordinatesFromFloatsToRef(W,0,i,t,p),W=p.x,i=p.z,W<this._minX||W>this._maxX||i<this._minZ||i>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var x=this._getFacetAt(W,i);return h.m.TransformNormalFromFloatsToRef(x.x,x.y,x.z,l,L),this},i.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},i.prototype._getFacetAt=function(W,i){var L=Math.floor((W+this._maxX)*this._subdivisionsX/this._width),h=Math.floor(-(i+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),l=this._heightQuads[h*this._subdivisionsX+L];return i<l.slope.x*W+l.slope.y?l.facet1:l.facet2},i.prototype._initHeightQuads=function(){var W=this._subdivisionsX,i=this._subdivisionsY;this._heightQuads=new Array;for(var L=0;L<i;L++)for(var l=0;l<W;l++){var t={slope:h.k.Zero(),facet1:new h.n(0,0,0,0),facet2:new h.n(0,0,0,0)};this._heightQuads[L*W+l]=t}return this},i.prototype._computeHeightQuads=function(){var W=this.getVerticesData(t.d.PositionKind);if(!W)return this;for(var i=h.h.Vector3[3],L=h.h.Vector3[2],l=h.h.Vector3[1],p=h.h.Vector3[0],x=h.h.Vector3[4],R=h.h.Vector3[5],z=h.h.Vector3[6],r=h.h.Vector3[7],N=h.h.Vector3[8],I=0,s=0,o=0,D=0,S=0,C=0,e=0,V=this._subdivisionsX,c=this._subdivisionsY,f=0;f<c;f++)for(var a=0;a<V;a++){I=3*a,s=f*(V+1)*3,o=(f+1)*(V+1)*3,i.x=W[s+I],i.y=W[s+I+1],i.z=W[s+I+2],L.x=W[s+I+3],L.y=W[s+I+4],L.z=W[s+I+5],l.x=W[o+I],l.y=W[o+I+1],l.z=W[o+I+2],p.x=W[o+I+3],p.y=W[o+I+4],p.z=W[o+I+5],D=(p.z-i.z)/(p.x-i.x),S=i.z-D*i.x,L.subtractToRef(i,x),l.subtractToRef(i,R),p.subtractToRef(i,z),h.m.CrossToRef(z,R,r),h.m.CrossToRef(x,z,N),r.normalize(),N.normalize(),C=-(r.x*i.x+r.y*i.y+r.z*i.z),e=-(N.x*L.x+N.y*L.y+N.z*L.z);var P=this._heightQuads[f*V+a];P.slope.copyFromFloats(D,S),P.facet1.copyFromFloats(r.x,r.y,r.z,C),P.facet2.copyFromFloats(N.x,N.y,N.z,e)}return this},i.prototype.serialize=function(i){W.prototype.serialize.call(this,i),i.subdivisionsX=this._subdivisionsX,i.subdivisionsY=this._subdivisionsY,i.minX=this._minX,i.maxX=this._maxX,i.minZ=this._minZ,i.maxZ=this._maxZ,i.width=this._width,i.height=this._height},i.Parse=function(W,L){var h=new i(W.name,L);return h._subdivisionsX=W.subdivisionsX||1,h._subdivisionsY=W.subdivisionsY||1,h._minX=W.minX,h._maxX=W.maxX,h._minZ=W.minZ,h._maxZ=W.maxZ,h._width=W.width,h._height=W.height,h},i}(l.e),G=L(9217);function u(W){var i,L,l=[],t=[],R=[],z=[],r=W.width||1,N=W.height||1,I=W.subdivisionsX||W.subdivisions||1,s=W.subdivisionsY||W.subdivisions||1;for(i=0;i<=s;i++)for(L=0;L<=I;L++){var o=new h.m(L*r/I-r/2,0,(s-i)*N/s-N/2),D=new h.m(0,1,0);t.push(o.x,o.y,o.z),R.push(D.x,D.y,D.z),z.push(L/I,x.d.UseOpenGLOrientationForUV?i/s:1-i/s)}for(i=0;i<s;i++)for(L=0;L<I;L++)l.push(L+1+(i+1)*(I+1)),l.push(L+1+i*(I+1)),l.push(L+i*(I+1)),l.push(L+(i+1)*(I+1)),l.push(L+1+(i+1)*(I+1)),l.push(L+i*(I+1));var S=new p.e;return S.indices=l,S.positions=t,S.normals=R,S.uvs=z,S}function J(W){var i,L,l,t,x=void 0!==W.xmin&&null!==W.xmin?W.xmin:-1,R=void 0!==W.zmin&&null!==W.zmin?W.zmin:-1,z=void 0!==W.xmax&&null!==W.xmax?W.xmax:1,r=void 0!==W.zmax&&null!==W.zmax?W.zmax:1,N=W.subdivisions||{w:1,h:1},I=W.precision||{w:1,h:1},s=new Array,o=new Array,D=new Array,S=new Array;N.h=N.h<1?1:N.h,N.w=N.w<1?1:N.w,I.w=I.w<1?1:I.w,I.h=I.h<1?1:I.h;var C=(z-x)/N.w,e=(r-R)/N.h;function V(W,l,t,p){var x=o.length/3,R=I.w+1;for(i=0;i<I.h;i++)for(L=0;L<I.w;L++){var z=[x+L+i*R,x+(L+1)+i*R,x+(L+1)+(i+1)*R,x+L+(i+1)*R];s.push(z[1]),s.push(z[2]),s.push(z[3]),s.push(z[0]),s.push(z[1]),s.push(z[3])}var r=h.m.Zero(),N=new h.m(0,1,0);for(i=0;i<=I.h;i++)for(r.z=i*(p-l)/I.h+l,L=0;L<=I.w;L++)r.x=L*(t-W)/I.w+W,r.y=0,o.push(r.x,r.y,r.z),D.push(N.x,N.y,N.z),S.push(L/I.w,i/I.h)}for(l=0;l<N.h;l++)for(t=0;t<N.w;t++)V(x+t*C,R+l*e,x+(t+1)*C,R+(l+1)*e);var c=new p.e;return c.indices=s,c.positions=o,c.normals=D,c.uvs=S,c}function A(W){var i,L,l=[],t=[],x=[],R=[],z=W.colorFilter||new I.d(.3,.59,.11),r=W.alphaFilter||0,N=!1;if(W.minHeight>W.maxHeight){N=!0;var s=W.maxHeight;W.maxHeight=W.minHeight,W.minHeight=s}for(i=0;i<=W.subdivisions;i++)for(L=0;L<=W.subdivisions;L++){var o=new h.m(L*W.width/W.subdivisions-W.width/2,0,(W.subdivisions-i)*W.height/W.subdivisions-W.height/2),D=4*(((o.x+W.width/2)/W.width*(W.bufferWidth-1)|0)+((1-(o.z+W.height/2)/W.height)*(W.bufferHeight-1)|0)*W.bufferWidth),S=W.buffer[D]/255,C=W.buffer[D+1]/255,e=W.buffer[D+2]/255,V=W.buffer[D+3]/255;N&&(S=1-S,C=1-C,e=1-e);var c=S*z.r+C*z.g+e*z.b;o.y=V>=r?W.minHeight+(W.maxHeight-W.minHeight)*c:W.minHeight-T.e,t.push(o.x,o.y,o.z),x.push(0,0,0),R.push(L/W.subdivisions,1-i/W.subdivisions)}for(i=0;i<W.subdivisions;i++)for(L=0;L<W.subdivisions;L++){var f=L+1+(i+1)*(W.subdivisions+1),a=L+1+i*(W.subdivisions+1),P=L+i*(W.subdivisions+1),y=L+(i+1)*(W.subdivisions+1),M=t[3*f+1]>=W.minHeight,b=t[3*a+1]>=W.minHeight,j=t[3*P+1]>=W.minHeight;M&&b&&j&&(l.push(f),l.push(a),l.push(P)),t[3*y+1]>=W.minHeight&&M&&j&&(l.push(y),l.push(f),l.push(P))}p.e.ComputeNormals(t,l,x);var Z=new p.e;return Z.indices=l,Z.positions=t,Z.normals=x,Z.uvs=R,Z}function v(W,i,L){void 0===i&&(i={});var h=new K(W,L);return h._setReady(!1),h._subdivisionsX=i.subdivisionsX||i.subdivisions||1,h._subdivisionsY=i.subdivisionsY||i.subdivisions||1,h._width=i.width||1,h._height=i.height||1,h._maxX=h._width/2,h._maxZ=h._height/2,h._minX=-h._maxX,h._minZ=-h._maxZ,u(i).applyToMesh(h,i.updatable),h._setReady(!0),h}function Q(W,i,L){void 0===L&&(L=null);var h=new l.e(W,L);return J(i).applyToMesh(h,i.updatable),h}function O(W,i,L,h){void 0===L&&(L={}),void 0===h&&(h=null);var l=L.width||10,t=L.height||10,p=L.subdivisions||1,x=L.minHeight||0,R=L.maxHeight||1,z=L.colorFilter||new I.d(.3,.59,.11),r=L.alphaFilter||0,N=L.updatable,s=L.onReady;h=h||F.d.LastCreatedScene;var o=new K(W,h);o._subdivisionsX=p,o._subdivisionsY=p,o._width=l,o._height=t,o._maxX=o._width/2,o._maxZ=o._height/2,o._minX=-o._maxX,o._minZ=-o._maxZ,o._setReady(!1);return G.h.LoadImage(i,(function(W){var i=W.width,L=W.height;if(!h.isDisposed){var I=null===h||void 0===h?void 0:h.getEngine().resizeImageBitmap(W,i,L);A({width:l,height:t,subdivisions:p,minHeight:x,maxHeight:R,colorFilter:z,buffer:I,bufferWidth:i,bufferHeight:L,alphaFilter:r}).applyToMesh(o,N),s&&s(o),o._setReady(!0)}}),(function(){}),h.offlineProvider),o}function Y(W,i,L){void 0===L&&(L=null);var t=i.path,p=i.instance,x=1;void 0!==i.radius?x=i.radius:p&&(x=p._creationDataStorage.radius);var R=i.tessellation||64,r=i.radiusFunction||null,N=i.cap||l.e.NO_CAP,I=i.invertUV||!1,s=i.updatable,o=l.e._GetDefaultSideOrientation(i.sideOrientation);i.arc=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1;var D,S,C=function(W,i,L,t,p,x,R,z){for(var r,N,I,s,o=i.getTangents(),D=i.getNormals(),S=i.getDistances(),C=2*Math.PI/p*z,e=x||function(){return t},V=h.h.Matrix[0],c=R===l.e.NO_CAP||R===l.e.CAP_END?0:2,f=0;f<W.length;f++){N=e(f,S[f]),r=Array(),I=D[f];for(var a=0;a<p;a++)h.d.RotationAxisToRef(o[f],C*a,V),s=r[a]?r[a]:h.m.Zero(),h.m.TransformCoordinatesToRef(I,V,s),s.scaleInPlace(N).addInPlace(W[f]),r[a]=s;L[c]=r,c++}var P=function(i,L){for(var h=Array(),l=0;l<i;l++)h.push(W[L]);return h};switch(R){case l.e.NO_CAP:break;case l.e.CAP_START:L[0]=P(p,0),L[1]=L[2].slice(0);break;case l.e.CAP_END:L[c]=L[c-1].slice(0),L[c+1]=P(p,W.length-1);break;case l.e.CAP_ALL:L[0]=P(p,0),L[1]=L[2].slice(0),L[c]=L[c-1].slice(0),L[c+1]=P(p,W.length-1)}return L};if(p){var e=p._creationDataStorage,V=i.arc||e.arc;return p=z("",{pathArray:S=C(t,D=e.path3D.update(t),e.pathArray,x,e.tessellation,r,e.cap,V),instance:p}),e.path3D=D,e.pathArray=S,e.arc=V,e.radius=x,p}N=N<0||N>3?0:N;var c=z(W,{pathArray:S=C(t,D=new X.h(t),new Array,x,R,r,N,i.arc),closePath:!0,closeArray:!1,updatable:s,sideOrientation:o,invertUV:I,frontUVs:i.frontUVs,backUVs:i.backUVs},L);return c._creationDataStorage.pathArray=S,c._creationDataStorage.path3D=D,c._creationDataStorage.tessellation=R,c._creationDataStorage.cap=N,c._creationDataStorage.arc=i.arc,c._creationDataStorage.radius=x,c}p.e.CreateGround=u,p.e.CreateTiledGround=J,p.e.CreateGroundFromHeightMap=A,l.e.CreateGround=function(W,i,L,h,l,t){return v(W,{width:i,height:L,subdivisions:h,updatable:t},l)},l.e.CreateTiledGround=function(W,i,L,h,l,t,p,x,R){return Q(W,{xmin:i,zmin:L,xmax:h,zmax:l,subdivisions:t,precision:p,updatable:R},x)},l.e.CreateGroundFromHeightMap=function(W,i,L,h,l,t,p,x,R,z,r){return O(W,i,{width:L,height:h,subdivisions:l,minHeight:t,maxHeight:p,updatable:R,onReady:z,alphaFilter:r},x)};function WW(W){var i=[];i[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},i[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},i[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},i[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},i[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},i[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},i[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},i[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},i[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},i[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},i[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},i[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},i[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},i[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},i[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var L,l,t,R,z,r,N=W.type&&(W.type<0||W.type>=i.length)?0:W.type||0,s=W.size,o=W.sizeX||s||1,D=W.sizeY||s||1,S=W.sizeZ||s||1,C=W.custom||i[N],e=C.face.length,V=W.faceUV||new Array(e),c=W.faceColors,f=void 0===W.flat||W.flat,a=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE,P=new Array,y=new Array,M=new Array,b=new Array,j=new Array,Z=0,X=0,T=new Array,F=0,q=0;if(f)for(q=0;q<e;q++)c&&void 0===c[q]&&(c[q]=new I.g(1,1,1,1)),V&&void 0===V[q]&&(V[q]=new h.n(0,0,1,1));if(f)for(q=0;q<e;q++){var H=C.face[q].length;for(t=2*Math.PI/H,R=.5*Math.tan(t/2),z=.5,F=0;F<H;F++)P.push(C.vertex[C.face[q][F]][0]*o,C.vertex[C.face[q][F]][1]*D,C.vertex[C.face[q][F]][2]*S),T.push(Z),Z++,L=V[q].x+(V[q].z-V[q].x)*(.5+R),l=V[q].y+(V[q].w-V[q].y)*(z-.5),b.push(L,x.d.UseOpenGLOrientationForUV?1-l:l),r=R*Math.cos(t)-z*Math.sin(t),z=R*Math.sin(t)+z*Math.cos(t),R=r,c&&j.push(c[q].r,c[q].g,c[q].b,c[q].a);for(F=0;F<H-2;F++)y.push(T[0+X],T[F+2+X],T[F+1+X]);X+=H}else{for(F=0;F<C.vertex.length;F++)P.push(C.vertex[F][0]*o,C.vertex[F][1]*D,C.vertex[F][2]*S),b.push(0,x.d.UseOpenGLOrientationForUV?1:0);for(q=0;q<e;q++)for(F=0;F<C.face[q].length-2;F++)y.push(C.face[q][0],C.face[q][F+2],C.face[q][F+1])}p.e.ComputeNormals(P,y,M),p.e._ComputeSides(a,P,y,M,b,W.frontUVs,W.backUVs);var k=new p.e;return k.positions=P,k.indices=y,k.normals=M,k.uvs=b,c&&f&&(k.colors=j),k}function iW(W,i,L){void 0===i&&(i={}),void 0===L&&(L=null);var h=new l.e(W,L);return i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,WW(i).applyToMesh(h,i.updatable),h}l.e.CreateTube=function(W,i,L,h,l,t,p,x,R,z){return Y(W,{path:i,radius:L,tessellation:h,radiusFunction:l,arc:1,cap:t,updatable:x,sideOrientation:R,instance:z},p)};function LW(W){var i,L=W.sideOrientation||p.e.DEFAULTSIDE,l=W.radius||1,t=void 0===W.flat||W.flat,R=W.subdivisions||4,z=W.radiusX||l,r=W.radiusY||l,N=W.radiusZ||l,I=(1+Math.sqrt(5))/2,s=[-1,I,-0,1,I,0,-1,-I,0,1,-I,0,0,-1,-I,0,1,-I,0,-1,I,0,1,I,I,0,1,I,0,-1,-I,0,1,-I,0,-1],o=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],D=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],S=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],C=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],e=new Array,V=new Array,c=new Array,f=new Array,a=0,P=new Array(3),y=new Array(3);for(i=0;i<3;i++)P[i]=h.m.Zero(),y[i]=h.k.Zero();for(var M=0;M<20;M++){for(i=0;i<3;i++){var b=o[3*M+i];P[i].copyFromFloats(s[3*D[b]],s[3*D[b]+1],s[3*D[b]+2]),P[i].normalize().scaleInPlace(l),y[i].copyFromFloats(.134765625*S[2*b]+.05859375+-.0390625*C[M],.2333984375*S[2*b+1]+.025390625+.01953125*C[M])}for(var j=function(W,i,L,l){var p,I=h.m.Lerp(P[0],P[2],i/R),s=h.m.Lerp(P[1],P[2],i/R),o=R===i?P[2]:h.m.Lerp(I,s,W/(R-i));if(o.normalize(),t){var D=h.m.Lerp(P[0],P[2],l/R),S=h.m.Lerp(P[1],P[2],l/R);p=h.m.Lerp(D,S,L/(R-l))}else p=new h.m(o.x,o.y,o.z);p.x/=z,p.y/=r,p.z/=N,p.normalize();var C=h.k.Lerp(y[0],y[2],i/R),M=h.k.Lerp(y[1],y[2],i/R),b=R===i?y[2]:h.k.Lerp(C,M,W/(R-i));V.push(o.x*z,o.y*r,o.z*N),c.push(p.x,p.y,p.z),f.push(b.x,x.d.UseOpenGLOrientationForUV?1-b.y:b.y),e.push(a),a++},Z=0;Z<R;Z++)for(var X=0;X+Z<R;X++)j(X,Z,X+1/3,Z+1/3),j(X+1,Z,X+1/3,Z+1/3),j(X,Z+1,X+1/3,Z+1/3),X+Z+1<R&&(j(X+1,Z,X+2/3,Z+2/3),j(X+1,Z+1,X+2/3,Z+2/3),j(X,Z+1,X+2/3,Z+2/3))}p.e._ComputeSides(L,V,e,c,f,W.frontUVs,W.backUVs);var T=new p.e;return T.indices=e,T.positions=V,T.normals=c,T.uvs=f,T}function hW(W,i,L){void 0===i&&(i={}),void 0===L&&(L=null);var h=new l.e(W,L);return i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),h._originalBuilderSideOrientation=i.sideOrientation,LW(i).applyToMesh(h,i.updatable),h}p.e.CreatePolyhedron=WW,l.e.CreatePolyhedron=function(W,i,L){return iW(W,i,L)};p.e.CreateIcoSphere=LW,l.e.CreateIcoSphere=function(W,i,L){return hW(W,i,L)};var lW=L(52270);function tW(W,i,L){var R=i.getIndices(),z=i.getVerticesData(t.d.PositionKind),r=i.getVerticesData(t.d.NormalKind),N=i.getVerticesData(t.d.UVKind),I=L.position||h.m.Zero(),s=L.normal||h.m.Up(),o=L.size||h.m.One(),D=L.angle||0;if(!s){var S=new h.m(0,0,1),C=i.getScene().activeCamera,e=h.m.TransformCoordinates(S,C.getWorldMatrix());s=C.globalPosition.subtract(e)}var V=-Math.atan2(s.z,s.x)-Math.PI/2,c=Math.sqrt(s.x*s.x+s.z*s.z),f=Math.atan2(s.y,c),a=h.d.RotationYawPitchRoll(V,f,D).multiply(h.d.Translation(I.x,I.y,I.z)),P=h.d.Invert(a),y=i.getWorldMatrix().multiply(P),M=new p.e;M.indices=[],M.positions=[],M.normals=[],M.uvs=[];for(var b=0,j=function(W){var i=new lW.d;if(!R||!z||!r)return i;var l=R[W];if(i.position=new h.m(z[3*l],z[3*l+1],z[3*l+2]),i.position=h.m.TransformCoordinates(i.position,y),i.normal=new h.m(r[3*l],r[3*l+1],r[3*l+2]),i.normal=h.m.TransformNormal(i.normal,y),L.captureUVS&&N){var t=N[2*l+1];i.uv=new h.k(N[2*l],x.d.UseOpenGLOrientationForUV?1-t:t)}return i},Z=function(W,i){if(0===W.length)return W;for(var L=.5*Math.abs(h.m.Dot(o,i)),l=function(W,l){var t=h.m.GetClipFactor(W.position,l.position,i,L);return new lW.d(h.m.Lerp(W.position,l.position,t),h.m.Lerp(W.normal,l.normal,t))},t=new Array,p=0;p<W.length;p+=3){var x=null,R=null,z=null,r=null,N=h.m.Dot(W[p].position,i)-L>0,I=h.m.Dot(W[p+1].position,i)-L>0,s=h.m.Dot(W[p+2].position,i)-L>0;switch((N?1:0)+(I?1:0)+(s?1:0)){case 0:t.push(W[p]),t.push(W[p+1]),t.push(W[p+2]);break;case 1:if(N&&(x=W[p+1],R=W[p+2],z=l(W[p],x),r=l(W[p],R)),I){x=W[p],R=W[p+2],z=l(W[p+1],x),r=l(W[p+1],R),t.push(z),t.push(R.clone()),t.push(x.clone()),t.push(R.clone()),t.push(z.clone()),t.push(r);break}s&&(x=W[p],R=W[p+1],z=l(W[p+2],x),r=l(W[p+2],R)),x&&R&&z&&r&&(t.push(x.clone()),t.push(R.clone()),t.push(z),t.push(r),t.push(z.clone()),t.push(R.clone()));break;case 2:N||(R=l(x=W[p].clone(),W[p+1]),z=l(x,W[p+2]),t.push(x),t.push(R),t.push(z)),I||(R=l(x=W[p+1].clone(),W[p+2]),z=l(x,W[p]),t.push(x),t.push(R),t.push(z)),s||(R=l(x=W[p+2].clone(),W[p]),z=l(x,W[p+1]),t.push(x),t.push(R),t.push(z))}}return t},X=0;X<R.length;X+=3){var T=new Array;if(T.push(j(X)),T.push(j(X+1)),T.push(j(X+2)),T=Z(T,new h.m(1,0,0)),T=Z(T,new h.m(-1,0,0)),T=Z(T,new h.m(0,1,0)),T=Z(T,new h.m(0,-1,0)),T=Z(T,new h.m(0,0,1)),0!==(T=Z(T,new h.m(0,0,-1))).length)for(var F=0;F<T.length;F++){var q=T[F];if(M.indices.push(b),q.position.toArray(M.positions,3*b),q.normal.toArray(M.normals,3*b),L.captureUVS)q.uv.toArray(M.uvs,2*b);else{M.uvs.push(.5+q.position.x/o.x);var H=.5+q.position.y/o.y;M.uvs.push(x.d.UseOpenGLOrientationForUV?1-H:H)}b++}}var k=new l.e(W,i.getScene());return M.applyToMesh(k),k.position=I.clone(),k.rotation=new h.m(f,V,D),k}function pW(W){void 0===W&&(W={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var i,L,l=Math.max(W.subdivisions?W.subdivisions:2,1),t=Math.max(W.tessellation?W.tessellation:16,3),R=Math.max(W.height?W.height:1,0),z=Math.max(W.radius?W.radius:.25,0),r=Math.max(W.capSubdivisions?W.capSubdivisions:6,1),N=t,I=l,s=Math.max(W.radiusTop?W.radiusTop:z,0),o=Math.max(W.radiusBottom?W.radiusBottom:z,0),D=R-(s+o),S=2*Math.PI,C=Math.max(W.topCapSubdivisions?W.topCapSubdivisions:r,1),e=Math.max(W.bottomCapSubdivisions?W.bottomCapSubdivisions:r,1),V=Math.acos((o-s)/R),c=[],f=[],a=[],P=[],y=0,M=[],b=.5*D,j=.5*Math.PI,Z=h.m.Zero(),X=h.m.Zero(),T=Math.cos(V),F=Math.sin(V),q=new h.k(s*F,b+s*T).subtract(new h.k(o*F,o*T-b)).length(),H=s*V+q+o*(j-V),k=0;for(L=0;L<=C;L++){var U=[],d=j-V*(L/C);k+=s*V/C;var B=Math.cos(d),w=Math.sin(d),g=B*s;for(i=0;i<=N;i++){var n=(u=i/N)*S+0,m=Math.sin(n),E=Math.cos(n);X.x=g*m,X.y=b+w*s,X.z=g*E,f.push(X.x,X.y,X.z),Z.set(B*m,w,B*E),a.push(Z.x,Z.y,Z.z),P.push(u,x.d.UseOpenGLOrientationForUV?k/H:1-k/H),U.push(y),y++}M.push(U)}var K=R-s-o+T*s-T*o,G=F*(o-s)/K;for(L=1;L<=I;L++){U=[];k+=q/I;g=F*(L*(o-s)/I+s);for(i=0;i<=N;i++){n=(u=i/N)*S+0,m=Math.sin(n),E=Math.cos(n);X.x=g*m,X.y=b+T*s-L*K/I,X.z=g*E,f.push(X.x,X.y,X.z),Z.set(m,G,E).normalize(),a.push(Z.x,Z.y,Z.z),P.push(u,x.d.UseOpenGLOrientationForUV?k/H:1-k/H),U.push(y),y++}M.push(U)}for(L=1;L<=e;L++){U=[],d=j-V-(Math.PI-V)*(L/e);k+=o*V/e;B=Math.cos(d),w=Math.sin(d),g=B*o;for(i=0;i<=N;i++){var u;n=(u=i/N)*S+0,m=Math.sin(n),E=Math.cos(n);X.x=g*m,X.y=w*o-b,X.z=g*E,f.push(X.x,X.y,X.z),Z.set(B*m,w,B*E),a.push(Z.x,Z.y,Z.z),P.push(u,x.d.UseOpenGLOrientationForUV?k/H:1-k/H),U.push(y),y++}M.push(U)}for(i=0;i<N;i++)for(L=0;L<C+I+e;L++){var J=M[L][i],A=M[L+1][i],v=M[L+1][i+1],Q=M[L][i+1];c.push(J),c.push(A),c.push(Q),c.push(A),c.push(v),c.push(Q)}if(c=c.reverse(),W.orientation&&!W.orientation.equals(h.m.Up())){var O=new h.d;W.orientation.clone().scale(.5*Math.PI).cross(h.m.Up()).toQuaternion().toRotationMatrix(O);for(var Y=h.m.Zero(),WW=0;WW<f.length;WW+=3)Y.set(f[WW],f[WW+1],f[WW+2]),h.m.TransformCoordinatesToRef(Y.clone(),O,Y),f[WW]=Y.x,f[WW+1]=Y.y,f[WW+2]=Y.z}var iW=new p.e;return iW.positions=f,iW.normals=a,iW.uvs=P,iW.indices=c,iW}function xW(W,i,L){void 0===i&&(i={orientation:h.m.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1}),void 0===L&&(L=null);var t=new l.e(W,L);return pW(i).applyToMesh(t,i.updatable),t}l.e.CreateDecal=function(W,i,L,h,l,t){return tW(W,i,{position:L,normal:h,size:l,angle:t})};l.e.CreateCapsule=function(W,i,L){return xW(W,i,L)},p.e.CreateCapsule=pW;var RW=L(96658),zW=function(){function W(W,i){void 0===W&&(W=0),void 0===i&&(i=0),this.x=W,this.y=i,W!==Math.floor(W)&&(Math.floor(W),Z.e.Warn("x is not an integer, floor(x) used")),i!==Math.floor(i)&&(Math.floor(i),Z.e.Warn("y is not an integer, floor(y) used"))}return W.prototype.clone=function(){return new W(this.x,this.y)},W.prototype.rotate60About=function(W){var i=this.x;return this.x=W.x+W.y-this.y,this.y=i+this.y-W.x,this},W.prototype.rotateNeg60About=function(W){var i=this.x;return this.x=i+this.y-W.y,this.y=W.x+W.y-i,this},W.prototype.rotate120=function(W,i){W!==Math.floor(W)&&(Math.floor(W),Z.e.Warn("m not an integer only floor(m) used")),i!==Math.floor(i)&&(Math.floor(i),Z.e.Warn("n not an integer only floor(n) used"));var L=this.x;return this.x=W-L-this.y,this.y=i+L,this},W.prototype.rotateNeg120=function(W,i){W!==Math.floor(W)&&(Math.floor(W),Z.e.Warn("m is not an integer, floor(m) used")),i!==Math.floor(i)&&(Math.floor(i),Z.e.Warn("n is not an integer,   floor(n) used"));var L=this.x;return this.x=this.y-i,this.y=W+i-L-this.y,this},W.prototype.toCartesianOrigin=function(W,i){var L=h.m.Zero();return L.x=W.x+2*this.x*i+this.y*i,L.y=W.y+Math.sqrt(3)*this.y*i,L},W.Zero=function(){return new W(0,0)},W}(),rW=function(){function W(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new NW("icosahedron","Regular",[[0,T.h,-1],[-T.h,1,0],[-1,0,-T.h],[1,0,-T.h],[T.h,1,0],[0,T.h,1],[-1,0,T.h],[-T.h,-1,0],[0,-T.h,-1],[T.h,-1,0],[1,0,T.h],[0,-T.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}return W.prototype.setIndices=function(){var W,i,L,h,l,t,p,x=12,R={},z=this.m,r=this.n,N=z;0!==r&&(N=RW.d.HCF(z,r)),W=z/N,i=r/N;var I,s,o,D=zW.Zero(),S=new zW(z,r),C=new zW(-r,z+r),e=zW.Zero(),V=zW.Zero(),c=zW.Zero(),f=[],a=[],P=this.vertByDist,y=function(W,i,L,h){s=i+"|"+h,(I=W+"|"+L)in R||s in R?I in R&&!(s in R)?R[s]=R[I]:s in R&&!(I in R)&&(R[I]=R[s]):(R[I]=x,R[s]=x,x++),P[L][0]>2?a[R[I]]=[-P[L][0],P[L][1],R[I]]:a[R[I]]=[f[P[L][0]],P[L][1],R[I]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(var M=0;M<20;M++){if(l=(f=this.IDATA.face[M])[2],t=f[1],p=f[0],o=D.x+"|"+D.y,(I=M+"|"+o)in R||(R[I]=l,a[l]=[f[P[o][0]],P[o][1]]),o=S.x+"|"+S.y,(I=M+"|"+o)in R||(R[I]=t,a[t]=[f[P[o][0]],P[o][1]]),o=C.x+"|"+C.y,(I=M+"|"+o)in R||(R[I]=p,a[p]=[f[P[o][0]],P[o][1]]),L=this.IDATA.edgematch[M][0],"B"===(h=this.IDATA.edgematch[M][1]))for(var b=1;b<N;b++)V.x=z-b*(W+i),V.y=r+b*W,c.x=-b*i,c.y=b*(W+i),y(M,L,o=V.x+"|"+V.y,c.x+"|"+c.y);if("O"===h)for(b=1;b<N;b++)c.x=-b*i,c.y=b*(W+i),e.x=b*W,e.y=b*i,y(M,L,o=c.x+"|"+c.y,e.x+"|"+e.y);if(L=this.IDATA.edgematch[M][2],(h=this.IDATA.edgematch[M][3])&&"A"===h)for(b=1;b<N;b++)e.x=b*W,e.y=b*i,V.x=z-(N-b)*(W+i),V.y=r+(N-b)*W,y(M,L,o=e.x+"|"+e.y,V.x+"|"+V.y);for(b=0;b<this.vertices.length;b++)o=this.vertices[b].x+"|"+this.vertices[b].y,(I=M+"|"+o)in R||(R[I]=x++,P[o][0]>2?a[R[I]]=[-P[o][0],P[o][1],R[I]]:a[R[I]]=[f[P[o][0]],P[o][1],R[I]])}this.closestTo=a,this.vecToidx=R},W.prototype.calcCoeffs=function(){var W=this.m,i=this.n,L=Math.sqrt(3)/3,h=W*W+i*i+W*i;this.coau=(W+i)/h,this.cobu=-i/h,this.coav=-L*(W-i)/h,this.cobv=L*(2*W+i)/h},W.prototype.createInnerFacets=function(){for(var W=this.m,i=this.n,L=0;L<i+W+1;L++)for(var h=this.min[L];h<this.max[L]+1;h++)h<this.max[L]&&h<this.max[L+1]+1&&this.innerFacets.push(["|"+h+"|"+L,"|"+h+"|"+(L+1),"|"+(h+1)+"|"+L]),L>0&&h<this.max[L-1]&&h+1<this.max[L]+1&&this.innerFacets.push(["|"+h+"|"+L,"|"+(h+1)+"|"+L,"|"+(h+1)+"|"+(L-1)])},W.prototype.edgeVecsABOB=function(){for(var W=this.m,i=this.n,L=new zW(-i,W+i),h=1;h<W+i;h++){var l=new zW(this.min[h],h),t=new zW(this.min[h-1],h-1),p=new zW(this.min[h+1],h+1),x=l.clone(),R=t.clone(),z=p.clone();x.rotate60About(L),R.rotate60About(L),z.rotate60About(L);var r=new zW(this.max[x.y],x.y),N=new zW(this.max[x.y-1],x.y-1),I=new zW(this.max[x.y-1]-1,x.y-1);x.x===r.x&&x.y===r.y||(x.x!==N.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([l,N,I]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([l,I,r])):x.y===z.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([l,t,N]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([l,N,p])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([l,t,N]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([l,N,r])))}},W.prototype.mapABOBtoOBOA=function(){for(var W=new zW(0,0),i=0;i<this.isoVecsABOB.length;i++){for(var L=[],h=0;h<3;h++)W.x=this.isoVecsABOB[i][h].x,W.y=this.isoVecsABOB[i][h].y,0===this.vertexTypes[i][h]&&W.rotateNeg120(this.m,this.n),L.push(W.clone());this.isoVecsOBOA.push(L)}},W.prototype.mapABOBtoBAOA=function(){for(var W=new zW(0,0),i=0;i<this.isoVecsABOB.length;i++){for(var L=[],h=0;h<3;h++)W.x=this.isoVecsABOB[i][h].x,W.y=this.isoVecsABOB[i][h].y,1===this.vertexTypes[i][h]&&W.rotate120(this.m,this.n),L.push(W.clone());this.isoVecsBAOA.push(L)}},W.prototype.MapToFace=function(W,i){for(var L,l=this.IDATA.face[W],t=l[2],p=l[1],x=l[0],R=h.m.FromArray(this.IDATA.vertex[t]),z=h.m.FromArray(this.IDATA.vertex[p]),r=h.m.FromArray(this.IDATA.vertex[x]),N=z.subtract(R),I=r.subtract(R),s=N.scale(this.coau).add(I.scale(this.cobu)),o=N.scale(this.coav).add(I.scale(this.cobv)),D=[],S=h.h.Vector3[0],C=0;C<this.cartesian.length;C++)S=s.scale(this.cartesian[C].x).add(o.scale(this.cartesian[C].y)).add(R),D[C]=[S.x,S.y,S.z],L=W+"|"+this.vertices[C].x+"|"+this.vertices[C].y,i.vertex[this.vecToidx[L]]=[S.x,S.y,S.z]},W.prototype.build=function(W,i){var L=new Array,h=zW.Zero(),l=new zW(W,i),t=new zW(-i,W+i);L.push(h,l,t);for(var p=i;p<W+1;p++)for(var x=0;x<W+1-p;x++)L.push(new zW(x,p));if(i>0){for(var R=RW.d.HCF(W,i),z=W/R,r=i/R,N=1;N<R;N++)L.push(new zW(N*z,N*r)),L.push(new zW(-N*r,N*(z+r))),L.push(new zW(W-N*(z+r),i+N*z));for(var I=W/i,s=1;s<i;s++)for(var o=0;o<s*I;o++)L.push(new zW(o,s)),L.push(new zW(o,s).rotate120(W,i)),L.push(new zW(o,s).rotateNeg120(W,i))}L.sort((function(W,i){return W.x-i.x})),L.sort((function(W,i){return W.y-i.y}));var D=new Array(W+i+1),S=new Array(W+i+1);for(N=0;N<D.length;N++)D[N]=1/0,S[N]=-1/0;var C=0,e=0,V=L.length;for(N=0;N<V;N++)e=L[N].x,D[C=L[N].y]=Math.min(e,D[C]),S[C]=Math.max(e,S[C]);var c=function(L,h){var l=L.clone();return"A"===h&&l.rotateNeg120(W,i),"B"===h&&l.rotate120(W,i),l.x<0?l.y:l.x+l.y},f=[],a=[],P=[],y=[],M={},b=[],j=-1,Z=-1;for(N=0;N<V;N++)f[N]=L[N].toCartesianOrigin(new zW(0,0),.5),a[N]=c(L[N],"O"),P[N]=c(L[N],"A"),y[N]=c(L[N],"B"),a[N]===P[N]&&P[N]===y[N]?(j=3,Z=a[N]):a[N]===P[N]?(j=4,Z=a[N]):P[N]===y[N]?(j=5,Z=P[N]):y[N]===a[N]&&(j=6,Z=a[N]),a[N]<P[N]&&a[N]<y[N]&&(j=2,Z=a[N]),P[N]<a[N]&&P[N]<y[N]&&(j=1,Z=P[N]),y[N]<P[N]&&y[N]<a[N]&&(j=0,Z=y[N]),b.push([j,Z,L[N].x,L[N].y]);b.sort((function(W,i){return W[2]-i[2]})),b.sort((function(W,i){return W[3]-i[3]})),b.sort((function(W,i){return W[1]-i[1]})),b.sort((function(W,i){return W[0]-i[0]}));for(var X=0;X<b.length;X++)M[b[X][2]+"|"+b[X][3]]=[b[X][0],b[X][1],X];return this.m=W,this.n=i,this.vertices=L,this.vertByDist=M,this.cartesian=f,this.min=D,this.max=S,this},W}(),NW=function(W,i,L,h){this.name=W,this.category=i,this.vertex=L,this.face=h},IW=function(W){function i(){return null!==W&&W.apply(this,arguments)||this}return(0,j.n)(i,W),i.prototype.innerToData=function(W,i){for(var L=0;L<i.innerFacets.length;L++)this.face.push(i.innerFacets[L].map((function(L){return i.vecToidx[W+L]})))},i.prototype.mapABOBtoDATA=function(W,i){for(var L=i.IDATA.edgematch[W][0],h=0;h<i.isoVecsABOB.length;h++){for(var l=[],t=0;t<3;t++)0===i.vertexTypes[h][t]?l.push(W+"|"+i.isoVecsABOB[h][t].x+"|"+i.isoVecsABOB[h][t].y):l.push(L+"|"+i.isoVecsABOB[h][t].x+"|"+i.isoVecsABOB[h][t].y);this.face.push([i.vecToidx[l[0]],i.vecToidx[l[1]],i.vecToidx[l[2]]])}},i.prototype.mapOBOAtoDATA=function(W,i){for(var L=i.IDATA.edgematch[W][0],h=0;h<i.isoVecsOBOA.length;h++){for(var l=[],t=0;t<3;t++)1===i.vertexTypes[h][t]?l.push(W+"|"+i.isoVecsOBOA[h][t].x+"|"+i.isoVecsOBOA[h][t].y):l.push(L+"|"+i.isoVecsOBOA[h][t].x+"|"+i.isoVecsOBOA[h][t].y);this.face.push([i.vecToidx[l[0]],i.vecToidx[l[1]],i.vecToidx[l[2]]])}},i.prototype.mapBAOAtoDATA=function(W,i){for(var L=i.IDATA.edgematch[W][2],h=0;h<i.isoVecsBAOA.length;h++){for(var l=[],t=0;t<3;t++)1===i.vertexTypes[h][t]?l.push(W+"|"+i.isoVecsBAOA[h][t].x+"|"+i.isoVecsBAOA[h][t].y):l.push(L+"|"+i.isoVecsBAOA[h][t].x+"|"+i.isoVecsBAOA[h][t].y);this.face.push([i.vecToidx[l[0]],i.vecToidx[l[1]],i.vecToidx[l[2]]])}},i.prototype.orderData=function(W){for(var i=[],L=0;L<13;L++)i[L]=[];var h=W.closestTo;for(L=0;L<h.length;L++)h[L][0]>-1?h[L][1]>0&&i[h[L][0]].push([L,h[L][1]]):i[12].push([L,h[L][0]]);var l=[];for(L=0;L<12;L++)l[L]=L;var t=12;for(L=0;L<12;L++){i[L].sort((function(W,i){return W[1]-i[1]}));for(var p=0;p<i[L].length;p++)l[i[L][p][0]]=t++}for(p=0;p<i[12].length;p++)l[i[12][p][0]]=t++;for(L=0;L<this.vertex.length;L++)this.vertex[L].push(l[L]);this.vertex.sort((function(W,i){return W[3]-i[3]}));for(L=0;L<this.vertex.length;L++)this.vertex[L].pop();for(L=0;L<this.face.length;L++)for(p=0;p<this.face[L].length;p++)this.face[L][p]=l[this.face[L][p]];this.sharedNodes=i[12].length,this.poleNodes=this.vertex.length-this.sharedNodes},i.prototype.setOrder=function(W,i){var L=[],h=[],l=i.pop();h.push(l);var t=this.face[l].indexOf(W);t=(t+2)%3;var p=this.face[l][t];L.push(p);for(var x=0;i.length>0;)l=i[x],this.face[l].indexOf(p)>-1?(t=(this.face[l].indexOf(p)+1)%3,p=this.face[l][t],L.push(p),h.push(l),i.splice(x,1),x=0):x++;return this.adjacentFaces.push(L),h},i.prototype.toGoldbergPolyhedronData=function(){var W=this,i=new NW("GeoDual","Goldberg",[],[]);i.name="GD dual";for(var L=this.vertex.length,h=new Array(L),l=0;l<L;l++)h[l]=[];for(var t=0;t<this.face.length;t++)for(var p=0;p<3;p++)h[this.face[t][p]].push(t);var x=0,R=0,z=0,r=[],N=[];this.adjacentFaces=[];for(var I=0;I<h.length;I++)i.face[I]=this.setOrder(I,h[I].concat([])),h[I].forEach((function(L){x=0,R=0,z=0,r=W.face[L];for(var h=0;h<3;h++)N=W.vertex[r[h]],x+=N[0],R+=N[1],z+=N[2];i.vertex[L]=[x/3,R/3,z/3]}));return i},i.BuildGeodesicData=function(W){var L=new i("Geodesic-m-n","Geodesic",[[0,T.h,-1],[-T.h,1,0],[-1,0,-T.h],[1,0,-T.h],[T.h,1,0],[0,T.h,1],[-1,0,T.h],[-T.h,-1,0],[0,-T.h,-1],[T.h,-1,0],[1,0,T.h],[0,-T.h,1]],[]);W.setIndices(),W.calcCoeffs(),W.createInnerFacets(),W.edgeVecsABOB(),W.mapABOBtoOBOA(),W.mapABOBtoBAOA();for(var h=0;h<W.IDATA.face.length;h++)W.MapToFace(h,L),L.innerToData(h,W),"B"===W.IDATA.edgematch[h][1]&&L.mapABOBtoDATA(h,W),"O"===W.IDATA.edgematch[h][1]&&L.mapOBOAtoDATA(h,W),"A"===W.IDATA.edgematch[h][3]&&L.mapBAOAtoDATA(h,W);L.orderData(W);return L.vertex=L.vertex.map((function(W){var i=W[0],L=W[1],h=W[2],l=Math.sqrt(i*i+L*L+h*h);return W[0]*=1/l,W[1]*=1/l,W[2]*=1/l,W})),L},i}(NW);l.e._GoldbergMeshParser=function(W,i){return sW.Parse(W,i)};var sW=function(W){function i(){var i=null!==W&&W.apply(this,arguments)||this;return i.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]},i}return(0,j.n)(i,W),i.prototype.relatedGoldbergFace=function(W,i){return void 0===i?(W>this.goldbergData.nbUnsharedFaces-1&&(Z.e.Warn("Maximum number of unshared faces used"),W=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+W):(W>11&&(Z.e.Warn("Last pole used"),W=11),i>this.goldbergData.nbFacesAtPole-1&&(Z.e.Warn("Maximum number of faces at a pole used"),i=this.goldbergData.nbFacesAtPole-1),12+W*this.goldbergData.nbFacesAtPole+i)},i.prototype._changeGoldbergFaceColors=function(W){for(var i=0;i<W.length;i++)for(var L=W[i][0],h=W[i][1],l=W[i][2],t=L;t<h+1;t++)this.goldbergData.faceColors[t]=l;var p=[];for(t=0;t<12;t++)for(i=0;i<5;i++)p.push(this.goldbergData.faceColors[t].r,this.goldbergData.faceColors[t].g,this.goldbergData.faceColors[t].b,this.goldbergData.faceColors[t].a);for(t=12;t<this.goldbergData.faceColors.length;t++)for(i=0;i<6;i++)p.push(this.goldbergData.faceColors[t].r,this.goldbergData.faceColors[t].g,this.goldbergData.faceColors[t].b,this.goldbergData.faceColors[t].a);return p},i.prototype.setGoldbergFaceColors=function(W){var i=this._changeGoldbergFaceColors(W);this.setVerticesData(t.d.ColorKind,i)},i.prototype.updateGoldbergFaceColors=function(W){var i=this._changeGoldbergFaceColors(W);this.updateVerticesData(t.d.ColorKind,i)},i.prototype._changeGoldbergFaceUVs=function(W){for(var i=this.getVerticesData(t.d.UVKind),L=0;L<W.length;L++){for(var h=W[L][0],l=W[L][1],p=W[L][2],x=W[L][3],R=W[L][4],z=[],r=[],N=void 0,I=void 0,s=0;s<5;s++)N=p.x+x*Math.cos(R+s*Math.PI/2.5),I=p.y+x*Math.sin(R+s*Math.PI/2.5),N<0&&(N=0),N>1&&(N=1),z.push(N,I);for(s=0;s<6;s++)N=p.x+x*Math.cos(R+s*Math.PI/3),I=p.y+x*Math.sin(R+s*Math.PI/3),N<0&&(N=0),N>1&&(N=1),r.push(N,I);for(var o=h;o<Math.min(12,l+1);o++)for(s=0;s<5;s++)i[10*o+2*s]=z[2*s],i[10*o+2*s+1]=z[2*s+1];for(o=Math.max(12,h);o<l+1;o++)for(s=0;s<6;s++)i[12*o-24+2*s]=r[2*s],i[12*o-23+2*s]=r[2*s+1]}return i},i.prototype.setGoldbergFaceUVs=function(W){var i=this._changeGoldbergFaceUVs(W);this.setVerticesData(t.d.UVKind,i)},i.prototype.updateGoldbergFaceUVs=function(W){var i=this._changeGoldbergFaceUVs(W);this.updateVerticesData(t.d.UVKind,i)},i.prototype.placeOnGoldbergFaceAt=function(W,i,L){var l=h.m.RotationFromAxis(this.goldbergData.faceXaxis[i],this.goldbergData.faceYaxis[i],this.goldbergData.faceZaxis[i]);W.rotation=l,W.position=this.goldbergData.faceCenters[i].add(this.goldbergData.faceXaxis[i].scale(L.x)).add(this.goldbergData.faceYaxis[i].scale(L.y)).add(this.goldbergData.faceZaxis[i].scale(L.z))},i.prototype.serialize=function(i){W.prototype.serialize.call(this,i),i.type="GoldbergMesh";var L={};if(L.adjacentFaces=this.goldbergData.adjacentFaces,L.nbSharedFaces=this.goldbergData.nbSharedFaces,L.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,L.nbFaces=this.goldbergData.nbFaces,L.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){L.faceColors=[];for(var h=0,l=this.goldbergData.faceColors;h<l.length;h++){var t=l[h];L.faceColors.push(t.asArray())}}if(this.goldbergData.faceCenters){L.faceCenters=[];for(var p=0,x=this.goldbergData.faceCenters;p<x.length;p++){var R=x[p];L.faceCenters.push(R.asArray())}}if(this.goldbergData.faceZaxis){L.faceZaxis=[];for(var z=0,r=this.goldbergData.faceZaxis;z<r.length;z++){R=r[z];L.faceZaxis.push(R.asArray())}}if(this.goldbergData.faceYaxis){L.faceYaxis=[];for(var N=0,I=this.goldbergData.faceYaxis;N<I.length;N++){R=I[N];L.faceYaxis.push(R.asArray())}}if(this.goldbergData.faceXaxis){L.faceXaxis=[];for(var s=0,o=this.goldbergData.faceXaxis;s<o.length;s++){R=o[s];L.faceXaxis.push(R.asArray())}}i.goldbergData=L},i.Parse=function(W,L){var l=W.goldbergData;l.faceColors=l.faceColors.map((function(W){return I.g.FromArray(W)})),l.faceCenters=l.faceCenters.map((function(W){return h.m.FromArray(W)})),l.faceZaxis=l.faceZaxis.map((function(W){return h.m.FromArray(W)})),l.faceXaxis=l.faceXaxis.map((function(W){return h.m.FromArray(W)})),l.faceYaxis=l.faceYaxis.map((function(W){return h.m.FromArray(W)}));var t=new i(W.name,L);return t.goldbergData=l,t},i}(l.e);function oW(W,i,L){void 0===L&&(L=null);var t=i.size,R=i.sizeX||t||1,z=i.sizeY||t||1,r=i.sizeZ||t||1,N=i.m||1;N!==Math.floor(N)&&(Math.floor(N),Z.e.Warn("m not an integer only floor(m) used"));var s=i.n||0;if(s!==Math.floor(s)&&(Math.floor(s),Z.e.Warn("n not an integer only floor(n) used")),s>N){var o=s;s=N,N=o,Z.e.Warn("n > m therefore m and n swapped")}var D=new rW;D.build(N,s);var S=IW.BuildGeodesicData(D),C=S.toGoldbergPolyhedronData(),e=new sW(W,L);i.sideOrientation=l.e._GetDefaultSideOrientation(i.sideOrientation),e._originalBuilderSideOrientation=i.sideOrientation;var V=function(W,i){for(var L=W.size,l=W.sizeX||L||1,t=W.sizeY||L||1,R=W.sizeZ||L||1,z=0===W.sideOrientation?0:W.sideOrientation||p.e.DEFAULTSIDE,r=new Array,N=new Array,I=new Array,s=new Array,o=1/0,D=-1/0,S=1/0,C=-1/0,e=0;e<i.vertex.length;e++)o=Math.min(o,i.vertex[e][0]*l),D=Math.max(D,i.vertex[e][0]*l),S=Math.min(S,i.vertex[e][1]*t),C=Math.max(C,i.vertex[e][1]*t);for(var V=0,c=0;c<i.face.length;c++){var f=i.face[c],a=h.m.FromArray(i.vertex[f[0]]),P=h.m.FromArray(i.vertex[f[2]]),y=h.m.FromArray(i.vertex[f[1]]),M=P.subtract(a),b=y.subtract(a),j=h.m.Cross(b,M).normalize();for(e=0;e<f.length;e++){I.push(j.x,j.y,j.z);var Z=i.vertex[f[e]];r.push(Z[0]*l,Z[1]*t,Z[2]*R);var X=(Z[1]*t-S)/(C-S);s.push((Z[0]*l-o)/(D-o),x.d.UseOpenGLOrientationForUV?1-X:X)}for(e=0;e<f.length-2;e++)N.push(V,V+e+2,V+e+1);V+=f.length}p.e._ComputeSides(z,r,N,I,s);var T=new p.e;return T.positions=r,T.indices=N,T.normals=I,T.uvs=s,T}(i,C);V.applyToMesh(e,i.updatable),e.goldbergData.nbSharedFaces=S.sharedNodes,e.goldbergData.nbUnsharedFaces=S.poleNodes,e.goldbergData.adjacentFaces=S.adjacentFaces,e.goldbergData.nbFaces=e.goldbergData.nbSharedFaces+e.goldbergData.nbUnsharedFaces,e.goldbergData.nbFacesAtPole=(e.goldbergData.nbUnsharedFaces-12)/12;for(var c=0;c<S.vertex.length;c++)e.goldbergData.faceCenters.push(h.m.FromArray(S.vertex[c])),e.goldbergData.faceCenters[c].x*=R,e.goldbergData.faceCenters[c].y*=z,e.goldbergData.faceCenters[c].z*=r,e.goldbergData.faceColors.push(new I.g(1,1,1,1));for(c=0;c<C.face.length;c++){var f=C.face[c],a=h.m.FromArray(C.vertex[f[0]]),P=h.m.FromArray(C.vertex[f[2]]),y=h.m.FromArray(C.vertex[f[1]]),M=P.subtract(a),b=y.subtract(a),j=h.m.Cross(b,M).normalize(),X=h.m.Cross(b,j).normalize();e.goldbergData.faceXaxis.push(b.normalize()),e.goldbergData.faceYaxis.push(j),e.goldbergData.faceZaxis.push(X)}return e}l.e.CreateGoldberg=oW;var DW={CreateBox:N.f,CreateTiledBox:S,CreateSphere:C.b,CreateDisc:r.c,CreateIcoSphere:hW,CreateRibbon:z,CreateCylinder:f,CreateTorus:P,CreateTorusKnot:M,CreateLineSystem:b.e,CreateLines:b.g,CreateDashedLines:b.c,ExtrudeShape:w,ExtrudeShapeCustom:g,CreateLathe:m,CreateTiledPlane:o,CreatePlane:E.b,CreateGround:v,CreateTiledGround:Q,CreateGroundFromHeightMap:O,CreatePolygon:d,ExtrudePolygon:B,CreateTube:Y,CreatePolyhedron:iW,CreateGeodesic:function(W,i,L){void 0===L&&(L=null);var h=i.m||1;h!==Math.floor(h)&&(Math.floor(h),Z.e.Warn("m not an integer only floor(m) used"));var l=i.n||0;if(l!==Math.floor(l)&&(Math.floor(l),Z.e.Warn("n not an integer only floor(n) used")),l>h){var t=l;l=h,h=t,Z.e.Warn("n > m therefore m and n swapped")}var p=new rW;return p.build(h,l),iW(W,{custom:IW.BuildGeodesicData(p),size:i.size,sizeX:i.sizeX,sizeY:i.sizeY,sizeZ:i.sizeZ,faceUV:i.faceUV,faceColors:i.faceColors,flat:i.flat,updatable:i.updatable,sideOrientation:i.sideOrientation,frontUVs:i.frontUVs,backUVs:i.backUVs},L)},CreateGoldberg:oW,CreateDecal:tW,CreateCapsule:xW}},14313:function(W,i,L){"use strict";var h=L(65847),l=L(43251),t=L(80105);h.e.prototype.thinInstanceAdd=function(W,i){void 0===i&&(i=!0),this._thinInstanceUpdateBufferSize("matrix",Array.isArray(W)?W.length:1);var L=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(W))for(var h=0;h<W.length;++h)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,W[h],h===W.length-1&&i);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,W,i);return L},h.e.prototype.thinInstanceAddSelf=function(W){return void 0===W&&(W=!0),this.thinInstanceAdd(t.d.IdentityReadOnly,W)},h.e.prototype.thinInstanceRegisterAttribute=function(W,i){W===l.d.ColorKind&&(W=l.d.ColorInstanceKind),this.removeVerticesData(W),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[W]=i,this._userThinInstanceBuffersStorage.sizes[W]=i*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[W]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[W]),this._userThinInstanceBuffersStorage.vertexBuffers[W]=new l.d(this.getEngine(),this._userThinInstanceBuffersStorage.data[W],W,!0,!1,i,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[W])},h.e.prototype.thinInstanceSetMatrixAt=function(W,i,L){if(void 0===L&&(L=!0),!this._thinInstanceDataStorage.matrixData||W>=this._thinInstanceDataStorage.instancesCount)return!1;var h=this._thinInstanceDataStorage.matrixData;return i.copyToArray(h,16*W),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[W]=i),L&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},h.e.prototype.thinInstanceSetAttributeAt=function(W,i,L,h){return void 0===h&&(h=!0),W===l.d.ColorKind&&(W=l.d.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[W]||i>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(W,0),this._userThinInstanceBuffersStorage.data[W].set(L,i*this._userThinInstanceBuffersStorage.strides[W]),h&&this.thinInstanceBufferUpdated(W),!0)},Object.defineProperty(h.e.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(W){var i,L,h=null!==(i=this._thinInstanceDataStorage.matrixData)&&void 0!==i?i:null===(L=this.source)||void 0===L?void 0:L._thinInstanceDataStorage.matrixData;W<=(h?h.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=W)},enumerable:!0,configurable:!0}),h.e.prototype._thinInstanceCreateMatrixBuffer=function(W,i,L){void 0===L&&(L=!1),W===l.d.ColorKind&&(W=l.d.ColorInstanceKind);for(var h=new l.c(this.getEngine(),i,!L,16,!1,!0),t=0;t<4;t++)this.setVerticesBuffer(h.createVertexBuffer(W+t,4*t,4));return h},h.e.prototype.thinInstanceSetBuffer=function(W,i,L,h){var t,p,x;void 0===L&&(L=0),void 0===h&&(h=!1),L=L||16,"matrix"===W?(null===(t=this._thinInstanceDataStorage.matrixBuffer)||void 0===t||t.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=i?i.length:32*L,this._thinInstanceDataStorage.matrixData=i,this._thinInstanceDataStorage.worldMatrices=null,null!==i?(this._thinInstanceDataStorage.instancesCount=i.length/L,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",i,h),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):"previousMatrix"===W?(null===(p=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===p||p.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=i,null!==i&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",i,h))):(W===l.d.ColorKind&&(W=l.d.ColorInstanceKind),null===i?(null===(x=this._userThinInstanceBuffersStorage)||void 0===x?void 0:x.data[W])&&(this.removeVerticesData(W),delete this._userThinInstanceBuffersStorage.data[W],delete this._userThinInstanceBuffersStorage.strides[W],delete this._userThinInstanceBuffersStorage.sizes[W],delete this._userThinInstanceBuffersStorage.vertexBuffers[W]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[W]=i,this._userThinInstanceBuffersStorage.strides[W]=L,this._userThinInstanceBuffersStorage.sizes[W]=i.length,this._userThinInstanceBuffersStorage.vertexBuffers[W]=new l.d(this.getEngine(),i,W,!h,!1,L,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[W])))},h.e.prototype.thinInstanceBufferUpdated=function(W){var i,L,h;"matrix"===W?null===(i=this._thinInstanceDataStorage.matrixBuffer)||void 0===i||i.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount):"previousMatrix"===W?null===(L=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===L||L.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount):(W===l.d.ColorKind&&(W=l.d.ColorInstanceKind),(null===(h=this._userThinInstanceBuffersStorage)||void 0===h?void 0:h.vertexBuffers[W])&&this._userThinInstanceBuffersStorage.vertexBuffers[W].updateDirectly(this._userThinInstanceBuffersStorage.data[W],0))},h.e.prototype.thinInstancePartialBufferUpdate=function(W,i,L){var h;"matrix"===W?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(i,L):(W===l.d.ColorKind&&(W=l.d.ColorInstanceKind),(null===(h=this._userThinInstanceBuffersStorage)||void 0===h?void 0:h.vertexBuffers[W])&&this._userThinInstanceBuffersStorage.vertexBuffers[W].updateDirectly(i,L))},h.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];var W=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=new Array;for(var i=0;i<this._thinInstanceDataStorage.instancesCount;++i)this._thinInstanceDataStorage.worldMatrices[i]=t.d.FromArray(W,16*i)}return this._thinInstanceDataStorage.worldMatrices},h.e.prototype.thinInstanceRefreshBoundingInfo=function(W,i,L){if(void 0===W&&(W=!1),void 0===i&&(i=!1),void 0===L&&(L=!1),this._thinInstanceDataStorage.matrixData&&this._thinInstanceDataStorage.matrixBuffer){var h=this._thinInstanceDataStorage.boundingVectors;W&&(h.length=0,this.refreshBoundingInfo(i,L));var l=this.getBoundingInfo(),p=this._thinInstanceDataStorage.matrixData;if(0===h.length)for(var x=0;x<l.boundingBox.vectors.length;++x)h.push(l.boundingBox.vectors[x].clone());t.h.Vector3[0].setAll(Number.POSITIVE_INFINITY),t.h.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var R=0;R<this._thinInstanceDataStorage.instancesCount;++R){t.d.FromArrayToRef(p,16*R,t.h.Matrix[0]);for(x=0;x<h.length;++x)t.m.TransformCoordinatesToRef(h[x],t.h.Matrix[0],t.h.Vector3[2]),t.h.Vector3[0].minimizeInPlace(t.h.Vector3[2]),t.h.Vector3[1].maximizeInPlace(t.h.Vector3[2])}l.reConstruct(t.h.Vector3[0],t.h.Vector3[1]),this._updateBoundingInfo()}},h.e.prototype._thinInstanceUpdateBufferSize=function(W,i){var L,h,t;void 0===i&&(i=1),W===l.d.ColorKind&&(W=l.d.ColorInstanceKind);var p="matrix"===W;if(p||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[W]){for(var x=p?16:this._userThinInstanceBuffersStorage.strides[W],R=p?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[W],z=p?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[W],r=(this._thinInstanceDataStorage.instancesCount+i)*x,N=R;N<r;)N*=2;if(!z||R!=N){if(z){var I=new Float32Array(N);I.set(z,0),z=I}else z=new Float32Array(N);p?(null===(L=this._thinInstanceDataStorage.matrixBuffer)||void 0===L||L.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",z,!1),this._thinInstanceDataStorage.matrixData=z,this._thinInstanceDataStorage.matrixBufferSize=N,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(null===(h=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===h||h.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",z,!1))):(null===(t=this._userThinInstanceBuffersStorage.vertexBuffers[W])||void 0===t||t.dispose(),this._userThinInstanceBuffersStorage.data[W]=z,this._userThinInstanceBuffersStorage.sizes[W]=N,this._userThinInstanceBuffersStorage.vertexBuffers[W]=new l.d(this.getEngine(),z,W,!0,!1,x,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[W]))}}},h.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},h.e.prototype._disposeThinInstanceSpecificData=function(){var W;(null===(W=this._thinInstanceDataStorage)||void 0===W?void 0:W.matrixBuffer)&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},77129:function(W,i,L){"use strict";L.d(i,{e:function(){return z}});var h=L(40061),l=L(9892),t=L(9271),p=L(80105),x=L(74134),R=L(54044),z=function(W){function i(L,h,l){void 0===h&&(h=null),void 0===l&&(l=!0);var x=W.call(this,L,h)||this;return x._forward=new p.m(0,0,1),x._up=new p.m(0,1,0),x._right=new p.m(1,0,0),x._position=p.m.Zero(),x._rotation=p.m.Zero(),x._rotationQuaternion=null,x._scaling=p.m.One(),x._transformToBoneReferal=null,x._isAbsoluteSynced=!1,x._billboardMode=i.BILLBOARDMODE_NONE,x._preserveParentRotationForBillboard=!1,x.scalingDeterminant=1,x._infiniteDistance=!1,x.ignoreNonUniformScaling=!1,x.reIntegrateRotationIntoRotationQuaternion=!1,x._poseMatrix=null,x._localMatrix=p.d.Zero(),x._usePivotMatrix=!1,x._absolutePosition=p.m.Zero(),x._absoluteScaling=p.m.Zero(),x._absoluteRotationQuaternion=p.g.Identity(),x._pivotMatrix=p.d.Identity(),x._postMultiplyPivotMatrix=!1,x._isWorldMatrixFrozen=!1,x._indexInSceneTransformNodesArray=-1,x.onAfterWorldMatrixUpdateObservable=new t.c,x._nonUniformScaling=!1,l&&x.getScene().addTransformNode(x),x}return(0,h.n)(i,W),Object.defineProperty(i.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(W){this._billboardMode!==W&&(this._billboardMode=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(W){W!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(W){this._infiniteDistance!==W&&(this._infiniteDistance=W)},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(W){this._position=W,this._isDirty=!0},enumerable:!1,configurable:!0}),i.prototype.isUsingPivotMatrix=function(){return this._usePivotMatrix},Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(W){this._rotation=W,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this._scaling},set:function(W){this._scaling=W,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(W){this._rotationQuaternion=W,W&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"forward",{get:function(){return p.m.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"up",{get:function(){return p.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return p.m.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()},enumerable:!1,configurable:!0}),i.prototype.updatePoseMatrix=function(W){return this._poseMatrix?(this._poseMatrix.copyFrom(W),this):(this._poseMatrix=W.clone(),this)},i.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=p.d.Identity()),this._poseMatrix},i.prototype._isSynchronized=function(){var W=this._cache;return this._billboardMode===W.billboardMode&&this._billboardMode===i.BILLBOARDMODE_NONE&&(!W.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))},i.prototype._initCache=function(){W.prototype._initCache.call(this);var i=this._cache;i.localMatrixUpdated=!1,i.billboardMode=-1,i.infiniteDistance=!1},Object.defineProperty(i.prototype,"absolutePosition",{get:function(){return this.getAbsolutePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),i.prototype.setPreTransformMatrix=function(W){return this.setPivotMatrix(W,!1)},i.prototype.setPivotMatrix=function(W,i){return void 0===i&&(i=!0),this._pivotMatrix.copyFrom(W),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=p.d.Invert(this._pivotMatrix)),this},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype.instantiateHierarchy=function(W,i,L){void 0===W&&(W=null);var h=this.clone("Clone of "+(this.name||this.id),W||this.parent,!0);h&&L&&L(this,h);for(var l=0,t=this.getChildTransformNodes(!0);l<t.length;l++){t[l].instantiateHierarchy(h,i,L)}return h},i.prototype.freezeWorldMatrix=function(W,i){return void 0===W&&(W=null),void 0===i&&(i=!1),W?i?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||p.g.Identity(),W.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=W,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},i.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(i.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(W){if(!W)return this;var i,L,h;if(void 0===W.x){if(arguments.length<3)return this;i=arguments[0],L=arguments[1],h=arguments[2]}else i=W.x,L=W.y,h=W.z;if(this.parent){var l=p.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(l),p.m.TransformCoordinatesFromFloatsToRef(i,L,h,l,this.position)}else this.position.x=i,this.position.y=L,this.position.z=h;return this._absolutePosition.copyFrom(W),this},i.prototype.setPositionWithLocalVector=function(W){return this.computeWorldMatrix(),this.position=p.m.TransformNormal(W,this._localMatrix),this},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var W=p.h.Matrix[0];return this._localMatrix.invertToRef(W),p.m.TransformNormal(this.position,W)},i.prototype.locallyTranslate=function(W){return this.computeWorldMatrix(!0),this.position=p.m.TransformCoordinates(W,this._localMatrix),this},i.prototype.lookAt=function(W,L,h,l,t){void 0===L&&(L=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===t&&(t=R.l.LOCAL);var x=i._LookAtVectorCache,z=t===R.l.LOCAL?this.position:this.getAbsolutePosition();if(W.subtractToRef(z,x),this.setDirection(x,L,h,l),t===R.l.WORLD&&this.parent)if(this.rotationQuaternion){var r=p.h.Matrix[0];this.rotationQuaternion.toRotationMatrix(r);var N=p.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.invert(),r.multiplyToRef(N,r),this.rotationQuaternion.fromRotationMatrix(r)}else{var I=p.h.Quaternion[0];p.g.FromEulerVectorToRef(this.rotation,I);r=p.h.Matrix[0];I.toRotationMatrix(r);N=p.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.invert(),r.multiplyToRef(N,r),I.fromRotationMatrix(r),I.toEulerAnglesToRef(this.rotation)}return this},i.prototype.getDirection=function(W){var i=p.m.Zero();return this.getDirectionToRef(W,i),i},i.prototype.getDirectionToRef=function(W,i){return p.m.TransformNormalToRef(W,this.getWorldMatrix(),i),this},i.prototype.setDirection=function(W,i,L,h){void 0===i&&(i=0),void 0===L&&(L=0),void 0===h&&(h=0);var l=-Math.atan2(W.z,W.x)+Math.PI/2,t=Math.sqrt(W.x*W.x+W.z*W.z),x=-Math.atan2(W.y,t);return this.rotationQuaternion?p.g.RotationYawPitchRollToRef(l+i,x+L,h,this.rotationQuaternion):(this.rotation.x=x+L,this.rotation.y=l+i,this.rotation.z=h),this},i.prototype.setPivotPoint=function(W,i){void 0===i&&(i=R.l.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var L=this.getWorldMatrix();if(i==R.l.WORLD){var h=p.h.Matrix[0];L.invertToRef(h),W=p.m.TransformCoordinates(W,h)}return this.setPivotMatrix(p.d.Translation(-W.x,-W.y,-W.z),!0)},i.prototype.getPivotPoint=function(){var W=p.m.Zero();return this.getPivotPointToRef(W),W},i.prototype.getPivotPointToRef=function(W){return W.x=-this._pivotMatrix.m[12],W.y=-this._pivotMatrix.m[13],W.z=-this._pivotMatrix.m[14],this},i.prototype.getAbsolutePivotPoint=function(){var W=p.m.Zero();return this.getAbsolutePivotPointToRef(W),W},i.prototype.getAbsolutePivotPointToRef=function(W){return this.getPivotPointToRef(W),p.m.TransformCoordinatesToRef(W,this.getWorldMatrix(),W),this},i.prototype.markAsDirty=function(i){if(this._children)for(var L=0,h=this._children;L<h.length;L++){h[L].markAsDirty(i)}return W.prototype.markAsDirty.call(this,i)},i.prototype.setParent=function(W,L){if(void 0===L&&(L=!1),!W&&!this.parent)return this;var h=p.h.Quaternion[0],l=p.h.Vector3[0],t=p.h.Vector3[1],x=p.h.Matrix[1];p.d.IdentityToRef(x);var R=p.h.Matrix[0];this.computeWorldMatrix(!0);var z=this.rotationQuaternion;return z||(z=i._TmpRotation,p.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,z)),p.d.ComposeToRef(this.scaling,z,this.position,R),this.parent&&R.multiplyToRef(this.parent.computeWorldMatrix(!0),R),W&&(W.computeWorldMatrix(!0).invertToRef(x),R.multiplyToRef(x,R)),R.decompose(t,h,l,L?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(h):h.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(t),this.position.copyFrom(l),this.parent=W,this},Object.defineProperty(i.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),i.prototype._updateNonUniformScalingState=function(W){return this._nonUniformScaling!==W&&(this._nonUniformScaling=W,!0)},i.prototype.attachToBone=function(W,i){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=i,this.parent=W,W.getSkeleton().prepare(),W.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},i.prototype.detachFromBone=function(W){return void 0===W&&(W=!1),this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=W?this._currentParentWhenAttachingToBone:null,this):(W&&(this.parent=this._currentParentWhenAttachingToBone),this)},i.prototype.rotate=function(W,L,h){var l;if(W.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),h&&h!==R.l.LOCAL){if(this.parent){var t=p.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(t),W=p.m.TransformNormal(W,t)}(l=p.g.RotationAxisToRef(W,L,i._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else l=p.g.RotationAxisToRef(W,L,i._RotationAxisCache),this.rotationQuaternion.multiplyToRef(l,this.rotationQuaternion);return this},i.prototype.rotateAround=function(W,i,L){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=p.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var h=p.h.Vector3[0],l=p.h.Vector3[1],t=p.h.Vector3[2],x=p.h.Quaternion[0],R=p.h.Matrix[0],z=p.h.Matrix[1],r=p.h.Matrix[2],N=p.h.Matrix[3];return W.subtractToRef(this.position,h),p.d.TranslationToRef(h.x,h.y,h.z,R),p.d.TranslationToRef(-h.x,-h.y,-h.z,z),p.d.RotationAxisToRef(i,L,r),z.multiplyToRef(r,N),N.multiplyToRef(R,N),N.decompose(l,x,t),this.position.addInPlace(t),x.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},i.prototype.translate=function(W,i,L){var h=W.scale(i);if(L&&L!==R.l.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(h));else{var l=this.getPositionExpressedInLocalSpace().add(h);this.setPositionWithLocalVector(l)}return this},i.prototype.addRotation=function(W,i,L){var h;this.rotationQuaternion?h=this.rotationQuaternion:(h=p.h.Quaternion[1],p.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,h));var l=p.h.Quaternion[0];return p.g.RotationYawPitchRollToRef(i,W,L,l),h.multiplyInPlace(l),this.rotationQuaternion||h.toEulerAnglesToRef(this.rotation),this},i.prototype._getEffectiveParent=function(){return this.parent},i.prototype.computeWorldMatrix=function(W){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var L=this.getScene().getRenderId();if(!this._isDirty&&!W&&(this._currentRenderId===L||this.isSynchronized()))return this._currentRenderId=L,this._worldMatrix;var h=this.getScene().activeCamera,l=0!==(this._billboardMode&i.BILLBOARDMODE_USE_POSITION),t=this._billboardMode!==i.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;this._updateCache();var x=this._cache;x.pivotMatrixUpdated=!1,x.billboardMode=this.billboardMode,x.infiniteDistance=this.infiniteDistance,x.parent=this._parentNode,this._currentRenderId=L,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var R,z=this._getEffectiveParent(),r=i._TmpScaling,N=this._position;if(this._infiniteDistance&&!this.parent&&h){var I=h.getWorldMatrix(),s=new p.m(I.m[12],I.m[13],I.m[14]);(N=i._TmpTranslation).copyFromFloats(this._position.x+s.x,this._position.y+s.y,this._position.z+s.z)}(r.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion)?(this._rotationQuaternion._isDirty=!1,R=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&(P=this.rotation.lengthSquared())&&(this._rotationQuaternion.multiplyInPlace(p.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(R=i._TmpRotation,p.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,R));if(this._usePivotMatrix){var o=p.h.Matrix[1];p.d.ScalingToRef(r.x,r.y,r.z,o);var D=p.h.Matrix[0];R.toRotationMatrix(D),this._pivotMatrix.multiplyToRef(o,p.h.Matrix[4]),p.h.Matrix[4].multiplyToRef(D,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(N.x,N.y,N.z)}else p.d.ComposeToRef(r,R,N,this._localMatrix);if(z&&z.getWorldMatrix){if(W&&z.computeWorldMatrix(W),t){this._transformToBoneReferal?z.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),p.h.Matrix[7]):p.h.Matrix[7].copyFrom(z.getWorldMatrix());var S=p.h.Vector3[5],C=p.h.Vector3[6];p.h.Matrix[7].decompose(C,void 0,S),p.d.ScalingToRef(C.x,C.y,C.z,p.h.Matrix[7]),p.h.Matrix[7].setTranslation(S),this._localMatrix.multiplyToRef(p.h.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(z.getWorldMatrix(),p.h.Matrix[6]),p.h.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(z.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(t&&h&&this.billboardMode&&!l){var e=p.h.Vector3[0];if(this._worldMatrix.getTranslationToRef(e),p.h.Matrix[1].copyFrom(h.getViewMatrix()),p.h.Matrix[1].setTranslationFromFloats(0,0,0),p.h.Matrix[1].invertToRef(p.h.Matrix[0]),(this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL){p.h.Matrix[0].decompose(void 0,p.h.Quaternion[0],void 0);var V=p.h.Vector3[1];p.h.Quaternion[0].toEulerAnglesToRef(V),(this.billboardMode&i.BILLBOARDMODE_X)!==i.BILLBOARDMODE_X&&(V.x=0),(this.billboardMode&i.BILLBOARDMODE_Y)!==i.BILLBOARDMODE_Y&&(V.y=0),(this.billboardMode&i.BILLBOARDMODE_Z)!==i.BILLBOARDMODE_Z&&(V.z=0),p.d.RotationYawPitchRollToRef(V.y,V.x,V.z,p.h.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(p.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(p.h.Vector3[0])}else if(t&&h&&this.billboardMode&&l){e=p.h.Vector3[0];this._worldMatrix.getTranslationToRef(e);var c=h.globalPosition;this._worldMatrix.invertToRef(p.h.Matrix[1]);var f=p.h.Vector3[1];p.m.TransformCoordinatesToRef(c,p.h.Matrix[1],f),f.normalize();var a=-Math.atan2(f.z,f.x)+Math.PI/2,P=Math.sqrt(f.x*f.x+f.z*f.z),y=-Math.atan2(f.y,P);if(p.g.RotationYawPitchRollToRef(a,y,0,p.h.Quaternion[0]),(this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL){V=p.h.Vector3[1];p.h.Quaternion[0].toEulerAnglesToRef(V),(this.billboardMode&i.BILLBOARDMODE_X)!==i.BILLBOARDMODE_X&&(V.x=0),(this.billboardMode&i.BILLBOARDMODE_Y)!==i.BILLBOARDMODE_Y&&(V.y=0),(this.billboardMode&i.BILLBOARDMODE_Z)!==i.BILLBOARDMODE_Z&&(V.z=0),p.d.RotationYawPitchRollToRef(V.y,V.x,V.z,p.h.Matrix[0])}else p.d.FromQuaternionToRef(p.h.Quaternion[0],p.h.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(p.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(p.h.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):z&&z._nonUniformScaling?this._updateNonUniformScalingState(z._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=p.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},i.prototype.resetLocalMatrix=function(W){if(void 0===W&&(W=!0),this.computeWorldMatrix(),W)for(var i=this.getChildren(),L=0;L<i.length;++L){var h=i[L];if(h){h.computeWorldMatrix();var l=p.h.Matrix[0];h._localMatrix.multiplyToRef(this._localMatrix,l);var t=p.h.Quaternion[0];l.decompose(h.scaling,t,h.position),h.rotationQuaternion?h.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(h.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=p.g.Identity()),this._worldMatrix=p.d.Identity()},i.prototype._afterComputeWorldMatrix=function(){},i.prototype.registerAfterWorldMatrixUpdate=function(W){return this.onAfterWorldMatrixUpdateObservable.add(W),this},i.prototype.unregisterAfterWorldMatrixUpdate=function(W){return this.onAfterWorldMatrixUpdateObservable.removeCallback(W),this},i.prototype.getPositionInCameraSpace=function(W){return void 0===W&&(W=null),W||(W=this.getScene().activeCamera),p.m.TransformCoordinates(this.getAbsolutePosition(),W.getViewMatrix())},i.prototype.getDistanceToCamera=function(W){return void 0===W&&(W=null),W||(W=this.getScene().activeCamera),this.getAbsolutePosition().subtract(W.globalPosition).length()},i.prototype.clone=function(W,L,h){var t=this,p=l.d.Clone((function(){return new i(W,t.getScene())}),this);if(p.name=W,p.id=W,L&&(p.parent=L),!h)for(var x=this.getDescendants(!0),R=0;R<x.length;R++){var z=x[R];z.clone&&z.clone(W+"."+z.name,p)}return p},i.prototype.serialize=function(W){var i=l.d.Serialize(this,W);return i.type=this.getClassName(),i.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(i),i.localMatrix=this.getPivotMatrix().asArray(),i.isEnabled=this.isEnabled(),i},i.Parse=function(W,L,h){var t=l.d.Parse((function(){return new i(W.name,L)}),W,L,h);return W.localMatrix?t.setPreTransformMatrix(p.d.FromArray(W.localMatrix)):W.pivotMatrix&&t.setPivotMatrix(p.d.FromArray(W.pivotMatrix)),t.setEnabled(W.isEnabled),void 0!==W.parentId&&(t._waitingParentId=W.parentId),void 0!==W.parentInstanceIndex&&(t._waitingParentInstanceIndex=W.parentInstanceIndex),t},i.prototype.getChildTransformNodes=function(W,L){var h=[];return this._getDescendants(h,W,(function(W){return(!L||L(W))&&W instanceof i})),h},i.prototype.dispose=function(i,L){if(void 0===L&&(L=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){var h=this._parentContainer.transformNodes.indexOf(this);h>-1&&this._parentContainer.transformNodes.splice(h,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),i)for(var l=0,t=this.getChildTransformNodes(!0);l<t.length;l++){var p=t[l];p.parent=null,p.computeWorldMatrix(!0)}W.prototype.dispose.call(this,i,L)},i.prototype.normalizeToUnitCube=function(W,i,L){void 0===W&&(W=!0),void 0===i&&(i=!1);var h=null,l=null;i&&(this.rotationQuaternion?(l=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(h=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var t=this.getHierarchyBoundingVectors(W,L),p=t.max.subtract(t.min),x=Math.max(p.x,p.y,p.z);if(0===x)return this;var R=1/x;return this.scaling.scaleInPlace(R),i&&(this.rotationQuaternion&&l?this.rotationQuaternion.copyFrom(l):this.rotation&&h&&this.rotation.copyFrom(h)),this},i.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},i.BILLBOARDMODE_NONE=0,i.BILLBOARDMODE_X=1,i.BILLBOARDMODE_Y=2,i.BILLBOARDMODE_Z=4,i.BILLBOARDMODE_ALL=7,i.BILLBOARDMODE_USE_POSITION=128,i._TmpRotation=p.g.Zero(),i._TmpScaling=p.m.Zero(),i._TmpTranslation=p.m.Zero(),i._LookAtVectorCache=new p.m(0,0,0),i._RotationAxisCache=new p.g,(0,h.j)([(0,l.G)("position")],i.prototype,"_position",void 0),(0,h.j)([(0,l.G)("rotation")],i.prototype,"_rotation",void 0),(0,h.j)([(0,l.B)("rotationQuaternion")],i.prototype,"_rotationQuaternion",void 0),(0,h.j)([(0,l.G)("scaling")],i.prototype,"_scaling",void 0),(0,h.j)([(0,l.H)("billboardMode")],i.prototype,"_billboardMode",void 0),(0,h.j)([(0,l.H)()],i.prototype,"scalingDeterminant",void 0),(0,h.j)([(0,l.H)("infiniteDistance")],i.prototype,"_infiniteDistance",void 0),(0,h.j)([(0,l.H)()],i.prototype,"ignoreNonUniformScaling",void 0),(0,h.j)([(0,l.H)()],i.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),i}(x.b)},5344:function(W,i,L){"use strict";L.d(i,{c:function(){return x}});var h=L(70937),l=L(81965),t=L(9217),p=0,x=function(W){if(!W.environmentBRDFTexture){var i=W.useDelayedTextureLoading;W.useDelayedTextureLoading=!1;var L=W._blockEntityCollection;W._blockEntityCollection=!1;var x=h.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+p++,W,!0,!1,h.e.BILINEAR_SAMPLINGMODE);W._blockEntityCollection=L;var R=W.getEngine().getLoadedTexturesCache(),z=R.indexOf(x.getInternalTexture());-1!==z&&R.splice(z,1),x.isRGBD=!0,x.wrapU=h.e.CLAMP_ADDRESSMODE,x.wrapV=h.e.CLAMP_ADDRESSMODE,W.environmentBRDFTexture=x,W.useDelayedTextureLoading=i,l.c.ExpandRGBDTexture(x);var r=W.getEngine().onContextRestoredObservable.add((function(){x.isRGBD=!0;!function W(){x.isReady()?l.c.ExpandRGBDTexture(x):t.h.SetImmediate(W)}()}));W.onDisposeObservable.add((function(){W.getEngine().onContextRestoredObservable.remove(r)}))}return W.environmentBRDFTexture}},61633:function(W,i,L){"use strict";function h(W,i,L){try{var h=W.next();h.done?i(h):h.value?h.value.then((function(){h.value=void 0,i(h)}),L):i(h)}catch(W){L(W)}}function l(W){var i;return void 0===W&&(W=25),function(L,l,t){var p=performance.now();void 0===i||p-i>W?(i=p,setTimeout((function(){h(L,l,t)}),0)):h(L,l,t)}}function t(W,i,L,h,l){!function t(){var p,x=function(W){W.done?L(W.value):void 0===p?p=!0:t()};do{p=void 0,l&&l.aborted?h(new Error("Aborted")):i(W,x,h),void 0===p&&(p=!1)}while(p)}()}function p(W,i){var L;return t(W,h,(function(W){return L=W}),(function(W){throw W}),i),L}function x(W,i,L){return new Promise((function(h,l){t(W,i,h,l,L)}))}function R(W,i){return function(){for(var L=[],h=0;h<arguments.length;h++)L[h]=arguments[h];return p(W.apply(void 0,L),i)}}L.d(i,{d:function(){return l},g:function(){return R},h:function(){return x},k:function(){return p}})},81965:function(W,i,L){"use strict";L.d(i,{c:function(){return s}});var h=L(56965),l=(L(69233),L(84468),L(70937),L(52128),L(40061)),t=L(90690),p=L(16179),x="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}";p.e.ShadersStore.passPixelShader=x;var R="varying vec2 vUV;\nuniform samplerCube textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";p.e.ShadersStore.passCubePixelShader=R;var z=L(31709),r=L(9892),N=function(W){function i(i,L,h,l,t,p,x,R){return void 0===h&&(h=null),void 0===x&&(x=0),void 0===R&&(R=!1),W.call(this,i,"pass",null,null,L,h,l,t,p,void 0,x,void 0,null,R)||this}return(0,l.n)(i,W),i.prototype.getClassName=function(){return"PassPostProcess"},i._Parse=function(W,L,h,l){return r.d.Parse((function(){return new i(W.name,W.options,L,W.renderTargetSamplingMode,W._engine,W.reusable)}),W,h,l)},i}(h.e);(0,z.c)("BABYLON.PassPostProcess",N);!function(W){function i(i,L,h,l,t,p,x,R){void 0===h&&(h=null),void 0===x&&(x=0),void 0===R&&(R=!1);var z=W.call(this,i,"passCube",null,null,L,h,l,t,p,"#define POSITIVEX",x,void 0,null,R)||this;return z._face=0,z}(0,l.n)(i,W),Object.defineProperty(i.prototype,"face",{get:function(){return this._face},set:function(W){if(!(W<0||W>5))switch(this._face=W,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PassCubePostProcess"},i._Parse=function(W,L,h,l){return r.d.Parse((function(){return new i(W.name,W.options,L,W.renderTargetSamplingMode,W._engine,W.reusable)}),W,h,l)}}(h.e);function I(W,i,L,l,t,p){var x=i.getEngine();return i.isReady=!1,t=null!==t&&void 0!==t?t:i.samplingMode,l=null!==l&&void 0!==l?l:i.type,p=null!==p&&void 0!==p?p:i.format,-1===l&&(l=0),new Promise((function(R){var z=new h.e("postprocess",W,null,null,1,null,t,x,!1,void 0,l,void 0,null,!1,p);z.externalTextureSamplerBinding=!0;var r=x.createRenderTargetTexture({width:i.width,height:i.height},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t,type:l,format:p});z.getEffect().executeWhenCompiled((function(){z.onApply=function(W){W._bindTexture("textureSampler",i),W.setFloat2("scale",1,1)},L.postProcessManager.directRender([z],r,!0),x.restoreDefaultFramebuffer(),x._releaseTexture(i),z&&z.dispose(),r._swapAndDie(i),i.type=l,i.format=5,i.isReady=!0,R(i)}))}))}t.c._RescalePostProcessFactory=function(W){return new N("rescale",1,null,2,W,!1,0)};var s=function(){function W(){}return W.ExpandRGBDTexture=function(W){var i=W._texture;if(i&&W.isRGBD){var L=i.getEngine(),l=L.getCaps(),t=i.isReady,p=!1;l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering?(p=!0,i.type=2):l.textureFloatRender&&l.textureFloatLinearFiltering&&(p=!0,i.type=1),p&&(i.isReady=!1,i._isRGBD=!1,i.invertY=!1);var x=function(){if(p){var l=new h.e("rgbdDecode","rgbdDecode",null,null,1,null,3,L,!1,void 0,i.type,void 0,null,!1);l.externalTextureSamplerBinding=!0;var t=L.createRenderTargetTexture(i.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:i.samplingMode,type:i.type,format:5});l.getEffect().executeWhenCompiled((function(){l.onApply=function(W){W._bindTexture("textureSampler",i),W.setFloat2("scale",1,1)},W.getScene().postProcessManager.directRender([l],t,!0),L.restoreDefaultFramebuffer(),L._releaseTexture(i),l&&l.dispose(),t._swapAndDie(i),i.isReady=!0}))}};t?x():W.onLoadObservable.addOnce(x)}},W.EncodeTextureToRGBD=function(W,i,L){return void 0===L&&(L=0),I("rgbdEncode",W,i,L,1,5)},W}()},44811:function(W,i,L){"use strict";L.d(i,{b:function(){return hW}});var h=L(80105),l=L(23016),t=L(51004),p=L(96658),x=function(){function W(){this.direction1=new h.m(0,1,0),this.direction2=new h.m(0,1,0),this.minEmitBox=new h.m(-.5,-.5,-.5),this.maxEmitBox=new h.m(.5,.5,.5)}return W.prototype.startDirectionFunction=function(W,i,L,l){var t=p.d.RandomRange(this.direction1.x,this.direction2.x),x=p.d.RandomRange(this.direction1.y,this.direction2.y),R=p.d.RandomRange(this.direction1.z,this.direction2.z);if(l)return i.x=t,i.y=x,void(i.z=R);h.m.TransformNormalFromFloatsToRef(t,x,R,W,i)},W.prototype.startPositionFunction=function(W,i,L,l){var t=p.d.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),x=p.d.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),R=p.d.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(l)return i.x=t,i.y=x,void(i.z=R);h.m.TransformCoordinatesFromFloatsToRef(t,x,R,W,i)},W.prototype.clone=function(){var i=new W;return t.e.DeepCopy(this,i),i},W.prototype.applyToShader=function(W){W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2),W.setVector3("minEmitBox",this.minEmitBox),W.setVector3("maxEmitBox",this.maxEmitBox)},W.prototype.buildUniformLayout=function(W){W.addUniform("direction1",3),W.addUniform("direction2",3),W.addUniform("minEmitBox",3),W.addUniform("maxEmitBox",3)},W.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},W.prototype.getClassName=function(){return"BoxParticleEmitter"},W.prototype.serialize=function(){var W={};return W.type=this.getClassName(),W.direction1=this.direction1.asArray(),W.direction2=this.direction2.asArray(),W.minEmitBox=this.minEmitBox.asArray(),W.maxEmitBox=this.maxEmitBox.asArray(),W},W.prototype.parse=function(W){h.m.FromArrayToRef(W.direction1,0,this.direction1),h.m.FromArrayToRef(W.direction2,0,this.direction2),h.m.FromArrayToRef(W.minEmitBox,0,this.minEmitBox),h.m.FromArrayToRef(W.maxEmitBox,0,this.maxEmitBox)},W}(),R=function(){function W(W,i,L){void 0===W&&(W=1),void 0===i&&(i=Math.PI),void 0===L&&(L=0),this.directionRandomizer=L,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=i,this.radius=W}return Object.defineProperty(W.prototype,"radius",{get:function(){return this._radius},set:function(W){this._radius=W,this._buildHeight()},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"angle",{get:function(){return this._angle},set:function(W){this._angle=W,this._buildHeight()},enumerable:!1,configurable:!0}),W.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},W.prototype.startDirectionFunction=function(W,i,L,l){l?h.h.Vector3[0].copyFrom(L._localPosition).normalize():L.position.subtractToRef(W.getTranslation(),h.h.Vector3[0]).normalize();var t=p.d.RandomRange(0,this.directionRandomizer),x=p.d.RandomRange(0,this.directionRandomizer),R=p.d.RandomRange(0,this.directionRandomizer);i.x=h.h.Vector3[0].x+t,i.y=h.h.Vector3[0].y+x,i.z=h.h.Vector3[0].z+R,i.normalize()},W.prototype.startPositionFunction=function(W,i,L,l){var t,x=p.d.RandomRange(0,2*Math.PI);t=this.emitFromSpawnPointOnly?1e-4:1-(t=p.d.RandomRange(0,this.heightRange))*t;var R=this._radius-p.d.RandomRange(0,this._radius*this.radiusRange),z=(R*=t)*Math.sin(x),r=R*Math.cos(x),N=t*this._height;if(l)return i.x=z,i.y=N,void(i.z=r);h.m.TransformCoordinatesFromFloatsToRef(z,N,r,W,i)},W.prototype.clone=function(){var i=new W(this._radius,this._angle,this.directionRandomizer);return t.e.DeepCopy(this,i),i},W.prototype.applyToShader=function(W){W.setFloat2("radius",this._radius,this.radiusRange),W.setFloat("coneAngle",this._angle),W.setFloat2("height",this._height,this.heightRange),W.setFloat("directionRandomizer",this.directionRandomizer)},W.prototype.buildUniformLayout=function(W){W.addUniform("radius",2),W.addUniform("coneAngle",1),W.addUniform("height",2),W.addUniform("directionRandomizer",1)},W.prototype.getEffectDefines=function(){var W="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(W+="\n#define CONEEMITTERSPAWNPOINT"),W},W.prototype.getClassName=function(){return"ConeParticleEmitter"},W.prototype.serialize=function(){var W={};return W.type=this.getClassName(),W.radius=this._radius,W.angle=this._angle,W.directionRandomizer=this.directionRandomizer,W.radiusRange=this.radiusRange,W.heightRange=this.heightRange,W.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,W},W.prototype.parse=function(W){this.radius=W.radius,this.angle=W.angle,this.directionRandomizer=W.directionRandomizer,this.radiusRange=void 0!==W.radiusRange?W.radiusRange:1,this.heightRange=void 0!==W.radiusRange?W.heightRange:1,this.emitFromSpawnPointOnly=void 0!==W.emitFromSpawnPointOnly&&W.emitFromSpawnPointOnly},W}(),z=L(40061),r=function(){function W(W,i,L,l){void 0===W&&(W=1),void 0===i&&(i=1),void 0===L&&(L=1),void 0===l&&(l=0),this.radius=W,this.height=i,this.radiusRange=L,this.directionRandomizer=l,this._tempVector=h.m.Zero()}return W.prototype.startDirectionFunction=function(W,i,L,l,t){L.position.subtractToRef(W.getTranslation(),this._tempVector),this._tempVector.normalize(),h.m.TransformNormalToRef(this._tempVector,t,this._tempVector);var x=p.d.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),R=Math.atan2(this._tempVector.x,this._tempVector.z);R+=p.d.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=x,this._tempVector.x=Math.sin(R),this._tempVector.z=Math.cos(R),this._tempVector.normalize(),l?i.copyFrom(this._tempVector):h.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,W,i)},W.prototype.startPositionFunction=function(W,i,L,l){var t=p.d.RandomRange(-this.height/2,this.height/2),x=p.d.RandomRange(0,2*Math.PI),R=p.d.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),z=Math.sqrt(R)*this.radius,r=z*Math.cos(x),N=z*Math.sin(x);l?i.copyFromFloats(r,t,N):h.m.TransformCoordinatesFromFloatsToRef(r,t,N,W,i)},W.prototype.clone=function(){var i=new W(this.radius,this.directionRandomizer);return t.e.DeepCopy(this,i),i},W.prototype.applyToShader=function(W){W.setFloat("radius",this.radius),W.setFloat("height",this.height),W.setFloat("radiusRange",this.radiusRange),W.setFloat("directionRandomizer",this.directionRandomizer)},W.prototype.buildUniformLayout=function(W){W.addUniform("radius",1),W.addUniform("height",1),W.addUniform("radiusRange",1),W.addUniform("directionRandomizer",1)},W.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},W.prototype.getClassName=function(){return"CylinderParticleEmitter"},W.prototype.serialize=function(){var W={};return W.type=this.getClassName(),W.radius=this.radius,W.height=this.height,W.radiusRange=this.radiusRange,W.directionRandomizer=this.directionRandomizer,W},W.prototype.parse=function(W){this.radius=W.radius,this.height=W.height,this.radiusRange=W.radiusRange,this.directionRandomizer=W.directionRandomizer},W}(),N=function(W){function i(i,L,l,t,p){void 0===i&&(i=1),void 0===L&&(L=1),void 0===l&&(l=1),void 0===t&&(t=new h.m(0,1,0)),void 0===p&&(p=new h.m(0,1,0));var x=W.call(this,i,L,l)||this;return x.direction1=t,x.direction2=p,x}return(0,z.n)(i,W),i.prototype.startDirectionFunction=function(W,i){var L=p.d.RandomRange(this.direction1.x,this.direction2.x),l=p.d.RandomRange(this.direction1.y,this.direction2.y),t=p.d.RandomRange(this.direction1.z,this.direction2.z);h.m.TransformNormalFromFloatsToRef(L,l,t,W,i)},i.prototype.clone=function(){var W=new i(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return t.e.DeepCopy(this,W),W},i.prototype.applyToShader=function(W){W.setFloat("radius",this.radius),W.setFloat("height",this.height),W.setFloat("radiusRange",this.radiusRange),W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)},i.prototype.buildUniformLayout=function(W){W.addUniform("radius",1),W.addUniform("height",1),W.addUniform("radiusRange",1),W.addUniform("direction1",3),W.addUniform("direction2",3)},i.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"},i.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},i.prototype.serialize=function(){var i=W.prototype.serialize.call(this);return i.direction1=this.direction1.asArray(),i.direction2=this.direction2.asArray(),i},i.prototype.parse=function(i){W.prototype.parse.call(this,i),this.direction1.copyFrom(i.direction1),this.direction2.copyFrom(i.direction2)},i}(r),I=function(){function W(W,i,L){void 0===W&&(W=1),void 0===i&&(i=1),void 0===L&&(L=0),this.radius=W,this.radiusRange=i,this.directionRandomizer=L}return W.prototype.startDirectionFunction=function(W,i,L,l){var t=L.position.subtract(W.getTranslation()).normalize(),x=p.d.RandomRange(0,this.directionRandomizer),R=p.d.RandomRange(0,this.directionRandomizer),z=p.d.RandomRange(0,this.directionRandomizer);t.x+=x,t.y+=R,t.z+=z,t.normalize(),l?i.copyFrom(t):h.m.TransformNormalFromFloatsToRef(t.x,t.y,t.z,W,i)},W.prototype.startPositionFunction=function(W,i,L,l){var t=this.radius-p.d.RandomRange(0,this.radius*this.radiusRange),x=p.d.RandomRange(0,1),R=p.d.RandomRange(0,2*Math.PI),z=Math.acos(2*x-1),r=t*Math.cos(R)*Math.sin(z),N=t*Math.cos(z),I=t*Math.sin(R)*Math.sin(z);l?i.copyFromFloats(r,Math.abs(N),I):h.m.TransformCoordinatesFromFloatsToRef(r,Math.abs(N),I,W,i)},W.prototype.clone=function(){var i=new W(this.radius,this.directionRandomizer);return t.e.DeepCopy(this,i),i},W.prototype.applyToShader=function(W){W.setFloat("radius",this.radius),W.setFloat("radiusRange",this.radiusRange),W.setFloat("directionRandomizer",this.directionRandomizer)},W.prototype.buildUniformLayout=function(W){W.addUniform("radius",1),W.addUniform("radiusRange",1),W.addUniform("directionRandomizer",1)},W.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},W.prototype.getClassName=function(){return"HemisphericParticleEmitter"},W.prototype.serialize=function(){var W={};return W.type=this.getClassName(),W.radius=this.radius,W.radiusRange=this.radiusRange,W.directionRandomizer=this.directionRandomizer,W},W.prototype.parse=function(W){this.radius=W.radius,this.radiusRange=W.radiusRange,this.directionRandomizer=W.directionRandomizer},W}(),s=function(){function W(){this.direction1=new h.m(0,1,0),this.direction2=new h.m(0,1,0)}return W.prototype.startDirectionFunction=function(W,i,L,l){var t=p.d.RandomRange(this.direction1.x,this.direction2.x),x=p.d.RandomRange(this.direction1.y,this.direction2.y),R=p.d.RandomRange(this.direction1.z,this.direction2.z);l?i.copyFromFloats(t,x,R):h.m.TransformNormalFromFloatsToRef(t,x,R,W,i)},W.prototype.startPositionFunction=function(W,i,L,l){l?i.copyFromFloats(0,0,0):h.m.TransformCoordinatesFromFloatsToRef(0,0,0,W,i)},W.prototype.clone=function(){var i=new W;return t.e.DeepCopy(this,i),i},W.prototype.applyToShader=function(W){W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)},W.prototype.buildUniformLayout=function(W){W.addUniform("direction1",3),W.addUniform("direction2",3)},W.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},W.prototype.getClassName=function(){return"PointParticleEmitter"},W.prototype.serialize=function(){var W={};return W.type=this.getClassName(),W.direction1=this.direction1.asArray(),W.direction2=this.direction2.asArray(),W},W.prototype.parse=function(W){h.m.FromArrayToRef(W.direction1,0,this.direction1),h.m.FromArrayToRef(W.direction2,0,this.direction2)},W}(),o=function(){function W(W,i,L){void 0===W&&(W=1),void 0===i&&(i=1),void 0===L&&(L=0),this.radius=W,this.radiusRange=i,this.directionRandomizer=L}return W.prototype.startDirectionFunction=function(W,i,L,l){var t=L.position.subtract(W.getTranslation()).normalize(),x=p.d.RandomRange(0,this.directionRandomizer),R=p.d.RandomRange(0,this.directionRandomizer),z=p.d.RandomRange(0,this.directionRandomizer);t.x+=x,t.y+=R,t.z+=z,t.normalize(),l?i.copyFrom(t):h.m.TransformNormalFromFloatsToRef(t.x,t.y,t.z,W,i)},W.prototype.startPositionFunction=function(W,i,L,l){var t=this.radius-p.d.RandomRange(0,this.radius*this.radiusRange),x=p.d.RandomRange(0,1),R=p.d.RandomRange(0,2*Math.PI),z=Math.acos(2*x-1),r=t*Math.cos(R)*Math.sin(z),N=t*Math.cos(z),I=t*Math.sin(R)*Math.sin(z);l?i.copyFromFloats(r,N,I):h.m.TransformCoordinatesFromFloatsToRef(r,N,I,W,i)},W.prototype.clone=function(){var i=new W(this.radius,this.directionRandomizer);return t.e.DeepCopy(this,i),i},W.prototype.applyToShader=function(W){W.setFloat("radius",this.radius),W.setFloat("radiusRange",this.radiusRange),W.setFloat("directionRandomizer",this.directionRandomizer)},W.prototype.buildUniformLayout=function(W){W.addUniform("radius",1),W.addUniform("radiusRange",1),W.addUniform("directionRandomizer",1)},W.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},W.prototype.getClassName=function(){return"SphereParticleEmitter"},W.prototype.serialize=function(){var W={};return W.type=this.getClassName(),W.radius=this.radius,W.radiusRange=this.radiusRange,W.directionRandomizer=this.directionRandomizer,W},W.prototype.parse=function(W){this.radius=W.radius,this.radiusRange=W.radiusRange,this.directionRandomizer=W.directionRandomizer},W}(),D=function(W){function i(i,L,l){void 0===i&&(i=1),void 0===L&&(L=new h.m(0,1,0)),void 0===l&&(l=new h.m(0,1,0));var t=W.call(this,i)||this;return t.direction1=L,t.direction2=l,t}return(0,z.n)(i,W),i.prototype.startDirectionFunction=function(W,i){var L=p.d.RandomRange(this.direction1.x,this.direction2.x),l=p.d.RandomRange(this.direction1.y,this.direction2.y),t=p.d.RandomRange(this.direction1.z,this.direction2.z);h.m.TransformNormalFromFloatsToRef(L,l,t,W,i)},i.prototype.clone=function(){var W=new i(this.radius,this.direction1,this.direction2);return t.e.DeepCopy(this,W),W},i.prototype.applyToShader=function(W){W.setFloat("radius",this.radius),W.setFloat("radiusRange",this.radiusRange),W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)},i.prototype.buildUniformLayout=function(W){W.addUniform("radius",1),W.addUniform("radiusRange",1),W.addUniform("direction1",3),W.addUniform("direction2",3)},i.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"},i.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},i.prototype.serialize=function(){var i=W.prototype.serialize.call(this);return i.direction1=this.direction1.asArray(),i.direction2=this.direction2.asArray(),i},i.prototype.parse=function(i){W.prototype.parse.call(this,i),this.direction1.copyFrom(i.direction1),this.direction2.copyFrom(i.direction2)},i}(o),S=function(){function W(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return W.prototype.startDirectionFunction=function(W,i,L,l){var t=h.h.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,L,t);var p=h.h.Vector3[1];t.subtractToRef(L.position,p),p.scaleToRef(1/L.lifeTime,t)}else t.set(0,0,0);l?i.copyFrom(t):h.m.TransformNormalToRef(t,W,i)},W.prototype.startPositionFunction=function(W,i,L,l){var t=h.h.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,L,t):t.set(0,0,0),l?i.copyFrom(t):h.m.TransformCoordinatesToRef(t,W,i)},W.prototype.clone=function(){var i=new W;return t.e.DeepCopy(this,i),i},W.prototype.applyToShader=function(W){},W.prototype.buildUniformLayout=function(W){},W.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},W.prototype.getClassName=function(){return"CustomParticleEmitter"},W.prototype.serialize=function(){var W={};return W.type=this.getClassName(),W},W.prototype.parse=function(W){},W}(),C=L(43251),e=function(){function W(W){void 0===W&&(W=null),this._indices=null,this._positions=null,this._normals=null,this._storedNormal=h.m.Zero(),this._mesh=null,this.direction1=new h.m(0,1,0),this.direction2=new h.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=W}return Object.defineProperty(W.prototype,"mesh",{get:function(){return this._mesh},set:function(W){this._mesh!==W&&(this._mesh=W,W?(this._indices=W.getIndices(),this._positions=W.getVerticesData(C.d.PositionKind),this._normals=W.getVerticesData(C.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))},enumerable:!1,configurable:!0}),W.prototype.startDirectionFunction=function(W,i,L,l){if(this.useMeshNormalsForDirection&&this._normals)h.m.TransformNormalToRef(this._storedNormal,W,i);else{var t=p.d.RandomRange(this.direction1.x,this.direction2.x),x=p.d.RandomRange(this.direction1.y,this.direction2.y),R=p.d.RandomRange(this.direction1.z,this.direction2.z);l?i.copyFromFloats(t,x,R):h.m.TransformNormalFromFloatsToRef(t,x,R,W,i)}},W.prototype.startPositionFunction=function(W,i,L,l){if(this._indices&&this._positions){var t=3*Math.random()*(this._indices.length/3)|0,p=Math.random(),x=Math.random()*(1-p),R=1-p-x,z=this._indices[t],r=this._indices[t+1],N=this._indices[t+2],I=h.h.Vector3[0],s=h.h.Vector3[1],o=h.h.Vector3[2],D=h.h.Vector3[3];h.m.FromArrayToRef(this._positions,3*z,I),h.m.FromArrayToRef(this._positions,3*r,s),h.m.FromArrayToRef(this._positions,3*N,o),D.x=p*I.x+x*s.x+R*o.x,D.y=p*I.y+x*s.y+R*o.y,D.z=p*I.z+x*s.z+R*o.z,l?i.copyFromFloats(D.x,D.y,D.z):h.m.TransformCoordinatesFromFloatsToRef(D.x,D.y,D.z,W,i),this.useMeshNormalsForDirection&&this._normals&&(h.m.FromArrayToRef(this._normals,3*z,I),h.m.FromArrayToRef(this._normals,3*r,s),h.m.FromArrayToRef(this._normals,3*N,o),this._storedNormal.x=p*I.x+x*s.x+R*o.x,this._storedNormal.y=p*I.y+x*s.y+R*o.y,this._storedNormal.z=p*I.z+x*s.z+R*o.z)}},W.prototype.clone=function(){var i=new W(this.mesh);return t.e.DeepCopy(this,i),i},W.prototype.applyToShader=function(W){W.setVector3("direction1",this.direction1),W.setVector3("direction2",this.direction2)},W.prototype.buildUniformLayout=function(W){W.addUniform("direction1",3),W.addUniform("direction2",3)},W.prototype.getEffectDefines=function(){return""},W.prototype.getClassName=function(){return"MeshParticleEmitter"},W.prototype.serialize=function(){var W,i={};return i.type=this.getClassName(),i.direction1=this.direction1.asArray(),i.direction2=this.direction2.asArray(),i.meshId=null===(W=this.mesh)||void 0===W?void 0:W.id,i.useMeshNormalsForDirection=this.useMeshNormalsForDirection,i},W.prototype.parse=function(W,i){h.m.FromArrayToRef(W.direction1,0,this.direction1),h.m.FromArrayToRef(W.direction2,0,this.direction2),W.meshId&&i&&(this.mesh=i.getLastMeshById(W.meshId)),this.useMeshNormalsForDirection=W.useMeshNormalsForDirection},W}(),V=L(9488),c=(L(37855),function(){function W(i){this.animations=[],this.renderingGroupId=0,this.emitter=h.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this._rootUrl="",this.noiseStrength=new h.m(10,10,10),this.onAnimationEnd=null,this.blendMode=W.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new h.k(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new h.m(0,0,0),this.gravity=h.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new V.g(1,1,1,1),this.color2=new V.g(1,1,1,1),this.colorDead=new V.g(0,0,0,1),this.textureMask=new V.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new l.e,this.id=i,this.name=i}return Object.defineProperty(W.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(W){this._noiseTexture!==W&&(this._noiseTexture=W,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(W){this._isAnimationSheetEnabled!=W&&(this._isAnimationSheetEnabled=W,this._reset())},enumerable:!1,configurable:!0}),W.prototype.getScene=function(){return this._scene},W.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},W.prototype.getDragGradients=function(){return this._dragGradients},W.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},W.prototype.getColorGradients=function(){return this._colorGradients},W.prototype.getSizeGradients=function(){return this._sizeGradients},W.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},W.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},W.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},W.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},W.prototype.getVelocityGradients=function(){return this._velocityGradients},W.prototype.getStartSizeGradients=function(){return this._startSizeGradients},W.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(W.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:h.m.Zero()},set:function(W){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:h.m.Zero()},set:function(W){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:h.m.Zero()},set:function(W){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:h.m.Zero()},set:function(W){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(W){this._billboardMode!==W&&(this._billboardMode=W,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(W){this._isBillboardBased!==W&&(this._isBillboardBased=W,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(W){this._attachImageProcessingConfiguration(W)},enumerable:!1,configurable:!0}),W.prototype._attachImageProcessingConfiguration=function(W){W!==this._imageProcessingConfiguration&&(!W&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=W)},W.prototype._reset=function(){},W.prototype._removeGradientAndTexture=function(W,i,L){if(!i)return this;for(var h=0,l=0,t=i;l<t.length;l++){if(t[l].gradient===W){i.splice(h,1);break}h++}return L&&L.dispose(),this},W.prototype.createPointEmitter=function(W,i){var L=new s;return L.direction1=W,L.direction2=i,this.particleEmitterType=L,L},W.prototype.createHemisphericEmitter=function(W,i){void 0===W&&(W=1),void 0===i&&(i=1);var L=new I(W,i);return this.particleEmitterType=L,L},W.prototype.createSphereEmitter=function(W,i){void 0===W&&(W=1),void 0===i&&(i=1);var L=new o(W,i);return this.particleEmitterType=L,L},W.prototype.createDirectedSphereEmitter=function(W,i,L){void 0===W&&(W=1),void 0===i&&(i=new h.m(0,1,0)),void 0===L&&(L=new h.m(0,1,0));var l=new D(W,i,L);return this.particleEmitterType=l,l},W.prototype.createCylinderEmitter=function(W,i,L,h){void 0===W&&(W=1),void 0===i&&(i=1),void 0===L&&(L=1),void 0===h&&(h=0);var l=new r(W,i,L,h);return this.particleEmitterType=l,l},W.prototype.createDirectedCylinderEmitter=function(W,i,L,l,t){void 0===W&&(W=1),void 0===i&&(i=1),void 0===L&&(L=1),void 0===l&&(l=new h.m(0,1,0)),void 0===t&&(t=new h.m(0,1,0));var p=new N(W,i,L,l,t);return this.particleEmitterType=p,p},W.prototype.createConeEmitter=function(W,i){void 0===W&&(W=1),void 0===i&&(i=Math.PI/4);var L=new R(W,i);return this.particleEmitterType=L,L},W.prototype.createBoxEmitter=function(W,i,L,h){var l=new x;return this.particleEmitterType=l,this.direction1=W,this.direction2=i,this.minEmitBox=L,this.maxEmitBox=h,l},W.BLENDMODE_ONEONE=0,W.BLENDMODE_STANDARD=1,W.BLENDMODE_ADD=2,W.BLENDMODE_MULTIPLY=3,W.BLENDMODE_MULTIPLYADD=4,W}()),f=L(90559),a=function(){function W(W){this._isUbo(W)?(this.setMatrix3x3=W.updateMatrix3x3.bind(W),this.setMatrix2x2=W.updateMatrix2x2.bind(W),this.setFloat=W.updateFloat.bind(W),this.setFloat2=W.updateFloat2.bind(W),this.setFloat3=W.updateFloat3.bind(W),this.setFloat4=W.updateFloat4.bind(W),this.setFloatArray=W.updateFloatArray.bind(W),this.setArray=W.updateArray.bind(W),this.setIntArray=W.updateIntArray.bind(W),this.setMatrix=W.updateMatrix.bind(W),this.setMatrices=W.updateMatrices.bind(W),this.setVector3=W.updateVector3.bind(W),this.setVector4=W.updateVector4.bind(W),this.setColor3=W.updateColor3.bind(W),this.setColor4=W.updateColor4.bind(W),this.setDirectColor4=W.updateDirectColor4.bind(W),this.setInt=W.updateInt.bind(W),this.setInt2=W.updateInt2.bind(W),this.setInt3=W.updateInt3.bind(W),this.setInt4=W.updateInt4.bind(W)):(this.setMatrix3x3=W.setMatrix3x3.bind(W),this.setMatrix2x2=W.setMatrix2x2.bind(W),this.setFloat=W.setFloat.bind(W),this.setFloat2=W.setFloat2.bind(W),this.setFloat3=W.setFloat3.bind(W),this.setFloat4=W.setFloat4.bind(W),this.setFloatArray=W.setFloatArray.bind(W),this.setArray=W.setArray.bind(W),this.setIntArray=W.setIntArray.bind(W),this.setMatrix=W.setMatrix.bind(W),this.setMatrices=W.setMatrices.bind(W),this.setVector3=W.setVector3.bind(W),this.setVector4=W.setVector4.bind(W),this.setColor3=W.setColor3.bind(W),this.setColor4=W.setColor4.bind(W),this.setDirectColor4=W.setDirectColor4.bind(W),this.setInt=W.setInt.bind(W),this.setInt2=W.setInt2.bind(W),this.setInt3=W.setInt3.bind(W),this.setInt4=W.setInt4.bind(W))}return W.prototype._isUbo=function(W){return void 0!==W.addUniform},W}(),P=L(31709),y=L(16179),M="#version 300 es\nvoid main() {\ndiscard;\n}\n";y.e.ShadersStore.gpuUpdateParticlesPixelShader=M;var b="#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {\nvec3 newPosition;\nvec3 newDirection;\nvec4 randoms=getRandomVec4(seed.x);\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=newAge-life;\noutSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=vec3(0,0,0);\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\nnewDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\nnewDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nnewPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;\nnewDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));\nnewDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;\nh=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h *height.x;\nnewPosition=vec3(randX,randY,randZ); \nif (abs(cos(coneAngle))==1.0) {\nnewDirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\nnewDirection=normalize(newPosition+directionRandomizer*randoms3); \n}\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;\noutInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);\nnewDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;\nif (cellInfos.w==1.0) {\nratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);\n}\nelse {\nratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);\n}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}";y.e.ShadersStore.gpuUpdateParticlesVertexShader=b;var j=function(){function W(W,i){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=W,this._engine=i,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}return W.prototype.isUpdateBufferCreated=function(){return!!this._updateEffect},W.prototype.isUpdateBufferReady=function(){var W,i;return null!==(i=null===(W=this._updateEffect)||void 0===W?void 0:W.isReady())&&void 0!==i&&i},W.prototype.createUpdateBuffer=function(W){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof S&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=W,this._updateEffect=new f.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new a(this._updateEffect)},W.prototype.createVertexBuffers=function(W,i){this._updateVAO.push(this._createUpdateVAO(W)),this._renderVAO.push(this._engine.recordVertexArrayObject(i,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null)},W.prototype.createParticleBuffer=function(W){return W},W.prototype.bindDrawBuffers=function(W){this._engine.bindVertexArrayObject(this._renderVAO[W],null)},W.prototype.preUpdateParticleBuffer=function(){var W=this._engine;if(this._engine.enableEffect(this._updateEffect),!W.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")},W.prototype.updateParticleBuffer=function(W,i,L){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[W],null);var h=this._engine;h.bindTransformFeedbackBuffer(i.getBuffer()),h.setRasterizerState(!1),h.beginTransformFeedback(!0),h.drawArraysType(3,0,L),h.endTransformFeedback(),h.setRasterizerState(!0),h.bindTransformFeedbackBuffer(null)},W.prototype.releaseBuffers=function(){},W.prototype.releaseVertexBuffers=function(){for(var W=0;W<this._updateVAO.length;W++)this._engine.releaseVertexArrayObject(this._updateVAO[W]);this._updateVAO=[];for(W=0;W<this._renderVAO.length;W++)this._engine.releaseVertexArrayObject(this._renderVAO[W]);this._renderVAO=[]},W.prototype._createUpdateVAO=function(W){var i={};i.position=W.createVertexBuffer("position",0,3);var L=3;i.age=W.createVertexBuffer("age",L,1),L+=1,i.size=W.createVertexBuffer("size",L,3),L+=3,i.life=W.createVertexBuffer("life",L,1),L+=1,i.seed=W.createVertexBuffer("seed",L,4),L+=4,i.direction=W.createVertexBuffer("direction",L,3),L+=3,this._parent.particleEmitterType instanceof S&&(i.initialPosition=W.createVertexBuffer("initialPosition",L,3),L+=3),this._parent._colorGradientsTexture||(i.color=W.createVertexBuffer("color",L,4),L+=4),this._parent._isBillboardBased||(i.initialDirection=W.createVertexBuffer("initialDirection",L,3),L+=3),this._parent.noiseTexture&&(i.noiseCoordinates1=W.createVertexBuffer("noiseCoordinates1",L,3),L+=3,i.noiseCoordinates2=W.createVertexBuffer("noiseCoordinates2",L,3),L+=3),this._parent._angularSpeedGradientsTexture?(i.angle=W.createVertexBuffer("angle",L,1),L+=1):(i.angle=W.createVertexBuffer("angle",L,2),L+=2),this._parent._isAnimationSheetEnabled&&(i.cellIndex=W.createVertexBuffer("cellIndex",L,1),L+=1,this._parent.spriteRandomStartCell&&(i.cellStartOffset=W.createVertexBuffer("cellStartOffset",L,1),L+=1));var h=this._engine.recordVertexArrayObject(i,null,this._updateEffect);return this._engine.bindArrayBuffer(null),h},W}();(0,P.c)("BABYLON.WebGL2ParticleSystem",j);var Z,X=function(){function W(W,i,L){void 0===L&&(L=3),this._engine=W,this._engine._storageBuffers.push(this),this._create(i,L)}return W.prototype._create=function(W,i){this._bufferSize=W,this._creationFlags=i,this._buffer=this._engine.createStorageBuffer(W,i)},W.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},W.prototype.getBuffer=function(){return this._buffer},W.prototype.update=function(W,i,L){this._buffer&&this._engine.updateStorageBuffer(this._buffer,W,i,L)},W.prototype.read=function(W,i,L){return this._engine.readFromStorageBuffer(this._buffer,W,i,L)},W.prototype.dispose=function(){var W=this._engine._storageBuffers,i=W.indexOf(this);-1!==i&&(W[i]=W[W.length-1],W.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null},W}(),T=L(9892),F=L(72284);!function(W){W[W.Texture=0]="Texture",W[W.StorageTexture=1]="StorageTexture",W[W.UniformBuffer=2]="UniformBuffer",W[W.StorageBuffer=3]="StorageBuffer",W[W.TextureWithoutSampler=4]="TextureWithoutSampler",W[W.Sampler=5]="Sampler"}(Z||(Z={})),F.e.prototype.createComputeEffect=function(W,i){throw new Error("createComputeEffect: This engine does not support compute shaders!")},F.e.prototype.createComputePipelineContext=function(){throw new Error("createComputePipelineContext: This engine does not support compute shaders!")},F.e.prototype.createComputeContext=function(){},F.e.prototype.computeDispatch=function(W,i,L,h,l,t,p){throw new Error("computeDispatch: This engine does not support compute shaders!")},F.e.prototype.areAllComputeEffectsReady=function(){return!0},F.e.prototype.releaseComputeEffects=function(){},F.e.prototype._prepareComputePipelineContext=function(W,i,L,h,l){},F.e.prototype._rebuildComputeEffects=function(){},F.e.prototype._executeWhenComputeStateIsCompiled=function(W,i){i()},F.e.prototype._releaseComputeEffect=function(W){},F.e.prototype._deleteComputePipelineContext=function(W){};var q=L(70937),H=L(45934),k=L(9127),U=L(80150),d=function(){function W(W,i,L,h){void 0===h&&(h={}),this._bindings={},this._samplers={},this._contextIsDirty=!1,this.onCompiled=null,this.onError=null,this.name=W,this._engine=i,this.uniqueId=H.b.UniqueId,this._engine.getCaps().supportComputeShaders?h.bindingsMapping?(this._context=i.createComputeContext(),this._shaderPath=L,this._options=(0,z.d)({bindingsMapping:{},defines:[]},h)):k.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):k.e.Error("This engine does not support compute shaders!")}return Object.defineProperty(W.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"shaderPath",{get:function(){return this._shaderPath},enumerable:!1,configurable:!0}),W.prototype.getClassName=function(){return"ComputeShader"},W.prototype.setTexture=function(W,i,L){void 0===L&&(L=!0);var h=this._bindings[W];this._bindings[W]={type:L?Z.Texture:Z.TextureWithoutSampler,object:i,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!h||h.object!==i||h.type!==this._bindings[W].type)},W.prototype.setStorageTexture=function(W,i){var L=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==i),this._bindings[W]={type:Z.StorageTexture,object:i,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}},W.prototype.setUniformBuffer=function(W,i){var L=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==i),this._bindings[W]={type:Z.UniformBuffer,object:i,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}},W.prototype.setStorageBuffer=function(W,i){var L=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!L||L.object!==i),this._bindings[W]={type:Z.StorageBuffer,object:i,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}},W.prototype.setTextureSampler=function(W,i){var L=this._bindings[W];this._contextIsDirty||(this._contextIsDirty=!L||!i.compareSampler(L.object)),this._bindings[W]={type:Z.Sampler,object:i,indexInGroupEntries:null===L||void 0===L?void 0:L.indexInGroupEntries}},W.prototype.isReady=function(){var W=this._effect;for(var i in this._bindings){var L=this._bindings[i],h=L.type,l=L.object;switch(h){case Z.Texture:case Z.TextureWithoutSampler:case Z.StorageTexture:if(!l.isReady())return!1}}var t=[],p=this._shaderPath;if(this._options.defines)for(var x=0;x<this._options.defines.length;x++)t.push(this._options.defines[x]);var R=t.join("\n");return this._cachedDefines!==R&&(this._cachedDefines=R,W=this._engine.createComputeEffect(p,{defines:R,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=W),!!W.isReady()},W.prototype.dispatch=function(W,i,L){var h;if(!this.isReady())return!1;for(var l in this._bindings){var t=this._bindings[l];if(!this._options.bindingsMapping[l])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+l+"'");if(t.type===Z.Texture){var p=this._samplers[l],x=t.object;p&&x._texture&&p.compareSampler(x._texture)||(this._samplers[l]=(new U.c).setParameters(x.wrapU,x.wrapV,x.wrapR,x.anisotropicFilteringLevel,x._texture.samplingMode,null===(h=x._texture)||void 0===h?void 0:h._comparisonFunction),this._contextIsDirty=!0)}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),this._engine.computeDispatch(this._effect,this._context,this._bindings,W,i,L,this._options.bindingsMapping),!0},W.prototype.dispatchWhenReady=function(W,i,L,h){var l=this;return void 0===h&&(h=10),new Promise((function(t){!function p(){l.dispatch(W,i,L)?t():setTimeout(p,h)}()}))},W.prototype.serialize=function(){var W=T.d.Serialize(this);for(var i in W.options=this._options,W.shaderPath=this._shaderPath,W.bindings={},W.textures={},this._bindings){var L=this._bindings[i],h=L.object;switch(L.type){case Z.Texture:case Z.TextureWithoutSampler:case Z.StorageTexture:var l=h.serialize();l&&(W.textures[i]=l,W.bindings[i]={type:L.type});case Z.UniformBuffer:}}return W},W.Parse=function(i,L,h){var l=T.d.Parse((function(){return new W(i.name,L.getEngine(),i.shaderPath,i.options)}),i,L,h);for(var t in i.textures){var p=i.bindings[t],x=q.e.Parse(i.textures[t],L,h);p.type===Z.Texture?l.setTexture(t,x):p.type===Z.TextureWithoutSampler?l.setTexture(t,x,!1):l.setStorageTexture(t,x)}return l},(0,z.j)([(0,T.H)()],W.prototype,"name",void 0),W}();(0,P.c)("BABYLON.ComputeShader",d);var B=L(90534),w="struct Particle {\nposition : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};\nstruct Particles {\nparticles : array<Particle>,\n};\nstruct SimParams {\ncurrentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\ndirectionRandomizer : f32,\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};\n@binding(0) @group(0) var<uniform> params : SimParams;\n@binding(1) @group(0) var<storage,read> particlesIn : Particles;\n@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;\n@binding(3) @group(0) var randomTexture : texture_2d<f32>;\n@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;\n@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;\n@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;\n@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;\n@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;\n@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;\n@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {\nreturn textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;\n}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {\nreturn textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);\n}\n@stage(compute) @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\nlet index : u32=GlobalInvocationID.x;\nlet vertexID : f32=f32(index);\nif (index>=u32(params.currentCount)) {\nreturn;\n}\nlet PI : f32=3.14159;\nlet timeDelta : f32=params.timeDelta;\nlet newAge : f32=particlesIn.particles[index].age+timeDelta;\nlet life : f32=particlesIn.particles[index].life;\nlet seed : vec4<f32>=particlesIn.particles[index].seed;\nlet direction : vec3<f32>=particlesIn.particles[index].direction;\nif (newAge>=life && params.stopFactor != 0.) {\nvar newPosition : vec3<f32>;\nvar newDirection : vec3<f32>;\nlet randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);\nlet outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;\nparticlesOut.particles[index].life=outLife;\nparticlesOut.particles[index].age=newAge-life;\nparticlesOut.particles[index].seed=seed;\nvar sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewPosition=vec3<f32>(0.,0.,0.);\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet phi : f32=2.0*PI*randoms2.x;\nlet theta : f32=acos(-1.0+2.0*randoms2.y);\nlet randX : f32=cos(phi)*sin(theta);\nlet randY : f32=cos(theta);\nlet randZ : f32=sin(phi)*sin(theta);\nnewPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet phi : f32=2.0*PI*randoms2.x;\nlet theta : f32=acos(-1.0+2.0*randoms2.y);\nlet randX : f32=cos(phi)*sin(theta);\nlet randY : f32=cos(theta);\nlet randZ : f32=sin(phi)*sin(theta);\nnewPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nlet yPos : f32=(-0.5+randoms2.x)*params.height;\nvar angle : f32=randoms2.y*PI*2.;\nlet inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);\nlet positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));\nlet xPos : f32=positionRadius*cos(angle);\nlet zPos : f32=positionRadius*sin(angle);\nnewPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;\nnewDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));\nnewDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);\nlet s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;\nh=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;\nlRadius=lRadius*h;\nlet randX : f32=lRadius*sin(s);\nlet randZ : f32=lRadius*cos(s);\nlet randY : f32=h *params.height.x;\nnewPosition=vec3<f32>(randX,randY,randZ); \nif (abs(cos(params.coneAngle))==1.0) {\nnewDirection=vec3<f32>(0.,1.0,0.);\n} else {\nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3); \n}\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;\nparticlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);\nnewDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;\nparticlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {\nvar directionScale : f32=timeDelta;\nparticlesOut.particles[index].age=newAge;\nlet ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;\nparticlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\nlet currentVelocity : f32=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*params.limitVelocityDamping;\n}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;\nlet noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;\nlet fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;\nlet force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;\nparticlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;\nparticlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;\nparticlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\nparticlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;\nparticlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;\nlet dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;\nparticlesOut.particles[index].cellStartOffset=cellStartOffset;\noffsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;\nif (params.cellInfos.w==1.0) {\nratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);\n}\nelse {\nratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);\n}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}\n}\n";y.e.ShadersStoreWGSL.gpuUpdateParticlesComputeShader=w;var g=function(){function W(W,i){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=W,this._engine=i}return W.prototype.isUpdateBufferCreated=function(){return!!this._updateComputeShader},W.prototype.isUpdateBufferReady=function(){var W,i;return null!==(i=null===(W=this._updateComputeShader)||void 0===W?void 0:W.isReady())&&void 0!==i&&i},W.prototype.createUpdateBuffer=function(W){var i,L={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(L.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(L.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(L.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(L.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(L.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(L.noiseTexture={group:1,binding:11}),this._updateComputeShader=new d("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:L,defines:W.split("\n")}),null===(i=this._simParamsComputeShader)||void 0===i||i.dispose(),this._simParamsComputeShader=new B.c(this._engine),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new a(this._simParamsComputeShader)},W.prototype.createVertexBuffers=function(W,i){this._renderVertexBuffers.push(i)},W.prototype.createParticleBuffer=function(W){var i=new X(this._engine,4*W.length,11);return i.update(W),this._bufferComputeShader.push(i),i.getBuffer()},W.prototype.bindDrawBuffers=function(W,i){this._engine.bindBuffers(this._renderVertexBuffers[W],null,i)},W.prototype.preUpdateParticleBuffer=function(){},W.prototype.updateParticleBuffer=function(W,i,L){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[W]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^W]),this._updateComputeShader.dispatch(Math.ceil(L/64))},W.prototype.releaseBuffers=function(){for(var W,i=0;i<this._bufferComputeShader.length;++i)this._bufferComputeShader[i].dispose();this._bufferComputeShader=[],null===(W=this._simParamsComputeShader)||void 0===W||W.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null},W.prototype.releaseVertexBuffers=function(){this._renderVertexBuffers=[]},W}();(0,P.c)("BABYLON.ComputeShaderParticleSystem",g);var n,m=function(){function W(W,i,L){this.gradient=W,this.color1=i,this.color2=L}return W.prototype.getColorToRef=function(W){this.color2?V.g.LerpToRef(this.color1,this.color2,Math.random(),W):W.copyFrom(this.color1)},W}(),E=function(W,i){this.gradient=W,this.color=i},K=function(){function W(W,i,L){this.gradient=W,this.factor1=i,this.factor2=L}return W.prototype.getFactor=function(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},W}(),G=function(){function W(){}return W.GetCurrentGradient=function(W,i,L){if(i[0].gradient>W)L(i[0],i[0],1);else{for(var h=0;h<i.length-1;h++){var l=i[h],t=i[h+1];if(W>=l.gradient&&W<=t.gradient)return void L(l,t,(W-l.gradient)/(t.gradient-l.gradient))}var p=i.length-1;L(i[p],i[p],1)}},W}(),u=L(9271),J=L(15099),A=L(78588),v=function(){function W(i){this.particleSystem=i,this.position=h.m.Zero(),this.direction=h.m.Zero(),this.color=new V.g(0,0,0,0),this.colorStep=new V.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new h.k(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new V.g(0,0,0,0),this._currentColor2=new V.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=W._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}return W.prototype._updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},W.prototype.updateCellIndex=function(){var W=this.age,i=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===i?(i=1,W=this._randomCellOffset):W+=this._randomCellOffset);var L,h=this._initialEndSpriteCellID-this._initialStartSpriteCellID;L=this._initialSpriteCellLoop?p.d.Clamp(W*i%this.lifeTime/this.lifeTime):p.d.Clamp(W*i/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+L*h|0},W.prototype._inheritParticleInfoToSubEmitter=function(W){if(W.particleSystem.emitter.position){var i=W.particleSystem.emitter;if(i.position.copyFrom(this.position),W.inheritDirection){var L=h.h.Vector3[0];this.direction.normalizeToRef(L),i.setDirection(L,0,Math.PI/2)}}else{W.particleSystem.emitter.copyFrom(this.position)}this.direction.scaleToRef(W.inheritedVelocityAmount/2,h.h.Vector3[0]),W.particleSystem._inheritedVelocityOffset.copyFrom(h.h.Vector3[0])},W.prototype._inheritParticleInfoToSubEmitters=function(){var W=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((function(i){W._inheritParticleInfoToSubEmitter(i)}))},W.prototype._reset=function(){this.age=0,this.id=W._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},W.prototype.copyTo=function(W){W.position.copyFrom(this.position),this._initialDirection?W._initialDirection?W._initialDirection.copyFrom(this._initialDirection):W._initialDirection=this._initialDirection.clone():W._initialDirection=null,W.direction.copyFrom(this.direction),this._localPosition&&(W._localPosition?W._localPosition.copyFrom(this._localPosition):W._localPosition=this._localPosition.clone()),W.color.copyFrom(this.color),W.colorStep.copyFrom(this.colorStep),W.lifeTime=this.lifeTime,W.age=this.age,W._randomCellOffset=this._randomCellOffset,W.size=this.size,W.scale.copyFrom(this.scale),W.angle=this.angle,W.angularSpeed=this.angularSpeed,W.particleSystem=this.particleSystem,W.cellIndex=this.cellIndex,W.id=this.id,W._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(W._currentColorGradient=this._currentColorGradient,W._currentColor1.copyFrom(this._currentColor1),W._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(W._currentSizeGradient=this._currentSizeGradient,W._currentSize1=this._currentSize1,W._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(W._currentAngularSpeedGradient=this._currentAngularSpeedGradient,W._currentAngularSpeed1=this._currentAngularSpeed1,W._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(W._currentVelocityGradient=this._currentVelocityGradient,W._currentVelocity1=this._currentVelocity1,W._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(W._currentLimitVelocityGradient=this._currentLimitVelocityGradient,W._currentLimitVelocity1=this._currentLimitVelocity1,W._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(W._currentDragGradient=this._currentDragGradient,W._currentDrag1=this._currentDrag1,W._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(W._initialStartSpriteCellID=this._initialStartSpriteCellID,W._initialEndSpriteCellID=this._initialEndSpriteCellID,W._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(W.remapData&&this.remapData?W.remapData.copyFrom(this.remapData):W.remapData=new h.n(0,0,0,0)),this._randomNoiseCoordinates1&&(W._randomNoiseCoordinates1?(W._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),W._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(W._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),W._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},W._Count=0,W}(),Q=L(50504);!function(W){W[W.ATTACHED=0]="ATTACHED",W[W.END=1]="END"}(n||(n={}));var O=function(){function W(W){if(this.particleSystem=W,this.type=n.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!W.emitter||!W.emitter.dispose){var i=(0,P.b)("BABYLON.AbstractMesh");W.emitter=new i("SubemitterSystemEmitter",W.getScene()),W._disposeEmitterOnDispose=!0}}return W.prototype.clone=function(){var i=this.particleSystem.emitter;if(i){if(i instanceof h.m)i=i.clone();else if(-1!==i.getClassName().indexOf("Mesh")){(i=new((0,P.b)("BABYLON.Mesh"))("",i.getScene())).isVisible=!1}}else i=new h.m;var L=new W(this.particleSystem.clone(this.particleSystem.name,i));return L.particleSystem.name+="Clone",L.type=this.type,L.inheritDirection=this.inheritDirection,L.inheritedVelocityAmount=this.inheritedVelocityAmount,L.particleSystem._disposeEmitterOnDispose=!0,L.particleSystem.disposeOnStop=!0,L},W.prototype.serialize=function(W){void 0===W&&(W=!1);var i={};return i.type=this.type,i.inheritDirection=this.inheritDirection,i.inheritedVelocityAmount=this.inheritedVelocityAmount,i.particleSystem=this.particleSystem.serialize(W),i},W._ParseParticleSystem=function(W,i,L,h){throw void 0===h&&(h=!1),(0,Q.b)("ParseParticle")},W.Parse=function(i,L,h){var l=i.particleSystem,t=new W(W._ParseParticleSystem(l,L,h,!0));return t.type=i.type,t.inheritDirection=i.inheritDirection,t.inheritedVelocityAmount=i.inheritedVelocityAmount,t.particleSystem._isSubEmitter=!0,t},W.prototype.dispose=function(){this.particleSystem.dispose()},W}(),Y=L(61803),WW=(L(76578),L(23598),L(83874),L(68923),L(84098),"varying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}");y.e.ShadersStore.particlesPixelShader=WW;L(49329),L(61906);var iW="attribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvPositionW=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition;\nvPositionW=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;\nvPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvPositionW=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset/particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";y.e.ShadersStore.particlesVertexShader=iW;var LW=L(86018),hW=(L(54980),function(W){function i(i,L,l,t,R,z){void 0===t&&(t=null),void 0===R&&(R=!1),void 0===z&&(z=.01);var r=W.call(this,i)||this;r._emitterInverseWorldMatrix=h.d.Identity(),r._inheritedVelocityOffset=new h.m,r.onDisposeObservable=new u.c,r.onStoppedObservable=new u.c,r._particles=new Array,r._stockParticles=new Array,r._newPartsExcess=0,r._vertexBuffers={},r._scaledColorStep=new V.g(0,0,0,0),r._colorDiff=new V.g(0,0,0,0),r._scaledDirection=h.m.Zero(),r._scaledGravity=h.m.Zero(),r._currentRenderId=-1,r._useInstancing=!1,r._started=!1,r._stopped=!1,r._actualFrame=0,r._currentEmitRate1=0,r._currentEmitRate2=0,r._currentStartSize1=0,r._currentStartSize2=0,r._rawTextureWidth=256,r._useRampGradients=!1,r._disposeEmitterOnDispose=!1,r.isLocal=!1,r._onBeforeDrawParticlesObservable=null,r.recycleParticle=function(W){var i=r._particles.pop();i!==W&&i.copyTo(W),r._stockParticles.push(i)},r._createParticle=function(){var W;if(0!==r._stockParticles.length?(W=r._stockParticles.pop())._reset():W=new v(r),r._subEmitters&&r._subEmitters.length>0){var i=r._subEmitters[Math.floor(Math.random()*r._subEmitters.length)];W._attachedSubEmitters=[],i.forEach((function(i){if(i.type===n.ATTACHED){var L=i.clone();W._attachedSubEmitters.push(L),L.particleSystem.start()}}))}return W},r._emitFromParticle=function(W){if(r._subEmitters&&0!==r._subEmitters.length){var i=Math.floor(Math.random()*r._subEmitters.length);r._subEmitters[i].forEach((function(i){if(i.type===n.END){var L=i.clone();W._inheritParticleInfoToSubEmitter(L),L.particleSystem._rootParticleSystem=r,r.activeSubSystems.push(L.particleSystem),L.particleSystem.start()}}))}},r._capacity=L,r._epsilon=z,r._isAnimationSheetEnabled=R,l&&"Scene"!==l.getClassName()?(r._engine=l,r.defaultProjectionMatrix=h.d.PerspectiveFovLH(.8,1,.1,100,r._engine.isNDCHalfZRange)):(r._scene=l||A.d.LastCreatedScene,r._engine=r._scene.getEngine(),r.uniqueId=r._scene.getUniqueId(),r._scene.particleSystems.push(r)),r._engine.getCaps().vertexArrayObject&&(r._vertexArrayObject=null),r._attachImageProcessingConfiguration(null),r._customWrappers={0:new Y.b(r._engine)},r._customWrappers[0].effect=t,r._drawWrappers=[],r._useInstancing=r._engine.getCaps().instancedArrays,r._createIndexBuffer(),r._createVertexBuffers(),r.particleEmitterType=new x;var N=null;return r.updateFunction=function(W){var i,L=null;r.noiseTexture&&(L=r.noiseTexture.getSize(),null===(i=r.noiseTexture.getContent())||void 0===i||i.then((function(W){N=W})));for(var l,t=function(i){var t=W[i],x=r._scaledUpdateSpeed,R=t.age;if(t.age+=x,t.age>t.lifeTime){var z=t.age-R;x=(t.lifeTime-R)*x/z,t.age=t.lifeTime}var I=t.age/t.lifeTime;r._colorGradients&&r._colorGradients.length>0?G.GetCurrentGradient(I,r._colorGradients,(function(W,i,L){W!==t._currentColorGradient&&(t._currentColor1.copyFrom(t._currentColor2),i.getColorToRef(t._currentColor2),t._currentColorGradient=W),V.g.LerpToRef(t._currentColor1,t._currentColor2,L,t.color)})):(t.colorStep.scaleToRef(x,r._scaledColorStep),t.color.addInPlace(r._scaledColorStep),t.color.a<0&&(t.color.a=0)),r._angularSpeedGradients&&r._angularSpeedGradients.length>0&&G.GetCurrentGradient(I,r._angularSpeedGradients,(function(W,i,L){W!==t._currentAngularSpeedGradient&&(t._currentAngularSpeed1=t._currentAngularSpeed2,t._currentAngularSpeed2=i.getFactor(),t._currentAngularSpeedGradient=W),t.angularSpeed=p.d.Lerp(t._currentAngularSpeed1,t._currentAngularSpeed2,L)})),t.angle+=t.angularSpeed*x;var s=x;if(r._velocityGradients&&r._velocityGradients.length>0&&G.GetCurrentGradient(I,r._velocityGradients,(function(W,i,L){W!==t._currentVelocityGradient&&(t._currentVelocity1=t._currentVelocity2,t._currentVelocity2=i.getFactor(),t._currentVelocityGradient=W),s*=p.d.Lerp(t._currentVelocity1,t._currentVelocity2,L)})),t.direction.scaleToRef(s,r._scaledDirection),r._limitVelocityGradients&&r._limitVelocityGradients.length>0&&G.GetCurrentGradient(I,r._limitVelocityGradients,(function(W,i,L){W!==t._currentLimitVelocityGradient&&(t._currentLimitVelocity1=t._currentLimitVelocity2,t._currentLimitVelocity2=i.getFactor(),t._currentLimitVelocityGradient=W);var h=p.d.Lerp(t._currentLimitVelocity1,t._currentLimitVelocity2,L);t.direction.length()>h&&t.direction.scaleInPlace(r.limitVelocityDamping)})),r._dragGradients&&r._dragGradients.length>0&&G.GetCurrentGradient(I,r._dragGradients,(function(W,i,L){W!==t._currentDragGradient&&(t._currentDrag1=t._currentDrag2,t._currentDrag2=i.getFactor(),t._currentDragGradient=W);var h=p.d.Lerp(t._currentDrag1,t._currentDrag2,L);r._scaledDirection.scaleInPlace(1-h)})),r.isLocal&&t._localPosition?(t._localPosition.addInPlace(r._scaledDirection),h.m.TransformCoordinatesToRef(t._localPosition,r._emitterWorldMatrix,t.position)):t.position.addInPlace(r._scaledDirection),N&&L&&t._randomNoiseCoordinates1){var o=r._fetchR(t._randomNoiseCoordinates1.x,t._randomNoiseCoordinates1.y,L.width,L.height,N),D=r._fetchR(t._randomNoiseCoordinates1.z,t._randomNoiseCoordinates2.x,L.width,L.height,N),S=r._fetchR(t._randomNoiseCoordinates2.y,t._randomNoiseCoordinates2.z,L.width,L.height,N),C=h.h.Vector3[0],e=h.h.Vector3[1];C.copyFromFloats((2*o-1)*r.noiseStrength.x,(2*D-1)*r.noiseStrength.y,(2*S-1)*r.noiseStrength.z),C.scaleToRef(x,e),t.direction.addInPlace(e)}if(r.gravity.scaleToRef(x,r._scaledGravity),t.direction.addInPlace(r._scaledGravity),r._sizeGradients&&r._sizeGradients.length>0&&G.GetCurrentGradient(I,r._sizeGradients,(function(W,i,L){W!==t._currentSizeGradient&&(t._currentSize1=t._currentSize2,t._currentSize2=i.getFactor(),t._currentSizeGradient=W),t.size=p.d.Lerp(t._currentSize1,t._currentSize2,L)})),r._useRampGradients&&(r._colorRemapGradients&&r._colorRemapGradients.length>0&&G.GetCurrentGradient(I,r._colorRemapGradients,(function(W,i,L){var h=p.d.Lerp(W.factor1,i.factor1,L),l=p.d.Lerp(W.factor2,i.factor2,L);t.remapData.x=h,t.remapData.y=l-h})),r._alphaRemapGradients&&r._alphaRemapGradients.length>0&&G.GetCurrentGradient(I,r._alphaRemapGradients,(function(W,i,L){var h=p.d.Lerp(W.factor1,i.factor1,L),l=p.d.Lerp(W.factor2,i.factor2,L);t.remapData.z=h,t.remapData.w=l-h}))),r._isAnimationSheetEnabled&&t.updateCellIndex(),t._inheritParticleInfoToSubEmitters(),t.age>=t.lifeTime)return r._emitFromParticle(t),t._attachedSubEmitters&&(t._attachedSubEmitters.forEach((function(W){W.particleSystem.disposeOnStop=!0,W.particleSystem.stop()})),t._attachedSubEmitters=null),r.recycleParticle(t),i--,l=i,"continue";l=i},x=0;x<W.length;x++)t(x),x=l},r}return(0,z.n)(i,W),Object.defineProperty(i.prototype,"onDispose",{set:function(W){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(W){this._useRampGradients!==W&&(this._useRampGradients=W,this._resetEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"particles",{get:function(){return this._particles},enumerable:!1,configurable:!0}),i.prototype.getActiveCount=function(){return this._particles.length},i.prototype.getClassName=function(){return"ParticleSystem"},i.prototype.isStopping=function(){return this._stopped&&this.isAlive()},i.prototype.getCustomEffect=function(W){var i,L;return void 0===W&&(W=0),null!==(L=null===(i=this._customWrappers[W])||void 0===i?void 0:i.effect)&&void 0!==L?L:this._customWrappers[0].effect},i.prototype._getCustomDrawWrapper=function(W){var i;return void 0===W&&(W=0),null!==(i=this._customWrappers[W])&&void 0!==i?i:this._customWrappers[0]},i.prototype.setCustomEffect=function(W,i){void 0===i&&(i=0),this._customWrappers[i]=new Y.b(this._engine),this._customWrappers[i].effect=W,this._customWrappers[i].drawContext&&(this._customWrappers[i].drawContext.useInstancing=this._useInstancing)},Object.defineProperty(i.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new u.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vertexShaderName",{get:function(){return"particles"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vertexBuffers",{get:function(){return this._vertexBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!1,configurable:!0}),i.prototype._addFactorGradient=function(W,i,L,h){var l=new K(i,L,h);W.push(l),W.sort((function(W,i){return W.gradient<i.gradient?-1:W.gradient>i.gradient?1:0}))},i.prototype._removeFactorGradient=function(W,i){if(W)for(var L=0,h=0,l=W;h<l.length;h++){if(l[h].gradient===i){W.splice(L,1);break}L++}},i.prototype.addLifeTimeGradient=function(W,i,L){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,W,i,L),this},i.prototype.removeLifeTimeGradient=function(W){return this._removeFactorGradient(this._lifeTimeGradients,W),this},i.prototype.addSizeGradient=function(W,i,L){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,W,i,L),this},i.prototype.removeSizeGradient=function(W){return this._removeFactorGradient(this._sizeGradients,W),this},i.prototype.addColorRemapGradient=function(W,i,L){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,W,i,L),this},i.prototype.removeColorRemapGradient=function(W){return this._removeFactorGradient(this._colorRemapGradients,W),this},i.prototype.addAlphaRemapGradient=function(W,i,L){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,W,i,L),this},i.prototype.removeAlphaRemapGradient=function(W){return this._removeFactorGradient(this._alphaRemapGradients,W),this},i.prototype.addAngularSpeedGradient=function(W,i,L){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,W,i,L),this},i.prototype.removeAngularSpeedGradient=function(W){return this._removeFactorGradient(this._angularSpeedGradients,W),this},i.prototype.addVelocityGradient=function(W,i,L){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,W,i,L),this},i.prototype.removeVelocityGradient=function(W){return this._removeFactorGradient(this._velocityGradients,W),this},i.prototype.addLimitVelocityGradient=function(W,i,L){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,W,i,L),this},i.prototype.removeLimitVelocityGradient=function(W){return this._removeFactorGradient(this._limitVelocityGradients,W),this},i.prototype.addDragGradient=function(W,i,L){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,W,i,L),this},i.prototype.removeDragGradient=function(W){return this._removeFactorGradient(this._dragGradients,W),this},i.prototype.addEmitRateGradient=function(W,i,L){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,W,i,L),this},i.prototype.removeEmitRateGradient=function(W){return this._removeFactorGradient(this._emitRateGradients,W),this},i.prototype.addStartSizeGradient=function(W,i,L){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,W,i,L),this},i.prototype.removeStartSizeGradient=function(W){return this._removeFactorGradient(this._startSizeGradients,W),this},i.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture&&this._scene){for(var W=new Uint8Array(4*this._rawTextureWidth),i=V.i.Color3[0],L=function(L){var l=L/h._rawTextureWidth;G.GetCurrentGradient(l,h._rampGradients,(function(h,l,t){V.d.LerpToRef(h.color,l.color,t,i),W[4*L]=255*i.r,W[4*L+1]=255*i.g,W[4*L+2]=255*i.b,W[4*L+3]=255}))},h=this,l=0;l<this._rawTextureWidth;l++)L(l);this._rampGradientsTexture=J.b.CreateRGBATexture(W,this._rawTextureWidth,1,this._scene,!1,!1,1)}},i.prototype.getRampGradients=function(){return this._rampGradients},i.prototype.forceRefreshGradients=function(){this._syncRampGradientTexture()},i.prototype._syncRampGradientTexture=function(){this._rampGradients&&(this._rampGradients.sort((function(W,i){return W.gradient<i.gradient?-1:W.gradient>i.gradient?1:0})),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())},i.prototype.addRampGradient=function(W,i){this._rampGradients||(this._rampGradients=[]);var L=new E(W,i);return this._rampGradients.push(L),this._syncRampGradientTexture(),this},i.prototype.removeRampGradient=function(W){return this._removeGradientAndTexture(W,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},i.prototype.addColorGradient=function(W,i,L){this._colorGradients||(this._colorGradients=[]);var h=new m(W,i,L);return this._colorGradients.push(h),this._colorGradients.sort((function(W,i){return W.gradient<i.gradient?-1:W.gradient>i.gradient?1:0})),this},i.prototype.removeColorGradient=function(W){if(!this._colorGradients)return this;for(var i=0,L=0,h=this._colorGradients;L<h.length;L++){if(h[L].gradient===W){this._colorGradients.splice(i,1);break}i++}return this},i.prototype.resetDrawCache=function(){for(var W=0,i=this._drawWrappers;W<i.length;W++){var L=i[W];if(L)for(var h=0,l=L;h<l.length;h++){var t=l[h];null===t||void 0===t||t.dispose()}}this._drawWrappers=[]},i.prototype._fetchR=function(W,i,L,h,l){return l[4*(((W=.5*Math.abs(W)+.5)*L%L|0)+((i=.5*Math.abs(i)+.5)*h%h|0)*L)]/255},i.prototype._reset=function(){this._resetEffect()},i.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()},i.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==i.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var W=this._engine,L=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*L),this._vertexBuffer=new C.c(W,this._vertexData,!0,L);var h=0,l=this._vertexBuffer.createVertexBuffer(C.d.PositionKind,h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[C.d.PositionKind]=l,h+=3;var t=this._vertexBuffer.createVertexBuffer(C.d.ColorKind,h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[C.d.ColorKind]=t,h+=4;var p=this._vertexBuffer.createVertexBuffer("angle",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=p,h+=1;var x,R=this._vertexBuffer.createVertexBuffer("size",h,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=R,h+=2,this._isAnimationSheetEnabled){var z=this._vertexBuffer.createVertexBuffer("cellIndex",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=z,h+=1}if(!this._isBillboardBased||this.billboardMode===i.BILLBOARDMODE_STRETCHED){var r=this._vertexBuffer.createVertexBuffer("direction",h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=r,h+=3}if(this._useRampGradients){var N=this._vertexBuffer.createVertexBuffer("remapData",h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=N,h+=4}if(this._useInstancing){var I=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new C.c(W,I,!1,2),x=this._spriteBuffer.createVertexBuffer("offset",0,2)}else x=this._vertexBuffer.createVertexBuffer("offset",h,2,this._vertexBufferSize,this._useInstancing),h+=2;this._vertexBuffers.offset=x,this.resetDrawCache()},i.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var W=[],i=0,L=0;L<this._capacity;L++)W.push(i),W.push(i+1),W.push(i+2),W.push(i),W.push(i+2),W.push(i+3),i+=4;this._indexBuffer=this._engine.createIndexBuffer(W)}},i.prototype.getCapacity=function(){return this._capacity},i.prototype.isAlive=function(){return this._alive},i.prototype.isStarted=function(){return this._started},i.prototype._prepareSubEmitterInternalArray=function(){var W=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((function(L){L instanceof i?W._subEmitters.push([new O(L)]):L instanceof O?W._subEmitters.push([L]):L instanceof Array&&W._subEmitters.push(L)}))},i.prototype.start=function(W){var i,L=this;if(void 0===W&&(W=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(W)setTimeout((function(){L.start(0)}),W);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){-1!==(null===(i=this.emitter)||void 0===i?void 0:i.getClassName().indexOf("Mesh"))&&this.emitter.computeWorldMatrix(!0);var h=this.noiseTexture;if(h&&h.onGeneratedObservable)h.onGeneratedObservable.addOnce((function(){setTimeout((function(){for(var W=0;W<L.preWarmCycles;W++)L.animate(!0),h.render()}))}));else for(var l=0;l<this.preWarmCycles;l++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},i.prototype.stop=function(W){void 0===W&&(W=!0),this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,W&&this._stopSubEmitters())},i.prototype.reset=function(){this._stockParticles=[],this._particles=[]},i.prototype._appendParticleVertex=function(W,L,l,t){var p=W*this._vertexBufferSize;if(this._vertexData[p++]=L.position.x+this.worldOffset.x,this._vertexData[p++]=L.position.y+this.worldOffset.y,this._vertexData[p++]=L.position.z+this.worldOffset.z,this._vertexData[p++]=L.color.r,this._vertexData[p++]=L.color.g,this._vertexData[p++]=L.color.b,this._vertexData[p++]=L.color.a,this._vertexData[p++]=L.angle,this._vertexData[p++]=L.scale.x*L.size,this._vertexData[p++]=L.scale.y*L.size,this._isAnimationSheetEnabled&&(this._vertexData[p++]=L.cellIndex),this._isBillboardBased)this.billboardMode===i.BILLBOARDMODE_STRETCHED&&(this._vertexData[p++]=L.direction.x,this._vertexData[p++]=L.direction.y,this._vertexData[p++]=L.direction.z);else if(L._initialDirection){var x=L._initialDirection;this.isLocal&&(h.m.TransformNormalToRef(x,this._emitterWorldMatrix,h.h.Vector3[0]),x=h.h.Vector3[0]),0===x.x&&0===x.z&&(x.x=.001),this._vertexData[p++]=x.x,this._vertexData[p++]=x.y,this._vertexData[p++]=x.z}else{var R=L.direction;this.isLocal&&(h.m.TransformNormalToRef(R,this._emitterWorldMatrix,h.h.Vector3[0]),R=h.h.Vector3[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[p++]=R.x,this._vertexData[p++]=R.y,this._vertexData[p++]=R.z}this._useRampGradients&&L.remapData&&(this._vertexData[p++]=L.remapData.x,this._vertexData[p++]=L.remapData.y,this._vertexData[p++]=L.remapData.z,this._vertexData[p++]=L.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===l?l=this._epsilon:1===l&&(l=1-this._epsilon),0===t?t=this._epsilon:1===t&&(t=1-this._epsilon)),this._vertexData[p++]=l,this._vertexData[p++]=t)},i.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach((function(W){W.stop(!0)})),this.activeSubSystems=new Array)},i.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var W=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==W&&this._rootParticleSystem.activeSubSystems.splice(W,1),this._rootParticleSystem=null}},i.prototype._update=function(W){var i,L=this;if(this._alive=this._particles.length>0,this.emitter.position){var l=this.emitter;this._emitterWorldMatrix=l.getWorldMatrix()}else{var t=this.emitter;this._emitterWorldMatrix=h.d.Translation(t.x,t.y,t.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this._particles);for(var x=function(W){if(R._particles.length===R._capacity)return"break";if(i=R._createParticle(),R._particles.push(i),R.targetStopDuration&&R._lifeTimeGradients&&R._lifeTimeGradients.length>0){var l=p.d.Clamp(R._actualFrame/R.targetStopDuration);G.GetCurrentGradient(l,R._lifeTimeGradients,(function(W,L){var h=W,t=L,x=h.getFactor(),R=t.getFactor(),z=(l-h.gradient)/(t.gradient-h.gradient);i.lifeTime=p.d.Lerp(x,R,z)}))}else i.lifeTime=p.d.RandomRange(R.minLifeTime,R.maxLifeTime);var t=p.d.RandomRange(R.minEmitPower,R.maxEmitPower);if(R.startPositionFunction?R.startPositionFunction(R._emitterWorldMatrix,i.position,i,R.isLocal):R.particleEmitterType.startPositionFunction(R._emitterWorldMatrix,i.position,i,R.isLocal),R.isLocal&&(i._localPosition?i._localPosition.copyFrom(i.position):i._localPosition=i.position.clone(),h.m.TransformCoordinatesToRef(i._localPosition,R._emitterWorldMatrix,i.position)),R.startDirectionFunction?R.startDirectionFunction(R._emitterWorldMatrix,i.direction,i,R.isLocal):R.particleEmitterType.startDirectionFunction(R._emitterWorldMatrix,i.direction,i,R.isLocal,R._emitterInverseWorldMatrix),0===t?i._initialDirection?i._initialDirection.copyFrom(i.direction):i._initialDirection=i.direction.clone():i._initialDirection=null,i.direction.scaleInPlace(t),R._sizeGradients&&0!==R._sizeGradients.length?(i._currentSizeGradient=R._sizeGradients[0],i._currentSize1=i._currentSizeGradient.getFactor(),i.size=i._currentSize1,R._sizeGradients.length>1?i._currentSize2=R._sizeGradients[1].getFactor():i._currentSize2=i._currentSize1):i.size=p.d.RandomRange(R.minSize,R.maxSize),i.scale.copyFromFloats(p.d.RandomRange(R.minScaleX,R.maxScaleX),p.d.RandomRange(R.minScaleY,R.maxScaleY)),R._startSizeGradients&&R._startSizeGradients[0]&&R.targetStopDuration){var x=R._actualFrame/R.targetStopDuration;G.GetCurrentGradient(x,R._startSizeGradients,(function(W,h,l){W!==L._currentStartSizeGradient&&(L._currentStartSize1=L._currentStartSize2,L._currentStartSize2=h.getFactor(),L._currentStartSizeGradient=W);var t=p.d.Lerp(L._currentStartSize1,L._currentStartSize2,l);i.scale.scaleInPlace(t)}))}if(R._angularSpeedGradients&&0!==R._angularSpeedGradients.length?(i._currentAngularSpeedGradient=R._angularSpeedGradients[0],i.angularSpeed=i._currentAngularSpeedGradient.getFactor(),i._currentAngularSpeed1=i.angularSpeed,R._angularSpeedGradients.length>1?i._currentAngularSpeed2=R._angularSpeedGradients[1].getFactor():i._currentAngularSpeed2=i._currentAngularSpeed1):i.angularSpeed=p.d.RandomRange(R.minAngularSpeed,R.maxAngularSpeed),i.angle=p.d.RandomRange(R.minInitialRotation,R.maxInitialRotation),R._velocityGradients&&R._velocityGradients.length>0&&(i._currentVelocityGradient=R._velocityGradients[0],i._currentVelocity1=i._currentVelocityGradient.getFactor(),R._velocityGradients.length>1?i._currentVelocity2=R._velocityGradients[1].getFactor():i._currentVelocity2=i._currentVelocity1),R._limitVelocityGradients&&R._limitVelocityGradients.length>0&&(i._currentLimitVelocityGradient=R._limitVelocityGradients[0],i._currentLimitVelocity1=i._currentLimitVelocityGradient.getFactor(),R._limitVelocityGradients.length>1?i._currentLimitVelocity2=R._limitVelocityGradients[1].getFactor():i._currentLimitVelocity2=i._currentLimitVelocity1),R._dragGradients&&R._dragGradients.length>0&&(i._currentDragGradient=R._dragGradients[0],i._currentDrag1=i._currentDragGradient.getFactor(),R._dragGradients.length>1?i._currentDrag2=R._dragGradients[1].getFactor():i._currentDrag2=i._currentDrag1),R._colorGradients&&0!==R._colorGradients.length)i._currentColorGradient=R._colorGradients[0],i._currentColorGradient.getColorToRef(i.color),i._currentColor1.copyFrom(i.color),R._colorGradients.length>1?R._colorGradients[1].getColorToRef(i._currentColor2):i._currentColor2.copyFrom(i.color);else{var z=p.d.RandomRange(0,1);V.g.LerpToRef(R.color1,R.color2,z,i.color),R.colorDead.subtractToRef(i.color,R._colorDiff),R._colorDiff.scaleToRef(1/i.lifeTime,i.colorStep)}R._isAnimationSheetEnabled&&(i._initialStartSpriteCellID=R.startSpriteCellID,i._initialEndSpriteCellID=R.endSpriteCellID,i._initialSpriteCellLoop=R.spriteCellLoop),i.direction.addInPlace(R._inheritedVelocityOffset),R._useRampGradients&&(i.remapData=new h.n(0,1,0,1)),R.noiseTexture&&(i._randomNoiseCoordinates1?(i._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),i._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(i._randomNoiseCoordinates1=new h.m(Math.random(),Math.random(),Math.random()),i._randomNoiseCoordinates2=new h.m(Math.random(),Math.random(),Math.random()))),i._inheritParticleInfoToSubEmitters()},R=this,z=0;z<W;z++){if("break"===x())break}},i._GetAttributeNamesOrOptions=function(W,i,L){void 0===W&&(W=!1),void 0===i&&(i=!1),void 0===L&&(L=!1);var h=[C.d.PositionKind,C.d.ColorKind,"angle","offset","size"];return W&&h.push("cellIndex"),i||h.push("direction"),L&&h.push("remapData"),h},i._GetEffectCreationOptions=function(W){void 0===W&&(W=!1);var i=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return W&&i.push("particlesInfos"),i},i.prototype.fillDefines=function(W,L){if(this._scene&&(this._scene.clipPlane&&W.push("#define CLIPPLANE"),this._scene.clipPlane2&&W.push("#define CLIPPLANE2"),this._scene.clipPlane3&&W.push("#define CLIPPLANE3"),this._scene.clipPlane4&&W.push("#define CLIPPLANE4"),this._scene.clipPlane5&&W.push("#define CLIPPLANE5"),this._scene.clipPlane6&&W.push("#define CLIPPLANE6")),this._isAnimationSheetEnabled&&W.push("#define ANIMATESHEET"),L===i.BLENDMODE_MULTIPLY&&W.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&W.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(W.push("#define BILLBOARD"),this.billboardMode){case i.BILLBOARDMODE_Y:W.push("#define BILLBOARDY");break;case i.BILLBOARDMODE_STRETCHED:W.push("#define BILLBOARDSTRETCHED");break;case i.BILLBOARDMODE_ALL:W.push("#define BILLBOARDMODE_ALL")}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),W.push(this._imageProcessingConfigurationDefines.toString()))},i.prototype.fillUniformsAttributesAndSamplerNames=function(W,L,h){L.push.apply(L,i._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==i.BILLBOARDMODE_STRETCHED,this._useRampGradients)),W.push.apply(W,i._GetEffectCreationOptions(this._isAnimationSheetEnabled)),h.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&(l.h.PrepareUniforms(W,this._imageProcessingConfigurationDefines),l.h.PrepareSamplers(h,this._imageProcessingConfigurationDefines))},i.prototype._getWrapper=function(W){var i=this._getCustomDrawWrapper(W);if(null===i||void 0===i?void 0:i.effect)return i;var L=[];this.fillDefines(L,W);var h=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0,l=this._drawWrappers[h];l||(l=this._drawWrappers[h]=[]);var t=l[W];t||((t=new Y.b(this._engine)).drawContext&&(t.drawContext.useInstancing=this._useInstancing),l[W]=t);var p=L.join("\n");if(t.defines!==p){var x=[],R=[],z=[];this.fillUniformsAttributesAndSamplerNames(R,x,z),t.setEffect(this._engine.createEffect("particles",x,R,z,p),p)}return t},i.prototype.animate=function(W){var i,L=this;if(void 0===W&&(W=!1),this._started){if(!W&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var h;if(this._scaledUpdateSpeed=this.updateSpeed*(W?this.preWarmStepOffset:(null===(i=this._scene)||void 0===i?void 0:i.getAnimationRatio())||1),this.manualEmitCount>-1)h=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var l=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var t=this._actualFrame/this.targetStopDuration;G.GetCurrentGradient(t,this._emitRateGradients,(function(W,i,h){W!==L._currentEmitRateGradient&&(L._currentEmitRate1=L._currentEmitRate2,L._currentEmitRate2=i.getFactor(),L._currentEmitRateGradient=W),l=p.d.Lerp(L._currentEmitRate1,L._currentEmitRate2,h)}))}h=l*this._scaledUpdateSpeed>>0,this._newPartsExcess+=l*this._scaledUpdateSpeed-h}if(this._newPartsExcess>1&&(h+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?h=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(h),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!W){for(var x=0,R=0;R<this._particles.length;R++){var z=this._particles[R];this._appendParticleVertices(x,z),x+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this._particles.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},i.prototype._appendParticleVertices=function(W,i){this._appendParticleVertex(W++,i,0,0),this._useInstancing||(this._appendParticleVertex(W++,i,1,0),this._appendParticleVertex(W++,i,1,1),this._appendParticleVertex(W++,i,0,1))},i.prototype.rebuild=function(){var W,i;for(var L in this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(W=this._spriteBuffer)||void 0===W||W._rebuild(),null===(i=this._vertexBuffer)||void 0===i||i._rebuild(),this._vertexBuffers)this._vertexBuffers[L]._rebuild();this.resetDrawCache()},i.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==i.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(i.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(i.BLENDMODE_ADD).effect.isReady())return!1}return!0},i.prototype._render=function(W){var L,l,t=this._getWrapper(W),p=t.effect,x=this._engine;x.enableEffect(t);var R=null!==(L=this.defaultViewMatrix)&&void 0!==L?L:this._scene.getViewMatrix();if(p.setTexture("diffuseSampler",this.particleTexture),p.setMatrix("view",R),p.setMatrix("projection",null!==(l=this.defaultProjectionMatrix)&&void 0!==l?l:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var z=this.particleTexture.getBaseSize();p.setFloat3("particlesInfos",this.spriteCellWidth/z.width,this.spriteCellHeight/z.height,this.spriteCellWidth/z.width)}if(p.setVector2("translationPivot",this.translationPivot),p.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){var r=this._scene.activeCamera;p.setVector3("eyePosition",r.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),p.setTexture("rampSampler",this._rampGradientsTexture));var N=p.defines;switch(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&LW.b.BindClipPlane(p,this._scene),N.indexOf("#define BILLBOARDMODE_ALL")>=0&&(R.invertToRef(h.h.Matrix[0]),p.setMatrix("invView",h.h.Matrix[0])),void 0!==this._vertexArrayObject?(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,p)),this._engine.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):x.bindBuffers(this._vertexBuffers,this._indexBuffer,p),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(p),W){case i.BLENDMODE_ADD:x.setAlphaMode(1);break;case i.BLENDMODE_ONEONE:x.setAlphaMode(6);break;case i.BLENDMODE_STANDARD:x.setAlphaMode(2);break;case i.BLENDMODE_MULTIPLY:x.setAlphaMode(4)}return this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(p),this._useInstancing?x.drawArraysType(7,0,4,this._particles.length):x.drawElementsType(0,0,6*this._particles.length),this._particles.length},i.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var W=this._engine;W.setState&&(W.setState(!1),this.forceDepthWrite&&W.setDepthWrite(!0));var L=0;return L=this.blendMode===i.BLENDMODE_MULTIPLYADD?this._render(i.BLENDMODE_MULTIPLY)+this._render(i.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),L},i.prototype.dispose=function(W){if(void 0===W&&(W=!0),this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),W&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),W&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),this._subEmitters&&this._subEmitters.length){for(var i=0;i<this._subEmitters.length;i++)for(var L=0,h=this._subEmitters[i];L<h.length;L++){h[L].dispose()}this._subEmitters=[],this.subEmitters=[]}(this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene)&&((i=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(i,1),this._scene._activeParticleSystems.dispose());this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onStoppedObservable.clear(),this.reset()},i.prototype.clone=function(W,L){var h=(0,z.d)({},this._customWrappers),l=null,t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){var p=(l=this.customShader).shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"",x=t.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,p);h[0]?h[0].effect=x:this.setCustomEffect(x,0)}var R=this.serialize(),r=i.Parse(R,this._scene||this._engine,this._rootUrl);return r.name=W,r.customShader=l,r._customWrappers=h,void 0===L&&(L=this.emitter),this.noiseTexture&&(r.noiseTexture=this.noiseTexture.clone()),r.emitter=L,this.preventAutoStart||r.start(),r},i.prototype.serialize=function(W){void 0===W&&(W=!1);var L={};if(i._Serialize(L,this,W),L.textureMask=this.textureMask.asArray(),L.customShader=this.customShader,L.preventAutoStart=this.preventAutoStart,this.subEmitters){L.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var h=0,l=this._subEmitters;h<l.length;h++){for(var t=[],p=0,x=l[h];p<x.length;p++){var R=x[p];t.push(R.serialize(W))}L.subEmitters.push(t)}}return L},i._Serialize=function(W,i,L){if(W.name=i.name,W.id=i.id,W.capacity=i.getCapacity(),W.disposeOnStop=i.disposeOnStop,W.manualEmitCount=i.manualEmitCount,i.emitter.position){var h=i.emitter;W.emitterId=h.id}else{var l=i.emitter;W.emitter=l.asArray()}i.particleEmitterType&&(W.particleEmitterType=i.particleEmitterType.serialize()),i.particleTexture&&(L?W.texture=i.particleTexture.serialize():(W.textureName=i.particleTexture.name,W.invertY=!!i.particleTexture._invertY)),W.isLocal=i.isLocal,T.d.AppendSerializedAnimations(i,W),W.beginAnimationOnStart=i.beginAnimationOnStart,W.beginAnimationFrom=i.beginAnimationFrom,W.beginAnimationTo=i.beginAnimationTo,W.beginAnimationLoop=i.beginAnimationLoop,W.startDelay=i.startDelay,W.renderingGroupId=i.renderingGroupId,W.isBillboardBased=i.isBillboardBased,W.billboardMode=i.billboardMode,W.minAngularSpeed=i.minAngularSpeed,W.maxAngularSpeed=i.maxAngularSpeed,W.minSize=i.minSize,W.maxSize=i.maxSize,W.minScaleX=i.minScaleX,W.maxScaleX=i.maxScaleX,W.minScaleY=i.minScaleY,W.maxScaleY=i.maxScaleY,W.minEmitPower=i.minEmitPower,W.maxEmitPower=i.maxEmitPower,W.minLifeTime=i.minLifeTime,W.maxLifeTime=i.maxLifeTime,W.emitRate=i.emitRate,W.gravity=i.gravity.asArray(),W.noiseStrength=i.noiseStrength.asArray(),W.color1=i.color1.asArray(),W.color2=i.color2.asArray(),W.colorDead=i.colorDead.asArray(),W.updateSpeed=i.updateSpeed,W.targetStopDuration=i.targetStopDuration,W.blendMode=i.blendMode,W.preWarmCycles=i.preWarmCycles,W.preWarmStepOffset=i.preWarmStepOffset,W.minInitialRotation=i.minInitialRotation,W.maxInitialRotation=i.maxInitialRotation,W.startSpriteCellID=i.startSpriteCellID,W.spriteCellLoop=i.spriteCellLoop,W.endSpriteCellID=i.endSpriteCellID,W.spriteCellChangeSpeed=i.spriteCellChangeSpeed,W.spriteCellWidth=i.spriteCellWidth,W.spriteCellHeight=i.spriteCellHeight,W.spriteRandomStartCell=i.spriteRandomStartCell,W.isAnimationSheetEnabled=i.isAnimationSheetEnabled;var t=i.getColorGradients();if(t){W.colorGradients=[];for(var p=0,x=t;p<x.length;p++){var R=x[p],z={gradient:R.gradient,color1:R.color1.asArray()};R.color2?z.color2=R.color2.asArray():z.color2=R.color1.asArray(),W.colorGradients.push(z)}}var r=i.getRampGradients();if(r){W.rampGradients=[];for(var N=0,I=r;N<I.length;N++){var s=I[N];z={gradient:s.gradient,color:s.color.asArray()};W.rampGradients.push(z)}W.useRampGradients=i.useRampGradients}var o=i.getColorRemapGradients();if(o){W.colorRemapGradients=[];for(var D=0,S=o;D<S.length;D++){var C=S[D];z={gradient:C.gradient,factor1:C.factor1};void 0!==C.factor2?z.factor2=C.factor2:z.factor2=C.factor1,W.colorRemapGradients.push(z)}}var e=i.getAlphaRemapGradients();if(e){W.alphaRemapGradients=[];for(var V=0,c=e;V<c.length;V++){var f=c[V];z={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?z.factor2=f.factor2:z.factor2=f.factor1,W.alphaRemapGradients.push(z)}}var a=i.getSizeGradients();if(a){W.sizeGradients=[];for(var P=0,y=a;P<y.length;P++){var M=y[P];z={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?z.factor2=M.factor2:z.factor2=M.factor1,W.sizeGradients.push(z)}}var b=i.getAngularSpeedGradients();if(b){W.angularSpeedGradients=[];for(var j=0,Z=b;j<Z.length;j++){var X=Z[j];z={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?z.factor2=X.factor2:z.factor2=X.factor1,W.angularSpeedGradients.push(z)}}var F=i.getVelocityGradients();if(F){W.velocityGradients=[];for(var q=0,H=F;q<H.length;q++){var k=H[q];z={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?z.factor2=k.factor2:z.factor2=k.factor1,W.velocityGradients.push(z)}}var U=i.getDragGradients();if(U){W.dragGradients=[];for(var d=0,B=U;d<B.length;d++){var w=B[d];z={gradient:w.gradient,factor1:w.factor1};void 0!==w.factor2?z.factor2=w.factor2:z.factor2=w.factor1,W.dragGradients.push(z)}}var g=i.getEmitRateGradients();if(g){W.emitRateGradients=[];for(var n=0,m=g;n<m.length;n++){var E=m[n];z={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?z.factor2=E.factor2:z.factor2=E.factor1,W.emitRateGradients.push(z)}}var K=i.getStartSizeGradients();if(K){W.startSizeGradients=[];for(var G=0,u=K;G<u.length;G++){var J=u[G];z={gradient:J.gradient,factor1:J.factor1};void 0!==J.factor2?z.factor2=J.factor2:z.factor2=J.factor1,W.startSizeGradients.push(z)}}var A=i.getLifeTimeGradients();if(A){W.lifeTimeGradients=[];for(var v=0,Q=A;v<Q.length;v++){var O=Q[v];z={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?z.factor2=O.factor2:z.factor2=O.factor1,W.lifeTimeGradients.push(z)}}var Y=i.getLimitVelocityGradients();if(Y){W.limitVelocityGradients=[];for(var WW=0,iW=Y;WW<iW.length;WW++){var LW=iW[WW];z={gradient:LW.gradient,factor1:LW.factor1};void 0!==LW.factor2?z.factor2=LW.factor2:z.factor2=LW.factor1,W.limitVelocityGradients.push(z)}W.limitVelocityDamping=i.limitVelocityDamping}i.noiseTexture&&(W.noiseTexture=i.noiseTexture.serialize())},i._Parse=function(W,i,L,l){var t,p,z,S;S=L instanceof F.e?null:L;var C,c=(0,P.b)("BABYLON.Texture");if(c&&S&&(W.texture?i.particleTexture=c.Parse(W.texture,S,l):W.textureName&&(i.particleTexture=new c(l+W.textureName,S,!1,void 0===W.invertY||W.invertY),i.particleTexture.name=W.textureName)),W.emitterId||0===W.emitterId||void 0!==W.emitter?W.emitterId&&S?i.emitter=S.getLastMeshById(W.emitterId):i.emitter=h.m.FromArray(W.emitter):i.emitter=h.m.Zero(),i.isLocal=!!W.isLocal,void 0!==W.renderingGroupId&&(i.renderingGroupId=W.renderingGroupId),void 0!==W.isBillboardBased&&(i.isBillboardBased=W.isBillboardBased),void 0!==W.billboardMode&&(i.billboardMode=W.billboardMode),W.animations){for(var f=0;f<W.animations.length;f++){var a=W.animations[f],y=(0,P.b)("BABYLON.Animation");y&&i.animations.push(y.Parse(a))}i.beginAnimationOnStart=W.beginAnimationOnStart,i.beginAnimationFrom=W.beginAnimationFrom,i.beginAnimationTo=W.beginAnimationTo,i.beginAnimationLoop=W.beginAnimationLoop}if(W.autoAnimate&&S&&S.beginAnimation(i,W.autoAnimateFrom,W.autoAnimateTo,W.autoAnimateLoop,W.autoAnimateSpeed||1),i.startDelay=0|W.startDelay,i.minAngularSpeed=W.minAngularSpeed,i.maxAngularSpeed=W.maxAngularSpeed,i.minSize=W.minSize,i.maxSize=W.maxSize,W.minScaleX&&(i.minScaleX=W.minScaleX,i.maxScaleX=W.maxScaleX,i.minScaleY=W.minScaleY,i.maxScaleY=W.maxScaleY),void 0!==W.preWarmCycles&&(i.preWarmCycles=W.preWarmCycles,i.preWarmStepOffset=W.preWarmStepOffset),void 0!==W.minInitialRotation&&(i.minInitialRotation=W.minInitialRotation,i.maxInitialRotation=W.maxInitialRotation),i.minLifeTime=W.minLifeTime,i.maxLifeTime=W.maxLifeTime,i.minEmitPower=W.minEmitPower,i.maxEmitPower=W.maxEmitPower,i.emitRate=W.emitRate,i.gravity=h.m.FromArray(W.gravity),W.noiseStrength&&(i.noiseStrength=h.m.FromArray(W.noiseStrength)),i.color1=V.g.FromArray(W.color1),i.color2=V.g.FromArray(W.color2),i.colorDead=V.g.FromArray(W.colorDead),i.updateSpeed=W.updateSpeed,i.targetStopDuration=W.targetStopDuration,i.blendMode=W.blendMode,W.colorGradients)for(var M=0,b=W.colorGradients;M<b.length;M++){var j=b[M];i.addColorGradient(j.gradient,V.g.FromArray(j.color1),j.color2?V.g.FromArray(j.color2):void 0)}if(W.rampGradients){for(var Z=0,X=W.rampGradients;Z<X.length;Z++){var T=X[Z];i.addRampGradient(T.gradient,V.d.FromArray(T.color))}i.useRampGradients=W.useRampGradients}if(W.colorRemapGradients)for(var q=0,H=W.colorRemapGradients;q<H.length;q++){var k=H[q];i.addColorRemapGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2)}if(W.alphaRemapGradients)for(var U=0,d=W.alphaRemapGradients;U<d.length;U++){var B=d[U];i.addAlphaRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2)}if(W.sizeGradients)for(var w=0,g=W.sizeGradients;w<g.length;w++){var n=g[w];i.addSizeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2)}if(W.angularSpeedGradients)for(var m=0,E=W.angularSpeedGradients;m<E.length;m++){var K=E[m];i.addAngularSpeedGradient(K.gradient,void 0!==K.factor1?K.factor1:K.factor,K.factor2)}if(W.velocityGradients)for(var G=0,u=W.velocityGradients;G<u.length;G++){var J=u[G];i.addVelocityGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2)}if(W.dragGradients)for(var A=0,v=W.dragGradients;A<v.length;A++){var Q=v[A];i.addDragGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2)}if(W.emitRateGradients)for(var O=0,Y=W.emitRateGradients;O<Y.length;O++){var WW=Y[O];i.addEmitRateGradient(WW.gradient,void 0!==WW.factor1?WW.factor1:WW.factor,WW.factor2)}if(W.startSizeGradients)for(var iW=0,LW=W.startSizeGradients;iW<LW.length;iW++){var hW=LW[iW];i.addStartSizeGradient(hW.gradient,void 0!==hW.factor1?hW.factor1:hW.factor,hW.factor2)}if(W.lifeTimeGradients)for(var lW=0,tW=W.lifeTimeGradients;lW<tW.length;lW++){var pW=tW[lW];i.addLifeTimeGradient(pW.gradient,void 0!==pW.factor1?pW.factor1:pW.factor,pW.factor2)}if(W.limitVelocityGradients){for(var xW=0,RW=W.limitVelocityGradients;xW<RW.length;xW++){var zW=RW[xW];i.addLimitVelocityGradient(zW.gradient,void 0!==zW.factor1?zW.factor1:zW.factor,zW.factor2)}i.limitVelocityDamping=W.limitVelocityDamping}if(W.noiseTexture&&S){var rW=(0,P.b)("BABYLON.ProceduralTexture");i.noiseTexture=rW.Parse(W.noiseTexture,S,l)}if(W.particleEmitterType){switch(W.particleEmitterType.type){case"SphereParticleEmitter":C=new o;break;case"SphereDirectedParticleEmitter":C=new D;break;case"ConeEmitter":case"ConeParticleEmitter":C=new R;break;case"CylinderParticleEmitter":C=new r;break;case"CylinderDirectedParticleEmitter":C=new N;break;case"HemisphericParticleEmitter":C=new I;break;case"PointParticleEmitter":C=new s;break;case"MeshParticleEmitter":C=new e;break;default:C=new x}C.parse(W.particleEmitterType,S)}else(C=new x).parse(W,S);i.particleEmitterType=C,i.startSpriteCellID=W.startSpriteCellID,i.endSpriteCellID=W.endSpriteCellID,i.spriteCellLoop=null===(t=W.spriteCellLoop)||void 0===t||t,i.spriteCellWidth=W.spriteCellWidth,i.spriteCellHeight=W.spriteCellHeight,i.spriteCellChangeSpeed=W.spriteCellChangeSpeed,i.spriteRandomStartCell=W.spriteRandomStartCell,i.disposeOnStop=null!==(p=W.disposeOnStop)&&void 0!==p&&p,i.manualEmitCount=null!==(z=W.manualEmitCount)&&void 0!==z?z:-1},i.Parse=function(W,L,h,l,t){void 0===l&&(l=!1);var p,x=W.name,R=null,z=null;if(p=L instanceof F.e?L:L.getEngine(),W.customShader&&p.createEffectForParticles){var r=(z=W.customShader).shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"";R=p.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,r)}var N=new i(x,t||W.capacity,L,R,W.isAnimationSheetEnabled);if(N.customShader=z,N._rootUrl=h,W.id&&(N.id=W.id),W.subEmitters){N.subEmitters=[];for(var I=0,s=W.subEmitters;I<s.length;I++){for(var o=[],D=0,S=s[I];D<S.length;D++){var C=S[D];o.push(O.Parse(C,L,h))}N.subEmitters.push(o)}}return i._Parse(W,N,L,h),W.textureMask&&(N.textureMask=V.g.FromArray(W.textureMask)),W.preventAutoStart&&(N.preventAutoStart=W.preventAutoStart),l||N.preventAutoStart||N.start(),N},i.BILLBOARDMODE_Y=2,i.BILLBOARDMODE_ALL=7,i.BILLBOARDMODE_STRETCHED=8,i}(c));O._ParseParticleSystem=hW.Parse;var lW=L(33048),tW="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";y.e.IncludesShadersStore.clipPlaneFragmentDeclaration2=tW;var pW="precision highp float;\nuniform sampler2D diffuseSampler;\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\ngl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\ngl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";y.e.ShadersStore.gpuRenderParticlesPixelShader=pW;var xW="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nout float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nout float fClipDistance6;\n#endif\n";y.e.IncludesShadersStore.clipPlaneVertexDeclaration2=xW;var RW="precision highp float;\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\nuniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;\nattribute float age;\nattribute float life;\nattribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nattribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix= mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=(position+worldOffset)-eyePosition;\nyaxis.y=0.;\nvPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=(position+worldOffset)-eyePosition;\nvPositionW=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvPositionW=rotate(yaxis,rotatedCorner);\nvec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n}";y.e.ShadersStore.gpuRenderParticlesVertexShader=RW;var zW=function(W){function i(i,L,l,t,p){void 0===t&&(t=null),void 0===p&&(p=!1);var R=W.call(this,i)||this;if(R.layerMask=268435455,R._accumulatedCount=0,R._targetIndex=0,R._currentRenderId=-1,R._currentRenderingCameraUniqueId=-1,R._started=!1,R._stopped=!1,R._timeDelta=0,R._actualFrame=0,R._rawTextureWidth=256,R.onDisposeObservable=new u.c,R.onStoppedObservable=new u.c,R.forceDepthWrite=!1,R._preWarmDone=!1,R.isLocal=!1,R._onBeforeDrawParticlesObservable=null,l&&"Scene"!==l.getClassName()?(R._engine=l,R.defaultProjectionMatrix=h.d.PerspectiveFovLH(.8,1,.1,100,R._engine.isNDCHalfZRange)):(R._scene=l||A.d.LastCreatedScene,R._engine=R._scene.getEngine(),R.uniqueId=R._scene.getUniqueId(),R._scene.particleSystems.push(R)),R._engine.getCaps().supportComputeShaders){if(!(0,P.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");R._platform=new((0,P.b)("BABYLON.ComputeShaderParticleSystem"))(R,R._engine)}else{if(!(0,P.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");R._platform=new((0,P.b)("BABYLON.WebGL2ParticleSystem"))(R,R._engine)}R._customWrappers={0:new Y.b(R._engine)},R._customWrappers[0].effect=t,R._drawWrappers={0:new Y.b(R._engine)},R._drawWrappers[0].drawContext&&(R._drawWrappers[0].drawContext.useInstancing=!0),R._attachImageProcessingConfiguration(null),(L=null!==L&&void 0!==L?L:{}).randomTextureSize||delete L.randomTextureSize;var r=(0,z.d)({capacity:5e4,randomTextureSize:R._engine.getCaps().maxTextureSize},L),N=L;isFinite(N)&&(r.capacity=N),R._capacity=r.capacity,R._activeCount=r.capacity,R._currentActiveCount=0,R._isAnimationSheetEnabled=p,R.particleEmitterType=new x;for(var I=Math.min(R._engine.getCaps().maxTextureSize,r.randomTextureSize),s=[],o=0;o<I;++o)s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),s.push(Math.random());R._randomTexture=new J.b(new Float32Array(s),I,1,5,l,!1,!1,1,1),R._randomTexture.name="GPUParticleSystem_random1",R._randomTexture.wrapU=1,R._randomTexture.wrapV=1,s=[];for(o=0;o<I;++o)s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),s.push(Math.random());return R._randomTexture2=new J.b(new Float32Array(s),I,1,5,l,!1,!1,1,1),R._randomTexture2.name="GPUParticleSystem_random2",R._randomTexture2.wrapU=1,R._randomTexture2.wrapV=1,R._randomTextureSize=I,R}return(0,z.n)(i,W),Object.defineProperty(i,"IsSupported",{get:function(){if(!A.d.LastCreatedEngine)return!1;var W=A.d.LastCreatedEngine.getCaps();return W.supportTransformFeedbacks||W.supportComputeShaders},enumerable:!1,configurable:!0}),i.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(i.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(W){this._activeCount=Math.min(W,this._capacity)},enumerable:!1,configurable:!0}),i.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==hW.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(hW.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(hW.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)},i.prototype.isStarted=function(){return this._started},i.prototype.isStopped=function(){return this._stopped},i.prototype.isStopping=function(){return!1},i.prototype.getActiveCount=function(){return this._currentActiveCount},i.prototype.start=function(W){var i=this;if(void 0===W&&(W=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";W?setTimeout((function(){i.start(0)}),W):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},i.prototype.stop=function(){this._stopped||(this._stopped=!0)},i.prototype.reset=function(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0},i.prototype.getClassName=function(){return"GPUParticleSystem"},i.prototype.getCustomEffect=function(W){var i,L;return void 0===W&&(W=0),null!==(L=null===(i=this._customWrappers[W])||void 0===i?void 0:i.effect)&&void 0!==L?L:this._customWrappers[0].effect},i.prototype._getCustomDrawWrapper=function(W){var i;return void 0===W&&(W=0),null!==(i=this._customWrappers[W])&&void 0!==i?i:this._customWrappers[0]},i.prototype.setCustomEffect=function(W,i){void 0===i&&(i=0),this._customWrappers[i]=new Y.b(this._engine),this._customWrappers[i].effect=W},Object.defineProperty(i.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new u.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vertexShaderName",{get:function(){return"gpuRenderParticles"},enumerable:!1,configurable:!0}),i.prototype._removeGradientAndTexture=function(i,L,h){return W.prototype._removeGradientAndTexture.call(this,i,L,h),this._releaseBuffers(),this},i.prototype.addColorGradient=function(W,i){this._colorGradients||(this._colorGradients=[]);var L=new m(W,i);return this._colorGradients.push(L),this._refreshColorGradient(!0),this._releaseBuffers(),this},i.prototype._refreshColorGradient=function(W){void 0===W&&(W=!1),this._colorGradients&&(W&&this._colorGradients.sort((function(W,i){return W.gradient<i.gradient?-1:W.gradient>i.gradient?1:0})),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))},i.prototype.forceRefreshGradients=function(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()},i.prototype.removeColorGradient=function(W){return this._removeGradientAndTexture(W,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},i.prototype.resetDrawCache=function(){var W;for(var i in this._drawWrappers){null===(W=this._drawWrappers[i].drawContext)||void 0===W||W.reset()}},i.prototype._addFactorGradient=function(W,i,L){var h=new K(i,L);W.push(h),this._releaseBuffers()},i.prototype.addSizeGradient=function(W,i){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,W,i),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this},i.prototype.removeSizeGradient=function(W){return this._removeGradientAndTexture(W,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},i.prototype._refreshFactorGradient=function(W,i,L){if(void 0===L&&(L=!1),W){L&&W.sort((function(W,i){return W.gradient<i.gradient?-1:W.gradient>i.gradient?1:0}));var h=this;h[i]&&(h[i].dispose(),h[i]=null)}},i.prototype.addAngularSpeedGradient=function(W,i){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,W,i),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this},i.prototype.removeAngularSpeedGradient=function(W){return this._removeGradientAndTexture(W,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},i.prototype.addVelocityGradient=function(W,i){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,W,i),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this},i.prototype.removeVelocityGradient=function(W){return this._removeGradientAndTexture(W,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},i.prototype.addLimitVelocityGradient=function(W,i){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,W,i),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this},i.prototype.removeLimitVelocityGradient=function(W){return this._removeGradientAndTexture(W,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},i.prototype.addDragGradient=function(W,i){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,W,i),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this},i.prototype.removeDragGradient=function(W){return this._removeGradientAndTexture(W,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},i.prototype.addEmitRateGradient=function(){return this},i.prototype.removeEmitRateGradient=function(){return this},i.prototype.addStartSizeGradient=function(){return this},i.prototype.removeStartSizeGradient=function(){return this},i.prototype.addColorRemapGradient=function(){return this},i.prototype.removeColorRemapGradient=function(){return this},i.prototype.addAlphaRemapGradient=function(){return this},i.prototype.removeAlphaRemapGradient=function(){return this},i.prototype.addRampGradient=function(){return this},i.prototype.removeRampGradient=function(){return this},i.prototype.getRampGradients=function(){return null},Object.defineProperty(i.prototype,"useRampGradients",{get:function(){return!1},set:function(W){},enumerable:!1,configurable:!0}),i.prototype.addLifeTimeGradient=function(){return this},i.prototype.removeLifeTimeGradient=function(){return this},i.prototype._reset=function(){this._releaseBuffers()},i.prototype._createVertexBuffers=function(W,i,L){var h={};h.position=i.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var l=3;h.age=i.createVertexBuffer("age",l,1,this._attributesStrideSize,!0),l+=1,h.size=i.createVertexBuffer("size",l,3,this._attributesStrideSize,!0),l+=3,h.life=i.createVertexBuffer("life",l,1,this._attributesStrideSize,!0),l+=1,l+=4,this.billboardMode===hW.BILLBOARDMODE_STRETCHED&&(h.direction=i.createVertexBuffer("direction",l,3,this._attributesStrideSize,!0)),l+=3,this._platform.alignDataInBuffer&&(l+=1),this.particleEmitterType instanceof S&&(l+=3,this._platform.alignDataInBuffer&&(l+=1)),this._colorGradientsTexture||(h.color=i.createVertexBuffer("color",l,4,this._attributesStrideSize,!0),l+=4),this._isBillboardBased||(h.initialDirection=i.createVertexBuffer("initialDirection",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1)),this.noiseTexture&&(h.noiseCoordinates1=i.createVertexBuffer("noiseCoordinates1",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1),h.noiseCoordinates2=i.createVertexBuffer("noiseCoordinates2",l,3,this._attributesStrideSize,!0),l+=3,this._platform.alignDataInBuffer&&(l+=1)),h.angle=i.createVertexBuffer("angle",l,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?l++:l+=2,this._isAnimationSheetEnabled&&(h.cellIndex=i.createVertexBuffer("cellIndex",l,1,this._attributesStrideSize,!0),l+=1,this.spriteRandomStartCell&&(h.cellStartOffset=i.createVertexBuffer("cellStartOffset",l,1,this._attributesStrideSize,!0),l+=1)),h.offset=L.createVertexBuffer("offset",0,2),h.uv=L.createVertexBuffer("uv",2,2),this._platform.createVertexBuffers(W,h),this.resetDrawCache()},i.prototype._initialize=function(W){if(void 0===W&&(W=!1),!this._buffer0||W){var i=this._engine,L=new Array;this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof S&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));for(var l=this.particleEmitterType instanceof S,t=h.h.Vector3[0],p=0,x=0;x<this._capacity;x++)if(L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(0),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),l?(this.particleEmitterType.particleDestinationGenerator(x,null,t),L.push(t.x),L.push(t.y),L.push(t.z)):(L.push(0),L.push(0),L.push(0)),this._platform.alignDataInBuffer&&L.push(0),p+=16,l&&(this.particleEmitterType.particlePositionGenerator(x,null,t),L.push(t.x),L.push(t.y),L.push(t.z),this._platform.alignDataInBuffer&&L.push(0),p+=4),this._colorGradientsTexture||(L.push(0),L.push(0),L.push(0),L.push(0),p+=4),this.isBillboardBased||(L.push(0),L.push(0),L.push(0),this._platform.alignDataInBuffer&&L.push(0),p+=4),this.noiseTexture&&(L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),this._platform.alignDataInBuffer&&L.push(0),L.push(Math.random()),L.push(Math.random()),L.push(Math.random()),this._platform.alignDataInBuffer&&L.push(0),p+=8),L.push(0),p+=1,this._angularSpeedGradientsTexture||(L.push(0),p+=1),this._isAnimationSheetEnabled&&(L.push(0),p+=1,this.spriteRandomStartCell&&(L.push(0),p+=1)),this._platform.alignDataInBuffer){var R=3-(p+3&3);for(p+=R;R-- >0;)L.push(0)}var z=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),r=this._platform.createParticleBuffer(L),N=this._platform.createParticleBuffer(L);this._buffer0=new C.c(i,r,!1,this._attributesStrideSize),this._buffer1=new C.c(i,N,!1,this._attributesStrideSize),this._spriteBuffer=new C.c(i,z,!1,4),this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},i.prototype._recreateUpdateEffect=function(){var W=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(W+="\n#define BILLBOARD"),this._colorGradientsTexture&&(W+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(W+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(W+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(W+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(W+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(W+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(W+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(W+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(W+="\n#define NOISE"),this.isLocal&&(W+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===W||(this._cachedUpdateDefines=W,this._updateBuffer=this._platform.createUpdateBuffer(W))},i.prototype._getWrapper=function(W){var i=this._getCustomDrawWrapper(W);if(null===i||void 0===i?void 0:i.effect)return i;var L=[];this.fillDefines(L,W);var h=this._drawWrappers[W];h||((h=new Y.b(this._engine)).drawContext&&(h.drawContext.useInstancing=!0),this._drawWrappers[W]=h);var l=L.join("\n");if(h.defines!==l){var t=[],p=[],x=[];this.fillUniformsAttributesAndSamplerNames(p,t,x),h.setEffect(this._engine.createEffect("gpuRenderParticles",t,p,x,l),l)}return h},i._GetAttributeNamesOrOptions=function(W,i,L,h){void 0===W&&(W=!1),void 0===i&&(i=!1),void 0===L&&(L=!1),void 0===h&&(h=!1);var l=[C.d.PositionKind,"age","life","size","angle"];return W||l.push(C.d.ColorKind),i&&l.push("cellIndex"),L||l.push("initialDirection"),h||l.push("direction"),l.push("offset",C.d.UVKind),l},i._GetEffectCreationOptions=function(W){void 0===W&&(W=!1);var i=["emitterWM","worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","translationPivot","eyePosition"];return W&&i.push("sheetInfos"),i},i.prototype.fillDefines=function(W,i){if(void 0===i&&(i=0),this._scene&&(this._scene.clipPlane&&W.push("#define CLIPPLANE"),this._scene.clipPlane2&&W.push("#define CLIPPLANE2"),this._scene.clipPlane3&&W.push("#define CLIPPLANE3"),this._scene.clipPlane4&&W.push("#define CLIPPLANE4"),this._scene.clipPlane5&&W.push("#define CLIPPLANE5"),this._scene.clipPlane6&&W.push("#define CLIPPLANE6")),i===hW.BLENDMODE_MULTIPLY&&W.push("#define BLENDMULTIPLYMODE"),this.isLocal&&W.push("#define LOCAL"),this._isBillboardBased)switch(W.push("#define BILLBOARD"),this.billboardMode){case hW.BILLBOARDMODE_Y:W.push("#define BILLBOARDY");break;case hW.BILLBOARDMODE_STRETCHED:W.push("#define BILLBOARDSTRETCHED");break;case hW.BILLBOARDMODE_ALL:W.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&W.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&W.push("#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),W.push(""+this._imageProcessingConfigurationDefines.toString()))},i.prototype.fillUniformsAttributesAndSamplerNames=function(W,L,h){L.push.apply(L,i._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===hW.BILLBOARDMODE_STRETCHED)),W.push.apply(W,i._GetEffectCreationOptions(this._isAnimationSheetEnabled)),h.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(l.h.PrepareUniforms(W,this._imageProcessingConfigurationDefines),l.h.PrepareSamplers(h,this._imageProcessingConfigurationDefines))},i.prototype.animate=function(W){var i;void 0===W&&(W=!1),this._timeDelta=this.updateSpeed*(W?this.preWarmStepOffset:(null===(i=this._scene)||void 0===i?void 0:i.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},i.prototype._createFactorGradientTexture=function(W,i){var L=this[i];if(W&&W.length&&!L){for(var h=new Float32Array(this._rawTextureWidth),l=function(i){var L=i/t._rawTextureWidth;G.GetCurrentGradient(L,W,(function(W,L,l){h[i]=p.d.Lerp(W.factor1,L.factor1,l)}))},t=this,x=0;x<this._rawTextureWidth;x++)l(x);this[i]=J.b.CreateRTexture(h,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1)}},i.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},i.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},i.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},i.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},i.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},i.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var W=new Uint8Array(4*this._rawTextureWidth),i=V.i.Color4[0],L=function(L){var l=L/h._rawTextureWidth;G.GetCurrentGradient(l,h._colorGradients,(function(h,l,t){V.g.LerpToRef(h.color1,l.color1,t,i),W[4*L]=255*i.r,W[4*L+1]=255*i.g,W[4*L+2]=255*i.b,W[4*L+3]=255*i.a}))},h=this,l=0;l<this._rawTextureWidth;l++)L(l);this._colorGradientsTexture=J.b.CreateRGBATexture(W,this._rawTextureWidth,1,this._scene,!1,!1,1)}},i.prototype._render=function(W,i){var L,l,t=this._getWrapper(W),p=t.effect;this._engine.enableEffect(t);var x=(null===(L=this._scene)||void 0===L?void 0:L.getViewMatrix())||h.d.IdentityReadOnly;if(p.setMatrix("view",x),p.setMatrix("projection",null!==(l=this.defaultProjectionMatrix)&&void 0!==l?l:this._scene.getProjectionMatrix()),p.setTexture("diffuseSampler",this.particleTexture),p.setVector2("translationPivot",this.translationPivot),p.setVector3("worldOffset",this.worldOffset),this.isLocal&&p.setMatrix("emitterWM",i),this._colorGradientsTexture?p.setTexture("colorGradientSampler",this._colorGradientsTexture):p.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var R=this.particleTexture.getBaseSize();p.setFloat3("sheetInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,R.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){var z=this._scene.activeCamera;p.setVector3("eyePosition",z.globalPosition)}var r=p.defines;if(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&lW.e.BindClipPlane(p,this._scene),r.indexOf("#define BILLBOARDMODE_ALL")>=0){var N=x.clone();N.invert(),p.setMatrix("invView",N)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(p),W){case hW.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case hW.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case hW.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case hW.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,p),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(p),this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),this._currentActiveCount},i.prototype.render=function(W,i){if(void 0===W&&(W=!1),void 0===i&&(i=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),!this.isReady())return 0;if(!W&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(var L=0;L<this.preWarmCycles;L++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getFrameId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var l=0|this._accumulatedCount;this._accumulatedCount-=l,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+l)}if(!this._currentActiveCount)return 0;var t;if(this.emitter.position){t=this.emitter.getWorldMatrix()}else{var p=this.emitter;t=h.d.Translation(p.x,p.y,p.z)}var x=this._engine;this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",t),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount);var R=0;W||i||(x.setState(!1),this.forceDepthWrite&&x.setDepthWrite(!0),R=this.blendMode===hW.BLENDMODE_MULTIPLYADD?this._render(hW.BLENDMODE_MULTIPLY,t)+this._render(hW.BLENDMODE_ADD,t):this._render(this.blendMode,t),this._engine.setAlphaMode(0)),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var z=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=z,R},i.prototype.rebuild=function(){this._initialize(!0)},i.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()},i.prototype.dispose=function(W){for(var i in void 0===W&&(W=!0),this._drawWrappers){this._drawWrappers[i].dispose()}if(this._drawWrappers={},this._scene){var L=this._scene.particleSystems.indexOf(this);L>-1&&this._scene.particleSystems.splice(L,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),W&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),W&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},i.prototype.clone=function(W,L){var h=(0,z.d)({},this._customWrappers),l=null,t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){var p=(l=this.customShader).shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";h[0]=t.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,p,void 0,void 0,void 0,this)}var x=this.serialize(),R=i.Parse(x,this._scene||this._engine,this._rootUrl);return R.name=W,R.customShader=l,R._customWrappers=h,void 0===L&&(L=this.emitter),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.emitter=L,R},i.prototype.serialize=function(W){void 0===W&&(W=!1);var i={};return hW._Serialize(i,this,W),i.activeParticleCount=this.activeParticleCount,i.randomTextureSize=this._randomTextureSize,i.customShader=this.customShader,i},i.Parse=function(W,L,h,l,t){void 0===l&&(l=!1);var p,x=W.name;p=L instanceof F.e?L:L.getEngine();var R=new i(x,{capacity:t||W.capacity,randomTextureSize:W.randomTextureSize},L,null,W.isAnimationSheetEnabled);if(R._rootUrl=h,W.customShader&&p.createEffectForParticles){var z=W.customShader,r=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"",N=p.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,r,void 0,void 0,void 0,R);R.setCustomEffect(N,0),R.customShader=z}return W.id&&(R.id=W.id),W.activeParticleCount&&(R.activeParticleCount=W.activeParticleCount),hW._Parse(W,R,L,h),W.preventAutoStart&&(R.preventAutoStart=W.preventAutoStart),l||R.preventAutoStart||R.start(),R},i}(c),rW=L(9217),NW=L(71898),IW=L(87683),sW=function(){function W(){this._emitterNodeIsOwned=!0,this.systems=new Array}return Object.defineProperty(W.prototype,"emitterNode",{get:function(){return this._emitterNode},set:function(W){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(var i=0,L=this.systems;i<L.length;i++){L[i].emitter=W}this._emitterNode=W},enumerable:!1,configurable:!0}),W.prototype.setEmitterAsSphere=function(W,i,L){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:W,renderingGroupId:i};var h=(0,NW.b)("emitterSphere",{diameter:W.diameter,segments:W.segments},L);h.renderingGroupId=i;var l=new IW.b("emitterSphereMaterial",L);l.emissiveColor=W.color,h.material=l;for(var t=0,p=this.systems;t<p.length;t++){p[t].emitter=h}this._emitterNode=h},W.prototype.start=function(W){for(var i=0,L=this.systems;i<L.length;i++){var h=L[i];W&&(h.emitter=W),h.start()}},W.prototype.dispose=function(){for(var W=0,i=this.systems;W<i.length;W++){i[W].dispose()}this.systems=[],this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)},W.prototype.serialize=function(W){void 0===W&&(W=!1);for(var i={systems:[]},L=0,h=this.systems;L<h.length;L++){var l=h[L];i.systems.push(l.serialize(W))}return this._emitterNode&&(i.emitter=this._emitterCreationOptions),i},W.Parse=function(i,L,h,l){void 0===h&&(h=!1);var t=new W,p=this.BaseAssetsUrl+"/textures/";L=L||A.d.LastCreatedScene;for(var x=0,R=i.systems;x<R.length;x++){var z=R[x];t.systems.push(h?zW.Parse(z,L,p,!0,l):hW.Parse(z,L,p,!0,l))}if(i.emitter){var r=i.emitter.options;if("Sphere"===i.emitter.kind)t.setEmitterAsSphere({diameter:r.diameter,segments:r.segments,color:V.d.FromArray(r.color)},i.emitter.renderingGroupId,L)}return t},W.BaseAssetsUrl="https://assets.babylonjs.com/particles",W}(),oW=L(67935),DW=(function(){function W(){}W.CreateDefault=function(W,i,L,h){var l;return void 0===i&&(i=500),void 0===h&&(h=!1),(l=h?new zW("default system",{capacity:i},L):new hW("default system",i,L)).emitter=W,l.particleTexture=new q.e("https://assets.babylonjs.com/textures/flare.png",l.getScene()),l.createConeEmitter(.1,Math.PI/4),l.color1=new V.g(1,1,1,1),l.color2=new V.g(1,1,1,1),l.colorDead=new V.g(1,1,1,0),l.minSize=.1,l.maxSize=.1,l.minEmitPower=2,l.maxEmitPower=2,l.updateSpeed=1/60,l.emitRate=30,l},W.CreateAsync=function(i,L,h,l){void 0===h&&(h=!1),L||(L=A.d.LastCreatedScene);var t={};return L._addPendingData(t),new Promise((function(p,x){if(h&&!zW.IsSupported)return L._removePendingData(t),x("Particle system with GPU is not supported.");rW.h.LoadFile("".concat(W.BaseAssetsUrl,"/systems/").concat(i,".json"),(function(W){L._removePendingData(t);var i=JSON.parse(W.toString());return p(sW.Parse(i,L,h,l))}),void 0,void 0,void 0,(function(){return L._removePendingData(t),x("An error occurred with the creation of your particle system. Check if your type '".concat(i,"' exists."))}))}))},W.ExportSet=function(W){for(var i=new sW,L=0,h=W;L<h.length;L++){var l=h[L];i.systems.push(l)}return i},W.ParseFromFileAsync=function(W,i,L,h,l,t){return void 0===h&&(h=!1),void 0===l&&(l=""),new Promise((function(p,x){var R=new oW.d;R.addEventListener("readystatechange",(function(){if(4==R.readyState)if(200==R.status){var i=JSON.parse(R.responseText),z=void 0;z=h?zW.Parse(i,L,l,!1,t):hW.Parse(i,L,l,!1,t),W&&(z.name=W),p(z)}else x("Unable to load the particle system")})),R.open("GET",i),R.send()}))},W.CreateFromSnippetAsync=function(W,i,L,h,l){var t=this;if(void 0===L&&(L=!1),void 0===h&&(h=""),"_BLANK"===W){var p=this.CreateDefault(null);return p.start(),Promise.resolve(p)}return new Promise((function(p,x){var R=new oW.d;R.addEventListener("readystatechange",(function(){if(4==R.readyState)if(200==R.status){var t=JSON.parse(JSON.parse(R.responseText).jsonPayload),z=JSON.parse(t.particleSystem),r=void 0;(r=L?zW.Parse(z,i,h,!1,l):hW.Parse(z,i,h,!1,l)).snippetId=W,p(r)}else x("Unable to load the snippet "+W)})),R.open("GET",t.SnippetUrl+"/"+W.replace(/#/g,"/")),R.send()}))},W.BaseAssetsUrl=sW.BaseAssetsUrl,W.SnippetUrl="https://snippet.babylonjs.com"}(),L(65847)),SW=L(60569),CW=L(90690),eW=L(21693);SW.d.AddParser(eW.e.NAME_PARTICLESYSTEM,(function(W,i,L,h){var l=SW.d.GetIndividualParser(eW.e.NAME_PARTICLESYSTEM);if(l&&void 0!==W.particleSystems&&null!==W.particleSystems)for(var t=0,p=W.particleSystems.length;t<p;t++){var x=W.particleSystems[t];L.particleSystems.push(l(x,i,h))}})),SW.d.AddIndividualParser(eW.e.NAME_PARTICLESYSTEM,(function(W,i,L){return W.activeParticleCount?zW.Parse(W,i,L):hW.Parse(W,i,L)})),CW.c.prototype.createEffectForParticles=function(W,i,L,h,l,t,p,x){var R;void 0===i&&(i=[]),void 0===L&&(L=[]),void 0===h&&(h="");var z=[],r=[],N=[];return x?x.fillUniformsAttributesAndSamplerNames(r,z,N):(z=hW._GetAttributeNamesOrOptions(),r=hW._GetEffectCreationOptions()),-1===h.indexOf(" BILLBOARD")&&(h+="\n#define BILLBOARD\n"),-1===L.indexOf("diffuseSampler")&&L.push("diffuseSampler"),this.createEffect({vertex:null!==(R=null===x||void 0===x?void 0:x.vertexShaderName)&&void 0!==R?R:"particles",fragmentElement:W},z,r.concat(i),N.concat(L),h,l,t,p)},DW.e.prototype.getEmittedParticleSystems=function(){for(var W=new Array,i=0;i<this.getScene().particleSystems.length;i++){var L=this.getScene().particleSystems[i];L.emitter===this&&W.push(L)}return W},DW.e.prototype.getHierarchyEmittedParticleSystems=function(){var W=new Array,i=this.getDescendants();i.push(this);for(var L=0;L<this.getScene().particleSystems.length;L++){var h=this.getScene().particleSystems[L],l=h.emitter;l.position&&-1!==i.indexOf(l)&&W.push(h)}return W};var VW,cW=L(97918),fW=L(70176),aW=L(52644),PW=function(){function W(W,i,L,l,t,p,x,R,z,r){void 0===z&&(z=null),void 0===r&&(r=null),this.idx=0,this.id=0,this.color=new V.g(1,1,1,1),this.position=h.m.Zero(),this.rotation=h.m.Zero(),this.scaling=h.m.One(),this.uvs=new h.n(0,0,1,1),this.velocity=h.m.Zero(),this.pivot=h.m.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.props=null,this.cullingStrategy=aW.e.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=h.m.Zero(),this.idx=W,this.id=i,this._pos=L,this._ind=l,this._model=t,this.shapeId=p,this.idxInShape=x,this._sps=R,z&&(this._modelBoundingInfo=z,this._boundingInfo=new cW.b(z.minimum,z.maximum)),null!==r&&(this.materialIndex=r)}return W.prototype.getBoundingInfo=function(){return this._boundingInfo},Object.defineProperty(W.prototype,"hasBoundingInfo",{get:function(){return null!==this._boundingInfo},enumerable:!1,configurable:!0}),W.prototype.copyToRef=function(W){return W.position.copyFrom(this.position),W.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(W.rotationQuaternion?W.rotationQuaternion.copyFrom(this.rotationQuaternion):W.rotationQuaternion=this.rotationQuaternion.clone()),W.scaling.copyFrom(this.scaling),this.color&&(W.color?W.color.copyFrom(this.color):W.color=this.color.clone()),W.uvs.copyFrom(this.uvs),W.velocity.copyFrom(this.velocity),W.pivot.copyFrom(this.pivot),W.translateFromPivot=this.translateFromPivot,W.alive=this.alive,W.isVisible=this.isVisible,W.parentId=this.parentId,W.cullingStrategy=this.cullingStrategy,null!==this.materialIndex&&(W.materialIndex=this.materialIndex),this},Object.defineProperty(W.prototype,"scale",{get:function(){return this.scaling},set:function(W){this.scaling=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(W){this.rotationQuaternion=W},enumerable:!1,configurable:!0}),W.prototype.intersectsMesh=function(W){return!(!this._boundingInfo||!W.hasBoundingInfo)&&(this._sps._bSphereOnly?fW.d.Intersects(this._boundingInfo.boundingSphere,W.getBoundingInfo().boundingSphere):this._boundingInfo.intersects(W.getBoundingInfo(),!1))},W.prototype.isInFrustum=function(W){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(W,this.cullingStrategy)},W.prototype.getRotationMatrix=function(W){var i;if(this.rotationQuaternion)i=this.rotationQuaternion;else{i=h.h.Quaternion[0];var L=this.rotation;h.g.RotationYawPitchRollToRef(L.y,L.x,L.z,i)}i.toRotationMatrix(W)},W}(),yW=function(){function W(W,i,L,h,l,t,p,x,R){this._indicesLength=0,this.shapeId=W,this._shape=i,this._indices=L,this._indicesLength=L.length,this._shapeUV=t,this._shapeColors=l,this._normals=h,this._positionFunction=p,this._vertexFunction=x,this._material=R}return Object.defineProperty(W.prototype,"shapeID",{get:function(){return this.shapeId},set:function(W){this.shapeId=W},enumerable:!1,configurable:!0}),W}(),MW=function(W,i,L,h){this.idx=0,this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.idx=W,this.ind=i,this.indicesLength=L,this.materialIndex=h},bW=function(){function W(){this.position=h.m.Zero(),this.color=new V.g(1,1,1,1),this.uv=h.k.Zero()}return Object.defineProperty(W.prototype,"x",{get:function(){return this.position.x},set:function(W){this.position.x=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"y",{get:function(){return this.position.y},set:function(W){this.position.y=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"z",{get:function(){return this.position.z},set:function(W){this.position.z=W},enumerable:!1,configurable:!0}),W}(),jW=L(85779),ZW=L(60612),XW=L(54044),TW=L(50384),FW=L(49443),qW=(function(){function W(W,i,L){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new PW(0,0,0,0,null,0,0,this),this._color=new V.g(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(W,i){return i.sqDistance-W.sqDistance},this._materialSortFunction=function(W,i){return W.materialIndex-i.materialIndex},this._autoUpdateSubMeshes=!1,this.name=W,this._scene=i||A.d.LastCreatedScene,this._camera=i.activeCamera,this._pickable=!!L&&L.isPickable,this._depthSort=!!L&&L.enableDepthSort,this._multimaterialEnabled=!!L&&L.enableMultiMaterial,this._useModelMaterial=!!L&&L.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!L&&L.expandable,this._particlesIntersect=!!L&&L.particleIntersection,this._bSphereOnly=!!L&&L.boundingSphereOnly,this._bSphereRadiusFactor=L&&L.bSphereRadiusFactor?L.bSphereRadiusFactor:1,L&&void 0!==L.updatable?this._updatable=L.updatable:this._updatable=!0,this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new FW.d(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={}),this._tmpVertex=new bW}W.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){var W=(0,ZW.c)("",{radius:1,tessellation:3},this._scene);this.addShape(W,1),W.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var i=new DW.e(this.name,this._scene);this.mesh=i}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&jW.e.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var L=new jW.e;if(L.indices=this._depthSort?this._indices:this._indices32,L.set(this._positions32,C.d.PositionKind),L.set(this._normals32,C.d.NormalKind),this._uvs32.length>0&&L.set(this._uvs32,C.d.UVKind),this._colors32.length>0&&L.set(this._colors32,C.d.ColorKind),L.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._pickable)for(var h=0,l=0;l<this.nbParticles;l++)for(var t=this.particles[l],p=t._model._indicesLength,x=0;x<p;x++){if(0==x%3){var R={idx:t.idx,faceId:h};this.pickedParticles[h]=R,h++}}return this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},W.prototype.digest=function(W,i){var L=i&&i.facetNb||1,l=i&&i.number||0,t=i&&i.delta||0,p=W.getVerticesData(C.d.PositionKind),x=W.getIndices(),R=W.getVerticesData(C.d.UVKind),z=W.getVerticesData(C.d.ColorKind),r=W.getVerticesData(C.d.NormalKind),N=i&&i.storage?i.storage:null,I=0,s=x.length/3;l?(l=l>s?s:l,L=Math.round(s/l),t=0):L=L>s?s:L;for(var o=[],D=[],S=[],e=[],V=[],c=h.m.Zero(),f=L;I<s;){I>s-(L=f+Math.floor((1+t)*Math.random()))&&(L=s-I),o.length=0,D.length=0,S.length=0,e.length=0,V.length=0;for(var a=0,P=3*I;P<3*(I+L);P++){S.push(a);var y=x[P],M=3*y;if(o.push(p[M],p[M+1],p[M+2]),D.push(r[M],r[M+1],r[M+2]),R){var b=2*y;e.push(R[b],R[b+1])}if(z){var j=4*y;V.push(z[j],z[j+1],z[j+2],z[j+3])}a++}var Z=this.nbParticles,X=this._posToShape(o),T=this._uvsToShapeUV(e),F=S.slice(),q=V.slice(),H=D.slice();c.copyFromFloats(0,0,0);var k=void 0;for(k=0;k<X.length;k++)c.addInPlace(X[k]);c.scaleInPlace(1/X.length);var U=new h.m(1/0,1/0,1/0),d=new h.m(-1/0,-1/0,-1/0);for(k=0;k<X.length;k++)X[k].subtractInPlace(c),U.minimizeInPlaceFromFloats(X[k].x,X[k].y,X[k].z),d.maximizeInPlaceFromFloats(X[k].x,X[k].y,X[k].z);var B=void 0;this._particlesIntersect&&(B=new cW.b(U,d));var w=null;this._useModelMaterial&&(w=W.material?W.material:this._setDefaultMaterial());var g=new yW(this._shapeCounter,X,F,H,q,T,null,null,w),n=this._positions.length,m=this._indices.length;this._meshBuilder(this._index,m,X,this._positions,F,this._indices,e,this._uvs,q,this._colors,H,this._normals,Z,0,null,g),this._addParticle(Z,this._lastParticleId,n,m,g,this._shapeCounter,0,B,N),this.particles[this.nbParticles].position.addInPlace(c),N||(this._index+=X.length,Z++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,I+=L}return this._isNotBuilt=!0,this},W.prototype._unrotateFixedNormals=function(){for(var W=0,i=0,L=h.h.Vector3[0],l=h.h.Quaternion[0],t=h.h.Matrix[0],p=0;p<this.particles.length;p++){var x=this.particles[p],R=x._model._shape;if(x.rotationQuaternion)x.rotationQuaternion.conjugateToRef(l);else{var z=x.rotation;h.g.RotationYawPitchRollToRef(z.y,z.x,z.z,l),l.conjugateInPlace()}l.toRotationMatrix(t);for(var r=0;r<R.length;r++)i=W+3*r,h.m.TransformNormalFromFloatsToRef(this._normals32[i],this._normals32[i+1],this._normals32[i+2],t,L),L.toArray(this._fixedNormal32,i);W=i+3}},W.prototype._resetCopy=function(){var W=this._copy;W.position.setAll(0),W.rotation.setAll(0),W.rotationQuaternion=null,W.scaling.setAll(1),W.uvs.copyFromFloats(0,0,1,1),W.color=null,W.translateFromPivot=!1,W.shapeId=0,W.materialIndex=null},W.prototype._meshBuilder=function(W,i,L,l,t,p,x,R,z,r,N,I,s,o,D,S){var C,e=0,V=0,c=0;this._resetCopy();var f=this._copy,a=!(!D||!D.storage);if(f.idx=s,f.idxInShape=o,f.shapeId=S.shapeId,this._useModelMaterial){var P=S._material.uniqueId,y=this._materialIndexesById;Object.prototype.hasOwnProperty.call(y,P)||(y[P]=this._materials.length,this._materials.push(S._material));var M=y[P];f.materialIndex=M}if(D&&D.positionFunction&&(D.positionFunction(f,s,o),this._mustUnrotateFixedNormals=!0),a)return f;var b=h.h.Matrix[0],j=this._tmpVertex,Z=j.position,X=j.color,T=j.uv,F=h.h.Vector3[1],q=h.h.Vector3[2],H=h.h.Vector3[3];h.d.IdentityToRef(b),f.getRotationMatrix(b),f.pivot.multiplyToRef(f.scaling,H),f.translateFromPivot?q.setAll(0):q.copyFrom(H);var k=D&&D.vertexFunction;for(C=0;C<L.length;C++){if(Z.copyFrom(L[C]),f.color&&X.copyFrom(f.color),x&&T.copyFromFloats(x[e],x[e+1]),k&&D.vertexFunction(f,j,C),Z.multiplyInPlace(f.scaling).subtractInPlace(H),h.m.TransformCoordinatesToRef(Z,b,F),F.addInPlace(q).addInPlace(f.position),l.push(F.x,F.y,F.z),x){var U=f.uvs;R.push((U.z-U.x)*T.x+U.x,(U.w-U.y)*T.y+U.y),e+=2}if(f.color)this._color.copyFrom(X);else{var d=this._color;z&&void 0!==z[V]?(d.r=z[V],d.g=z[V+1],d.b=z[V+2],d.a=z[V+3]):(d.r=1,d.g=1,d.b=1,d.a=1)}r.push(this._color.r,this._color.g,this._color.b,this._color.a),V+=4,!this.recomputeNormals&&N&&(h.m.TransformNormalFromFloatsToRef(N[c],N[c+1],N[c+2],b,Z),I.push(Z.x,Z.y,Z.z),c+=3)}for(C=0;C<t.length;C++){var B=W+t[C];p.push(B),B>65535&&(this._needs32Bits=!0)}if(this._depthSort||this._multimaterialEnabled){var w=null!==f.materialIndex?f.materialIndex:0;this.depthSortedParticles.push(new MW(s,i,t.length,w))}return f},W.prototype._posToShape=function(W){for(var i=[],L=0;L<W.length;L+=3)i.push(h.m.FromArray(W,L));return i},W.prototype._uvsToShapeUV=function(W){var i=[];if(W)for(var L=0;L<W.length;L++)i.push(W[L]);return i},W.prototype._addParticle=function(W,i,L,h,l,t,p,x,R){void 0===x&&(x=null),void 0===R&&(R=null);var z=new PW(W,i,L,h,l,t,p,this,x);return(R||this.particles).push(z),z},W.prototype.addShape=function(W,i,L){var h=W.getVerticesData(C.d.PositionKind),l=W.getIndices(),t=W.getVerticesData(C.d.UVKind),p=W.getVerticesData(C.d.ColorKind),x=W.getVerticesData(C.d.NormalKind);this.recomputeNormals=!x;var R=Array.from(l),z=Array.from(x),r=p?Array.from(p):[],N=L&&L.storage?L.storage:null,I=null;this._particlesIntersect&&(I=W.getBoundingInfo());var s=this._posToShape(h),o=this._uvsToShapeUV(t),D=L?L.positionFunction:null,S=L?L.vertexFunction:null,e=null;this._useModelMaterial&&(e=W.material?W.material:this._setDefaultMaterial());for(var V=new yW(this._shapeCounter,s,R,z,r,o,D,S,e),c=0;c<i;c++)this._insertNewParticle(this.nbParticles,c,V,s,l,t,p,x,I,N,L);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},W.prototype._rebuildParticle=function(W,i){void 0===i&&(i=!1),this._resetCopy();var L=this._copy;W._model._positionFunction&&W._model._positionFunction(L,W.idx,W.idxInShape);var l=h.h.Matrix[0],t=h.h.Vector3[0],p=h.h.Vector3[1],x=h.h.Vector3[2],R=h.h.Vector3[3];L.getRotationMatrix(l),W.pivot.multiplyToRef(W.scaling,R),L.translateFromPivot?x.copyFromFloats(0,0,0):x.copyFrom(R);for(var z=W._model._shape,r=0;r<z.length;r++)t.copyFrom(z[r]),W._model._vertexFunction&&W._model._vertexFunction(L,t,r),t.multiplyInPlace(L.scaling).subtractInPlace(R),h.m.TransformCoordinatesToRef(t,l,p),p.addInPlace(x).addInPlace(L.position).toArray(this._positions32,W._pos+3*r);i&&(W.position.setAll(0),W.rotation.setAll(0),W.rotationQuaternion=null,W.scaling.setAll(1),W.uvs.setAll(0),W.pivot.setAll(0),W.translateFromPivot=!1,W.parentId=null)},W.prototype.rebuildMesh=function(W){void 0===W&&(W=!1);for(var i=0;i<this.particles.length;i++)this._rebuildParticle(this.particles[i],W);return this.mesh.updateVerticesData(C.d.PositionKind,this._positions32,!1,!1),this},W.prototype.removeParticles=function(W,i){var L=i-W+1;if(!this._expandable||L<=0||L>=this.nbParticles||!this._updatable)return[];var h=this.particles,l=this.nbParticles;if(i<l-1)for(var t=i+1,p=h[t]._pos-h[W]._pos,x=h[t]._ind-h[W]._ind,R=t;R<l;R++){var z=h[R];z._pos-=p,z._ind-=x}var r=h.splice(W,L);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var N=0,I=h.length,s=0;s<I;s++){var o=h[s],D=o._model,S=D._shape,C=D._indices,e=D._normals,V=D._shapeColors,c=D._shapeUV;o.idx=s,this._idxOfId[o.id]=s,this._meshBuilder(this._index,N,S,this._positions,C,this._indices,c,this._uvs,V,this._colors,e,this._normals,o.idx,o.idxInShape,null,D),this._index+=S.length,N+=C.length}return this.nbParticles-=L,this._isNotBuilt=!0,r},W.prototype.insertParticlesFromArray=function(W){if(!this._expandable)return this;for(var i=0,L=W[0].shapeId,h=W.length,l=0;l<h;l++){var t=W[l],p=t._model,x=p._shape,R=p._indices,z=p._shapeUV,r=p._shapeColors,N=p._normals,I=!N;this.recomputeNormals=I||this.recomputeNormals;var s=t.getBoundingInfo(),o=this._insertNewParticle(this.nbParticles,i,p,x,R,z,r,N,s,null,null);t.copyToRef(o),i++,L!=t.shapeId&&(L=t.shapeId,i=0)}return this._isNotBuilt=!0,this},W.prototype._insertNewParticle=function(W,i,L,h,l,t,p,x,R,z,r){var N=this._positions.length,I=this._indices.length,s=this._meshBuilder(this._index,I,h,this._positions,l,this._indices,t,this._uvs,p,this._colors,x,this._normals,W,i,r,L),o=null;return this._updatable&&((o=this._addParticle(this.nbParticles,this._lastParticleId,N,I,L,this._shapeCounter,i,R,z)).position.copyFrom(s.position),o.rotation.copyFrom(s.rotation),s.rotationQuaternion&&(o.rotationQuaternion?o.rotationQuaternion.copyFrom(s.rotationQuaternion):o.rotationQuaternion=s.rotationQuaternion.clone()),s.color&&(o.color?o.color.copyFrom(s.color):o.color=s.color.clone()),o.scaling.copyFrom(s.scaling),o.uvs.copyFrom(s.uvs),null!==s.materialIndex&&(o.materialIndex=s.materialIndex),this.expandable&&(this._idxOfId[o.id]=o.idx)),z||(this._index+=h.length,this.nbParticles++,this._lastParticleId++),o},W.prototype.setParticles=function(W,i,L){if(void 0===W&&(W=0),void 0===i&&(i=this.nbParticles-1),void 0===L&&(L=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(W,i,L);var l=h.h.Matrix[0],t=h.h.Matrix[1],p=this.mesh,x=this._colors32,R=this._positions32,z=this._normals32,r=this._uvs32,N=this._indices32,I=this._indices,s=this._fixedNormal32,o=h.h.Vector3,D=o[5].copyFromFloats(1,0,0),S=o[6].copyFromFloats(0,1,0),e=o[7].copyFromFloats(0,0,1),V=o[8].setAll(Number.MAX_VALUE),c=o[9].setAll(-Number.MAX_VALUE),f=o[10].setAll(0),a=this._tmpVertex,P=a.position,y=a.color,M=a.uv;if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(t)),this.billboard){var b=o[0];this._camera.getDirectionToRef(XW.e.Z,b),h.m.TransformNormalToRef(b,t,e),e.normalize();var j=this._camera.getViewMatrix(!0);h.m.TransformNormalFromFloatsToRef(j.m[1],j.m[5],j.m[9],t,S),h.m.CrossToRef(S,e,D),S.normalize(),D.normalize()}this._depthSort&&h.m.TransformCoordinatesToRef(this._camera.globalPosition,t,f),h.d.IdentityToRef(l);var Z=0,X=0,T=0,F=0,q=0,H=0,k=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),i=i>=this.nbParticles?this.nbParticles-1:i,this._computeBoundingBox&&(0!=W||i!=this.nbParticles-1)){var U=this.mesh.getBoundingInfo();U&&(V.copyFrom(U.minimum),c.copyFrom(U.maximum))}var d=(X=this.particles[W]._pos)/3|0;F=4*d,H=2*d;for(var B=W;B<=i;B++){var w=this.particles[B];this.updateParticle(w);var g=w._model._shape,n=w._model._shapeUV,m=w._rotationMatrix,E=w.position,K=w.rotation,G=w.scaling,u=w._globalPosition;if(this._depthSort&&this._depthSortParticles){var J=this.depthSortedParticles[B];J.idx=w.idx,J.ind=w._ind,J.indicesLength=w._model._indicesLength,J.sqDistance=h.m.DistanceSquared(w.position,f)}if(!w.alive||w._stillInvisible&&!w.isVisible)X+=3*(k=g.length),F+=4*k,H+=2*k;else{if(w.isVisible){w._stillInvisible=!1;var A=o[12];if(w.pivot.multiplyToRef(G,A),this.billboard&&(K.x=0,K.y=0),(this._computeParticleRotation||this.billboard)&&w.getRotationMatrix(l),null!==w.parentId){var v=this.getParticleById(w.parentId);if(v){var Q=v._rotationMatrix,O=v._globalPosition,Y=E.x*Q[1]+E.y*Q[4]+E.z*Q[7],WW=E.x*Q[0]+E.y*Q[3]+E.z*Q[6],iW=E.x*Q[2]+E.y*Q[5]+E.z*Q[8];if(u.x=O.x+WW,u.y=O.y+Y,u.z=O.z+iW,this._computeParticleRotation||this.billboard){var LW=l.m;m[0]=LW[0]*Q[0]+LW[1]*Q[3]+LW[2]*Q[6],m[1]=LW[0]*Q[1]+LW[1]*Q[4]+LW[2]*Q[7],m[2]=LW[0]*Q[2]+LW[1]*Q[5]+LW[2]*Q[8],m[3]=LW[4]*Q[0]+LW[5]*Q[3]+LW[6]*Q[6],m[4]=LW[4]*Q[1]+LW[5]*Q[4]+LW[6]*Q[7],m[5]=LW[4]*Q[2]+LW[5]*Q[5]+LW[6]*Q[8],m[6]=LW[8]*Q[0]+LW[9]*Q[3]+LW[10]*Q[6],m[7]=LW[8]*Q[1]+LW[9]*Q[4]+LW[10]*Q[7],m[8]=LW[8]*Q[2]+LW[9]*Q[5]+LW[10]*Q[8]}}else w.parentId=null}else if(u.x=E.x,u.y=E.y,u.z=E.z,this._computeParticleRotation||this.billboard){LW=l.m;m[0]=LW[0],m[1]=LW[1],m[2]=LW[2],m[3]=LW[4],m[4]=LW[5],m[5]=LW[6],m[6]=LW[8],m[7]=LW[9],m[8]=LW[10]}var hW=o[11];for(w.translateFromPivot?hW.setAll(0):hW.copyFrom(A),k=0;k<g.length;k++){Z=X+3*k,T=F+4*k,q=H+2*k;var lW=2*k,tW=lW+1;P.copyFrom(g[k]),this._computeParticleColor&&w.color&&y.copyFrom(w.color),this._computeParticleTexture&&M.copyFromFloats(n[lW],n[tW]),this._computeParticleVertex&&this.updateParticleVertex(w,a,k);var pW=P.x*G.x-A.x,xW=P.y*G.y-A.y,RW=P.z*G.z-A.z;WW=pW*m[0]+xW*m[3]+RW*m[6],Y=pW*m[1]+xW*m[4]+RW*m[7],iW=pW*m[2]+xW*m[5]+RW*m[8];WW+=hW.x,Y+=hW.y,iW+=hW.z;var zW=R[Z]=u.x+D.x*WW+S.x*Y+e.x*iW,rW=R[Z+1]=u.y+D.y*WW+S.y*Y+e.y*iW,NW=R[Z+2]=u.z+D.z*WW+S.z*Y+e.z*iW;if(this._computeBoundingBox&&(V.minimizeInPlaceFromFloats(zW,rW,NW),c.maximizeInPlaceFromFloats(zW,rW,NW)),!this._computeParticleVertex){var IW=s[Z],sW=s[Z+1],oW=s[Z+2],DW=IW*m[0]+sW*m[3]+oW*m[6],SW=IW*m[1]+sW*m[4]+oW*m[7],CW=IW*m[2]+sW*m[5]+oW*m[8];z[Z]=D.x*DW+S.x*SW+e.x*CW,z[Z+1]=D.y*DW+S.y*SW+e.y*CW,z[Z+2]=D.z*DW+S.z*SW+e.z*CW}if(this._computeParticleColor&&w.color){var eW=this._colors32;eW[T]=y.r,eW[T+1]=y.g,eW[T+2]=y.b,eW[T+3]=y.a}if(this._computeParticleTexture){var VW=w.uvs;r[q]=M.x*(VW.z-VW.x)+VW.x,r[q+1]=M.y*(VW.w-VW.y)+VW.y}}}else for(w._stillInvisible=!0,k=0;k<g.length;k++){if(T=F+4*k,q=H+2*k,R[Z=X+3*k]=R[Z+1]=R[Z+2]=0,z[Z]=z[Z+1]=z[Z+2]=0,this._computeParticleColor&&w.color){var cW=w.color;x[T]=cW.r,x[T+1]=cW.g,x[T+2]=cW.b,x[T+3]=cW.a}if(this._computeParticleTexture){VW=w.uvs;r[q]=n[2*k]*(VW.z-VW.x)+VW.x,r[q+1]=n[2*k+1]*(VW.w-VW.y)+VW.y}}if(this._particlesIntersect){var fW=w.getBoundingInfo(),aW=fW.boundingBox,PW=fW.boundingSphere,yW=w._modelBoundingInfo;if(!this._bSphereOnly){var MW=yW.boundingBox.vectors,bW=o[1],ZW=o[2];bW.setAll(Number.MAX_VALUE),ZW.setAll(-Number.MAX_VALUE);for(var TW=0;TW<8;TW++){var FW=MW[TW].x*G.x,qW=MW[TW].y*G.y,HW=MW[TW].z*G.z,kW=(WW=FW*m[0]+qW*m[3]+HW*m[6],Y=FW*m[1]+qW*m[4]+HW*m[7],iW=FW*m[2]+qW*m[5]+HW*m[8],E.x+D.x*WW+S.x*Y+e.x*iW),UW=E.y+D.y*WW+S.y*Y+e.y*iW,dW=E.z+D.z*WW+S.z*Y+e.z*iW;bW.minimizeInPlaceFromFloats(kW,UW,dW),ZW.maximizeInPlaceFromFloats(kW,UW,dW)}aW.reConstruct(bW,ZW,p._worldMatrix)}var BW=yW.minimum.multiplyToRef(G,o[1]),wW=yW.maximum.multiplyToRef(G,o[2]),gW=wW.addToRef(BW,o[3]).scaleInPlace(.5).addInPlace(u),nW=wW.subtractToRef(BW,o[4]).scaleInPlace(.5*this._bSphereRadiusFactor),mW=gW.subtractToRef(nW,o[1]),EW=gW.addToRef(nW,o[2]);PW.reConstruct(mW,EW,p._worldMatrix)}X=Z+3,F=T+4,H=q+2}}if(L){if(this._computeParticleColor)(JW=p.getVertexBuffer(C.d.ColorKind))&&!p.isPickable?JW.updateDirectly(x,0):p.updateVerticesData(C.d.ColorKind,x,!1,!1);if(this._computeParticleTexture)(JW=p.getVertexBuffer(C.d.UVKind))&&!p.isPickable?JW.updateDirectly(r,0):p.updateVerticesData(C.d.UVKind,r,!1,!1);var KW=p.getVertexBuffer(C.d.PositionKind);if(KW&&!p.isPickable?KW.updateDirectly(R,0):p.updateVerticesData(C.d.PositionKind,R,!1,!1),!p.areNormalsFrozen||p.isFacetDataEnabled){if(this._computeParticleVertex||p.isFacetDataEnabled){var GW=p.isFacetDataEnabled?p.getFacetDataParameters():null;jW.e.ComputeNormals(R,N,z,GW);for(var uW=0;uW<z.length;uW++)s[uW]=z[uW]}var JW;if(!p.areNormalsFrozen)(JW=p.getVertexBuffer(C.d.NormalKind))&&!p.isPickable?JW.updateDirectly(z,0):p.updateVerticesData(C.d.NormalKind,z,!1,!1)}if(this._depthSort&&this._depthSortParticles){var AW=this.depthSortedParticles;AW.sort(this._depthSortFunction);for(var vW=AW.length,QW=0,OW=0,YW=0;YW<vW;YW++){var Wi=AW[YW],ii=Wi.indicesLength,Li=Wi.ind;for(uW=0;uW<ii;uW++){if(N[QW]=I[Li+uW],QW++,this._pickable)if(0==uW%3){var hi=this.pickedParticles[OW];hi.idx=Wi.idx,hi.faceId=OW,OW++}}}p.updateIndices(N)}}return this._computeBoundingBox&&(p.hasBoundingInfo?p.getBoundingInfo().reConstruct(V,c,p._worldMatrix):p.buildBoundingInfo(V,c,p._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(W,i,L),this},W.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null,this.pickedBySubMesh=null,this._materials=null,this._materialIndexes=null,this._indicesByMaterial=null,this._idxOfId=null},W.prototype.pickedParticle=function(W){if(W.hit){var i=W.subMeshId,L=W.faceId-this.mesh.subMeshes[i].indexStart/3,h=this.pickedBySubMesh;if(h[i]&&h[i][L])return h[i][L]}return null},W.prototype.getParticleById=function(W){var i=this.particles[W];if(i&&i.id==W)return i;var L=this.particles,h=this._idxOfId[W];if(void 0!==h)return L[h];for(var l=0,t=this.nbParticles;l<t;){var p=L[l];if(p.id==W)return p;l++}return null},W.prototype.getParticlesByShapeId=function(W){var i=[];return this.getParticlesByShapeIdToRef(W,i),i},W.prototype.getParticlesByShapeIdToRef=function(W,i){i.length=0;for(var L=0;L<this.nbParticles;L++){var h=this.particles[L];h.shapeId==W&&i.push(h)}return this},W.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var W=this.depthSortedParticles;if(this.particles.length>0)for(var i=0;i<this.particles.length;i++){var L=this.particles[i];L.materialIndex||(L.materialIndex=0);var h=W[i];h.materialIndex=L.materialIndex,h.ind=L._ind,h.indicesLength=L._model._indicesLength,h.idx=L.idx}this._sortParticlesByMaterial();var l=this._indicesByMaterial,t=this._materialIndexes,p=this.mesh;p.subMeshes=[];for(var x=p.getTotalVertices(),R=0;R<t.length;R++){var z=l[R],r=l[R+1]-z,N=t[R];new TW.d(N,0,x,z,r,p)}return this},W.prototype._sortParticlesByMaterial=function(){var W=[0];this._indicesByMaterial=W;var i=[];this._materialIndexes=i;var L=this.depthSortedParticles;L.sort(this._materialSortFunction);var h=L.length,l=this._indices32,t=this._indices,p=0,x=0,R=0,z=L[0].materialIndex;i.push(z),this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(var r=0;r<h;r++){var N=L[r],I=N.indicesLength,s=N.ind;N.materialIndex!==z&&(z=N.materialIndex,W.push(R),i.push(z),this._pickable&&(p++,this.pickedBySubMesh[p]=[],x=0));for(var o=0,D=0;D<I;D++){if(l[R]=t[s+D],this._pickable)if(0==D%3){var S=this.pickedBySubMesh[p][x];S?(S.idx=N.idx,S.faceId=o):this.pickedBySubMesh[p][x]={idx:N.idx,faceId:o},x++,o++}R++}}return W.push(l.length),this._updatable&&this.mesh.updateIndices(l),this},W.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var W=0;W<this._materials.length;W++){var i=this._materials[W].uniqueId;this._materialIndexesById[i]=W}},W.prototype._filterUniqueMaterialId=function(W){return W.filter((function(W,i,L){return L.indexOf(W)===i}))},W.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new IW.b(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},W.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},W.prototype.setVisibilityBox=function(W){var i=W/2;this.mesh.buildBoundingInfo(new h.m(-i,-i,-i),new h.m(i,i,i))},Object.defineProperty(W.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(W){this._alwaysVisible=W,this.mesh.alwaysSelectAsActiveMesh=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(W){this._isVisibilityBoxLocked=W,this.mesh.getBoundingInfo().isLocked=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(W){this._computeParticleRotation=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(W){this._computeParticleColor=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(W){this._computeParticleTexture=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(W){this._computeParticleVertex=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(W){this._computeBoundingBox=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(W){this._depthSortParticles=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"expandable",{get:function(){return this._expandable},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"materials",{get:function(){return this._materials},enumerable:!1,configurable:!0}),W.prototype.setMultiMaterial=function(W){this._materials=this._filterUniqueMaterialId(W),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new FW.d(this.name+"MultiMaterial",this._scene);for(var i=0;i<this._materials.length;i++)this._multimaterial.subMaterials.push(this._materials[i]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(W.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(W){this._multimaterial=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(W){this._autoUpdateSubMeshes=W},enumerable:!1,configurable:!0}),W.prototype.initParticles=function(){},W.prototype.recycleParticle=function(W){return W},W.prototype.updateParticle=function(W){return W},W.prototype.updateParticleVertex=function(W,i,L){return this},W.prototype.beforeUpdateParticles=function(W,i,L){},W.prototype.afterUpdateParticles=function(W,i,L){}}(),L(39578)),HW=function(){function W(W,i,L,h,l){this.idx=0,this.color=new qW.i(1,1,1,1),this.position=qW.u.Zero(),this.rotation=qW.u.Zero(),this.uv=new qW.q(0,0),this.velocity=qW.u.Zero(),this.pivot=qW.u.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=qW.u.Zero(),this.idx=W,this._group=i,this.groupId=L,this.idxInGroup=h,this._pcs=l}return Object.defineProperty(W.prototype,"size",{get:function(){return this.size},set:function(W){this.size=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(W){this.rotationQuaternion=W},enumerable:!1,configurable:!0}),W.prototype.intersectsMesh=function(W,i){if(!W.hasBoundingInfo)return!1;if(i=i||!1)return W.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var L,h,l,t,p,x;L=W.getBoundingInfo().boundingBox.maximumWorld.x,h=W.getBoundingInfo().boundingBox.minimumWorld.x,l=W.getBoundingInfo().boundingBox.maximumWorld.y,t=W.getBoundingInfo().boundingBox.minimumWorld.y,p=W.getBoundingInfo().boundingBox.maximumWorld.z,x=W.getBoundingInfo().boundingBox.minimumWorld.z;var R=this.position.x+this._pcs.mesh.position.x,z=this.position.y+this._pcs.mesh.position.y,r=this.position.z+this._pcs.mesh.position.z;return h<=R&&R<=L&&t<=z&&z<=l&&x<=r&&r<=p},W.prototype.getRotationMatrix=function(W){var i;if(this.rotationQuaternion)i=this.rotationQuaternion;else{i=qW.p.Quaternion[0];var L=this.rotation;qW.l.RotationYawPitchRollToRef(L.y,L.x,L.z,i)}i.toRotationMatrix(W)},W}(),kW=function(){function W(W,i){this.groupId=W,this._positionFunction=i}return Object.defineProperty(W.prototype,"groupID",{get:function(){return this.groupId},set:function(W){this.groupId=W},enumerable:!1,configurable:!0}),W}(),UW=L(11126),dW=L(76384);!function(W){W[W.Color=2]="Color",W[W.UV=1]="UV",W[W.Random=0]="Random",W[W.Stated=3]="Stated"}(VW||(VW={}));!function(){function W(W,i,L,h){this.particles=new Array,this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array,this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=W,this._size=i,this._scene=L||A.d.LastCreatedScene,h&&void 0!==h.updatable?this._updatable=h.updatable:this._updatable=!0}Object.defineProperty(W.prototype,"positions",{get:function(){return this._positions32},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"colors",{get:function(){return this._colors32},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"uvs",{get:function(){return this._uvs32},enumerable:!1,configurable:!0}),W.prototype.buildMeshAsync=function(W){var i=this;return Promise.all(this._promises).then((function(){return i._isReady=!0,i._buildMesh(W)}))},W.prototype._buildMesh=function(W){0===this.nbParticles&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var i=new jW.e;i.set(this._positions32,C.d.PositionKind),this._uvs32.length>0&&i.set(this._uvs32,C.d.UVKind);var L=0;this._colors32.length>0&&(L=1,i.set(this._colors32,C.d.ColorKind));var h=new DW.e(this.name,this._scene);i.applyToMesh(h,this._updatable),this.mesh=h,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var l=W;return l||((l=new IW.b("point cloud material",this._scene)).emissiveColor=new qW.e(L,L,L),l.disableLighting=!0,l.pointsCloud=!0,l.pointSize=this._size),h.material=l,new Promise((function(W){return W(h)}))},W.prototype._addParticle=function(W,i,L,h){var l=new HW(W,i,L,h,this);return this.particles.push(l),l},W.prototype._randomUnitVector=function(W){W.position=new h.m(Math.random(),Math.random(),Math.random()),W.color=new qW.i(1,1,1,1)},W.prototype._getColorIndicesForCoord=function(W,i,L,h){var l=W._groupImageData,t=L*(4*h)+4*i,p=[t,t+1,t+2,t+3],x=p[1],R=p[2],z=p[3],r=l[p[0]],N=l[x],I=l[R],s=l[z];return new qW.i(r/255,N/255,I/255,s)},W.prototype._setPointsColorOrUV=function(W,i,L,l,t,x,R){L&&W.updateFacetData();var z=2*W.getBoundingInfo().boundingSphere.radius,r=W.getVerticesData(C.d.PositionKind),N=W.getIndices(),I=W.getVerticesData(C.d.UVKind),s=W.getVerticesData(C.d.ColorKind),o=h.m.Zero();W.computeWorldMatrix();var D=W.getWorldMatrix();if(!D.isIdentity()){r=r.slice(0);for(var S=0;S<r.length/3;S++)h.m.TransformCoordinatesFromFloatsToRef(r[3*S],r[3*S+1],r[3*S+2],D,o),r[3*S]=o.x,r[3*S+1]=o.y,r[3*S+2]=o.z}var e,V,c=0,f=0,a=0,P=0,y=0,M=0,b=0,j=0,Z=0,X=0,T=0,F=0,q=0,H=h.m.Zero(),k=h.m.Zero(),U=h.m.Zero(),d=h.m.Zero(),B=h.m.Zero(),w=0,g=0,n=0,m=0,E=0,K=0,G=h.k.Zero(),u=h.k.Zero(),J=h.k.Zero(),A=h.k.Zero(),v=h.k.Zero(),Q=0,O=0,Y=0,WW=0,iW=0,LW=0,hW=0,lW=0,tW=0,pW=0,xW=0,RW=0,zW=h.n.Zero(),rW=h.n.Zero(),NW=h.n.Zero(),IW=h.n.Zero(),sW=h.n.Zero(),oW=0,DW=0;R=R||0;for(var SW,CW=new h.n(0,0,0,0),eW=h.m.Zero(),VW=h.m.Zero(),cW=h.m.Zero(),fW=0,aW=h.m.Zero(),PW=0,yW=0,MW=new UW.e(h.m.Zero(),new h.m(1,0,0)),bW=h.m.Zero(),jW=0;jW<N.length/3;jW++){f=N[3*jW],a=N[3*jW+1],P=N[3*jW+2],y=r[3*f],M=r[3*f+1],b=r[3*f+2],j=r[3*a],Z=r[3*a+1],X=r[3*a+2],T=r[3*P],F=r[3*P+1],q=r[3*P+2],H.set(y,M,b),k.set(j,Z,X),U.set(T,F,q),k.subtractToRef(H,d),U.subtractToRef(k,B),I&&(w=I[2*f],g=I[2*f+1],n=I[2*a],m=I[2*a+1],E=I[2*P],K=I[2*P+1],G.set(w,g),u.set(n,m),J.set(E,K),u.subtractToRef(G,A),J.subtractToRef(u,v)),s&&l&&(Q=s[4*f],O=s[4*f+1],Y=s[4*f+2],WW=s[4*f+3],iW=s[4*a],LW=s[4*a+1],hW=s[4*a+2],lW=s[4*a+3],tW=s[4*P],pW=s[4*P+1],xW=s[4*P+2],RW=s[4*P+3],zW.set(Q,O,Y,WW),rW.set(iW,LW,hW,lW),NW.set(tW,pW,xW,RW),rW.subtractToRef(zW,IW),NW.subtractToRef(rW,sW));for(var ZW=void 0,XW=void 0,TW=void 0,FW=void 0,HW=void 0,kW=void 0,dW=void 0,BW=void 0,wW=new qW.e(0,0,0),gW=new qW.e(0,0,0),nW=void 0,mW=void 0,EW=0;EW<i._groupDensity[jW];EW++)c=this.particles.length,this._addParticle(c,i,this._groupCounter,jW+EW),mW=this.particles[c],oW=p.d.RandomRange(0,1),DW=p.d.RandomRange(0,1),e=H.add(d.scale(oW)).add(B.scale(oW*DW)),L&&(eW=W.getFacetNormal(jW).normalize().scale(-1),VW=d.clone().normalize(),cW=h.m.Cross(eW,VW),fW=p.d.RandomRange(0,2*Math.PI),aW=VW.scale(Math.cos(fW)).add(cW.scale(Math.sin(fW))),fW=p.d.RandomRange(.1,Math.PI/2),bW=aW.scale(Math.cos(fW)).add(eW.scale(Math.sin(fW))),MW.origin=e.add(bW.scale(1e-5)),MW.direction=bW,MW.length=z,(SW=MW.intersectsMesh(W)).hit&&(yW=SW.pickedPoint.subtract(e).length(),PW=p.d.RandomRange(0,1)*yW,e.addInPlace(bW.scale(PW)))),mW.position=e.clone(),this._positions.push(mW.position.x,mW.position.y,mW.position.z),void 0!==l?I&&(V=G.add(A.scale(oW)).add(v.scale(oW*DW)),l?t&&null!==i._groupImageData?(ZW=i._groupImgWidth,XW=i._groupImgHeight,nW=this._getColorIndicesForCoord(i,Math.round(V.x*ZW),Math.round(V.y*XW),ZW),mW.color=nW,this._colors.push(nW.r,nW.g,nW.b,nW.a)):s?(CW=zW.add(IW.scale(oW)).add(sW.scale(oW*DW)),mW.color=new qW.i(CW.x,CW.y,CW.z,CW.w),this._colors.push(CW.x,CW.y,CW.z,CW.w)):(CW=zW.set(Math.random(),Math.random(),Math.random(),1),mW.color=new qW.i(CW.x,CW.y,CW.z,CW.w),this._colors.push(CW.x,CW.y,CW.z,CW.w)):(mW.uv=V.clone(),this._uvs.push(mW.uv.x,mW.uv.y))):(x?(wW.set(x.r,x.g,x.b),TW=p.d.RandomRange(-R,R),FW=p.d.RandomRange(-R,R),HW=(BW=wW.toHSV()).r,(kW=BW.g+TW)<0&&(kW=0),kW>1&&(kW=1),(dW=BW.b+FW)<0&&(dW=0),dW>1&&(dW=1),qW.e.HSVtoRGBToRef(HW,kW,dW,gW),CW.set(gW.r,gW.g,gW.b,1)):CW=zW.set(Math.random(),Math.random(),Math.random(),1),mW.color=new qW.i(CW.x,CW.y,CW.z,CW.w),this._colors.push(CW.x,CW.y,CW.z,CW.w))}},W.prototype._colorFromTexture=function(W,i,L){var h=this;if(null===W.material)return k.e.Warn(W.name+"has no material."),i._groupImageData=null,void this._setPointsColorOrUV(W,i,L,!0,!1);var l=W.material.getActiveTextures();if(0===l.length)return k.e.Warn(W.name+"has no usable texture."),i._groupImageData=null,void this._setPointsColorOrUV(W,i,L,!0,!1);var t=W.clone();t.setEnabled(!1),this._promises.push(new Promise((function(W){dW.d.WhenAllReady(l,(function(){var p=i._textureNb;p<0&&(p=0),p>l.length-1&&(p=l.length-1);var x=function(){i._groupImgWidth=l[p].getSize().width,i._groupImgHeight=l[p].getSize().height,h._setPointsColorOrUV(t,i,L,!0,!0),t.dispose(),W()};i._groupImageData=null;var R=l[p].readPixels();R?R.then((function(W){i._groupImageData=W,x()})):x()}))})))},W.prototype._calculateDensity=function(W,i,L){for(var l,t,p,x,R,z,r,N,I,s,o,D,S,C,e,V,c,f=new Array,a=h.m.Zero(),P=h.m.Zero(),y=h.m.Zero(),M=h.m.Zero(),b=h.m.Zero(),j=h.m.Zero(),Z=new Array,X=0,T=L.length/3,F=0;F<T;F++)l=L[3*F],t=L[3*F+1],p=L[3*F+2],x=i[3*l],R=i[3*l+1],z=i[3*l+2],r=i[3*t],N=i[3*t+1],I=i[3*t+2],s=i[3*p],o=i[3*p+1],D=i[3*p+2],a.set(x,R,z),P.set(r,N,I),y.set(s,o,D),P.subtractToRef(a,M),y.subtractToRef(P,b),y.subtractToRef(a,j),V=((S=M.length())+(C=b.length())+(e=j.length()))/2,X+=c=Math.sqrt(V*(V-S)*(V-C)*(V-e)),Z[F]=c;var q=0;for(F=0;F<T;F++)f[F]=Math.floor(W*Z[F]/X),q+=f[F];var H=W-q,k=Math.floor(H/T),U=H%T;k>0&&(f=f.map((function(W){return W+k})));for(F=0;F<U;F++)f[F]+=1;return f},W.prototype.addPoints=function(W,i){void 0===i&&(i=this._randomUnitVector);for(var L,h=new kW(this._groupCounter,i),l=this.nbParticles,t=0;t<W;t++)L=this._addParticle(l,h,this._groupCounter,t),h&&h._positionFunction&&h._positionFunction(L,l,t),this._positions.push(L.position.x,L.position.y,L.position.z),L.color&&this._colors.push(L.color.r,L.color.g,L.color.b,L.color.a),L.uv&&this._uvs.push(L.uv.x,L.uv.y),l++;return this.nbParticles+=W,this._groupCounter++,this._groupCounter},W.prototype.addSurfacePoints=function(W,i,L,h,l){var t=L||VW.Random;(isNaN(t)||t<0||t>3)&&(t=VW.Random);var p=W.getVerticesData(C.d.PositionKind),x=W.getIndices();this._groups.push(this._groupCounter);var R=new kW(this._groupCounter,null);switch(R._groupDensity=this._calculateDensity(i,p,x),t===VW.Color?R._textureNb=h||0:h=h||new qW.i(1,1,1,1),t){case VW.Color:this._colorFromTexture(W,R,!1);break;case VW.UV:this._setPointsColorOrUV(W,R,!1,!1,!1);break;case VW.Random:this._setPointsColorOrUV(W,R,!1);break;case VW.Stated:this._setPointsColorOrUV(W,R,!1,void 0,void 0,h,l)}return this.nbParticles+=i,this._groupCounter++,this._groupCounter-1},W.prototype.addVolumePoints=function(W,i,L,h,l){var t=L||VW.Random;(isNaN(t)||t<0||t>3)&&(t=VW.Random);var p=W.getVerticesData(C.d.PositionKind),x=W.getIndices();this._groups.push(this._groupCounter);var R=new kW(this._groupCounter,null);switch(R._groupDensity=this._calculateDensity(i,p,x),t===VW.Color?R._textureNb=h||0:h=h||new qW.i(1,1,1,1),t){case VW.Color:this._colorFromTexture(W,R,!0);break;case VW.UV:this._setPointsColorOrUV(W,R,!0,!1,!1);break;case VW.Random:this._setPointsColorOrUV(W,R,!0);break;case VW.Stated:this._setPointsColorOrUV(W,R,!0,void 0,void 0,h,l)}return this.nbParticles+=i,this._groupCounter++,this._groupCounter-1},W.prototype.setParticles=function(W,i,L){if(void 0===W&&(W=0),void 0===i&&(i=this.nbParticles-1),void 0===L&&(L=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(W,i,L);var l=h.h.Matrix[0],t=this.mesh,p=this._colors32,x=this._positions32,R=this._uvs32,z=h.h.Vector3,r=z[5].copyFromFloats(1,0,0),N=z[6].copyFromFloats(0,1,0),I=z[7].copyFromFloats(0,0,1),s=z[8].setAll(Number.MAX_VALUE),o=z[9].setAll(-Number.MAX_VALUE);h.d.IdentityToRef(l);var D=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),i=i>=this.nbParticles?this.nbParticles-1:i,this._computeBoundingBox&&(0!=W||i!=this.nbParticles-1)){var S=this.mesh.getBoundingInfo();S&&(s.copyFrom(S.minimum),o.copyFrom(S.maximum))}D=0;for(var e=0,V=0,c=0,f=W;f<=i;f++){var a=this.particles[f];e=3*(D=a.idx),V=4*D,c=2*D,this.updateParticle(a);var P=a._rotationMatrix,y=a.position,M=a._globalPosition;if(this._computeParticleRotation&&a.getRotationMatrix(l),null!==a.parentId){var b=this.particles[a.parentId],j=b._rotationMatrix,Z=b._globalPosition,X=y.x*j[1]+y.y*j[4]+y.z*j[7],T=y.x*j[0]+y.y*j[3]+y.z*j[6],F=y.x*j[2]+y.y*j[5]+y.z*j[8];if(M.x=Z.x+T,M.y=Z.y+X,M.z=Z.z+F,this._computeParticleRotation){var q=l.m;P[0]=q[0]*j[0]+q[1]*j[3]+q[2]*j[6],P[1]=q[0]*j[1]+q[1]*j[4]+q[2]*j[7],P[2]=q[0]*j[2]+q[1]*j[5]+q[2]*j[8],P[3]=q[4]*j[0]+q[5]*j[3]+q[6]*j[6],P[4]=q[4]*j[1]+q[5]*j[4]+q[6]*j[7],P[5]=q[4]*j[2]+q[5]*j[5]+q[6]*j[8],P[6]=q[8]*j[0]+q[9]*j[3]+q[10]*j[6],P[7]=q[8]*j[1]+q[9]*j[4]+q[10]*j[7],P[8]=q[8]*j[2]+q[9]*j[5]+q[10]*j[8]}}else if(M.x=0,M.y=0,M.z=0,this._computeParticleRotation){q=l.m;P[0]=q[0],P[1]=q[1],P[2]=q[2],P[3]=q[4],P[4]=q[5],P[5]=q[6],P[6]=q[8],P[7]=q[9],P[8]=q[10]}var H=z[11];a.translateFromPivot?H.setAll(0):H.copyFrom(a.pivot);var k=z[0];k.copyFrom(a.position);var U=k.x-a.pivot.x,d=k.y-a.pivot.y,B=k.z-a.pivot.z,w=U*P[0]+d*P[3]+B*P[6],g=U*P[1]+d*P[4]+B*P[7],n=U*P[2]+d*P[5]+B*P[8];w+=H.x,g+=H.y,n+=H.z;var m=x[e]=M.x+r.x*w+N.x*g+I.x*n,E=x[e+1]=M.y+r.y*w+N.y*g+I.y*n,K=x[e+2]=M.z+r.z*w+N.z*g+I.z*n;if(this._computeBoundingBox&&(s.minimizeInPlaceFromFloats(m,E,K),o.maximizeInPlaceFromFloats(m,E,K)),this._computeParticleColor&&a.color){var G=a.color,u=this._colors32;u[V]=G.r,u[V+1]=G.g,u[V+2]=G.b,u[V+3]=G.a}if(this._computeParticleTexture&&a.uv){var J=a.uv,A=this._uvs32;A[c]=J.x,A[c+1]=J.y}}return L&&(this._computeParticleColor&&t.updateVerticesData(C.d.ColorKind,p,!1,!1),this._computeParticleTexture&&t.updateVerticesData(C.d.UVKind,R,!1,!1),t.updateVerticesData(C.d.PositionKind,x,!1,!1)),this._computeBoundingBox&&(t.hasBoundingInfo?t.getBoundingInfo().reConstruct(s,o,t._worldMatrix):t.buildBoundingInfo(s,o,t._worldMatrix)),this.afterUpdateParticles(W,i,L),this},W.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},W.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},W.prototype.setVisibilityBox=function(W){var i=W/2;this.mesh.buildBoundingInfo(new h.m(-i,-i,-i),new h.m(i,i,i))},Object.defineProperty(W.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(W){this._alwaysVisible=W,this.mesh.alwaysSelectAsActiveMesh=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeParticleRotation",{set:function(W){this._computeParticleRotation=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(W){this._computeParticleColor=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(W){this._computeParticleTexture=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(W){this._computeBoundingBox=W},enumerable:!1,configurable:!0}),W.prototype.initParticles=function(){},W.prototype.recycleParticle=function(W){return W},W.prototype.updateParticle=function(W){return W},W.prototype.beforeUpdateParticles=function(W,i,L){},W.prototype.afterUpdateParticles=function(W,i,L){}}()},56965:function(W,i,L){"use strict";L.d(i,{e:function(){return I}});var h=L(40061),l=L(21901),t=L(9271),p=L(80105),x="attribute vec2 position;\nuniform vec2 scale;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";L(16179).e.ShadersStore.postprocessVertexShader=x;var R=L(90690),z=(L(84468),L(9892)),r=L(31709),N=L(61803),I=function(){function W(W,i,L,h,x,R,z,r,I,s,o,D,S,C,e){void 0===z&&(z=1),void 0===s&&(s=null),void 0===o&&(o=0),void 0===D&&(D="postprocess"),void 0===C&&(C=!1),void 0===e&&(e=5),this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=0,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new l.h(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new p.k(1,1),this._texelSize=p.k.Zero(),this.onActivateObservable=new t.c,this.onSizeChangedObservable=new t.c,this.onApplyObservable=new t.c,this.onBeforeRenderObservable=new t.c,this.onAfterRenderObservable=new t.c,this.name=W,null!=R?(this._camera=R,this._scene=R.getScene(),R.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):r&&(this._engine=r,this._engine.postProcesses.push(this)),this._options=x,this.renderTargetSamplingMode=z||1,this._reusable=I||!1,this._textureType=o,this._textureFormat=e,this._samplers=h||[],this._samplers.push("textureSampler"),this._fragmentUrl=i,this._vertexUrl=D,this._parameters=L||[],this._parameters.push("scale"),this._indexParameters=S,this._drawWrapper=new N.b(this._engine),C||this.updateEffect(s)}return Object.defineProperty(W.prototype,"samples",{get:function(){return this._samples},set:function(W){var i=this;this._samples=Math.min(W,this._engine.getCaps().maxMSAASamples),this._textures.forEach((function(W){W.samples!==i._samples&&i._engine.updateRenderTargetTextureSampleCount(W,i._samples)}))},enumerable:!1,configurable:!0}),W.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(W.prototype,"onActivate",{set:function(W){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),W&&(this._onActivateObserver=this.onActivateObservable.add(W))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onSizeChanged",{set:function(W){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onApply",{set:function(W){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onBeforeRender",{set:function(W){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onAfterRender",{set:function(W){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(W){this._forcedOutputTexture=W},enumerable:!1,configurable:!0}),W.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())},W.prototype.getCamera=function(){return this._camera},Object.defineProperty(W.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),W.prototype.getClassName=function(){return"PostProcess"},W.prototype.getEngine=function(){return this._engine},W.prototype.getEffect=function(){return this._drawWrapper.effect},W.prototype.shareOutputWith=function(W){return this._disposeTextures(),this._shareOutputWithPostProcess=W,this},W.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new l.h(2)),this._shareOutputWithPostProcess=null},W.prototype.updateEffect=function(W,i,L,h,l,t,p,x){void 0===W&&(W=null),void 0===i&&(i=null),void 0===L&&(L=null),this._postProcessDefines=W,this._drawWrapper.effect=this._engine.createEffect({vertex:null!==p&&void 0!==p?p:this._vertexUrl,fragment:null!==x&&void 0!==x?x:this._fragmentUrl},["position"],i||this._parameters,L||this._samplers,null!==W?W:"",void 0,l,t,h||this._indexParameters)},W.prototype.isReusable=function(){return this._reusable},W.prototype.markTextureDirty=function(){this.width=-1},W.prototype._createRenderTargetTexture=function(W,i,L){void 0===L&&(L=0);for(var h=0;h<this._textureCache.length;h++)if(this._textureCache[h].texture.width===W.width&&this._textureCache[h].texture.height===W.height&&this._textureCache[h].postProcessChannel===L&&this._textureCache[h].texture._generateDepthBuffer===i.generateDepthBuffer)return this._textureCache[h].texture;var l=this._engine.createRenderTargetTexture(W,i);return this._textureCache.push({texture:l,postProcessChannel:L,lastUsedRenderId:-1}),l},W.prototype._flushTextureCache=function(){for(var W=this._renderId,i=this._textureCache.length-1;i>=0;i--)if(W-this._textureCache[i].lastUsedRenderId>100){for(var L=!1,h=0;h<this._textures.length;h++)if(this._textures.data[h]===this._textureCache[i].texture){L=!0;break}L||(this._textureCache[i].texture.dispose(),this._textureCache.splice(i,1))}},W.prototype._resize=function(W,i,L,h,l){this._textures.length>0&&this._textures.reset(),this.width=W,this.height=i;for(var t=null,p=0;p<L._postProcesses.length;p++)if(null!==L._postProcesses[p]){t=L._postProcesses[p];break}var x={width:this.width,height:this.height},R={generateMipMaps:h,generateDepthBuffer:l||t===this,generateStencilBuffer:(l||t===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._createRenderTargetTexture(x,R,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(x,R,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)},W.prototype.activate=function(W,i,L){var h,l,t=this;void 0===i&&(i=null);var p=(W=W||this._camera).getScene(),x=p.getEngine(),z=x.getCaps().maxTextureSize,r=(i?i.width:this._engine.getRenderWidth(!0))*this._options|0,N=(i?i.height:this._engine.getRenderHeight(!0))*this._options|0,I=W.parent;!I||I.leftCamera!=W&&I.rightCamera!=W||(r/=2);var s,o=this._options.width||r,D=this._options.height||N,S=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var C=x.currentViewport;C&&(o*=C.width,D*=C.height)}(S||this.alwaysForcePOT)&&(this._options.width||(o=x.needPOTTextures?R.c.GetExponentOfTwo(o,z,this.scaleMode):o),this._options.height||(D=x.needPOTTextures?R.c.GetExponentOfTwo(D,z,this.scaleMode):D)),this.width===o&&this.height===D||this._resize(o,D,W,S,L),this._textures.forEach((function(W){W.samples!==t.samples&&t._engine.updateRenderTargetTextureSampleCount(W,t.samples)})),this._flushTextureCache(),this._renderId++}if(this._shareOutputWithPostProcess)s=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)s=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{s=this.inputTexture;for(var e=void 0,V=0;V<this._textureCache.length;V++)if(this._textureCache[V].texture===s){e=this._textureCache[V];break}e&&(e.lastUsedRenderId=this._renderId)}return this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(r/o,N/D),this._engine.bindFramebuffer(s,0,r,N,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(s,0,void 0,void 0,this.forceFullscreenViewport)),null===(l=(h=this._engine)._debugInsertMarker)||void 0===l||l.call(h,"post process ".concat(this.name," input")),this.onActivateObservable.notifyObservers(W),this.autoClear&&0===this.alphaMode&&this._engine.clear(this.clearColor?this.clearColor:p.clearColor,p._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),s},Object.defineProperty(W.prototype,"isSupported",{get:function(){return this._drawWrapper.effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),W.prototype.isReady=function(){var W,i;return null!==(i=null===(W=this._drawWrapper.effect)||void 0===W?void 0:W.isReady())&&void 0!==i&&i},W.prototype.apply=function(){var W,i;return(null===(W=this._drawWrapper.effect)||void 0===W?void 0:W.isReady())?(this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),i=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",null===i||void 0===i?void 0:i.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),this._drawWrapper.effect):null},W.prototype._disposeTextures=function(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())},W.prototype._disposeTextureCache=function(){for(var W=this._textureCache.length-1;W>=0;W--)this._textureCache[W].texture.dispose();this._textureCache.length=0},W.prototype.setPrePassRenderer=function(W){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=W.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},W.prototype.dispose=function(W){var i;if(W=W||this._camera,this._disposeTextures(),this._scene&&-1!==(i=this._scene.postProcesses.indexOf(this))&&this._scene.postProcesses.splice(i,1),this._parentContainer){var L=this._parentContainer.postProcesses.indexOf(this);L>-1&&this._parentContainer.postProcesses.splice(L,1),this._parentContainer=null}if(-1!==(i=this._engine.postProcesses.indexOf(this))&&this._engine.postProcesses.splice(i,1),W){if(W.detachPostProcess(this),0===(i=W._postProcesses.indexOf(this))&&W._postProcesses.length>0){var h=this._camera._getFirstPostProcess();h&&h.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},W.prototype.serialize=function(){var W=z.d.Serialize(this),i=this.getCamera()||this._scene&&this._scene.activeCamera;return W.customType="BABYLON."+this.getClassName(),W.cameraId=i?i.id:null,W.reusable=this._reusable,W.textureType=this._textureType,W.fragmentUrl=this._fragmentUrl,W.parameters=this._parameters,W.samplers=this._samplers,W.options=this._options,W.defines=this._postProcessDefines,W.textureFormat=this._textureFormat,W.vertexUrl=this._vertexUrl,W.indexParameters=this._indexParameters,W},W.prototype.clone=function(){var i=this.serialize();i._engine=this._engine,i.cameraId=null;var L=W.Parse(i,this._scene,"");return L?(L.onActivateObservable=this.onActivateObservable.clone(),L.onSizeChangedObservable=this.onSizeChangedObservable.clone(),L.onApplyObservable=this.onApplyObservable.clone(),L.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),L.onAfterRenderObservable=this.onAfterRenderObservable.clone(),L._prePassEffectConfiguration=this._prePassEffectConfiguration,L):null},W.Parse=function(W,i,L){var h=(0,r.b)(W.customType);if(!h||!h._Parse)return null;var l=i?i.getCameraById(W.cameraId):null;return h._Parse(W,l,i,L)},W._Parse=function(i,L,h,l){return z.d.Parse((function(){return new W(i.name,i.fragmentUrl,i.parameters,i.samplers,i.options,L,i.renderTargetSamplingMode,i._engine,i.reusable,i.defines,i.textureType,i.vertexUrl,i.indexParameters,!1,i.textureFormat)}),i,h,l)},(0,h.j)([(0,z.H)()],W.prototype,"uniqueId",void 0),(0,h.j)([(0,z.H)()],W.prototype,"name",void 0),(0,h.j)([(0,z.H)()],W.prototype,"width",void 0),(0,h.j)([(0,z.H)()],W.prototype,"height",void 0),(0,h.j)([(0,z.H)()],W.prototype,"renderTargetSamplingMode",void 0),(0,h.j)([(0,z.r)()],W.prototype,"clearColor",void 0),(0,h.j)([(0,z.H)()],W.prototype,"autoClear",void 0),(0,h.j)([(0,z.H)()],W.prototype,"alphaMode",void 0),(0,h.j)([(0,z.H)()],W.prototype,"alphaConstants",void 0),(0,h.j)([(0,z.H)()],W.prototype,"enablePixelPerfectMode",void 0),(0,h.j)([(0,z.H)()],W.prototype,"forceFullscreenViewport",void 0),(0,h.j)([(0,z.H)()],W.prototype,"scaleMode",void 0),(0,h.j)([(0,z.H)()],W.prototype,"alwaysForcePOT",void 0),(0,h.j)([(0,z.H)("samples")],W.prototype,"_samples",void 0),(0,h.j)([(0,z.H)()],W.prototype,"adaptScaleToCurrentViewport",void 0),W}();(0,r.c)("BABYLON.PostProcess",I)},69233:function(W,i,L){"use strict";var h=L(16179),l=(L(83874),"rgbdDecodePixelShader"),t="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";h.e.ShadersStore[l]=t},63251:function(W,i,L){"use strict";var h=function(){function W(){var W=this;this.promise=new Promise((function(i,L){W._resolve=i,W._reject=L}))}return Object.defineProperty(W.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),W}(),l=L(80105),t=L(9488),p=L(9217),x=L(37643),R=L(35958),z=L(21664),r=L(9271),N=L(78588),I=L(45883),s=function(){function W(){}return W.prototype.getClassName=function(){return"TargetedAnimation"},W.prototype.serialize=function(){var W={};return W.animation=this.animation.serialize(),W.targetId=this.target.id,W},W}(),o=function(){function W(W,i){void 0===i&&(i=null),this.name=W,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._parentContainer=null,this.onAnimationEndObservable=new r.c,this.onAnimationLoopObservable=new r.c,this.onAnimationGroupLoopObservable=new r.c,this.onAnimationGroupEndObservable=new r.c,this.onAnimationGroupPauseObservable=new r.c,this.onAnimationGroupPlayObservable=new r.c,this.metadata=null,this._scene=i||N.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(W.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(W){if(this._speedRatio!==W){this._speedRatio=W;for(var i=0;i<this._animatables.length;i++){this._animatables[i].speedRatio=this._speedRatio}}},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(W){if(this._loopAnimation!==W){this._loopAnimation=W;for(var i=0;i<this._animatables.length;i++){this._animatables[i].loopAnimation=this._loopAnimation}}},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(W){if(this._isAdditive!==W){this._isAdditive=W;for(var i=0;i<this._animatables.length;i++){this._animatables[i].isAdditive=this._isAdditive}}},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),W.prototype.addTargetedAnimation=function(W,i){var L=new s;L.animation=W,L.target=i;var h=W.getKeys();return this._from>h[0].frame&&(this._from=h[0].frame),this._to<h[h.length-1].frame&&(this._to=h[h.length-1].frame),this._targetedAnimations.push(L),L},W.prototype.normalize=function(W,i){void 0===W&&(W=null),void 0===i&&(i=null),null==W&&(W=this._from),null==i&&(i=this._to);for(var L=0;L<this._targetedAnimations.length;L++){var h=this._targetedAnimations[L].animation.getKeys(),l=h[0],t=h[h.length-1];if(l.frame>W){var p={frame:W,value:l.value,inTangent:l.inTangent,outTangent:l.outTangent,interpolation:l.interpolation};h.splice(0,0,p)}if(t.frame<i){p={frame:i,value:t.value,inTangent:t.inTangent,outTangent:t.outTangent,interpolation:t.interpolation};h.push(p)}}return this._from=W,this._to=i,this},W.prototype._processLoop=function(W,i,L){var h=this;W.onAnimationLoop=function(){h.onAnimationLoopObservable.notifyObservers(i),h._animationLoopFlags[L]||(h._animationLoopFlags[L]=!0,h._animationLoopCount++,h._animationLoopCount===h._targetedAnimations.length&&(h.onAnimationGroupLoopObservable.notifyObservers(h),h._animationLoopCount=0,h._animationLoopFlags=[]))}},W.prototype.start=function(W,i,L,h,l){var t=this;if(void 0===W&&(W=!1),void 0===i&&(i=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=W,this._animationLoopCount=0,this._animationLoopFlags=[];for(var p=function(p){var R=x._targetedAnimations[p],z=x._scene.beginDirectAnimation(R.target,[R.animation],void 0!==L?L:x._from,void 0!==h?h:x._to,W,i,void 0,void 0,void 0!==l?l:x._isAdditive);z.onAnimationEnd=function(){t.onAnimationEndObservable.notifyObservers(R),t._checkAnimationGroupEnded(z)},x._processLoop(z,R,p),x._animatables.push(z)},x=this,R=0;R<this._targetedAnimations.length;R++)p(R);return this._speedRatio=i,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},W.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var W=0;W<this._animatables.length;W++){this._animatables[W].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},W.prototype.play=function(W){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==W&&(this.loopAnimation=W),this.restart()):(this.stop(),this.start(W,this._speedRatio)),this._isPaused=!1,this},W.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var W=0;W<this._animatables.length;W++){this._animatables[W].reset()}return this},W.prototype.restart=function(){if(!this._isStarted)return this;for(var W=0;W<this._animatables.length;W++){this._animatables[W].restart()}return this.onAnimationGroupPlayObservable.notifyObservers(this),this},W.prototype.stop=function(){if(!this._isStarted)return this;for(var W=this._animatables.slice(),i=0;i<W.length;i++)W[i].stop();return this._isStarted=!1,this},W.prototype.setWeightForAllAnimatables=function(W){for(var i=0;i<this._animatables.length;i++){this._animatables[i].weight=W}return this},W.prototype.syncAllAnimationsWith=function(W){for(var i=0;i<this._animatables.length;i++){this._animatables[i].syncWith(W)}return this},W.prototype.goToFrame=function(W){if(!this._isStarted)return this;for(var i=0;i<this._animatables.length;i++){this._animatables[i].goToFrame(W)}return this},W.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var W=this._scene.animationGroups.indexOf(this);if(W>-1&&this._scene.animationGroups.splice(W,1),this._parentContainer){var i=this._parentContainer.animationGroups.indexOf(this);i>-1&&this._parentContainer.animationGroups.splice(i,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},W.prototype._checkAnimationGroupEnded=function(W){var i=this._animatables.indexOf(W);i>-1&&this._animatables.splice(i,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},W.prototype.clone=function(i,L,h){void 0===h&&(h=!1);for(var l=new W(i||this.name,this._scene),t=0,p=this._targetedAnimations;t<p.length;t++){var x=p[t];l.addTargetedAnimation(h?x.animation.clone():x.animation,L?L(x.target):x.target)}return l},W.prototype.serialize=function(){var W={};W.name=this.name,W.from=this.from,W.to=this.to,W.targetedAnimations=[];for(var i=0;i<this.targetedAnimations.length;i++){var L=this.targetedAnimations[i];W.targetedAnimations[i]=L.serialize()}return I.d&&I.d.HasTags(this)&&(W.tags=I.d.GetTags(this)),this.metadata&&(W.metadata=this.metadata),W},W.Parse=function(i,L){for(var h=new W(i.name,L),l=0;l<i.targetedAnimations.length;l++){var t=i.targetedAnimations[l],p=z.c.Parse(t.animation),x=t.targetId;if("influence"===t.animation.property){var R=L.getMorphTargetById(x);R&&h.addTargetedAnimation(p,R)}else{var r=L.getNodeById(x);null!=r&&h.addTargetedAnimation(p,r)}}return null!==i.from&&null!==i.to&&h.normalize(i.from,i.to),I.d&&I.d.AddTagsTo(h,i.tags),void 0!==i.metadata&&(h.metadata=i.metadata),h},W.MakeAnimationAdditive=function(W,i,L,h,l){void 0===i&&(i=0),void 0===h&&(h=!1);var t=W;h&&(t=W.clone(l||t.name));for(var p=t.targetedAnimations,x=0;x<p.length;x++){var R=p[x];z.c.MakeAnimationAdditive(R.animation,i,L)}return t.isAdditive=!0,t},W.prototype.getClassName=function(){return"AnimationGroup"},W.prototype.toString=function(W){var i="Name: "+this.name;return i+=", type: "+this.getClassName(),W&&(i+=", from: "+this._from,i+=", to: "+this._to,i+=", isStarted: "+this._isStarted,i+=", speedRatio: "+this._speedRatio,i+=", targetedAnimations length: "+this._targetedAnimations.length,i+=", animatables length: "+this._animatables),i},W}(),D=L(40061),S=L(89214),C=L(74134),e=L(54044),V=function(W){function i(i,L,h,t,p,x,R){void 0===h&&(h=null),void 0===t&&(t=null),void 0===p&&(p=null),void 0===x&&(x=null),void 0===R&&(R=null);var z=W.call(this,i,L.getScene())||this;return z.name=i,z.children=new Array,z.animations=new Array,z._index=null,z._absoluteTransform=new l.d,z._invertedAbsoluteTransform=new l.d,z._scalingDeterminant=1,z._worldTransform=new l.d,z._needToDecompose=!0,z._needToCompose=!1,z._linkedTransformNode=null,z._waitingTransformNodeId=null,z._skeleton=L,z._localMatrix=t?t.clone():l.d.Identity(),z._restPose=p||z._localMatrix.clone(),z._baseMatrix=x||z._localMatrix.clone(),z._index=R,L.bones.push(z),z.setParent(h,!1),(x||t)&&z._updateDifferenceMatrix(),z}return(0,D.n)(i,W),Object.defineProperty(i.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(W){this._needToCompose=!1,W.updateFlag!==this._localMatrix.updateFlag&&(this._localMatrix.copyFrom(W),this._markAsDirtyAndDecompose())},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"Bone"},i.prototype.getSkeleton=function(){return this._skeleton},Object.defineProperty(i.prototype,"parent",{get:function(){return this._parentNode},set:function(W){this.setParent(W)},enumerable:!1,configurable:!0}),i.prototype.getParent=function(){return this.parent},i.prototype.getChildren=function(){return this.children},i.prototype.getIndex=function(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index},i.prototype.setParent=function(W,i){if(void 0===i&&(i=!0),this.parent!==W){if(this.parent){var L=this.parent.children.indexOf(this);-1!==L&&this.parent.children.splice(L,1)}this._parentNode=W,this.parent&&this.parent.children.push(this),i&&this._updateDifferenceMatrix(),this.markAsDirty()}},i.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},i.prototype.getBaseMatrix=function(){return this._baseMatrix},i.prototype.getRestPose=function(){return this._restPose},i.prototype.setRestPose=function(W){this._restPose.copyFrom(W)},i.prototype.getBindPose=function(){return this._baseMatrix},i.prototype.setBindPose=function(W){this.updateMatrix(W)},i.prototype.getWorldMatrix=function(){return this._worldTransform},i.prototype.returnToRest=function(){var W;if(this._linkedTransformNode){var i=l.h.Vector3[0],L=l.h.Quaternion[0],h=l.h.Vector3[1];this.getRestPose().decompose(i,L,h),this._linkedTransformNode.position.copyFrom(h),this._linkedTransformNode.rotationQuaternion=null!==(W=this._linkedTransformNode.rotationQuaternion)&&void 0!==W?W:l.g.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(L),this._linkedTransformNode.scaling.copyFrom(i)}else this._matrix=this._restPose},i.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},i.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},i.prototype.linkTransformNode=function(W){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=W,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},i.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(i.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(W){this._decompose(),this._localPosition.copyFrom(W),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.getRotation()},set:function(W){this.setRotation(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(W){this.setRotationQuaternion(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this.getScale()},set:function(W){this.setScale(W)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),i.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=l.m.Zero(),this._localRotation=l.g.Zero(),this._localPosition=l.m.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},i.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,l.d.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},i.prototype.updateMatrix=function(W,i,L){void 0===i&&(i=!0),void 0===L&&(L=!0),this._baseMatrix.copyFrom(W),i&&this._updateDifferenceMatrix(),L?this._matrix=W:this.markAsDirty()},i.prototype._updateDifferenceMatrix=function(W,i){if(void 0===i&&(i=!0),W||(W=this._baseMatrix),this.parent?W.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(W),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),i)for(var L=0;L<this.children.length;L++)this.children[L]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},i.prototype.markAsDirty=function(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this},i.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},i.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},i.prototype.translate=function(W,L,h){void 0===L&&(L=e.l.LOCAL);var t=this.getLocalMatrix();if(L==e.l.LOCAL)t.addAtIndex(12,W.x),t.addAtIndex(13,W.y),t.addAtIndex(14,W.z);else{var p=null;h&&(p=h.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var x=i._TmpMats[0],R=i._TmpVecs[0];this.parent?h&&p?(x.copyFrom(this.parent.getAbsoluteTransform()),x.multiplyToRef(p,x)):x.copyFrom(this.parent.getAbsoluteTransform()):l.d.IdentityToRef(x),x.setTranslationFromFloats(0,0,0),x.invert(),l.m.TransformCoordinatesToRef(W,x,R),t.addAtIndex(12,R.x),t.addAtIndex(13,R.y),t.addAtIndex(14,R.z)}this._markAsDirtyAndDecompose()},i.prototype.setPosition=function(W,L,h){void 0===L&&(L=e.l.LOCAL);var t=this.getLocalMatrix();if(L==e.l.LOCAL)t.setTranslationFromFloats(W.x,W.y,W.z);else{var p=null;h&&(p=h.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var x=i._TmpMats[0],R=i._TmpVecs[0];this.parent?(h&&p?(x.copyFrom(this.parent.getAbsoluteTransform()),x.multiplyToRef(p,x)):x.copyFrom(this.parent.getAbsoluteTransform()),x.invert()):l.d.IdentityToRef(x),l.m.TransformCoordinatesToRef(W,x,R),t.setTranslationFromFloats(R.x,R.y,R.z)}this._markAsDirtyAndDecompose()},i.prototype.setAbsolutePosition=function(W,i){this.setPosition(W,e.l.WORLD,i)},i.prototype.scale=function(W,L,h,t){void 0===t&&(t=!1);var p=this.getLocalMatrix(),x=i._TmpMats[0];l.d.ScalingToRef(W,L,h,x),x.multiplyToRef(p,p),x.invert();for(var R=0,z=this.children;R<z.length;R++){var r=(s=z[R]).getLocalMatrix();r.multiplyToRef(x,r),r.multiplyAtIndex(12,W),r.multiplyAtIndex(13,L),r.multiplyAtIndex(14,h),s._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),t)for(var N=0,I=this.children;N<I.length;N++){var s;(s=I[N]).scale(W,L,h,t)}},i.prototype.setScale=function(W){this._decompose(),this._localScaling.copyFrom(W),this._markAsDirtyAndCompose()},i.prototype.getScale=function(){return this._decompose(),this._localScaling},i.prototype.getScaleToRef=function(W){this._decompose(),W.copyFrom(this._localScaling)},i.prototype.setYawPitchRoll=function(W,L,h,t,p){if(void 0===t&&(t=e.l.LOCAL),t===e.l.LOCAL){var x=i._TmpQuat;return l.g.RotationYawPitchRollToRef(W,L,h,x),void this.setRotationQuaternion(x,t,p)}var R=i._TmpMats[0];if(this._getNegativeRotationToRef(R,p)){var z=i._TmpMats[1];l.d.RotationYawPitchRollToRef(W,L,h,z),R.multiplyToRef(z,z),this._rotateWithMatrix(z,t,p)}},i.prototype.rotate=function(W,L,h,t){void 0===h&&(h=e.l.LOCAL);var p=i._TmpMats[0];p.setTranslationFromFloats(0,0,0),l.d.RotationAxisToRef(W,L,p),this._rotateWithMatrix(p,h,t)},i.prototype.setAxisAngle=function(W,L,h,t){if(void 0===h&&(h=e.l.LOCAL),h===e.l.LOCAL){var p=i._TmpQuat;return l.g.RotationAxisToRef(W,L,p),void this.setRotationQuaternion(p,h,t)}var x=i._TmpMats[0];if(this._getNegativeRotationToRef(x,t)){var R=i._TmpMats[1];l.d.RotationAxisToRef(W,L,R),x.multiplyToRef(R,R),this._rotateWithMatrix(R,h,t)}},i.prototype.setRotation=function(W,i,L){void 0===i&&(i=e.l.LOCAL),this.setYawPitchRoll(W.y,W.x,W.z,i,L)},i.prototype.setRotationQuaternion=function(W,L,h){if(void 0===L&&(L=e.l.LOCAL),L===e.l.LOCAL)return this._decompose(),this._localRotation.copyFrom(W),void this._markAsDirtyAndCompose();var t=i._TmpMats[0];if(this._getNegativeRotationToRef(t,h)){var p=i._TmpMats[1];l.d.FromQuaternionToRef(W,p),t.multiplyToRef(p,p),this._rotateWithMatrix(p,L,h)}},i.prototype.setRotationMatrix=function(W,L,h){if(void 0===L&&(L=e.l.LOCAL),L===e.l.LOCAL){var t=i._TmpQuat;return l.g.FromRotationMatrixToRef(W,t),void this.setRotationQuaternion(t,L,h)}var p=i._TmpMats[0];if(this._getNegativeRotationToRef(p,h)){var x=i._TmpMats[1];x.copyFrom(W),p.multiplyToRef(W,x),this._rotateWithMatrix(x,L,h)}},i.prototype._rotateWithMatrix=function(W,L,h){void 0===L&&(L=e.l.LOCAL);var l=this.getLocalMatrix(),t=l.m[12],p=l.m[13],x=l.m[14],R=this.getParent(),z=i._TmpMats[3],r=i._TmpMats[4];R&&L==e.l.WORLD?(h?(z.copyFrom(h.getWorldMatrix()),R.getAbsoluteTransform().multiplyToRef(z,z)):z.copyFrom(R.getAbsoluteTransform()),r.copyFrom(z),r.invert(),l.multiplyToRef(z,l),l.multiplyToRef(W,l),l.multiplyToRef(r,l)):L==e.l.WORLD&&h?(z.copyFrom(h.getWorldMatrix()),r.copyFrom(z),r.invert(),l.multiplyToRef(z,l),l.multiplyToRef(W,l),l.multiplyToRef(r,l)):l.multiplyToRef(W,l),l.setTranslationFromFloats(t,p,x),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},i.prototype._getNegativeRotationToRef=function(W,L){var h=i._TmpMats[2];return W.copyFrom(this.getAbsoluteTransform()),L?(W.multiplyToRef(L.getWorldMatrix(),W),l.d.ScalingToRef(L.scaling.x,L.scaling.y,L.scaling.z,h)):l.d.IdentityToRef(h),W.invert(),!isNaN(W.m[0])&&(h.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyToRef(h,W),!0)},i.prototype.getPosition=function(W,i){void 0===W&&(W=e.l.LOCAL),void 0===i&&(i=null);var L=l.m.Zero();return this.getPositionToRef(W,i,L),L},i.prototype.getPositionToRef=function(W,L,h){if(void 0===W&&(W=e.l.LOCAL),W==e.l.LOCAL){var l=this.getLocalMatrix();h.x=l.m[12],h.y=l.m[13],h.z=l.m[14]}else{var t=null;L&&(t=L.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var p=i._TmpMats[0];L&&t?(p.copyFrom(this.getAbsoluteTransform()),p.multiplyToRef(t,p)):p=this.getAbsoluteTransform(),h.x=p.m[12],h.y=p.m[13],h.z=p.m[14]}},i.prototype.getAbsolutePosition=function(W){void 0===W&&(W=null);var i=l.m.Zero();return this.getPositionToRef(e.l.WORLD,W,i),i},i.prototype.getAbsolutePositionToRef=function(W,i){this.getPositionToRef(e.l.WORLD,W,i)},i.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var W=this._skeleton.getPoseMatrix();W&&this._absoluteTransform.multiplyToRef(W,this._absoluteTransform)}for(var i=this.children,L=i.length,h=0;h<L;h++)i[h].computeAbsoluteTransforms()},i.prototype.getDirection=function(W,i){void 0===i&&(i=null);var L=l.m.Zero();return this.getDirectionToRef(W,i,L),L},i.prototype.getDirectionToRef=function(W,L,h){void 0===L&&(L=null);var t=null;L&&(t=L.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var p=i._TmpMats[0];p.copyFrom(this.getAbsoluteTransform()),L&&t&&p.multiplyToRef(t,p),l.m.TransformNormalToRef(W,p,h),h.normalize()},i.prototype.getRotation=function(W,i){void 0===W&&(W=e.l.LOCAL),void 0===i&&(i=null);var L=l.m.Zero();return this.getRotationToRef(W,i,L),L},i.prototype.getRotationToRef=function(W,L,h){void 0===W&&(W=e.l.LOCAL),void 0===L&&(L=null);var l=i._TmpQuat;this.getRotationQuaternionToRef(W,L,l),l.toEulerAnglesToRef(h)},i.prototype.getRotationQuaternion=function(W,i){void 0===W&&(W=e.l.LOCAL),void 0===i&&(i=null);var L=l.g.Identity();return this.getRotationQuaternionToRef(W,i,L),L},i.prototype.getRotationQuaternionToRef=function(W,L,h){if(void 0===W&&(W=e.l.LOCAL),void 0===L&&(L=null),W==e.l.LOCAL)this._decompose(),h.copyFrom(this._localRotation);else{var l=i._TmpMats[0],t=this.getAbsoluteTransform();L?t.multiplyToRef(L.getWorldMatrix(),l):l.copyFrom(t),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.decompose(void 0,h,void 0)}},i.prototype.getRotationMatrix=function(W,i){void 0===W&&(W=e.l.LOCAL);var L=l.d.Identity();return this.getRotationMatrixToRef(W,i,L),L},i.prototype.getRotationMatrixToRef=function(W,L,h){if(void 0===W&&(W=e.l.LOCAL),W==e.l.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(h);else{var l=i._TmpMats[0],t=this.getAbsoluteTransform();L?t.multiplyToRef(L.getWorldMatrix(),l):l.copyFrom(t),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.getRotationMatrixToRef(h)}},i.prototype.getAbsolutePositionFromLocal=function(W,i){void 0===i&&(i=null);var L=l.m.Zero();return this.getAbsolutePositionFromLocalToRef(W,i,L),L},i.prototype.getAbsolutePositionFromLocalToRef=function(W,L,h){void 0===L&&(L=null);var t=null;L&&(t=L.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var p=i._TmpMats[0];L&&t?(p.copyFrom(this.getAbsoluteTransform()),p.multiplyToRef(t,p)):p=this.getAbsoluteTransform(),l.m.TransformCoordinatesToRef(W,p,h)},i.prototype.getLocalPositionFromAbsolute=function(W,i){void 0===i&&(i=null);var L=l.m.Zero();return this.getLocalPositionFromAbsoluteToRef(W,i,L),L},i.prototype.getLocalPositionFromAbsoluteToRef=function(W,L,h){void 0===L&&(L=null);var t=null;L&&(t=L.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var p=i._TmpMats[0];p.copyFrom(this.getAbsoluteTransform()),L&&t&&p.multiplyToRef(t,p),p.invert(),l.m.TransformCoordinatesToRef(W,p,h)},i.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},i._TmpVecs=S.e.BuildArray(2,l.m.Zero),i._TmpQuat=l.g.Identity(),i._TmpMats=S.e.BuildArray(5,l.d.Identity),i}(C.b),c=L(15099),f=L(7686),a=L(9127),P=L(51004),y=function(){function W(W,i,L){this.name=W,this.id=i,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=l.d.Identity(),this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new r.c,this.bones=[],this._scene=L||N.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var h=this._scene.getEngine().getCaps();this._canUseTextureForBones=h.textureFloat&&h.maxVertexTextureImageUnits>0}return Object.defineProperty(W.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(W){this._useTextureToStoreBoneMatrices=W,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(W){this._animationPropertiesOverride=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),W.prototype.getClassName=function(){return"Skeleton"},W.prototype.getChildren=function(){return this.bones.filter((function(W){return!W.getParent()}))},W.prototype.getTransformMatrices=function(W){return this.needInitialSkinMatrix?(W._bonesTransformMatrices||this.prepare(),W._bonesTransformMatrices):(this._transformMatrices||this.prepare(),this._transformMatrices)},W.prototype.getTransformMatrixTexture=function(W){return this.needInitialSkinMatrix&&W._transformMatrixTexture?W._transformMatrixTexture:this._transformMatrixTexture},W.prototype.getScene=function(){return this._scene},W.prototype.toString=function(W){var i="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);if(i+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none"),W){i+=", Ranges: {";var L=!0;for(var h in this._ranges)L&&(i+=", ",L=!1),i+=h;i+="}"}return i},W.prototype.getBoneIndexByName=function(W){for(var i=0,L=this.bones.length;i<L;i++)if(this.bones[i].name===W)return i;return-1},W.prototype.createAnimationRange=function(W,i,L){if(!this._ranges[W]){this._ranges[W]=new f.e(W,i,L);for(var h=0,l=this.bones.length;h<l;h++)this.bones[h].animations[0]&&this.bones[h].animations[0].createRange(W,i,L)}},W.prototype.deleteAnimationRange=function(W,i){void 0===i&&(i=!0);for(var L=0,h=this.bones.length;L<h;L++)this.bones[L].animations[0]&&this.bones[L].animations[0].deleteRange(W,i);this._ranges[W]=null},W.prototype.getAnimationRange=function(W){return this._ranges[W]||null},W.prototype.getAnimationRanges=function(){var W,i=[];for(W in this._ranges)i.push(this._ranges[W]);return i},W.prototype.copyAnimationRange=function(W,i,L){if(void 0===L&&(L=!1),this._ranges[i]||!W.getAnimationRange(i))return!1;var h,l,t=!0,p=this._getHighestAnimationFrame()+1,x={},R=W.bones;for(l=0,h=R.length;l<h;l++)x[R[l].name]=R[l];this.bones.length!==R.length&&(a.e.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(R.length)),t=!1);var z=L&&this.dimensionsAtRest&&W.dimensionsAtRest?this.dimensionsAtRest.divide(W.dimensionsAtRest):null;for(l=0,h=this.bones.length;l<h;l++){var r=this.bones[l].name,N=x[r];N?t=t&&this.bones[l].copyAnimationRange(N,i,p,L,z):(a.e.Warn("copyAnimationRange: not same rig, missing source bone "+r),t=!1)}var I=W.getAnimationRange(i);return I&&(this._ranges[i]=new f.e(i,I.from+p,I.to+p)),t},W.prototype.returnToRest=function(){for(var W=0,i=this.bones;W<i.length;W++){var L=i[W];-1!==L._index&&L.returnToRest()}},W.prototype._getHighestAnimationFrame=function(){for(var W=0,i=0,L=this.bones.length;i<L;i++)if(this.bones[i].animations[0]){var h=this.bones[i].animations[0].getHighestFrame();W<h&&(W=h)}return W},W.prototype.beginAnimation=function(W,i,L,h){var l=this.getAnimationRange(W);return l?this._scene.beginAnimation(this,l.from,l.to,i,L,h):null},W.MakeAnimationAdditive=function(W,i,L){void 0===i&&(i=0);var h=W.getAnimationRange(L);if(!h)return null;for(var l=W._scene.getAllAnimatablesByTarget(W),t=null,p=0;p<l.length;p++){var x=l[p];if(x.fromFrame===(null===h||void 0===h?void 0:h.from)&&x.toFrame===(null===h||void 0===h?void 0:h.to)){t=x;break}}var R=W.getAnimatables();for(p=0;p<R.length;p++){var r=R[p].animations;if(r)for(var N=0;N<r.length;N++)z.c.MakeAnimationAdditive(r[N],i,L)}return t&&(t.isAdditive=!0),W},W.prototype._markAsDirty=function(){this._isDirty=!0,this._absoluteTransformIsDirty=!0},W.prototype._registerMeshWithPoseMatrix=function(W){this._meshesWithPoseMatrix.push(W)},W.prototype._unregisterMeshWithPoseMatrix=function(W){var i=this._meshesWithPoseMatrix.indexOf(W);i>-1&&this._meshesWithPoseMatrix.splice(i,1)},W.prototype._computeTransformMatrices=function(W,i){this.onBeforeComputeObservable.notifyObservers(this);for(var L=0;L<this.bones.length;L++){var h=this.bones[L];h._childUpdateId++;var l=h.getParent();if(l?h.getLocalMatrix().multiplyToRef(l.getWorldMatrix(),h.getWorldMatrix()):i?h.getLocalMatrix().multiplyToRef(i,h.getWorldMatrix()):h.getWorldMatrix().copyFrom(h.getLocalMatrix()),-1!==h._index){var t=null===h._index?L:h._index;h.getInvertedAbsoluteTransform().multiplyToArray(h.getWorldMatrix(),W,16*t)}}this._identity.copyToArray(W,16*this.bones.length)},W.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var W=0,i=this.bones;W<i.length;W++){(r=i[W])._linkedTransformNode&&(r._linkedTransformNode.computeWorldMatrix(),r._matrix=r._linkedTransformNode._localMatrix)}if(this.needInitialSkinMatrix)for(var L=0,h=this._meshesWithPoseMatrix;L<h.length;L++){var t=h[L],p=t.getPoseMatrix(),x=this._isDirty;if(t._bonesTransformMatrices&&t._bonesTransformMatrices.length===16*(this.bones.length+1)||(t._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),x=!0),x){if(this._synchronizedWithMesh!==t){this._synchronizedWithMesh=t;for(var R=0,z=this.bones;R<z.length;R++){var r;if(!(r=z[R]).getParent())r.getBaseMatrix().multiplyToRef(p,l.h.Matrix[1]),r._updateDifferenceMatrix(l.h.Matrix[1])}if(this.isUsingTextureForMatrices){var N=4*(this.bones.length+1);t._transformMatrixTexture&&t._transformMatrixTexture.getSize().width===N||(t._transformMatrixTexture&&t._transformMatrixTexture.dispose(),t._transformMatrixTexture=c.b.CreateRGBATexture(t._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(t._bonesTransformMatrices,p),this.isUsingTextureForMatrices&&t._transformMatrixTexture&&t._transformMatrixTexture.update(t._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=c.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1},W.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var W=0;W<this.bones.length;W++)this._animatables.push(this.bones[W])}return this._animatables},W.prototype.clone=function(i,L){var h=new W(i,L||i,this._scene);h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var l=0;l<this.bones.length;l++){var t=this.bones[l],p=null,x=t.getParent();if(x){var R=this.bones.indexOf(x);p=h.bones[R]}var z=new V(t.name,h,p,t.getBaseMatrix().clone(),t.getRestPose().clone());z._index=t._index,t._linkedTransformNode&&z.linkTransformNode(t._linkedTransformNode),P.e.DeepCopy(t.animations,z.animations)}if(this._ranges)for(var r in h._ranges={},this._ranges){var N=this._ranges[r];N&&(h._ranges[r]=N.clone())}return this._isDirty=!0,h},W.prototype.enableBlending=function(W){void 0===W&&(W=.01),this.bones.forEach((function(i){i.animations.forEach((function(i){i.enableBlending=!0,i.blendingSpeed=W}))}))},W.prototype.dispose=function(){if(this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){var W=this._parentContainer.skeletons.indexOf(this);W>-1&&this._parentContainer.skeletons.splice(W,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},W.prototype.serialize=function(){var W,i={};i.name=this.name,i.id=this.id,this.dimensionsAtRest&&(i.dimensionsAtRest=this.dimensionsAtRest.asArray()),i.bones=[],i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var L=0;L<this.bones.length;L++){var h=this.bones[L],l=h.getParent(),t={parentBoneIndex:l?this.bones.indexOf(l):-1,index:h.getIndex(),name:h.name,id:h.id,matrix:h.getBaseMatrix().toArray(),rest:h.getRestPose().toArray(),linkedTransformNodeId:null===(W=h.getTransformNode())||void 0===W?void 0:W.id};for(var p in i.bones.push(t),h.length&&(t.length=h.length),h.metadata&&(t.metadata=h.metadata),h.animations&&h.animations.length>0&&(t.animation=h.animations[0].serialize()),i.ranges=[],this._ranges){var x=this._ranges[p];if(x){var R={};R.name=p,R.from=x.from,R.to=x.to,i.ranges.push(R)}}}return i},W.Parse=function(i,L){var h,t=new W(i.name,i.id,L);for(i.dimensionsAtRest&&(t.dimensionsAtRest=l.m.FromArray(i.dimensionsAtRest)),t.needInitialSkinMatrix=i.needInitialSkinMatrix,h=0;h<i.bones.length;h++){var p=i.bones[h],x=i.bones[h].index,R=null;p.parentBoneIndex>-1&&(R=t.bones[p.parentBoneIndex]);var r=p.rest?l.d.FromArray(p.rest):null,N=new V(p.name,t,R,l.d.FromArray(p.matrix),r,null,x);void 0!==p.id&&null!==p.id&&(N.id=p.id),p.length&&(N.length=p.length),p.metadata&&(N.metadata=p.metadata),p.animation&&N.animations.push(z.c.Parse(p.animation)),void 0!==p.linkedTransformNodeId&&null!==p.linkedTransformNodeId&&(t._hasWaitingData=!0,N._waitingTransformNodeId=p.linkedTransformNodeId)}if(i.ranges)for(h=0;h<i.ranges.length;h++){var I=i.ranges[h];t.createAnimationRange(I.name,I.from,I.to)}return t},W.prototype.computeAbsoluteTransforms=function(W){void 0===W&&(W=!1),(this._absoluteTransformIsDirty||W)&&(this.bones[0].computeAbsoluteTransforms(),this._absoluteTransformIsDirty=!1)},W.prototype.getPoseMatrix=function(){var W=null;return this._meshesWithPoseMatrix.length>0&&(W=this._meshesWithPoseMatrix[0].getPoseMatrix()),W},W.prototype.sortBones=function(){for(var W=new Array,i=new Array(this.bones.length),L=0;L<this.bones.length;L++)this._sortBones(L,W,i);this.bones=W},W.prototype._sortBones=function(W,i,L){if(!L[W]){L[W]=!0;var h=this.bones[W];if(h){void 0===h._index&&(h._index=W);var l=h.getParent();l&&this._sortBones(this.bones.indexOf(l),i,L),i.push(h)}}},W.prototype.setCurrentPoseAsRest=function(){this.bones.forEach((function(W){W.setCurrentPoseAsRest()}))},W}(),M=L(46907),b=L(9892),j=L(5344),Z=L(82325),X=L(31709),T=function(W){function i(L,h){var l=W.call(this,L,h)||this;return l.directIntensity=1,l.emissiveIntensity=1,l.environmentIntensity=1,l.specularIntensity=1,l.disableBumpMap=!1,l.ambientTextureStrength=1,l.ambientTextureImpactOnAnalyticalLights=i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,l.metallicF0Factor=1,l.metallicReflectanceColor=t.d.White(),l.useOnlyMetallicFromMetallicReflectanceTexture=!1,l.ambientColor=new t.d(0,0,0),l.albedoColor=new t.d(1,1,1),l.reflectivityColor=new t.d(1,1,1),l.reflectionColor=new t.d(1,1,1),l.emissiveColor=new t.d(0,0,0),l.microSurface=1,l.useLightmapAsShadowmap=!1,l.useAlphaFromAlbedoTexture=!1,l.forceAlphaTest=!1,l.alphaCutOff=.4,l.useSpecularOverAlpha=!0,l.useMicroSurfaceFromReflectivityMapAlpha=!1,l.useRoughnessFromMetallicTextureAlpha=!0,l.useRoughnessFromMetallicTextureGreen=!1,l.useMetallnessFromMetallicTextureBlue=!1,l.useAmbientOcclusionFromMetallicTextureRed=!1,l.useAmbientInGrayScale=!1,l.useAutoMicroSurfaceFromReflectivityMap=!1,l.useRadianceOverAlpha=!0,l.useObjectSpaceNormalMap=!1,l.useParallax=!1,l.useParallaxOcclusion=!1,l.parallaxScaleBias=.05,l.disableLighting=!1,l.forceIrradianceInFragment=!1,l.maxSimultaneousLights=4,l.invertNormalMapX=!1,l.invertNormalMapY=!1,l.twoSidedLighting=!1,l.useAlphaFresnel=!1,l.useLinearAlphaFresnel=!1,l.environmentBRDFTexture=null,l.forceNormalForward=!1,l.enableSpecularAntiAliasing=!1,l.useHorizonOcclusion=!0,l.useRadianceOcclusion=!0,l.unlit=!1,l._environmentBRDFTexture=(0,j.c)(l.getScene()),l}return(0,D.n)(i,W),Object.defineProperty(i.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(W){this.subSurface.refractionTexture=W,W?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"indexOfRefraction",{get:function(){return this.subSurface.indexOfRefraction},set:function(W){this.subSurface.indexOfRefraction=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(W){this.subSurface.invertRefractionY=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(W){this.subSurface.linkRefractionWithTransparency=W,W&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===Z.c.LIGHTFALLOFF_PHYSICAL},set:function(W){W!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=W?Z.c.LIGHTFALLOFF_PHYSICAL:Z.c.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===Z.c.LIGHTFALLOFF_GLTF},set:function(W){W!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=W?Z.c.LIGHTFALLOFF_GLTF:Z.c.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(W){this._attachImageProcessingConfiguration(W),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(W){this.imageProcessingConfiguration.colorCurvesEnabled=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(W){this.imageProcessingConfiguration.colorGradingEnabled=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(W){this._imageProcessingConfiguration.toneMappingEnabled=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(W){this._imageProcessingConfiguration.exposure=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(W){this._imageProcessingConfiguration.contrast=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(W){this._imageProcessingConfiguration.colorGradingTexture=W},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(W){this._imageProcessingConfiguration.colorCurves=W},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PBRMaterial"},i.prototype.clone=function(W){var L=this,h=b.d.Clone((function(){return new i(W,L.getScene())}),this);return h.id=W,h.name=W,this.stencil.copyTo(h.stencil),this.clearCoat.copyTo(h.clearCoat),this.anisotropy.copyTo(h.anisotropy),this.brdf.copyTo(h.brdf),this.sheen.copyTo(h.sheen),this.subSurface.copyTo(h.subSurface),h},i.prototype.serialize=function(){var i=W.prototype.serialize.call(this);return i.customType="BABYLON.PBRMaterial",i.clearCoat=this.clearCoat.serialize(),i.anisotropy=this.anisotropy.serialize(),i.brdf=this.brdf.serialize(),i.sheen=this.sheen.serialize(),i.subSurface=this.subSurface.serialize(),i.iridescence=this.iridescence.serialize(),i},i.Parse=function(W,L,h){var l=b.d.Parse((function(){return new i(W.name,L)}),W,L,h);return W.stencil&&l.stencil.parse(W.stencil,L,h),W.clearCoat&&l.clearCoat.parse(W.clearCoat,L,h),W.anisotropy&&l.anisotropy.parse(W.anisotropy,L,h),W.brdf&&l.brdf.parse(W.brdf,L,h),W.sheen&&l.sheen.parse(W.sheen,L,h),W.subSurface&&l.subSurface.parse(W.subSurface,L,h),W.iridescence&&l.iridescence.parse(W.iridescence,L,h),l},i.PBRMATERIAL_OPAQUE=Z.c.PBRMATERIAL_OPAQUE,i.PBRMATERIAL_ALPHATEST=Z.c.PBRMATERIAL_ALPHATEST,i.PBRMATERIAL_ALPHABLEND=Z.c.PBRMATERIAL_ALPHABLEND,i.PBRMATERIAL_ALPHATESTANDBLEND=Z.c.PBRMATERIAL_ALPHATESTANDBLEND,i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=Z.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"directIntensity",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveIntensity",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"environmentIntensity",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"specularIntensity",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"disableBumpMap",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTexture",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTextureStrength",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"opacityTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectivityTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicTexture",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallic",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicF0Factor",void 0),(0,D.j)([(0,b.q)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicReflectanceColor",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicReflectanceTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectanceTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"microSurfaceTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),(0,D.j)([(0,b.C)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty",null)],i.prototype,"lightmapTexture",void 0),(0,D.j)([(0,b.q)("ambient"),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientColor",void 0),(0,D.j)([(0,b.q)("albedo"),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoColor",void 0),(0,D.j)([(0,b.q)("reflectivity"),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectivityColor",void 0),(0,D.j)([(0,b.q)("reflection"),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionColor",void 0),(0,D.j)([(0,b.q)("emissive"),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveColor",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"microSurface",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"useAlphaFromAlbedoTexture",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"forceAlphaTest",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"alphaCutOff",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useSpecularOverAlpha",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAmbientInGrayScale",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,D.j)([(0,b.H)()],i.prototype,"usePhysicalLightFalloff",null),(0,D.j)([(0,b.H)()],i.prototype,"useGLTFLightFalloff",null),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRadianceOverAlpha",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useObjectSpaceNormalMap",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallax",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallaxOcclusion",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"parallaxScaleBias",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"forceIrradianceInFragment",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"twoSidedLighting",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAlphaFresnel",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLinearAlphaFresnel",void 0),(0,D.j)([(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"environmentBRDFTexture",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"forceNormalForward",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"enableSpecularAntiAliasing",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useHorizonOcclusion",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRadianceOcclusion",void 0),(0,D.j)([(0,b.H)(),(0,b.g)("_markAllSubMeshesAsMiscDirty")],i.prototype,"unlit",void 0),i}(Z.c);(0,X.c)("BABYLON.PBRMaterial",T);var F=L(70937),q=L(77129),H=L(43251),k=L(3579),U=L(65847),d=function(){function W(W,i,L){void 0===i&&(i=0),void 0===L&&(L=null),this.name=W,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new r.c,this._onDataLayoutChanged=new r.c,this._animationPropertiesOverride=null,this._scene=L||N.d.LastCreatedScene,this.influence=i,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(W.prototype,"influence",{get:function(){return this._influence},set:function(W){if(this._influence!==W){var i=this._influence;this._influence=W,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===i||0===W)}},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(W){this._animationPropertiesOverride=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0}),W.prototype.setPositions=function(W){var i=this.hasPositions;this._positions=W,i!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},W.prototype.getPositions=function(){return this._positions},W.prototype.setNormals=function(W){var i=this.hasNormals;this._normals=W,i!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},W.prototype.getNormals=function(){return this._normals},W.prototype.setTangents=function(W){var i=this.hasTangents;this._tangents=W,i!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},W.prototype.getTangents=function(){return this._tangents},W.prototype.setUVs=function(W){var i=this.hasUVs;this._uvs=W,i!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},W.prototype.getUVs=function(){return this._uvs},W.prototype.clone=function(){var i=this,L=b.d.Clone((function(){return new W(i.name,i.influence,i._scene)}),this);return L._positions=this._positions,L._normals=this._normals,L._tangents=this._tangents,L._uvs=this._uvs,L},W.prototype.serialize=function(){var W={};return W.name=this.name,W.influence=this.influence,W.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(W.id=this.id),this.hasNormals&&(W.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(W.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(W.uvs=Array.prototype.slice.call(this.getUVs())),b.d.AppendSerializedAnimations(this,W),W},W.prototype.getClassName=function(){return"MorphTarget"},W.Parse=function(i,L){var h=new W(i.name,i.influence);if(h.setPositions(i.positions),null!=i.id&&(h.id=i.id),i.normals&&h.setNormals(i.normals),i.tangents&&h.setTangents(i.tangents),i.uvs&&h.setUVs(i.uvs),i.animations){for(var l=0;l<i.animations.length;l++){var t=i.animations[l],p=(0,X.b)("BABYLON.Animation");p&&h.animations.push(p.Parse(t))}i.autoAnimate&&L&&L.beginAnimation(h,i.autoAnimateFrom,i.autoAnimateTo,i.autoAnimateLoop,i.autoAnimateSpeed||1)}return h},W.FromMesh=function(i,L,h){L||(L=i.name);var l=new W(L,h,i.getScene());return l.setPositions(i.getVerticesData(H.d.PositionKind)),i.isVerticesDataPresent(H.d.NormalKind)&&l.setNormals(i.getVerticesData(H.d.NormalKind)),i.isVerticesDataPresent(H.d.TangentKind)&&l.setTangents(i.getVerticesData(H.d.TangentKind)),i.isVerticesDataPresent(H.d.UVKind)&&l.setUVs(i.getVerticesData(H.d.UVKind)),l},(0,D.j)([(0,b.H)()],W.prototype,"id",void 0),W}(),B=L(21901),w=L(57194),g=function(){function W(W){if(void 0===W&&(W=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new B.h(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._useTextureToStoreTargets=!0,W||(W=N.d.LastCreatedScene),this._scene=W,this._scene){this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId();var i=this._scene.getEngine().getCaps();this._canUseTextureForTargets=i.canUseGLVertexID&&i.textureFloat&&i.maxVertexTextureImageUnits>0&&i.texture2DArrayMaxLayerCount>1}}return Object.defineProperty(W.prototype,"areUpdatesFrozen",{get:function(){return this._blockCounter>0},set:function(W){W?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"useTextureToStoreTargets",{get:function(){return this._useTextureToStoreTargets},set:function(W){this._useTextureToStoreTargets=W},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"isUsingTextureForTargets",{get:function(){return W.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets},enumerable:!1,configurable:!0}),W.prototype.getActiveTarget=function(W){return this._activeTargets.data[W]},W.prototype.getTarget=function(W){return this._targets[W]},W.prototype.addTarget=function(W){var i=this;this._targets.push(W),this._targetInfluenceChangedObservers.push(W.onInfluenceChanged.add((function(W){i._syncActiveTargets(W)}))),this._targetDataLayoutChangedObservers.push(W._onDataLayoutChanged.add((function(){i._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)},W.prototype.removeTarget=function(W){var i=this._targets.indexOf(W);i>=0&&(this._targets.splice(i,1),W.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(i,1)[0]),W._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(i,1)[0]),this._syncActiveTargets(!0))},W.prototype._bind=function(W){W.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),W.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),W.setTexture("morphTargets",this._targetStoreTexture)},W.prototype.clone=function(){for(var i=new W(this._scene),L=0,h=this._targets;L<h.length;L++){var l=h[L];i.addTarget(l.clone())}return i.enableNormalMorphing=this.enableNormalMorphing,i.enableTangentMorphing=this.enableTangentMorphing,i.enableUVMorphing=this.enableUVMorphing,i},W.prototype.serialize=function(){var W={};W.id=this.uniqueId,W.targets=[];for(var i=0,L=this._targets;i<L.length;i++){var h=L[i];W.targets.push(h.serialize())}return W},W.prototype._syncActiveTargets=function(W){if(!this.areUpdatesFrozen){var i=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));for(var L=-1,h=0,l=this._targets;h<l.length;h++){var t=l[h];if(L++,0!==t.influence||!this.optimizeInfluencers){this._activeTargets.push(t),this._morphTargetTextureIndices[i]=L,this._tempInfluences[i++]=t.influence,this._supportsNormals=this._supportsNormals&&t.hasNormals,this._supportsTangents=this._supportsTangents&&t.hasTangents,this._supportsUVs=this._supportsUVs&&t.hasUVs;var p=t.getPositions();if(p){var x=p.length/3;if(0===this._vertexCount)this._vertexCount=x;else if(this._vertexCount!==x)return void a.e.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===i||(this._influences=new Float32Array(i));for(var R=0;R<i;R++)this._influences[R]=this._tempInfluences[R];W&&this.synchronize()}},W.prototype.synchronize=function(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&this._vertexCount){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride,this._textureHeight=1;var W=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>W&&(this._textureHeight=Math.ceil(this._textureWidth/W),this._textureWidth=W);var i=!0;if(this._targetStoreTexture){var L=this._targetStoreTexture.getSize();L.width===this._textureWidth&&L.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(i=!1)}if(i){this._targetStoreTexture&&this._targetStoreTexture.dispose();for(var h=this._targets.length,l=new Float32Array(h*this._textureWidth*this._textureHeight*4),t=0,p=0;p<h;p++){var x=this._targets[p],R=x.getPositions(),z=x.getNormals(),r=x.getUVs(),N=x.getTangents();if(!R)return void(0===p&&a.e.Error("Invalid morph target. Target must have positions."));t=p*this._textureWidth*this._textureHeight*4;for(var I=0;I<this._vertexCount;I++)l[t]=R[3*I],l[t+1]=R[3*I+1],l[t+2]=R[3*I+2],t+=4,z&&(l[t]=z[3*I],l[t+1]=z[3*I+1],l[t+2]=z[3*I+2],t+=4),r&&(l[t]=r[2*I],l[t+1]=r[2*I+1],t+=4),N&&(l[t]=N[3*I],l[t+1]=N[3*I+1],l[t+2]=N[3*I+2],t+=4)}this._targetStoreTexture=w.d.CreateRGBATexture(l,this._textureWidth,this._textureHeight,h,this._scene,!1,!1,1,1)}}for(var s=0,o=this._scene.meshes;s<o.length;s++){var D=o[s];D.morphTargetManager===this&&D._syncGeometryWithMorphTargetManager()}}},W.prototype.dispose=function(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene&&(this._scene.removeMorphTargetManager(this),this._parentContainer)){var W=this._parentContainer.morphTargetManagers.indexOf(this);W>-1&&this._parentContainer.morphTargetManagers.splice(W,1),this._parentContainer=null}},W.Parse=function(i,L){var h=new W(L);h._uniqueId=i.id;for(var l=0,t=i.targets;l<t.length;l++){var p=t[l];h.addTarget(d.Parse(p,L))}return h},W.EnableTextureStorage=!0,W}(),n=L(47984),m=L(25488),E=L(82790),K=L(97918),G=function(){function W(){}return W.Get=function(W,i,L){if(!i||void 0==L||!i[L])throw new Error("".concat(W,": Failed to find index (").concat(L,")"));return i[L]},W.Assign=function(W){if(W)for(var i=0;i<W.length;i++)W[i].index=i},W}();function u(){for(var W=[],i=0;i<arguments.length;i++)W[i]=arguments[i];var L=function(W){return W&&"object"===typeof W};return W.reduce((function(W,i){return Object.keys(i).forEach((function(h){var l=W[h],t=i[h];Array.isArray(l)&&Array.isArray(t)?W[h]=l.concat.apply(l,t):L(l)&&L(t)?W[h]=u(l,t):W[h]=t})),W}),{})}var J=function(){function W(W){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=W}return W.RegisterExtension=function(i,L){W.UnregisterExtension(i)&&a.e.Warn("Extension with the name '".concat(i,"' already exists")),W._RegisteredExtensions[i]={factory:L}},W.UnregisterExtension=function(i){return!!W._RegisteredExtensions[i]&&(delete W._RegisteredExtensions[i],!0)},Object.defineProperty(W.prototype,"gltf",{get:function(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"babylonScene",{get:function(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),W.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((function(W){return W.dispose&&W.dispose()})),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())},W.prototype.importMeshAsync=function(W,i,L,h,l,t,p){var x=this;return void 0===p&&(p=""),Promise.resolve().then((function(){x._babylonScene=i,x._assetContainer=L,x._loadData(h);var t=null;if(W){var R={};if(x._gltf.nodes)for(var z=0,r=x._gltf.nodes;z<r.length;z++){var N=r[z];N.name&&(R[N.name]=N.index)}t=(W instanceof Array?W:[W]).map((function(W){var i=R[W];if(void 0===i)throw new Error("Failed to find node '".concat(W,"'"));return i}))}return x._loadAsync(l,p,t,(function(){return{meshes:x._getMeshes(),particleSystems:[],skeletons:x._getSkeletons(),animationGroups:x._getAnimationGroups(),lights:x._babylonLights,transformNodes:x._getTransformNodes(),geometries:x._getGeometries()}}))}))},W.prototype.loadAsync=function(W,i,L,h,l){var t=this;return void 0===l&&(l=""),Promise.resolve().then((function(){return t._babylonScene=W,t._loadData(i),t._loadAsync(L,l,null,(function(){}))}))},W.prototype._loadAsync=function(W,i,L,h){var l=this;return Promise.resolve().then((function(){l._rootUrl=W,l._uniqueRootUrl=!W.startsWith("file:")&&i?W:"".concat(W).concat(Date.now(),"/"),l._fileName=i,l._loadExtensions(),l._checkExtensions();var t="".concat(n.k[n.k.LOADING]," => ").concat(n.k[n.k.READY]),x="".concat(n.k[n.k.LOADING]," => ").concat(n.k[n.k.COMPLETE]);l._parent._startPerformanceCounter(t),l._parent._startPerformanceCounter(x),l._parent._setState(n.k.LOADING),l._extensionsOnLoading();var R=new Array;if(!l.parent.loadOnlyMaterials)if(L)R.push(l.loadSceneAsync("/nodes",{nodes:L,index:-1}));else if(void 0!=l._gltf.scene||l._gltf.scenes&&l._gltf.scenes[0]){var z=G.Get("/scene",l._gltf.scenes,l._gltf.scene||0);R.push(l.loadSceneAsync("/scenes/".concat(z.index),z))}if(!l.parent.skipMaterials&&l.parent.loadAllMaterials&&l._gltf.materials)for(var r=0;r<l._gltf.materials.length;++r){var N=l._gltf.materials[r],I="/materials/"+r,s=M.b.TriangleFillMode;R.push(l._loadMaterialAsync(I,N,null,s,(function(){})))}return l._parent.compileMaterials&&R.push(l._compileMaterialsAsync()),l._parent.compileShadowGenerators&&R.push(l._compileShadowGeneratorsAsync()),Promise.all(R).then((function(){return l._rootBabylonMesh&&l._rootBabylonMesh.setEnabled(!0),l._extensionsOnReady(),l._parent._setState(n.k.READY),l._startAnimations(),h()})).then((function(W){return l._parent._endPerformanceCounter(t),p.h.SetImmediate((function(){l._disposed||Promise.all(l._completePromises).then((function(){l._parent._endPerformanceCounter(x),l._parent._setState(n.k.COMPLETE),l._parent.onCompleteObservable.notifyObservers(void 0),l._parent.onCompleteObservable.clear(),l.dispose()}),(function(W){l._parent.onErrorObservable.notifyObservers(W),l._parent.onErrorObservable.clear(),l.dispose()}))})),W}))})).catch((function(W){throw l._disposed||(l._parent.onErrorObservable.notifyObservers(W),l._parent.onErrorObservable.clear(),l.dispose()),W}))},W.prototype._loadData=function(W){if(this._gltf=W.json,this._setupData(),W.bin){var i=this._gltf.buffers;if(i&&i[0]&&!i[0].uri){var L=i[0];(L.byteLength<W.bin.byteLength-3||L.byteLength>W.bin.byteLength)&&a.e.Warn("Binary buffer length (".concat(L.byteLength,") from JSON does not match chunk length (").concat(W.bin.byteLength,")")),this._bin=W.bin}else a.e.Warn("Unexpected BIN chunk")}},W.prototype._setupData=function(){if(G.Assign(this._gltf.accessors),G.Assign(this._gltf.animations),G.Assign(this._gltf.buffers),G.Assign(this._gltf.bufferViews),G.Assign(this._gltf.cameras),G.Assign(this._gltf.images),G.Assign(this._gltf.materials),G.Assign(this._gltf.meshes),G.Assign(this._gltf.nodes),G.Assign(this._gltf.samplers),G.Assign(this._gltf.scenes),G.Assign(this._gltf.skins),G.Assign(this._gltf.textures),this._gltf.nodes){for(var W={},i=0,L=this._gltf.nodes;i<L.length;i++){if((R=L[i]).children)for(var h=0,l=R.children;h<l.length;h++){W[l[h]]=R.index}}for(var t=this._createRootNode(),p=0,x=this._gltf.nodes;p<x.length;p++){var R,z=W[(R=x[p]).index];R.parent=void 0===z?t:this._gltf.nodes[z]}}},W.prototype._loadExtensions=function(){for(var i in W._RegisteredExtensions){var L=W._RegisteredExtensions[i].factory(this);L.name!==i&&a.e.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(L.name," !== ").concat(i)),this._extensions.push(L),this._parent.onExtensionLoadedObservable.notifyObservers(L)}this._extensions.sort((function(W,i){return(W.order||Number.MAX_VALUE)-(i.order||Number.MAX_VALUE)})),this._parent.onExtensionLoadedObservable.clear()},W.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var W=function(W){if(!i._extensions.some((function(i){return i.name===W&&i.enabled})))throw new Error("Require extension ".concat(W," is not available"))},i=this,L=0,h=this._gltf.extensionsRequired;L<h.length;L++){W(h[L])}},W.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=!!this._assetContainer,this._rootBabylonMesh=new U.e("__root__",this._babylonScene),this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var i={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case n.h.AUTO:this._babylonScene.useRightHandedSystem||(i.rotation=[0,1,0,0],i.scale=[1,1,-1],W._LoadTransform(i,this._rootBabylonMesh));break;case n.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),i},W.prototype.loadSceneAsync=function(W,i){var L=this,h=this._extensionsLoadSceneAsync(W,i);if(h)return h;var l=new Array;if(this.logOpen("".concat(W," ").concat(i.name||"")),i.nodes)for(var t=0,p=i.nodes;t<p.length;t++){var x=p[t],R=G.Get("".concat(W,"/nodes/").concat(x),this._gltf.nodes,x);l.push(this.loadNodeAsync("/nodes/".concat(R.index),R,(function(W){W.parent=L._rootBabylonMesh})))}for(var z=0,r=this._postSceneLoadActions;z<r.length;z++){(0,r[z])()}return l.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(l).then((function(){}))},W.prototype._forEachPrimitive=function(W,i){if(W._primitiveBabylonMeshes)for(var L=0,h=W._primitiveBabylonMeshes;L<h.length;L++){i(h[L])}},W.prototype._getGeometries=function(){var W=new Array,i=this._gltf.nodes;if(i)for(var L=0,h=i;L<h.length;L++){var l=h[L];this._forEachPrimitive(l,(function(i){var L=i.geometry;L&&-1===W.indexOf(L)&&W.push(L)}))}return W},W.prototype._getMeshes=function(){var W=new Array;this._rootBabylonMesh&&W.push(this._rootBabylonMesh);var i=this._gltf.nodes;if(i)for(var L=0,h=i;L<h.length;L++){var l=h[L];this._forEachPrimitive(l,(function(i){W.push(i)}))}return W},W.prototype._getTransformNodes=function(){var W=new Array,i=this._gltf.nodes;if(i)for(var L=0,h=i;L<h.length;L++){var l=h[L];l._babylonTransformNode&&"TransformNode"===l._babylonTransformNode.getClassName()&&W.push(l._babylonTransformNode),l._babylonTransformNodeForSkin&&W.push(l._babylonTransformNodeForSkin)}return W},W.prototype._getSkeletons=function(){var W=new Array,i=this._gltf.skins;if(i)for(var L=0,h=i;L<h.length;L++){var l=h[L];l._data&&W.push(l._data.babylonSkeleton)}return W},W.prototype._getAnimationGroups=function(){var W=new Array,i=this._gltf.animations;if(i)for(var L=0,h=i;L<h.length;L++){var l=h[L];l._babylonAnimationGroup&&W.push(l._babylonAnimationGroup)}return W},W.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case n.d.NONE:break;case n.d.FIRST:0!==(W=this._getAnimationGroups()).length&&W[0].start(!0);break;case n.d.ALL:for(var W,i=0,L=W=this._getAnimationGroups();i<L.length;i++){L[i].start(!0)}break;default:return void a.e.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}},W.prototype.loadNodeAsync=function(i,L,h){var l=this;void 0===h&&(h=function(){});var t=this._extensionsLoadNodeAsync(i,L,h);if(t)return t;if(L._babylonTransformNode)throw new Error("".concat(i,": Invalid recursive node hierarchy"));var p=new Array;this.logOpen("".concat(i," ").concat(L.name||""));var x=function(t){if(W.AddPointerMetadata(t,i),W._LoadTransform(L,t),void 0!=L.camera){var x=G.Get("".concat(i,"/camera"),l._gltf.cameras,L.camera);p.push(l.loadCameraAsync("/cameras/".concat(x.index),x,(function(W){W.parent=t})))}if(L.children)for(var R=0,z=L.children;R<z.length;R++){var r=z[R],N=G.Get("".concat(i,"/children/").concat(r),l._gltf.nodes,r);p.push(l.loadNodeAsync("/nodes/".concat(N.index),N,(function(W){W.parent=t})))}h(t)};if(void 0==L.mesh||void 0!=L.skin){var R=L.name||"node".concat(L.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var z=new q.e(R,this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==L.mesh?L._babylonTransformNode=z:L._babylonTransformNodeForSkin=z,x(z)}if(void 0!=L.mesh)if(void 0==L.skin){var r=G.Get("".concat(i,"/mesh"),this._gltf.meshes,L.mesh);p.push(this._loadMeshAsync("/meshes/".concat(r.index),L,r,x))}else{r=G.Get("".concat(i,"/mesh"),this._gltf.meshes,L.mesh);p.push(this._loadMeshAsync("/meshes/".concat(r.index),L,r,(function(W){var h=L._babylonTransformNodeForSkin;W.metadata=u(h.metadata,W.metadata||{});var t=G.Get("".concat(i,"/skin"),l._gltf.skins,L.skin);p.push(l._loadSkinAsync("/skins/".concat(t.index),L,t,(function(i){l._forEachPrimitive(L,(function(W){W.skeleton=i})),l._postSceneLoadActions.push((function(){if(void 0!=t.skeleton){var i=G.Get("/skins/".concat(t.index,"/skeleton"),l._gltf.nodes,t.skeleton).parent;L.index===i.index?W.parent=h.parent:W.parent=i._babylonTransformNode}else W.parent=l._rootBabylonMesh;l._parent.onSkinLoadedObservable.notifyObservers({node:h,skinnedNode:W})}))})))})))}return this.logClose(),Promise.all(p).then((function(){return l._forEachPrimitive(L,(function(W){W.geometry&&W.geometry.useBoundingInfoFromGeometry?W._updateBoundingInfo():W.refreshBoundingInfo(!0)})),L._babylonTransformNode}))},W.prototype._loadMeshAsync=function(W,i,L,h){var l=L.primitives;if(!l||!l.length)throw new Error("".concat(W,": Primitives are missing"));void 0==l[0].index&&G.Assign(l);var t=new Array;this.logOpen("".concat(W," ").concat(L.name||""));var p=i.name||"node".concat(i.index);if(1===l.length){var x=L.primitives[0];t.push(this._loadMeshPrimitiveAsync("".concat(W,"/primitives/").concat(x.index),p,i,L,x,(function(W){i._babylonTransformNode=W,i._primitiveBabylonMeshes=[W]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,i._babylonTransformNode=new q.e(p,this._babylonScene),i._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i._primitiveBabylonMeshes=[];for(var R=0,z=l;R<z.length;R++){x=z[R];t.push(this._loadMeshPrimitiveAsync("".concat(W,"/primitives/").concat(x.index),"".concat(p,"_primitive").concat(x.index),i,L,x,(function(W){W.parent=i._babylonTransformNode,i._primitiveBabylonMeshes.push(W)})))}}return h(i._babylonTransformNode),this.logClose(),Promise.all(t).then((function(){return i._babylonTransformNode}))},W.prototype._loadMeshPrimitiveAsync=function(i,L,h,l,t,p){var x=this,R=this._extensionsLoadMeshPrimitiveAsync(i,L,h,l,t,p);if(R)return R;this.logOpen("".concat(i));var z,r,N=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==h.skin&&!l.primitives[0].targets;if(N&&t._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,(z=t._instanceData.babylonSourceMesh.createInstance(L))._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r=t._instanceData.promise;else{var I=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;var s=new U.e(L,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?M.b.CounterClockWiseSideOrientation:M.b.ClockWiseSideOrientation,this._createMorphTargets(i,h,l,t,s),I.push(this._loadVertexDataAsync(i,t,s).then((function(W){return x._loadMorphTargetsAsync(i,t,s,W).then((function(){x._disposed||(x._babylonScene._blockEntityCollection=!!x._assetContainer,W.applyToMesh(s),W._parentContainer=x._assetContainer,x._babylonScene._blockEntityCollection=!1)}))})));var o=W._GetDrawMode(i,t.mode);if(void 0==t.material){var D=this._defaultBabylonMaterialData[o];D||(D=this._createDefaultMaterial("__GLTFLoader._default",o),this._parent.onMaterialLoadedObservable.notifyObservers(D),this._defaultBabylonMaterialData[o]=D),s.material=D}else if(!this.parent.skipMaterials){var S=G.Get("".concat(i,"/material"),this._gltf.materials,t.material);I.push(this._loadMaterialAsync("/materials/".concat(S.index),S,s,o,(function(W){s.material=W})))}r=Promise.all(I),N&&(t._instanceData={babylonSourceMesh:s,promise:r}),z=s}return W.AddPointerMetadata(z,i),this._parent.onMeshLoadedObservable.notifyObservers(z),p(z),this.logClose(),r.then((function(){return z}))},W.prototype._loadVertexDataAsync=function(W,i,L){var h=this,t=this._extensionsLoadVertexDataAsync(W,i,L);if(t)return t;var p=i.attributes;if(!p)throw new Error("".concat(W,": Attributes are missing"));var x=new Array,R=new k.b(L.name,this._babylonScene);if(void 0==i.indices)L.isUnIndexed=!0;else{var z=G.Get("".concat(W,"/indices"),this._gltf.accessors,i.indices);x.push(this._loadIndicesAccessorAsync("/accessors/".concat(z.index),z).then((function(W){R.setIndices(W)})))}var r=function(i,t,z){if(void 0!=p[i]){L._delayInfo=L._delayInfo||[],-1===L._delayInfo.indexOf(t)&&L._delayInfo.push(t);var r=G.Get("".concat(W,"/attributes/").concat(i),h._gltf.accessors,p[i]);x.push(h._loadVertexAccessorAsync("/accessors/".concat(r.index),r,t).then((function(W){if(W.getKind()===H.d.PositionKind&&!h.parent.alwaysComputeBoundingBox&&!L.skeleton){var i=r.min,t=r.max;if(void 0!==i&&void 0!==t){if(r.normalized&&5126!==r.componentType){var p=1;switch(r.componentType){case 5120:p=127;break;case 5121:p=255;break;case 5122:p=32767;break;case 5123:p=65535}for(var x=0;x<3;++x)i[x]=Math.max(i[x]/p,-1),t[x]=Math.max(t[x]/p,-1)}var z=l.h.Vector3[0],N=l.h.Vector3[1];z.copyFromFloats.apply(z,i),N.copyFromFloats.apply(N,t),R._boundingInfo=new K.b(z,N),R.useBoundingInfoFromGeometry=!0}}R.setVerticesBuffer(W,r.count)}))),t==H.d.MatricesIndicesExtraKind&&(L.numBoneInfluencers=8),z&&z(r)}};return r("POSITION",H.d.PositionKind),r("NORMAL",H.d.NormalKind),r("TANGENT",H.d.TangentKind),r("TEXCOORD_0",H.d.UVKind),r("TEXCOORD_1",H.d.UV2Kind),r("TEXCOORD_2",H.d.UV3Kind),r("TEXCOORD_3",H.d.UV4Kind),r("TEXCOORD_4",H.d.UV5Kind),r("TEXCOORD_5",H.d.UV6Kind),r("JOINTS_0",H.d.MatricesIndicesKind),r("WEIGHTS_0",H.d.MatricesWeightsKind),r("JOINTS_1",H.d.MatricesIndicesExtraKind),r("WEIGHTS_1",H.d.MatricesWeightsExtraKind),r("COLOR_0",H.d.ColorKind,(function(W){"VEC4"===W.type&&(L.hasVertexAlpha=!0)})),Promise.all(x).then((function(){return R}))},W.prototype._createMorphTargets=function(W,i,L,h,l){if(h.targets){if(void 0==i._numMorphTargets)i._numMorphTargets=h.targets.length;else if(h.targets.length!==i._numMorphTargets)throw new Error("".concat(W,": Primitives do not have the same number of targets"));var t=L.extras?L.extras.targetNames:null;l.morphTargetManager=new g(l.getScene()),l.morphTargetManager.areUpdatesFrozen=!0;for(var p=0;p<h.targets.length;p++){var x=i.weights?i.weights[p]:L.weights?L.weights[p]:0,R=t?t[p]:"morphTarget".concat(p);l.morphTargetManager.addTarget(new d(R,x,l.getScene()))}}},W.prototype._loadMorphTargetsAsync=function(W,i,L,h){if(!i.targets)return Promise.resolve();for(var l=new Array,t=L.morphTargetManager,p=0;p<t.numTargets;p++){var x=t.getTarget(p);l.push(this._loadMorphTargetVertexDataAsync("".concat(W,"/targets/").concat(p),h,i.targets[p],x))}return Promise.all(l).then((function(){t.areUpdatesFrozen=!1}))},W.prototype._loadMorphTargetVertexDataAsync=function(W,i,L,h){var l=this,t=new Array,p=function(h,p,x){if(void 0!=L[h]){var R=i.getVertexBuffer(p);if(R){var z=G.Get("".concat(W,"/").concat(h),l._gltf.accessors,L[h]);t.push(l._loadFloatAccessorAsync("/accessors/".concat(z.index),z).then((function(W){x(R,W)})))}}};return p("POSITION",H.d.PositionKind,(function(W,i){var L=new Float32Array(i.length);W.forEach(i.length,(function(W,h){L[h]=i[h]+W})),h.setPositions(L)})),p("NORMAL",H.d.NormalKind,(function(W,i){var L=new Float32Array(i.length);W.forEach(L.length,(function(W,h){L[h]=i[h]+W})),h.setNormals(L)})),p("TANGENT",H.d.TangentKind,(function(W,i){var L=new Float32Array(i.length/3*4),l=0;W.forEach(i.length/3*4,(function(W,h){(h+1)%4!==0&&(L[l]=i[l]+W,l++)})),h.setTangents(L)})),Promise.all(t).then((function(){}))},W._LoadTransform=function(W,i){if(void 0==W.skin){var L=l.m.Zero(),h=l.g.Identity(),t=l.m.One();if(W.matrix)l.d.FromArray(W.matrix).decompose(t,h,L);else W.translation&&(L=l.m.FromArray(W.translation)),W.rotation&&(h=l.g.FromArray(W.rotation)),W.scale&&(t=l.m.FromArray(W.scale));i.position=L,i.rotationQuaternion=h,i.scaling=t}},W.prototype._loadSkinAsync=function(W,i,L,h){var l=this,t=this._extensionsLoadSkinAsync(W,i,L);if(t)return t;if(L._data)return h(L._data.babylonSkeleton),L._data.promise;var p="skeleton".concat(L.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var x=new y(L.name||p,p,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(W,L,x);var R=this._loadSkinInverseBindMatricesDataAsync(W,L).then((function(W){l._updateBoneMatrices(x,W)}));return L._data={babylonSkeleton:x,promise:R},h(x),R},W.prototype._loadBones=function(W,i,L){if(void 0==i.skeleton||this._parent.alwaysComputeSkeletonRootNode){var h=this._findSkeletonRootNode("".concat(W,"/joints"),i.joints);if(h)if(void 0===i.skeleton)i.skeleton=h.index;else{var l=G.Get("".concat(W,"/skeleton"),this._gltf.nodes,i.skeleton);l===h||function(W,i){for(;i.parent;i=i.parent)if(i.parent===W)return!0;return!1}(l,h)||(a.e.Warn("".concat(W,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),i.skeleton=h.index)}else a.e.Warn("".concat(W,": Failed to find common root"))}for(var t={},p=0,x=i.joints;p<x.length;p++){var R=x[p],z=G.Get("".concat(W,"/joints/").concat(R),this._gltf.nodes,R);this._loadBone(z,i,L,t)}},W.prototype._findSkeletonRootNode=function(W,i){if(0===i.length)return null;for(var L={},h=0,l=i;h<l.length;h++){for(var t=l[h],p=new Array,x=G.Get("".concat(W,"/").concat(t),this._gltf.nodes,t);-1!==x.index;)p.unshift(x),x=x.parent;L[t]=p}for(var R=null,z=0;;++z){if(z>=(p=L[i[0]]).length)return R;x=p[z];for(var r=1;r<i.length;++r)if(z>=(p=L[i[r]]).length||x!==p[z])return R;R=x}},W.prototype._loadBone=function(W,i,L,h){var l=h[W.index];if(l)return l;var t=null;W.index!==i.skeleton&&(W.parent&&-1!==W.parent.index?t=this._loadBone(W.parent,i,L,h):void 0!==i.skeleton&&a.e.Warn("/skins/".concat(i.index,"/skeleton: Skeleton node is not a common root")));var p=i.joints.indexOf(W.index);return l=new V(W.name||"joint".concat(W.index),L,t,this._getNodeMatrix(W),null,null,p),h[W.index]=l,this._postSceneLoadActions.push((function(){l.linkTransformNode(W._babylonTransformNode)})),l},W.prototype._loadSkinInverseBindMatricesDataAsync=function(W,i){if(void 0==i.inverseBindMatrices)return Promise.resolve(null);var L=G.Get("".concat(W,"/inverseBindMatrices"),this._gltf.accessors,i.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(L.index),L)},W.prototype._updateBoneMatrices=function(W,i){for(var L=0,h=W.bones;L<h.length;L++){var t=h[L],p=l.d.Identity(),x=t._index;i&&-1!==x&&(l.d.FromArrayToRef(i,16*x,p),p.invertToRef(p));var R=t.getParent();R&&p.multiplyToRef(R.getInvertedAbsoluteTransform(),p),t.updateMatrix(p,!1,!1),t._updateDifferenceMatrix(void 0,!1)}},W.prototype._getNodeMatrix=function(W){return W.matrix?l.d.FromArray(W.matrix):l.d.Compose(W.scale?l.m.FromArray(W.scale):l.m.One(),W.rotation?l.g.FromArray(W.rotation):l.g.Identity(),W.translation?l.m.FromArray(W.translation):l.m.Zero())},W.prototype.loadCameraAsync=function(i,L,h){void 0===h&&(h=function(){});var t=this._extensionsLoadCameraAsync(i,L,h);if(t)return t;var p=new Array;this.logOpen("".concat(i," ").concat(L.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;var z=new R.c(L.name||"camera".concat(L.index),l.m.Zero(),this._babylonScene,!1);switch(z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.ignoreParentScaling=!0,z.rotation=new l.m(0,Math.PI,0),L.type){case"perspective":var r=L.perspective;if(!r)throw new Error("".concat(i,": Camera perspective properties are missing"));z.fov=r.yfov,z.minZ=r.znear,z.maxZ=r.zfar||0;break;case"orthographic":if(!L.orthographic)throw new Error("".concat(i,": Camera orthographic properties are missing"));z.mode=x.c.ORTHOGRAPHIC_CAMERA,z.orthoLeft=-L.orthographic.xmag,z.orthoRight=L.orthographic.xmag,z.orthoBottom=-L.orthographic.ymag,z.orthoTop=L.orthographic.ymag,z.minZ=L.orthographic.znear,z.maxZ=L.orthographic.zfar;break;default:throw new Error("".concat(i,": Invalid camera type (").concat(L.type,")"))}return W.AddPointerMetadata(z,i),this._parent.onCameraLoadedObservable.notifyObservers(z),h(z),this.logClose(),Promise.all(p).then((function(){return z}))},W.prototype._loadAnimationsAsync=function(){var W=this._gltf.animations;if(!W)return Promise.resolve();for(var i=new Array,L=0;L<W.length;L++){var h=W[L];i.push(this.loadAnimationAsync("/animations/".concat(h.index),h).then((function(W){0===W.targetedAnimations.length&&W.dispose()})))}return Promise.all(i).then((function(){}))},W.prototype.loadAnimationAsync=function(W,i){var L=this._extensionsLoadAnimationAsync(W,i);if(L)return L;this._babylonScene._blockEntityCollection=!!this._assetContainer;var h=new o(i.name||"animation".concat(i.index),this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i._babylonAnimationGroup=h;var l=new Array;G.Assign(i.channels),G.Assign(i.samplers);for(var t=0,p=i.channels;t<p.length;t++){var x=p[t];l.push(this._loadAnimationChannelAsync("".concat(W,"/channels/").concat(x.index),W,i,x,h))}return Promise.all(l).then((function(){return h.normalize(0),h}))},W.prototype._loadAnimationChannelAsync=function(W,i,L,h,t,p){var x=this;if(void 0===p&&(p=null),void 0==h.target.node)return Promise.resolve();var R=G.Get("".concat(W,"/target/node"),this._gltf.nodes,h.target.node);if("weights"===h.target.path&&!R._numMorphTargets||"weights"!==h.target.path&&!R._babylonTransformNode)return Promise.resolve();var r=G.Get("".concat(W,"/sampler"),L.samplers,h.sampler);return this._loadAnimationSamplerAsync("".concat(i,"/samplers/").concat(h.sampler),r).then((function(i){var L,r;switch(h.target.path){case"translation":L="position",r=z.c.ANIMATIONTYPE_VECTOR3;break;case"rotation":L="rotationQuaternion",r=z.c.ANIMATIONTYPE_QUATERNION;break;case"scale":L="scaling",r=z.c.ANIMATIONTYPE_VECTOR3;break;case"weights":L="influence",r=z.c.ANIMATIONTYPE_FLOAT;break;default:throw new Error("".concat(W,"/target/path: Invalid value (").concat(h.target.path,")"))}var N,I,s=0;switch(L){case"position":N=function(W){var L=l.m.FromArray(i.output,s).scaleInPlace(W);return s+=3,L};break;case"rotationQuaternion":N=function(W){var L=l.g.FromArray(i.output,s).scaleInPlace(W);return s+=4,L};break;case"scaling":N=function(W){var L=l.m.FromArray(i.output,s).scaleInPlace(W);return s+=3,L};break;case"influence":N=function(W){for(var L=new Array(R._numMorphTargets),h=0;h<R._numMorphTargets;h++)L[h]=i.output[s++]*W;return L}}switch(i.interpolation){case"STEP":I=function(W){return{frame:i.input[W]*x.parent.targetFps,value:N(1),interpolation:m.e.STEP}};break;case"LINEAR":I=function(W){return{frame:i.input[W]*x.parent.targetFps,value:N(1)}};break;case"CUBICSPLINE":var o=1/x.parent.targetFps;I=function(W){return{frame:i.input[W]*x.parent.targetFps,inTangent:N(o),value:N(1),outTangent:N(o)}}}for(var D=new Array(i.input.length),S=0;S<i.input.length;S++)D[S]=I(S);if("influence"===L)for(var C=function(W){var i="".concat(t.name,"_channel").concat(t.targetedAnimations.length),h=new z.c(i,L,x.parent.targetFps,r);h.setKeys(D.map((function(i){return{frame:i.frame,inTangent:i.inTangent?i.inTangent[W]:void 0,value:i.value[W],outTangent:i.outTangent?i.outTangent[W]:void 0,interpolation:i.interpolation}}))),x._forEachPrimitive(R,(function(i){var L=i;if(L.morphTargetManager){var l=L.morphTargetManager.getTarget(W),p=h.clone();l.animations.push(p),t.addTargetedAnimation(p,l)}}))},e=0;e<R._numMorphTargets;e++)C(e);else{var V="".concat(t.name,"_channel").concat(t.targetedAnimations.length),c=new z.c(V,L,x.parent.targetFps,r);c.setKeys(D),null!=p&&null!=p.animations?(p.animations.push(c),t.addTargetedAnimation(c,p)):(R._babylonTransformNode.animations.push(c),t.addTargetedAnimation(c,R._babylonTransformNode))}}))},W.prototype._loadAnimationSamplerAsync=function(W,i){if(i._data)return i._data;var L=i.interpolation||"LINEAR";switch(L){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(W,"/interpolation: Invalid value (").concat(i.interpolation,")"))}var h=G.Get("".concat(W,"/input"),this._gltf.accessors,i.input),l=G.Get("".concat(W,"/output"),this._gltf.accessors,i.output);return i._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(h.index),h),this._loadFloatAccessorAsync("/accessors/".concat(l.index),l)]).then((function(W){var i=W[0],h=W[1];return{input:i,interpolation:L,output:h}})),i._data},W.prototype.loadBufferAsync=function(W,i,L,h){var l=this._extensionsLoadBufferAsync(W,i,L,h);if(l)return l;if(!i._data)if(i.uri)i._data=this.loadUriAsync("".concat(W,"/uri"),i,i.uri);else{if(!this._bin)throw new Error("".concat(W,": Uri is missing or the binary glTF is missing its binary chunk"));i._data=this._bin.readAsync(0,i.byteLength)}return i._data.then((function(i){try{return new Uint8Array(i.buffer,i.byteOffset+L,h)}catch(i){throw new Error("".concat(W,": ").concat(i.message))}}))},W.prototype.loadBufferViewAsync=function(W,i){var L=this._extensionsLoadBufferViewAsync(W,i);if(L)return L;if(i._data)return i._data;var h=G.Get("".concat(W,"/buffer"),this._gltf.buffers,i.buffer);return i._data=this.loadBufferAsync("/buffers/".concat(h.index),h,i.byteOffset||0,i.byteLength),i._data},W.prototype._loadAccessorAsync=function(i,L,h){var l=this;if(L._data)return L._data;var t=W._GetNumComponents(i,L.type),p=t*H.d.GetTypeByteLength(L.componentType),x=t*L.count;if(void 0==L.bufferView)L._data=Promise.resolve(new h(x));else{var R=G.Get("".concat(i,"/bufferView"),this._gltf.bufferViews,L.bufferView);L._data=this.loadBufferViewAsync("/bufferViews/".concat(R.index),R).then((function(l){if(5126!==L.componentType||L.normalized||R.byteStride&&R.byteStride!==p){var z=new h(x);return H.d.ForEach(l,L.byteOffset||0,R.byteStride||p,t,L.componentType,z.length,L.normalized||!1,(function(W,i){z[i]=W})),z}return W._GetTypedArray(i,L.componentType,l,L.byteOffset,x)}))}if(L.sparse){var z=L.sparse;L._data=L._data.then((function(x){var R=x,r=G.Get("".concat(i,"/sparse/indices/bufferView"),l._gltf.bufferViews,z.indices.bufferView),N=G.Get("".concat(i,"/sparse/values/bufferView"),l._gltf.bufferViews,z.values.bufferView);return Promise.all([l.loadBufferViewAsync("/bufferViews/".concat(r.index),r),l.loadBufferViewAsync("/bufferViews/".concat(N.index),N)]).then((function(l){var x,r=l[0],N=l[1],I=W._GetTypedArray("".concat(i,"/sparse/indices"),z.indices.componentType,r,z.indices.byteOffset,z.count),s=t*z.count;if(5126!==L.componentType||L.normalized){var o=W._GetTypedArray("".concat(i,"/sparse/values"),L.componentType,N,z.values.byteOffset,s);x=new h(s),H.d.ForEach(o,0,p,t,L.componentType,x.length,L.normalized||!1,(function(W,i){x[i]=W}))}else x=W._GetTypedArray("".concat(i,"/sparse/values"),L.componentType,N,z.values.byteOffset,s);for(var D=0,S=0;S<I.length;S++)for(var C=I[S]*t,e=0;e<t;e++)R[C++]=x[D++];return R}))}))}return L._data},W.prototype._loadFloatAccessorAsync=function(W,i){return this._loadAccessorAsync(W,i,Float32Array)},W.prototype._loadIndicesAccessorAsync=function(i,L){if("SCALAR"!==L.type)throw new Error("".concat(i,"/type: Invalid value ").concat(L.type));if(5121!==L.componentType&&5123!==L.componentType&&5125!==L.componentType)throw new Error("".concat(i,"/componentType: Invalid value ").concat(L.componentType));if(L._data)return L._data;if(L.sparse){var h=W._GetTypedArrayConstructor("".concat(i,"/componentType"),L.componentType);L._data=this._loadAccessorAsync(i,L,h)}else{var l=G.Get("".concat(i,"/bufferView"),this._gltf.bufferViews,L.bufferView);L._data=this.loadBufferViewAsync("/bufferViews/".concat(l.index),l).then((function(h){return W._GetTypedArray(i,L.componentType,h,L.byteOffset,L.count)}))}return L._data},W.prototype._loadVertexBufferViewAsync=function(W){if(W._babylonBuffer)return W._babylonBuffer;var i=this._babylonScene.getEngine();return W._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(W.index),W).then((function(W){return new H.c(i,W,!1)})),W._babylonBuffer},W.prototype._loadVertexAccessorAsync=function(i,L,h){var l;if(null===(l=L._babylonVertexBuffer)||void 0===l?void 0:l[h])return L._babylonVertexBuffer[h];L._babylonVertexBuffer||(L._babylonVertexBuffer={});var t=this._babylonScene.getEngine();if(L.sparse)L._babylonVertexBuffer[h]=this._loadFloatAccessorAsync(i,L).then((function(W){return new H.d(t,W,h,!1)}));else if(h===H.d.MatricesIndicesKind||h===H.d.MatricesIndicesExtraKind)L._babylonVertexBuffer[h]=this._loadFloatAccessorAsync(i,L).then((function(W){return new H.d(t,W,h,!1)}));else{var p=G.Get("".concat(i,"/bufferView"),this._gltf.bufferViews,L.bufferView);L._babylonVertexBuffer[h]=this._loadVertexBufferViewAsync(p).then((function(l){var x=W._GetNumComponents(i,L.type);return new H.d(t,l,h,!1,!1,p.byteStride,!1,L.byteOffset,x,L.componentType,L.normalized,!0,1,!0)}))}return L._babylonVertexBuffer[h]},W.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(W,i,L){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var h=new Array;return i&&(i.baseColorFactor?(L.albedoColor=t.d.FromArray(i.baseColorFactor),L.alpha=i.baseColorFactor[3]):L.albedoColor=t.d.White(),L.metallic=void 0==i.metallicFactor?1:i.metallicFactor,L.roughness=void 0==i.roughnessFactor?1:i.roughnessFactor,i.baseColorTexture&&h.push(this.loadTextureInfoAsync("".concat(W,"/baseColorTexture"),i.baseColorTexture,(function(W){W.name="".concat(L.name," (Base Color)"),L.albedoTexture=W}))),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync("".concat(W,"/metallicRoughnessTexture"),i.metallicRoughnessTexture,(function(W){W.name="".concat(L.name," (Metallic Roughness)"),L.metallicTexture=W}))),L.useMetallnessFromMetallicTextureBlue=!0,L.useRoughnessFromMetallicTextureGreen=!0,L.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(h).then((function(){}))},W.prototype._loadMaterialAsync=function(i,L,h,l,t){void 0===t&&(t=function(){});var p=this._extensionsLoadMaterialAsync(i,L,h,l,t);if(p)return p;L._data=L._data||{};var x=L._data[l];if(!x){this.logOpen("".concat(i," ").concat(L.name||""));var R=this.createMaterial(i,L,l);x={babylonMaterial:R,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(i,L,R)},L._data[l]=x,W.AddPointerMetadata(R,i),this._parent.onMaterialLoadedObservable.notifyObservers(R),this.logClose()}return h&&(x.babylonMeshes.push(h),h.onDisposeObservable.addOnce((function(){var W=x.babylonMeshes.indexOf(h);-1!==W&&x.babylonMeshes.splice(W,1)}))),t(x.babylonMaterial),x.promise.then((function(){return x.babylonMaterial}))},W.prototype._createDefaultMaterial=function(W,i){this._babylonScene._blockEntityCollection=!!this._assetContainer;var L=new T(W,this._babylonScene);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.fillMode=i,L.enableSpecularAntiAliasing=!0,L.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,L.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,L.transparencyMode=T.PBRMATERIAL_OPAQUE,L.metallic=1,L.roughness=1,L},W.prototype.createMaterial=function(W,i,L){var h=this._extensionsCreateMaterial(W,i,L);if(h)return h;var l=i.name||"material".concat(i.index);return this._createDefaultMaterial(l,L)},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this._extensionsLoadMaterialPropertiesAsync(W,i,L);if(h)return h;var l=new Array;return l.push(this.loadMaterialBasePropertiesAsync(W,i,L)),i.pbrMetallicRoughness&&l.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(W,"/pbrMetallicRoughness"),i.pbrMetallicRoughness,L)),this.loadMaterialAlphaProperties(W,i,L),Promise.all(l).then((function(){}))},W.prototype.loadMaterialBasePropertiesAsync=function(W,i,L){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var h=new Array;return L.emissiveColor=i.emissiveFactor?t.d.FromArray(i.emissiveFactor):new t.d(0,0,0),i.doubleSided&&(L.backFaceCulling=!1,L.twoSidedLighting=!0),i.normalTexture&&(i.normalTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync("".concat(W,"/normalTexture"),i.normalTexture,(function(W){W.name="".concat(L.name," (Normal)"),L.bumpTexture=W}))),L.invertNormalMapX=!this._babylonScene.useRightHandedSystem,L.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=i.normalTexture.scale&&L.bumpTexture&&(L.bumpTexture.level=i.normalTexture.scale),L.forceIrradianceInFragment=!0),i.occlusionTexture&&(i.occlusionTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync("".concat(W,"/occlusionTexture"),i.occlusionTexture,(function(W){W.name="".concat(L.name," (Occlusion)"),L.ambientTexture=W}))),L.useAmbientInGrayScale=!0,void 0!=i.occlusionTexture.strength&&(L.ambientTextureStrength=i.occlusionTexture.strength)),i.emissiveTexture&&h.push(this.loadTextureInfoAsync("".concat(W,"/emissiveTexture"),i.emissiveTexture,(function(W){W.name="".concat(L.name," (Emissive)"),L.emissiveTexture=W}))),Promise.all(h).then((function(){}))},W.prototype.loadMaterialAlphaProperties=function(W,i,L){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));switch(i.alphaMode||"OPAQUE"){case"OPAQUE":L.transparencyMode=T.PBRMATERIAL_OPAQUE;break;case"MASK":L.transparencyMode=T.PBRMATERIAL_ALPHATEST,L.alphaCutOff=void 0==i.alphaCutoff?.5:i.alphaCutoff,L.albedoTexture&&(L.albedoTexture.hasAlpha=!0);break;case"BLEND":L.transparencyMode=T.PBRMATERIAL_ALPHABLEND,L.albedoTexture&&(L.albedoTexture.hasAlpha=!0,L.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(W,"/alphaMode: Invalid value (").concat(i.alphaMode,")"))}},W.prototype.loadTextureInfoAsync=function(i,L,h){var l=this;void 0===h&&(h=function(){});var t=this._extensionsLoadTextureInfoAsync(i,L,h);if(t)return t;if(this.logOpen("".concat(i)),L.texCoord>=6)throw new Error("".concat(i,"/texCoord: Invalid value (").concat(L.texCoord,")"));var p=G.Get("".concat(i,"/index"),this._gltf.textures,L.index);p._textureInfo=L;var x=this._loadTextureAsync("/textures/".concat(L.index),p,(function(t){t.coordinatesIndex=L.texCoord||0,W.AddPointerMetadata(t,i),l._parent.onTextureLoadedObservable.notifyObservers(t),h(t)}));return this.logClose(),x},W.prototype._loadTextureAsync=function(i,L,h){void 0===h&&(h=function(){});var l=this._extensionsLoadTextureAsync(i,L,h);if(l)return l;this.logOpen("".concat(i," ").concat(L.name||""));var t=void 0==L.sampler?W.DefaultSampler:G.Get("".concat(i,"/sampler"),this._gltf.samplers,L.sampler),p=G.Get("".concat(i,"/source"),this._gltf.images,L.source),x=this._createTextureAsync(i,t,p,h,void 0,!L._textureInfo.nonColorData);return this.logClose(),x},W.prototype._createTextureAsync=function(W,i,L,l,t,p){var x=this;void 0===l&&(l=function(){});var R=this._loadSampler("/samplers/".concat(i.index),i),z=new Array,r=new h;this._babylonScene._blockEntityCollection=!!this._assetContainer;var N={noMipmap:R.noMipMaps,invertY:!1,samplingMode:R.samplingMode,onLoad:function(){x._disposed||r.resolve()},onError:function(i,L){x._disposed||r.reject(new Error("".concat(W,": ").concat(L&&L.message?L.message:i||"Failed to load texture")))},mimeType:L.mimeType,loaderOptions:t,useSRGBBuffer:!!p&&this._parent.useSRGBBuffers},I=new F.e(null,this._babylonScene,N);return I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.push(r.promise),z.push(this.loadImageAsync("/images/".concat(L.index),L).then((function(W){var i=L.uri||"".concat(x._fileName,"#image").concat(L.index),h="data:".concat(x._uniqueRootUrl).concat(i);I.updateURL(h,W)}))),I.wrapU=R.wrapU,I.wrapV=R.wrapV,l(I),Promise.all(z).then((function(){return I}))},W.prototype._loadSampler=function(i,L){return L._data||(L._data={noMipMaps:9728===L.minFilter||9729===L.minFilter,samplingMode:W._GetTextureSamplingMode(i,L),wrapU:W._GetTextureWrapMode("".concat(i,"/wrapS"),L.wrapS),wrapV:W._GetTextureWrapMode("".concat(i,"/wrapT"),L.wrapT)}),L._data},W.prototype.loadImageAsync=function(W,i){if(!i._data){if(this.logOpen("".concat(W," ").concat(i.name||"")),i.uri)i._data=this.loadUriAsync("".concat(W,"/uri"),i,i.uri);else{var L=G.Get("".concat(W,"/bufferView"),this._gltf.bufferViews,i.bufferView);i._data=this.loadBufferViewAsync("/bufferViews/".concat(L.index),L)}this.logClose()}return i._data},W.prototype.loadUriAsync=function(i,L,h){var l=this,t=this._extensionsLoadUriAsync(i,L,h);if(t)return t;if(!W._ValidateUri(h))throw new Error("".concat(i,": '").concat(h,"' is invalid"));if((0,E.g)(h)){var p=new Uint8Array((0,E.c)(h));return this.log("".concat(i,": Decoded ").concat(h.substr(0,64),"... (").concat(p.length," bytes)")),Promise.resolve(p)}return this.log("".concat(i,": Loading ").concat(h)),this._parent.preprocessUrlAsync(this._rootUrl+h).then((function(W){return new Promise((function(L,t){l._parent._loadFile(l._babylonScene,W,(function(W){l._disposed||(l.log("".concat(i,": Loaded ").concat(h," (").concat(W.byteLength," bytes)")),L(new Uint8Array(W)))}),!0,(function(W){t(new E.j("".concat(i,": Failed to load '").concat(h,"'").concat(W?": "+W.status+" "+W.statusText:""),W))}))}))}))},W.AddPointerMetadata=function(W,i){var L=W.metadata=W.metadata||{},h=L.gltf=L.gltf||{};(h.pointers=h.pointers||[]).push(i)},W._GetTextureWrapMode=function(W,i){switch(i=void 0==i?10497:i){case 33071:return F.e.CLAMP_ADDRESSMODE;case 33648:return F.e.MIRROR_ADDRESSMODE;case 10497:return F.e.WRAP_ADDRESSMODE;default:return a.e.Warn("".concat(W,": Invalid value (").concat(i,")")),F.e.WRAP_ADDRESSMODE}},W._GetTextureSamplingMode=function(W,i){var L=void 0==i.magFilter?9729:i.magFilter,h=void 0==i.minFilter?9987:i.minFilter;if(9729===L)switch(h){case 9728:return F.e.LINEAR_NEAREST;case 9729:return F.e.LINEAR_LINEAR;case 9984:return F.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return F.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return F.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return F.e.LINEAR_LINEAR_MIPLINEAR;default:return a.e.Warn("".concat(W,"/minFilter: Invalid value (").concat(h,")")),F.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==L&&a.e.Warn("".concat(W,"/magFilter: Invalid value (").concat(L,")")),h){case 9728:return F.e.NEAREST_NEAREST;case 9729:return F.e.NEAREST_LINEAR;case 9984:return F.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return F.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return F.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return F.e.NEAREST_LINEAR_MIPLINEAR;default:return a.e.Warn("".concat(W,"/minFilter: Invalid value (").concat(h,")")),F.e.NEAREST_NEAREST_MIPNEAREST}},W._GetTypedArrayConstructor=function(W,i){switch(i){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("".concat(W,": Invalid component type ").concat(i))}},W._GetTypedArray=function(i,L,h,l,t){var p=h.buffer;l=h.byteOffset+(l||0);var x=W._GetTypedArrayConstructor("".concat(i,"/componentType"),L),R=H.d.GetTypeByteLength(L);return l%R!==0?(a.e.Warn("".concat(i,": Copying buffer as byte offset (").concat(l,") is not a multiple of component type byte length (").concat(R,")")),new x(p.slice(l,l+t*R),0)):new x(p,l,t)},W._GetNumComponents=function(W,i){switch(i){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(W,": Invalid type (").concat(i,")"))},W._ValidateUri=function(W){return p.h.IsBase64(W)||-1===W.indexOf("..")},W._GetDrawMode=function(W,i){switch(void 0==i&&(i=4),i){case 0:return M.b.PointListDrawMode;case 1:return M.b.LineListDrawMode;case 2:return M.b.LineLoopDrawMode;case 3:return M.b.LineStripDrawMode;case 4:return M.b.TriangleFillMode;case 5:return M.b.TriangleStripDrawMode;case 6:return M.b.TriangleFanDrawMode}throw new Error("".concat(W,": Invalid mesh primitive mode (").concat(i,")"))},W.prototype._compileMaterialsAsync=function(){var W=this;this._parent._startPerformanceCounter("Compile materials");var i=new Array;if(this._gltf.materials)for(var L=0,h=this._gltf.materials;L<h.length;L++){var l=h[L];if(l._data)for(var t in l._data)for(var p=l._data[t],x=0,R=p.babylonMeshes;x<R.length;x++){var z=R[x];z.computeWorldMatrix(!0);var r=p.babylonMaterial;i.push(r.forceCompilationAsync(z)),i.push(r.forceCompilationAsync(z,{useInstances:!0})),this._parent.useClipPlane&&(i.push(r.forceCompilationAsync(z,{clipPlane:!0})),i.push(r.forceCompilationAsync(z,{clipPlane:!0,useInstances:!0})))}}return Promise.all(i).then((function(){W._parent._endPerformanceCounter("Compile materials")}))},W.prototype._compileShadowGeneratorsAsync=function(){var W=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var i=new Array,L=0,h=this._babylonScene.lights;L<h.length;L++){var l=h[L].getShadowGenerator();l&&i.push(l.forceCompilationAsync())}return Promise.all(i).then((function(){W._parent._endPerformanceCounter("Compile shadow generators")}))},W.prototype._forEachExtensions=function(W){for(var i=0,L=this._extensions;i<L.length;i++){var h=L[i];h.enabled&&W(h)}},W.prototype._applyExtensions=function(W,i,L){for(var h=0,l=this._extensions;h<l.length;h++){var t=l[h];if(t.enabled){var p="".concat(t.name,".").concat(i),x=W;x._activeLoaderExtensionFunctions=x._activeLoaderExtensionFunctions||{};var R=x._activeLoaderExtensionFunctions;if(!R[p]){R[p]=!0;try{var z=L(t);if(z)return z}finally{delete R[p]}}}}return null},W.prototype._extensionsOnLoading=function(){this._forEachExtensions((function(W){return W.onLoading&&W.onLoading()}))},W.prototype._extensionsOnReady=function(){this._forEachExtensions((function(W){return W.onReady&&W.onReady()}))},W.prototype._extensionsLoadSceneAsync=function(W,i){return this._applyExtensions(i,"loadScene",(function(L){return L.loadSceneAsync&&L.loadSceneAsync(W,i)}))},W.prototype._extensionsLoadNodeAsync=function(W,i,L){return this._applyExtensions(i,"loadNode",(function(h){return h.loadNodeAsync&&h.loadNodeAsync(W,i,L)}))},W.prototype._extensionsLoadCameraAsync=function(W,i,L){return this._applyExtensions(i,"loadCamera",(function(h){return h.loadCameraAsync&&h.loadCameraAsync(W,i,L)}))},W.prototype._extensionsLoadVertexDataAsync=function(W,i,L){return this._applyExtensions(i,"loadVertexData",(function(h){return h._loadVertexDataAsync&&h._loadVertexDataAsync(W,i,L)}))},W.prototype._extensionsLoadMeshPrimitiveAsync=function(W,i,L,h,l,t){return this._applyExtensions(l,"loadMeshPrimitive",(function(p){return p._loadMeshPrimitiveAsync&&p._loadMeshPrimitiveAsync(W,i,L,h,l,t)}))},W.prototype._extensionsLoadMaterialAsync=function(W,i,L,h,l){return this._applyExtensions(i,"loadMaterial",(function(t){return t._loadMaterialAsync&&t._loadMaterialAsync(W,i,L,h,l)}))},W.prototype._extensionsCreateMaterial=function(W,i,L){return this._applyExtensions(i,"createMaterial",(function(h){return h.createMaterial&&h.createMaterial(W,i,L)}))},W.prototype._extensionsLoadMaterialPropertiesAsync=function(W,i,L){return this._applyExtensions(i,"loadMaterialProperties",(function(h){return h.loadMaterialPropertiesAsync&&h.loadMaterialPropertiesAsync(W,i,L)}))},W.prototype._extensionsLoadTextureInfoAsync=function(W,i,L){return this._applyExtensions(i,"loadTextureInfo",(function(h){return h.loadTextureInfoAsync&&h.loadTextureInfoAsync(W,i,L)}))},W.prototype._extensionsLoadTextureAsync=function(W,i,L){return this._applyExtensions(i,"loadTexture",(function(h){return h._loadTextureAsync&&h._loadTextureAsync(W,i,L)}))},W.prototype._extensionsLoadAnimationAsync=function(W,i){return this._applyExtensions(i,"loadAnimation",(function(L){return L.loadAnimationAsync&&L.loadAnimationAsync(W,i)}))},W.prototype._extensionsLoadSkinAsync=function(W,i,L){return this._applyExtensions(L,"loadSkin",(function(h){return h._loadSkinAsync&&h._loadSkinAsync(W,i,L)}))},W.prototype._extensionsLoadUriAsync=function(W,i,L){return this._applyExtensions(i,"loadUri",(function(h){return h._loadUriAsync&&h._loadUriAsync(W,i,L)}))},W.prototype._extensionsLoadBufferViewAsync=function(W,i){return this._applyExtensions(i,"loadBufferView",(function(L){return L.loadBufferViewAsync&&L.loadBufferViewAsync(W,i)}))},W.prototype._extensionsLoadBufferAsync=function(W,i,L,h){return this._applyExtensions(i,"loadBuffer",(function(l){return l.loadBufferAsync&&l.loadBufferAsync(W,i,L,h)}))},W.LoadExtensionAsync=function(W,i,L,h){if(!i.extensions)return null;var l=i.extensions[L];return l?h("".concat(W,"/extensions/").concat(L),l):null},W.LoadExtraAsync=function(W,i,L,h){if(!i.extras)return null;var l=i.extras[L];return l?h("".concat(W,"/extras/").concat(L),l):null},W.prototype.isExtensionUsed=function(W){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(W)},W.prototype.logOpen=function(W){this._parent._logOpen(W)},W.prototype.logClose=function(){this._parent._logClose()},W.prototype.log=function(W){this._parent._log(W)},W.prototype.startPerformanceCounter=function(W){this._parent._startPerformanceCounter(W)},W.prototype.endPerformanceCounter=function(W){this._parent._endPerformanceCounter(W)},W._RegisteredExtensions={},W.DefaultSampler={index:-1},W}();n.b._CreateGLTF2Loader=function(W){return new J(W)};var A=L(96658),v=L(37094),Q=L(60766),O=L(76384),Y=(L(37105),L(56965)),WW=(L(81965),L(42373),L(91156),L(28689),L(16179)),iW=(L(83874),"varying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}");WW.e.ShadersStore.rgbdEncodePixelShader=iW;L(69233);var LW="image/png";function hW(W,i,L,h,l,t,p,x,R,z,r){return new Promise((function(N,I){if(L){var s=i.createTexture(null,!0,!0,null,1,null,(function(W){I(W)}),W);h.getEffect().executeWhenCompiled((function(){h.externalTextureSamplerBinding=!0,h.onApply=function(L){L._bindTexture("textureSampler",s),L.setFloat2("scale",1,i._features.needsInvertingBitmap&&W instanceof ImageBitmap?-1:1)},i.scenes.length&&(i.scenes[0].postProcessManager.directRender([h],z,!0,t,p),i.restoreDefaultFramebuffer(),s.dispose(),URL.revokeObjectURL(l),N())}))}else{if(i._uploadImageToTexture(r,W,t,p),x){var o=R[p];o&&i._uploadImageToTexture(o._texture,W,t,0)}N()}}))}function lW(W,i,L){if(void 0===L&&(L=LW),!p.h.IsExponentOfTwo(W.width))throw new Error("Texture size must be a power of two");var h=A.d.ILog2(W.width)+1,l=W.getEngine(),t=!1,x=!1,R=null,z=null,r=null,N=l.getCaps();if(W.format=5,W.type=0,W.generateMipMaps=!0,W._cachedAnisotropicFilteringLevel=null,l.updateTextureSamplingMode(3,W),N.textureLOD?l._features.supportRenderAndCopyToLodForFloatTextures?N.textureHalfFloatRender&&N.textureHalfFloatLinearFiltering?(t=!0,W.type=2):N.textureFloatRender&&N.textureFloatLinearFiltering&&(t=!0,W.type=1):t=!1:(t=!1,x=!0,r={}),t)R=new Y.e("rgbdDecode","rgbdDecode",null,null,1,null,3,l,!1,void 0,W.type,void 0,null,!1),W._isRGBD=!1,W.invertY=!1,z=l.createRenderTargetCubeTexture(W.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:W.type,format:5});else if(W._isRGBD=!0,W.invertY=!0,x)for(var I=W._lodGenerationScale,s=W._lodGenerationOffset,o=0;o<3;o++){var D=(h-1)*I+s,S=s+(D-s)*(1-o/2),C=Math.round(Math.min(Math.max(S,0),D)),e=new Q.e(l,Q.b.Temp);e.isCube=!0,e.invertY=!0,e.generateMipMaps=!1,l.updateTextureSamplingMode(2,e);var V=new O.d(null);switch(V.isCube=!0,V._texture=e,r[C]=V,o){case 0:W._lodTextureLow=V;break;case 1:W._lodTextureMid=V;break;case 2:W._lodTextureHigh=V}}var c=[],f=function(h){for(var p=function(p){var N=i[h][p],I=new Blob([N],{type:L}),s=URL.createObjectURL(I),o=void 0;if("undefined"===typeof Image||l._features.forceBitmapOverHTMLImageElement)o=l.createImageBitmap(I,{premultiplyAlpha:"none"}).then((function(i){return hW(i,l,t,R,s,p,h,x,r,z,W)}));else{var D=new Image;D.src=s,o=new Promise((function(i,L){D.onload=function(){hW(D,l,t,R,s,p,h,x,r,z,W).then((function(){return i()})).catch((function(W){L(W)}))},D.onerror=function(W){L(W)}}))}c.push(o)},N=0;N<6;N++)p(N)};for(o=0;o<i.length;o++)f(o);if(i.length<h){var a=void 0,P=Math.pow(2,h-1-i.length),y=P*P*4;switch(W.type){case 0:a=new Uint8Array(y);break;case 2:a=new Uint16Array(y);break;case 1:a=new Float32Array(y)}for(o=i.length;o<h;o++)for(var M=0;M<6;M++)l._uploadArrayBufferViewToTexture(W,a,M,o)}return Promise.all(c).then((function(){z&&(l._releaseTexture(W),z._swapAndDie(W)),R&&R.dispose(),x&&(W._lodTextureHigh&&W._lodTextureHigh._texture&&(W._lodTextureHigh._texture.isReady=!0),W._lodTextureMid&&W._lodTextureMid._texture&&(W._lodTextureMid._texture.isReady=!0),W._lodTextureLow&&W._lodTextureLow._texture&&(W._lodTextureLow._texture.isReady=!0))}))}var tW=L(16708),pW=(L(36125),function(W){function i(i,L,h,l,t,p,x,R,z){void 0===l&&(l=5),void 0===t&&(t=0),void 0===p&&(p=!1),void 0===x&&(x=!1),void 0===R&&(R=3),void 0===z&&(z=null);var r=W.call(this,"",i)||this;return r._texture=i.getEngine().createRawCubeTexture(L,h,l,t,p,x,R,z),r}return(0,D.n)(i,W),i.prototype.update=function(W,i,L,h,l){void 0===l&&(l=null),this._texture.getEngine().updateRawCubeTexture(this._texture,W,i,L,h,l)},i.prototype.updateRGBDAsync=function(W,i,L,h){return void 0===i&&(i=null),void 0===L&&(L=.8),void 0===h&&(h=0),function(W,i,L,h,l){var t=lW(W.getEngine().createRawCubeTexture(null,W.width,W.format,W.type,W.generateMipMaps,W.invertY,W.samplingMode,W._compression),i).then((function(){return W}));return W.onRebuildCallback=function(W){return{proxy:t,isReady:!0,isAsync:!0}},W._source=Q.b.CubeRawRGBD,W._bufferViewArrayArray=i,W._lodGenerationScale=h,W._lodGenerationOffset=l,W._sphericalPolynomial=L,lW(W,i).then((function(){return W.isReady=!0,W}))}(this._texture,W,i,L,h).then((function(){}))},i.prototype.clone=function(){var W=this;return b.d.Clone((function(){var L=W.getScene(),h=W._texture,l=new i(L,h._bufferViewArray,h.width,h.format,h.type,h.generateMipMaps,h.invertY,h.samplingMode,h._compression);return h.source===Q.b.CubeRawRGBD&&l.updateRGBDAsync(h._bufferViewArrayArray,h._sphericalPolynomial,h._lodGenerationScale,h._lodGenerationOffset),l}),this)},i}(tW.e)),xW="EXT_lights_image_based",RW=function(){function W(W){this.name=xW,this._loader=W,this.enabled=this._loader.isExtensionUsed(xW)}return W.prototype.dispose=function(){this._loader=null,delete this._lights},W.prototype.onLoading=function(){var W=this._loader.gltf.extensions;if(W&&W[this.name]){var i=W[this.name];this._lights=i.lights}},W.prototype.loadSceneAsync=function(W,i){var L=this;return J.LoadExtensionAsync(W,i,this.name,(function(h,l){var t=new Array;t.push(L._loader.loadSceneAsync(W,i)),L._loader.logOpen("".concat(h));var p=G.Get("".concat(h,"/light"),L._lights,l.light);return t.push(L._loadLightAsync("/extensions/".concat(L.name,"/lights/").concat(l.light),p).then((function(W){L._loader.babylonScene.environmentTexture=W}))),L._loader.logClose(),Promise.all(t).then((function(){}))}))},W.prototype._loadLightAsync=function(W,i){var L=this;if(!i._loaded){var h=new Array;this._loader.logOpen("".concat(W));for(var t=new Array(i.specularImages.length),p=function(L){var l=i.specularImages[L];t[L]=new Array(l.length);for(var p=function(i){var p="".concat(W,"/specularImages/").concat(L,"/").concat(i);x._loader.logOpen("".concat(p));var R=l[i],z=G.Get(p,x._loader.gltf.images,R);h.push(x._loader.loadImageAsync("/images/".concat(R),z).then((function(W){t[L][i]=W}))),x._loader.logClose()},R=0;R<l.length;R++)p(R)},x=this,R=0;R<i.specularImages.length;R++)p(R);this._loader.logClose(),i._loaded=Promise.all(h).then((function(){var h=new pW(L._loader.babylonScene,null,i.specularImageSize);if(h.name=i.name||"environment",i._babylonTexture=h,void 0!=i.intensity&&(h.level=i.intensity),i.rotation){var p=l.g.FromArray(i.rotation);L._loader.babylonScene.useRightHandedSystem||(p=l.g.Inverse(p)),l.d.FromQuaternionToRef(p,h.getReflectionTextureMatrix())}if(!i.irradianceCoefficients)throw new Error("".concat(W,": Irradiance coefficients are missing"));var x=v.e.FromArray(i.irradianceCoefficients);x.scaleInPlace(i.intensity),x.convertIrradianceToLambertianRadiance();var R=v.f.FromHarmonics(x),z=(t.length-1)/A.d.Log2(i.specularImageSize);return h.updateRGBDAsync(t,R,z)}))}return i._loaded.then((function(){return i._babylonTexture}))},W}();J.RegisterExtension(xW,(function(W){return new RW(W)}));L(14313);var zW="EXT_mesh_gpu_instancing",rW=function(){function W(W){this.name=zW,this._loader=W,this.enabled=this._loader.isExtensionUsed(zW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadNodeAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(W,t){h._loader._disableInstancedMesh++;var p=h._loader.loadNodeAsync("/nodes/".concat(i.index),i,L);if(h._loader._disableInstancedMesh--,!i._primitiveBabylonMeshes)return p;var x=new Array,R=0,z=function(i){if(void 0!=t.attributes[i]){var L=G.Get("".concat(W,"/attributes/").concat(i),h._loader.gltf.accessors,t.attributes[i]);if(x.push(h._loader._loadFloatAccessorAsync("/accessors/".concat(L.bufferView),L)),0===R)R=L.count;else if(R!==L.count)throw new Error("".concat(W,"/attributes: Instance buffer accessors do not have the same count."))}else x.push(Promise.resolve(null))};return z("TRANSLATION"),z("ROTATION"),z("SCALE"),p.then((function(W){return Promise.all(x).then((function(L){var h=L[0],t=L[1],p=L[2],x=new Float32Array(16*R);l.h.Vector3[0].copyFromFloats(0,0,0),l.h.Quaternion[0].copyFromFloats(0,0,0,1),l.h.Vector3[1].copyFromFloats(1,1,1);for(var z=0;z<R;++z)h&&l.m.FromArrayToRef(h,3*z,l.h.Vector3[0]),t&&l.g.FromArrayToRef(t,4*z,l.h.Quaternion[0]),p&&l.m.FromArrayToRef(p,3*z,l.h.Vector3[1]),l.d.ComposeToRef(l.h.Vector3[1],l.h.Quaternion[0],l.h.Vector3[0],l.h.Matrix[0]),l.h.Matrix[0].copyToArray(x,16*z);for(var r=0,N=i._primitiveBabylonMeshes;r<N.length;r++){N[r].thinInstanceSetBuffer("matrix",x,16,!0)}return W}))}))}))},W}();J.RegisterExtension(zW,(function(W){return new rW(W)}));var NW=function(){function W(){var i=W.Configuration.decoder;this._decoderModulePromise=p.h.LoadScriptAsync(p.h.GetAbsoluteUrl(i.url)).then((function(){return MeshoptDecoder.ready}))}return Object.defineProperty(W,"Default",{get:function(){return W._Default||(W._Default=new W),W._Default},enumerable:!1,configurable:!0}),W.prototype.dispose=function(){delete this._decoderModulePromise},W.prototype.decodeGltfBufferAsync=function(W,i,L,h,l){return this._decoderModulePromise.then((function(){var t=new Uint8Array(i*L);return MeshoptDecoder.decodeGltfBuffer(t,i,L,W,h,l),t}))},W.Configuration={decoder:{url:"https://preview.babylonjs.com/meshopt_decoder.js"}},W._Default=null,W}(),IW="EXT_meshopt_compression",sW=function(){function W(W){this.name=IW,this.enabled=W.isExtensionUsed(IW),this._loader=W}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadBufferViewAsync=function(W,i){var L=this;return J.LoadExtensionAsync(W,i,this.name,(function(h,l){var t=i;if(t._meshOptData)return t._meshOptData;var p=G.Get("".concat(W,"/buffer"),L._loader.gltf.buffers,l.buffer);return t._meshOptData=L._loader.loadBufferAsync("/buffers/".concat(p.index),p,l.byteOffset||0,l.byteLength).then((function(W){return NW.Default.decodeGltfBufferAsync(W,l.count,l.byteStride,l.mode,l.filter)})),t._meshOptData}))},W}();J.RegisterExtension(IW,(function(W){return new sW(W)}));var oW="EXT_texture_webp",DW=function(){function W(W){this.name=oW,this._loader=W,this.enabled=W.isExtensionUsed(oW)}return W.prototype.dispose=function(){this._loader=null},W.prototype._loadTextureAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=void 0==i.sampler?J.DefaultSampler:G.Get("".concat(W,"/sampler"),h._loader.gltf.samplers,i.sampler),x=G.Get("".concat(l,"/source"),h._loader.gltf.images,t.source);return h._loader._createTextureAsync(W,p,x,(function(W){L(W)}),void 0,!i._textureInfo.nonColorData)}))},W}();J.RegisterExtension(oW,(function(W){return new DW(W)}));var SW=L(40689),CW="KHR_draco_mesh_compression",eW=function(){function W(W){this.name=CW,this._loader=W,this.enabled=SW.e.DecoderAvailable&&this._loader.isExtensionUsed(CW)}return W.prototype.dispose=function(){delete this.dracoCompression,this._loader=null},W.prototype._loadVertexDataAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){if(void 0!=i.mode){if(5!==i.mode&&4!==i.mode)throw new Error("".concat(W,": Unsupported mode ").concat(i.mode));if(5===i.mode)throw new Error("".concat(W,": Mode ").concat(i.mode," is not currently supported"))}var p={},x={},R=function(l,R){var z=t.attributes[l];if(void 0!==z&&void 0!==i.attributes[l]){p[R]=z;var r=G.Get("".concat(W,"/attributes/").concat(l),h._loader.gltf.accessors,i.attributes[l]);if(r.normalized&&5126!==r.componentType){var N=1;switch(r.componentType){case 5120:N=127;break;case 5121:N=255;break;case 5122:N=32767;break;case 5123:N=65535}x[R]=N}L._delayInfo=L._delayInfo||[],-1===L._delayInfo.indexOf(R)&&L._delayInfo.push(R)}};R("POSITION",H.d.PositionKind),R("NORMAL",H.d.NormalKind),R("TANGENT",H.d.TangentKind),R("TEXCOORD_0",H.d.UVKind),R("TEXCOORD_1",H.d.UV2Kind),R("TEXCOORD_2",H.d.UV3Kind),R("TEXCOORD_3",H.d.UV4Kind),R("TEXCOORD_4",H.d.UV5Kind),R("TEXCOORD_5",H.d.UV6Kind),R("JOINTS_0",H.d.MatricesIndicesKind),R("WEIGHTS_0",H.d.MatricesWeightsKind),R("COLOR_0",H.d.ColorKind);var z=G.Get(l,h._loader.gltf.bufferViews,t.bufferView);return z._dracoBabylonGeometry||(z._dracoBabylonGeometry=h._loader.loadBufferViewAsync("/bufferViews/".concat(z.index),z).then((function(i){return(h.dracoCompression||SW.e.Default).decodeMeshAsync(i,p,x).then((function(W){var i=new k.b(L.name,h._loader.babylonScene);return W.applyToGeometry(i),i})).catch((function(i){throw new Error("".concat(W,": ").concat(i.message))}))}))),z._dracoBabylonGeometry}))},W}();J.RegisterExtension(CW,(function(W){return new eW(W)}));var VW=L(15706),cW=L(315),fW=L(13680);C.b.AddNodeConstructor("Light_Type_0",(function(W,i){return function(){return new aW(W,l.m.Zero(),i)}}));var aW=function(W){function i(i,L,h){var l=W.call(this,i,h)||this;return l._shadowAngle=Math.PI/2,l.position=L,l}return(0,D.n)(i,W),Object.defineProperty(i.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(W){this._shadowAngle=W,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(W){var i=this.needCube();this._direction=W,this.needCube()!==i&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PointLight"},i.prototype.getTypeID=function(){return cW.d.LIGHTTYPEID_POINTLIGHT},i.prototype.needCube=function(){return!this.direction},i.prototype.getShadowDirection=function(i){if(this.direction)return W.prototype.getShadowDirection.call(this,i);switch(i){case 0:return new l.m(1,0,0);case 1:return new l.m(-1,0,0);case 2:return new l.m(0,-1,0);case 3:return new l.m(0,1,0);case 4:return new l.m(0,0,1);case 5:return new l.m(0,0,-1)}return l.m.Zero()},i.prototype._setDefaultShadowProjectionMatrix=function(W,i,L){var h=this.getScene().activeCamera;if(h){var t=void 0!==this.shadowMinZ?this.shadowMinZ:h.minZ,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,x=this.getScene().getEngine().useReverseDepthBuffer;l.d.PerspectiveFovLHToRef(this.shadowAngle,1,x?p:t,x?t:p,W,!0,this._scene.getEngine().isNDCHalfZRange,void 0,x)}},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.transferToEffect=function(W,i){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,i):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,i),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,i),this},i.prototype.transferToNodeMaterialEffect=function(W,i){return this.computeTransformedInformation()?W.setFloat3(i,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):W.setFloat3(i,this.position.x,this.position.y,this.position.z),this},i.prototype.prepareLightSpecificDefines=function(W,i){W["POINTLIGHT"+i]=!0},(0,D.j)([(0,b.H)()],i.prototype,"shadowAngle",null),i}(fW.c);C.b.AddNodeConstructor("Light_Type_2",(function(W,i){return function(){return new PW(W,l.m.Zero(),l.m.Zero(),0,0,i)}}));var PW=function(W){function i(i,L,h,t,p,x){var R=W.call(this,i,x)||this;return R._innerAngle=0,R._projectionTextureMatrix=l.d.Zero(),R._projectionTextureLightNear=1e-6,R._projectionTextureLightFar=1e3,R._projectionTextureUpDirection=l.m.Up(),R._projectionTextureViewLightDirty=!0,R._projectionTextureProjectionLightDirty=!0,R._projectionTextureDirty=!0,R._projectionTextureViewTargetVector=l.m.Zero(),R._projectionTextureViewLightMatrix=l.d.Zero(),R._projectionTextureProjectionLightMatrix=l.d.Zero(),R._projectionTextureScalingMatrix=l.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),R.position=L,R.direction=h,R.angle=t,R.exponent=p,R}return(0,D.n)(i,W),Object.defineProperty(i.prototype,"angle",{get:function(){return this._angle},set:function(W){this._angle=W,this._cosHalfAngle=Math.cos(.5*W),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(W){this._innerAngle=W,this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(W){this._shadowAngleScale=W,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(W){this._projectionTextureLightNear=W,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(W){this._projectionTextureLightFar=W,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(W){this._projectionTextureUpDirection=W,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(W){var L=this;this._projectionTexture!==W&&(this._projectionTexture=W,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(i._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((function(){L._markMeshesAsLightDirty()})):i._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((function(){L._markMeshesAsLightDirty()}))))},enumerable:!1,configurable:!0}),i._IsProceduralTexture=function(W){return void 0!==W.onGeneratedObservable},i._IsTexture=function(W){return void 0!==W.onLoadObservable},Object.defineProperty(i.prototype,"projectionTextureProjectionLightMatrix",{get:function(){return this._projectionTextureProjectionLightMatrix},set:function(W){this._projectionTextureProjectionLightMatrix=W,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"SpotLight"},i.prototype.getTypeID=function(){return cW.d.LIGHTTYPEID_SPOTLIGHT},i.prototype._setDirection=function(i){W.prototype._setDirection.call(this,i),this._projectionTextureViewLightDirty=!0},i.prototype._setPosition=function(i){W.prototype._setPosition.call(this,i),this._projectionTextureViewLightDirty=!0},i.prototype._setDefaultShadowProjectionMatrix=function(W,i,L){var h=this.getScene().activeCamera;if(h){this._shadowAngleScale=this._shadowAngleScale||1;var t=this._shadowAngleScale*this._angle,p=void 0!==this.shadowMinZ?this.shadowMinZ:h.minZ,x=void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,R=this.getScene().getEngine().useReverseDepthBuffer;l.d.PerspectiveFovLHToRef(t,1,R?x:p,R?p:x,W,!0,this._scene.getEngine().isNDCHalfZRange,void 0,R)}},i.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),l.d.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},i.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var W=this.projectionTextureLightFar,i=this.projectionTextureLightNear,L=W/(W-i),h=-L*i,t=1/Math.tan(this._angle/2);l.d.FromValuesToRef(t/1,0,0,0,0,t,0,0,0,0,L,1,0,0,h,0,this._projectionTextureProjectionLightMatrix)},i.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof F.e){var W=this._projectionTexture.uScale/2,i=this._projectionTexture.vScale/2;l.d.FromValuesToRef(W,0,0,0,0,i,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},i.prototype.transferTexturesToEffect=function(W,i){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),W.setMatrix("textureProjectionMatrix"+i,this._projectionTextureMatrix),W.setTexture("projectionLightSampler"+i,this.projectionTexture)),this},i.prototype.transferToEffect=function(W,i){var L;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,i),L=l.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,i),L=l.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",L.x,L.y,L.z,this._cosHalfAngle,i),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,i),this},i.prototype.transferToNodeMaterialEffect=function(W,i){var L;return L=this.computeTransformedInformation()?l.m.Normalize(this.transformedDirection):l.m.Normalize(this.direction),this.getScene().useRightHandedSystem?W.setFloat3(i,-L.x,-L.y,-L.z):W.setFloat3(i,L.x,L.y,L.z),this},i.prototype.dispose=function(){W.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},i.prototype.getDepthMinZ=function(W){var i=this._scene.getEngine(),L=void 0!==this.shadowMinZ?this.shadowMinZ:W.minZ;return i.useReverseDepthBuffer&&i.isNDCHalfZRange?L:this._scene.getEngine().isNDCHalfZRange?0:L},i.prototype.getDepthMaxZ=function(W){var i=this._scene.getEngine(),L=void 0!==this.shadowMaxZ?this.shadowMaxZ:W.maxZ;return i.useReverseDepthBuffer&&i.isNDCHalfZRange?0:L},i.prototype.prepareLightSpecificDefines=function(W,i){W["SPOTLIGHT"+i]=!0,W["PROJECTEDLIGHTTEXTURE"+i]=!(!this.projectionTexture||!this.projectionTexture.isReady())},(0,D.j)([(0,b.H)()],i.prototype,"angle",null),(0,D.j)([(0,b.H)()],i.prototype,"innerAngle",null),(0,D.j)([(0,b.H)()],i.prototype,"shadowAngleScale",null),(0,D.j)([(0,b.H)()],i.prototype,"exponent",void 0),(0,D.j)([(0,b.H)()],i.prototype,"projectionTextureLightNear",null),(0,D.j)([(0,b.H)()],i.prototype,"projectionTextureLightFar",null),(0,D.j)([(0,b.H)()],i.prototype,"projectionTextureUpDirection",null),(0,D.j)([(0,b.C)("projectedLightTexture")],i.prototype,"_projectionTexture",void 0),i}(fW.c),yW="KHR_lights_punctual",MW=function(){function W(W){this.name=yW,this._loader=W,this.enabled=this._loader.isExtensionUsed(yW)}return W.prototype.dispose=function(){this._loader=null,delete this._lights},W.prototype.onLoading=function(){var W=this._loader.gltf.extensions;if(W&&W[this.name]){var i=W[this.name];this._lights=i.lights}},W.prototype.loadNodeAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(p,x){return h._loader.loadNodeAsync(W,i,(function(W){var i,R=G.Get(p,h._lights,x.light),z=R.name||W.name;switch(h._loader.babylonScene._blockEntityCollection=!!h._loader._assetContainer,R.type){case"directional":i=new VW.d(z,l.m.Backward(),h._loader.babylonScene);break;case"point":i=new aW(z,l.m.Zero(),h._loader.babylonScene);break;case"spot":var r=new PW(z,l.m.Zero(),l.m.Backward(),0,1,h._loader.babylonScene);r.angle=2*(R.spot&&R.spot.outerConeAngle||Math.PI/4),r.innerAngle=2*(R.spot&&R.spot.innerConeAngle||0),i=r;break;default:throw h._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(p,": Invalid light type (").concat(R.type,")"))}i._parentContainer=h._loader._assetContainer,h._loader.babylonScene._blockEntityCollection=!1,i.falloffType=cW.d.FALLOFF_GLTF,i.diffuse=R.color?t.d.FromArray(R.color):t.d.White(),i.intensity=void 0==R.intensity?1:R.intensity,i.range=void 0==R.range?Number.MAX_VALUE:R.range,i.parent=W,h._loader._babylonLights.push(i),J.AddPointerMetadata(i,p),L(W)}))}))},W}();J.RegisterExtension(yW,(function(W){return new MW(W)}));var bW="KHR_materials_pbrSpecularGlossiness",jW=function(){function W(W){this.name=bW,this.order=200,this._loader=W,this.enabled=this._loader.isExtensionUsed(bW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialBasePropertiesAsync(W,i,L)),p.push(h._loadSpecularGlossinessPropertiesAsync(l,i,t,L)),h._loader.loadMaterialAlphaProperties(W,i,L),Promise.all(p).then((function(){}))}))},W.prototype._loadSpecularGlossinessPropertiesAsync=function(W,i,L,h){if(!(h instanceof T))throw new Error("".concat(W,": Material type not supported"));var l=new Array;return h.metallic=null,h.roughness=null,L.diffuseFactor?(h.albedoColor=t.d.FromArray(L.diffuseFactor),h.alpha=L.diffuseFactor[3]):h.albedoColor=t.d.White(),h.reflectivityColor=L.specularFactor?t.d.FromArray(L.specularFactor):t.d.White(),h.microSurface=void 0==L.glossinessFactor?1:L.glossinessFactor,L.diffuseTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(W,"/diffuseTexture"),L.diffuseTexture,(function(W){W.name="".concat(h.name," (Diffuse)"),h.albedoTexture=W}))),L.specularGlossinessTexture&&(l.push(this._loader.loadTextureInfoAsync("".concat(W,"/specularGlossinessTexture"),L.specularGlossinessTexture,(function(W){W.name="".concat(h.name," (Specular Glossiness)"),h.reflectivityTexture=W,h.reflectivityTexture.hasAlpha=!0}))),h.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(l).then((function(){}))},W}();J.RegisterExtension(bW,(function(W){return new jW(W)}));var ZW="KHR_materials_unlit",XW=function(){function W(W){this.name=ZW,this.order=210,this._loader=W,this.enabled=this._loader.isExtensionUsed(ZW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(){return h._loadUnlitPropertiesAsync(W,i,L)}))},W.prototype._loadUnlitPropertiesAsync=function(W,i,L){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var h=new Array;L.unlit=!0;var l=i.pbrMetallicRoughness;return l&&(l.baseColorFactor?(L.albedoColor=t.d.FromArray(l.baseColorFactor),L.alpha=l.baseColorFactor[3]):L.albedoColor=t.d.White(),l.baseColorTexture&&h.push(this._loader.loadTextureInfoAsync("".concat(W,"/baseColorTexture"),l.baseColorTexture,(function(W){W.name="".concat(L.name," (Base Color)"),L.albedoTexture=W})))),i.doubleSided&&(L.backFaceCulling=!1,L.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(W,i,L),Promise.all(h).then((function(){}))},W}();J.RegisterExtension(ZW,(function(W){return new XW(W)}));var TW="KHR_materials_clearcoat",FW=function(){function W(W){this.name=TW,this.order=190,this._loader=W,this.enabled=this._loader.isExtensionUsed(TW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialPropertiesAsync(W,i,L)),p.push(h._loadClearCoatPropertiesAsync(l,t,L)),Promise.all(p).then((function(){}))}))},W.prototype._loadClearCoatPropertiesAsync=function(W,i,L){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var h=new Array;return L.clearCoat.isEnabled=!0,L.clearCoat.useRoughnessFromMainTexture=!1,L.clearCoat.remapF0OnInterfaceChange=!1,void 0!=i.clearcoatFactor?L.clearCoat.intensity=i.clearcoatFactor:L.clearCoat.intensity=0,i.clearcoatTexture&&h.push(this._loader.loadTextureInfoAsync("".concat(W,"/clearcoatTexture"),i.clearcoatTexture,(function(W){W.name="".concat(L.name," (ClearCoat Intensity)"),L.clearCoat.texture=W}))),void 0!=i.clearcoatRoughnessFactor?L.clearCoat.roughness=i.clearcoatRoughnessFactor:L.clearCoat.roughness=0,i.clearcoatRoughnessTexture&&(i.clearcoatRoughnessTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync("".concat(W,"/clearcoatRoughnessTexture"),i.clearcoatRoughnessTexture,(function(W){W.name="".concat(L.name," (ClearCoat Roughness)"),L.clearCoat.textureRoughness=W})))),i.clearcoatNormalTexture&&(i.clearcoatNormalTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync("".concat(W,"/clearcoatNormalTexture"),i.clearcoatNormalTexture,(function(W){W.name="".concat(L.name," (ClearCoat Normal)"),L.clearCoat.bumpTexture=W}))),L.invertNormalMapX=!L.getScene().useRightHandedSystem,L.invertNormalMapY=L.getScene().useRightHandedSystem,void 0!=i.clearcoatNormalTexture.scale&&(L.clearCoat.bumpTexture.level=i.clearcoatNormalTexture.scale)),Promise.all(h).then((function(){}))},W}();J.RegisterExtension(TW,(function(W){return new FW(W)}));var qW="KHR_materials_iridescence",HW=function(){function W(W){this.name=qW,this.order=195,this._loader=W,this.enabled=this._loader.isExtensionUsed(qW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialPropertiesAsync(W,i,L)),p.push(h._loadIridescencePropertiesAsync(l,t,L)),Promise.all(p).then((function(){}))}))},W.prototype._loadIridescencePropertiesAsync=function(W,i,L){var h,l,t,p,x;if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var R=new Array;return L.iridescence.isEnabled=!0,L.iridescence.intensity=null!==(h=i.iridescenceFactor)&&void 0!==h?h:0,L.iridescence.indexOfRefraction=null!==(t=null!==(l=i.iridescenceIor)&&void 0!==l?l:i.iridescenceIOR)&&void 0!==t?t:1.3,L.iridescence.minimumThickness=null!==(p=i.iridescenceThicknessMinimum)&&void 0!==p?p:100,L.iridescence.maximumThickness=null!==(x=i.iridescenceThicknessMaximum)&&void 0!==x?x:400,i.iridescenceTexture&&R.push(this._loader.loadTextureInfoAsync("".concat(W,"/iridescenceTexture"),i.iridescenceTexture,(function(W){W.name="".concat(L.name," (Iridescence Intensity)"),L.iridescence.texture=W}))),i.iridescenceThicknessTexture&&R.push(this._loader.loadTextureInfoAsync("".concat(W,"/iridescenceThicknessTexture"),i.iridescenceThicknessTexture,(function(W){W.name="".concat(L.name," (Iridescence Thickness)"),L.iridescence.thicknessTexture=W}))),Promise.all(R).then((function(){}))},W}();J.RegisterExtension(qW,(function(W){return new HW(W)}));var kW="KHR_materials_emissive_strength",UW=function(){function W(W){this.name=kW,this.order=170,this._loader=W,this.enabled=this._loader.isExtensionUsed(kW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){return h._loader.loadMaterialPropertiesAsync(W,i,L).then((function(){h._loadEmissiveProperties(l,t,L)}))}))},W.prototype._loadEmissiveProperties=function(W,i,L){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));void 0!==i.emissiveStrength&&L.emissiveColor.scaleToRef(i.emissiveStrength,L.emissiveColor)},W}();J.RegisterExtension(kW,(function(W){return new UW(W)}));var dW="KHR_materials_sheen",BW=function(){function W(W){this.name=dW,this.order=190,this._loader=W,this.enabled=this._loader.isExtensionUsed(dW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialPropertiesAsync(W,i,L)),p.push(h._loadSheenPropertiesAsync(l,t,L)),Promise.all(p).then((function(){}))}))},W.prototype._loadSheenPropertiesAsync=function(W,i,L){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var h=new Array;return L.sheen.isEnabled=!0,L.sheen.intensity=1,void 0!=i.sheenColorFactor?L.sheen.color=t.d.FromArray(i.sheenColorFactor):L.sheen.color=t.d.Black(),i.sheenColorTexture&&h.push(this._loader.loadTextureInfoAsync("".concat(W,"/sheenColorTexture"),i.sheenColorTexture,(function(W){W.name="".concat(L.name," (Sheen Color)"),L.sheen.texture=W}))),void 0!==i.sheenRoughnessFactor?L.sheen.roughness=i.sheenRoughnessFactor:L.sheen.roughness=0,i.sheenRoughnessTexture&&(i.sheenRoughnessTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync("".concat(W,"/sheenRoughnessTexture"),i.sheenRoughnessTexture,(function(W){W.name="".concat(L.name," (Sheen Roughness)"),L.sheen.textureRoughness=W})))),L.sheen.albedoScaling=!0,L.sheen.useRoughnessFromMainTexture=!1,Promise.all(h).then((function(){}))},W}();J.RegisterExtension(dW,(function(W){return new BW(W)}));var wW="KHR_materials_specular",gW=function(){function W(W){this.name=wW,this.order=190,this._loader=W,this.enabled=this._loader.isExtensionUsed(wW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialPropertiesAsync(W,i,L)),p.push(h._loadSpecularPropertiesAsync(l,t,L)),Promise.all(p).then((function(){}))}))},W.prototype._loadSpecularPropertiesAsync=function(W,i,L){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var h=new Array;return void 0!==i.specularFactor&&(L.metallicF0Factor=i.specularFactor),void 0!==i.specularColorFactor&&(L.metallicReflectanceColor=t.d.FromArray(i.specularColorFactor)),i.specularTexture&&(i.specularTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync("".concat(W,"/specularTexture"),i.specularTexture,(function(W){W.name="".concat(L.name," (Specular F0 Strength)"),L.metallicReflectanceTexture=W,L.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),i.specularColorTexture&&h.push(this._loader.loadTextureInfoAsync("".concat(W,"/specularColorTexture"),i.specularColorTexture,(function(W){W.name="".concat(L.name," (Specular F0 Color)"),L.reflectanceTexture=W}))),Promise.all(h).then((function(){}))},W}();J.RegisterExtension(wW,(function(W){return new gW(W)}));var nW="KHR_materials_ior",mW=function(){function W(W){this.name=nW,this.order=180,this._loader=W,this.enabled=this._loader.isExtensionUsed(nW)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialPropertiesAsync(W,i,L)),p.push(h._loadIorPropertiesAsync(l,t,L)),Promise.all(p).then((function(){}))}))},W.prototype._loadIorPropertiesAsync=function(i,L,h){if(!(h instanceof T))throw new Error("".concat(i,": Material type not supported"));return void 0!==L.ior?h.indexOfRefraction=L.ior:h.indexOfRefraction=W._DEFAULT_IOR,Promise.resolve()},W._DEFAULT_IOR=1.5,W}();J.RegisterExtension(nW,(function(W){return new mW(W)}));var EW="KHR_materials_variants",KW=function(){function W(W){this.name=EW,this._loader=W,this.enabled=this._loader.isExtensionUsed(EW)}return W.prototype.dispose=function(){this._loader=null},W.GetAvailableVariants=function(W){var i=this._GetExtensionMetadata(W);return i?Object.keys(i.variants):[]},W.prototype.getAvailableVariants=function(i){return W.GetAvailableVariants(i)},W.SelectVariant=function(W,i){var L=this._GetExtensionMetadata(W);if(!L)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(EW," extension"));var h=function(W){var i=L.variants[W];if(i)for(var h=0,l=i;h<l.length;h++){var t=l[h];t.mesh.material=t.material}};if(i instanceof Array)for(var l=0,t=i;l<t.length;l++){h(t[l])}else h(i);L.lastSelected=i},W.prototype.selectVariant=function(i,L){return W.SelectVariant(i,L)},W.Reset=function(W){var i=this._GetExtensionMetadata(W);if(!i)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(EW," extension"));for(var L=0,h=i.original;L<h.length;L++){var l=h[L];l.mesh.material=l.material}i.lastSelected=null},W.prototype.reset=function(i){return W.Reset(i)},W.GetLastSelectedVariant=function(W){var i=this._GetExtensionMetadata(W);if(!i)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(EW," extension"));return i.lastSelected},W.prototype.getLastSelectedVariant=function(i){return W.GetLastSelectedVariant(i)},W._GetExtensionMetadata=function(W){var i,L;return(null===(L=null===(i=null===W||void 0===W?void 0:W.metadata)||void 0===i?void 0:i.gltf)||void 0===L?void 0:L.KHR_materials_variants)||null},W.prototype.onLoading=function(){var W=this._loader.gltf.extensions;if(W&&W[this.name]){var i=W[this.name];this._variants=i.variants}},W.prototype._loadMeshPrimitiveAsync=function(i,L,h,l,t,p){var x=this;return J.LoadExtensionAsync(i,t,this.name,(function(R,z){var r=new Array;return r.push(x._loader._loadMeshPrimitiveAsync(i,L,h,l,t,(function(L){if(p(L),L instanceof U.e){var h=J._GetDrawMode(i,t.mode),l=x._loader.rootBabylonMesh,N=l?l.metadata=l.metadata||{}:{},I=N.gltf=N.gltf||{},s=I.KHR_materials_variants=I.KHR_materials_variants||{lastSelected:null,original:[],variants:{}};s.original.push({mesh:L,material:L.material});for(var o=function(i){var t=z.mappings[i],p=G.Get("".concat(R,"/mappings/").concat(i,"/material"),x._loader.gltf.materials,t.material);r.push(x._loader._loadMaterialAsync("#/materials/".concat(t.material),p,L,h,(function(i){for(var h=function(h){var p=t.variants[h],R=G.Get("/extensions/".concat(EW,"/variants/").concat(p),x._variants,p);s.variants[R.name]=s.variants[R.name]||[],s.variants[R.name].push({mesh:L,material:i}),L.onClonedObservable.add((function(i){var h=i,t=null,p=h;do{if(!(p=p.parent))return;t=W._GetExtensionMetadata(p)}while(null===t);if(l&&t===W._GetExtensionMetadata(l)){for(var x in p.metadata={},l.metadata)p.metadata[x]=l.metadata[x];for(var x in p.metadata.gltf=[],l.metadata.gltf)p.metadata.gltf[x]=l.metadata.gltf[x];p.metadata.gltf.KHR_materials_variants={lastSelected:null,original:[],variants:{}};for(var z=0,r=t.original;z<r.length;z++){var N=r[z];p.metadata.gltf.KHR_materials_variants.original.push({mesh:N.mesh,material:N.material})}for(var x in t.variants)if(Object.prototype.hasOwnProperty.call(t.variants,x)){p.metadata.gltf.KHR_materials_variants.variants[x]=[];for(var I=0,s=t.variants[x];I<s.length;I++){var o=s[I];p.metadata.gltf.KHR_materials_variants.variants[x].push({mesh:o.mesh,material:o.material})}}t=p.metadata.gltf.KHR_materials_variants}for(var D=0,S=t.original;D<S.length;D++){(V=S[D]).mesh===L&&(V.mesh=h)}for(var C=0,e=t.variants[R.name];C<e.length;C++){var V;(V=e[C]).mesh===L&&(V.mesh=h)}}))},p=0;p<t.variants.length;++p)h(p)})))},D=0;D<z.mappings.length;++D)o(D)}}))),Promise.all(r).then((function(W){return W[0]}))}))},W}();J.RegisterExtension(EW,(function(W){return new KW(W)}));var GW=function(){return GW=Object.assign||function(W){for(var i,L=1,h=arguments.length;L<h;L++)for(var l in i=arguments[L])Object.prototype.hasOwnProperty.call(i,l)&&(W[l]=i[l]);return W},GW.apply(this,arguments)};Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var uW=L(52128),JW=function(){function W(){}return W.ALPHA_DISABLE=0,W.ALPHA_ADD=1,W.ALPHA_COMBINE=2,W.ALPHA_SUBTRACT=3,W.ALPHA_MULTIPLY=4,W.ALPHA_MAXIMIZED=5,W.ALPHA_ONEONE=6,W.ALPHA_PREMULTIPLIED=7,W.ALPHA_PREMULTIPLIED_PORTERDUFF=8,W.ALPHA_INTERPOLATE=9,W.ALPHA_SCREENMODE=10,W.ALPHA_ONEONE_ONEONE=11,W.ALPHA_ALPHATOCOLOR=12,W.ALPHA_REVERSEONEMINUS=13,W.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,W.ALPHA_ONEONE_ONEZERO=15,W.ALPHA_EXCLUSION=16,W.ALPHA_LAYER_ACCUMULATE=17,W.ALPHA_EQUATION_ADD=0,W.ALPHA_EQUATION_SUBSTRACT=1,W.ALPHA_EQUATION_REVERSE_SUBTRACT=2,W.ALPHA_EQUATION_MAX=3,W.ALPHA_EQUATION_MIN=4,W.ALPHA_EQUATION_DARKEN=5,W.DELAYLOADSTATE_NONE=0,W.DELAYLOADSTATE_LOADED=1,W.DELAYLOADSTATE_LOADING=2,W.DELAYLOADSTATE_NOTLOADED=4,W.NEVER=512,W.ALWAYS=519,W.LESS=513,W.EQUAL=514,W.LEQUAL=515,W.GREATER=516,W.GEQUAL=518,W.NOTEQUAL=517,W.KEEP=7680,W.ZERO=0,W.REPLACE=7681,W.INCR=7682,W.DECR=7683,W.INVERT=5386,W.INCR_WRAP=34055,W.DECR_WRAP=34056,W.TEXTURE_CLAMP_ADDRESSMODE=0,W.TEXTURE_WRAP_ADDRESSMODE=1,W.TEXTURE_MIRROR_ADDRESSMODE=2,W.TEXTURE_CREATIONFLAG_STORAGE=1,W.TEXTUREFORMAT_ALPHA=0,W.TEXTUREFORMAT_LUMINANCE=1,W.TEXTUREFORMAT_LUMINANCE_ALPHA=2,W.TEXTUREFORMAT_RGB=4,W.TEXTUREFORMAT_RGBA=5,W.TEXTUREFORMAT_RED=6,W.TEXTUREFORMAT_R=6,W.TEXTUREFORMAT_RG=7,W.TEXTUREFORMAT_RED_INTEGER=8,W.TEXTUREFORMAT_R_INTEGER=8,W.TEXTUREFORMAT_RG_INTEGER=9,W.TEXTUREFORMAT_RGB_INTEGER=10,W.TEXTUREFORMAT_RGBA_INTEGER=11,W.TEXTUREFORMAT_BGRA=12,W.TEXTUREFORMAT_DEPTH24_STENCIL8=13,W.TEXTUREFORMAT_DEPTH32_FLOAT=14,W.TEXTUREFORMAT_DEPTH16=15,W.TEXTUREFORMAT_DEPTH24=16,W.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,W.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,W.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,W.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,W.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,W.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,W.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,W.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,W.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,W.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,W.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,W.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,W.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,W.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,W.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,W.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,W.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,W.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,W.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,W.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,W.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,W.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,W.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,W.TEXTURETYPE_UNSIGNED_BYTE=0,W.TEXTURETYPE_UNSIGNED_INT=0,W.TEXTURETYPE_FLOAT=1,W.TEXTURETYPE_HALF_FLOAT=2,W.TEXTURETYPE_BYTE=3,W.TEXTURETYPE_SHORT=4,W.TEXTURETYPE_UNSIGNED_SHORT=5,W.TEXTURETYPE_INT=6,W.TEXTURETYPE_UNSIGNED_INTEGER=7,W.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,W.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,W.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,W.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,W.TEXTURETYPE_UNSIGNED_INT_24_8=12,W.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,W.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,W.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,W.TEXTURETYPE_UNDEFINED=16,W.TEXTURE_NEAREST_SAMPLINGMODE=1,W.TEXTURE_NEAREST_NEAREST=1,W.TEXTURE_BILINEAR_SAMPLINGMODE=2,W.TEXTURE_LINEAR_LINEAR=2,W.TEXTURE_TRILINEAR_SAMPLINGMODE=3,W.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,W.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,W.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,W.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,W.TEXTURE_NEAREST_LINEAR=7,W.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,W.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,W.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,W.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,W.TEXTURE_LINEAR_NEAREST=12,W.TEXTURE_EXPLICIT_MODE=0,W.TEXTURE_SPHERICAL_MODE=1,W.TEXTURE_PLANAR_MODE=2,W.TEXTURE_CUBIC_MODE=3,W.TEXTURE_PROJECTION_MODE=4,W.TEXTURE_SKYBOX_MODE=5,W.TEXTURE_INVCUBIC_MODE=6,W.TEXTURE_EQUIRECTANGULAR_MODE=7,W.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,W.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,W.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,W.TEXTURE_FILTERING_QUALITY_HIGH=64,W.TEXTURE_FILTERING_QUALITY_MEDIUM=16,W.TEXTURE_FILTERING_QUALITY_LOW=8,W.SCALEMODE_FLOOR=1,W.SCALEMODE_NEAREST=2,W.SCALEMODE_CEILING=3,W.MATERIAL_TextureDirtyFlag=1,W.MATERIAL_LightDirtyFlag=2,W.MATERIAL_FresnelDirtyFlag=4,W.MATERIAL_AttributesDirtyFlag=8,W.MATERIAL_MiscDirtyFlag=16,W.MATERIAL_PrePassDirtyFlag=32,W.MATERIAL_AllDirtyFlag=63,W.MATERIAL_TriangleFillMode=0,W.MATERIAL_WireFrameFillMode=1,W.MATERIAL_PointFillMode=2,W.MATERIAL_PointListDrawMode=3,W.MATERIAL_LineListDrawMode=4,W.MATERIAL_LineLoopDrawMode=5,W.MATERIAL_LineStripDrawMode=6,W.MATERIAL_TriangleStripDrawMode=7,W.MATERIAL_TriangleFanDrawMode=8,W.MATERIAL_ClockWiseSideOrientation=0,W.MATERIAL_CounterClockWiseSideOrientation=1,W.ACTION_NothingTrigger=0,W.ACTION_OnPickTrigger=1,W.ACTION_OnLeftPickTrigger=2,W.ACTION_OnRightPickTrigger=3,W.ACTION_OnCenterPickTrigger=4,W.ACTION_OnPickDownTrigger=5,W.ACTION_OnDoublePickTrigger=6,W.ACTION_OnPickUpTrigger=7,W.ACTION_OnPickOutTrigger=16,W.ACTION_OnLongPressTrigger=8,W.ACTION_OnPointerOverTrigger=9,W.ACTION_OnPointerOutTrigger=10,W.ACTION_OnEveryFrameTrigger=11,W.ACTION_OnIntersectionEnterTrigger=12,W.ACTION_OnIntersectionExitTrigger=13,W.ACTION_OnKeyDownTrigger=14,W.ACTION_OnKeyUpTrigger=15,W.PARTICLES_BILLBOARDMODE_Y=2,W.PARTICLES_BILLBOARDMODE_ALL=7,W.PARTICLES_BILLBOARDMODE_STRETCHED=8,W.MESHES_CULLINGSTRATEGY_STANDARD=0,W.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,W.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,W.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,W.SCENELOADER_NO_LOGGING=0,W.SCENELOADER_MINIMAL_LOGGING=1,W.SCENELOADER_SUMMARY_LOGGING=2,W.SCENELOADER_DETAILED_LOGGING=3,W.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,W.PREPASS_POSITION_TEXTURE_TYPE=1,W.PREPASS_VELOCITY_TEXTURE_TYPE=2,W.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,W.PREPASS_COLOR_TEXTURE_TYPE=4,W.PREPASS_DEPTH_TEXTURE_TYPE=5,W.PREPASS_NORMAL_TEXTURE_TYPE=6,W.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,W.BUFFER_CREATIONFLAG_READ=1,W.BUFFER_CREATIONFLAG_WRITE=2,W.BUFFER_CREATIONFLAG_READWRITE=3,W.BUFFER_CREATIONFLAG_UNIFORM=4,W.BUFFER_CREATIONFLAG_VERTEX=8,W.BUFFER_CREATIONFLAG_INDEX=16,W.BUFFER_CREATIONFLAG_STORAGE=32,W.RENDERPASS_MAIN=0,W.INPUT_ALT_KEY=18,W.INPUT_CTRL_KEY=17,W.INPUT_META_KEY1=91,W.INPUT_META_KEY2=92,W.INPUT_META_KEY3=93,W.INPUT_SHIFT_KEY=16,W.SNAPSHOTRENDERING_STANDARD=0,W.SNAPSHOTRENDERING_FAST=1,W.PERSPECTIVE_CAMERA=0,W.ORTHOGRAPHIC_CAMERA=1,W.FOVMODE_VERTICAL_FIXED=0,W.FOVMODE_HORIZONTAL_FIXED=1,W.RIG_MODE_NONE=0,W.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,W.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,W.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,W.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,W.RIG_MODE_STEREOSCOPIC_INTERLACED=14,W.RIG_MODE_VR=20,W.RIG_MODE_WEBVR=21,W.RIG_MODE_CUSTOM=22,W.MAX_SUPPORTED_UV_SETS=6,W.GL_ALPHA_EQUATION_ADD=32774,W.GL_ALPHA_EQUATION_MIN=32775,W.GL_ALPHA_EQUATION_MAX=32776,W.GL_ALPHA_EQUATION_SUBTRACT=32778,W.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,W.GL_ALPHA_FUNCTION_SRC=768,W.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,W.GL_ALPHA_FUNCTION_SRC_ALPHA=770,W.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,W.GL_ALPHA_FUNCTION_DST_ALPHA=772,W.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,W.GL_ALPHA_FUNCTION_DST_COLOR=774,W.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,W.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,W.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,W.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,W.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,W.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,W.SnippetUrl="https://snippet.babylonjs.com",W}(),AW=function(){function W(i,L){var h=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=GW(GW({},W._GetDefaultOptions()),i),this._scene=L,this._scene._transmissionHelper=this,this.onErrorObservable=new r.c,this._scene.onDisposeObservable.addOnce((function(){h.dispose()})),this._parseScene(),this._setupRenderTargets()}return W._GetDefaultOptions=function(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:JW.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}},W.prototype.updateOptions=function(W){var i=this;if(Object.keys(W).filter((function(L){return i._options[L]!==W[L]})).length){var L=GW(GW({},this._options),W),h=this._options;this._options=L,L.renderSize===h.renderSize&&L.renderTargetTextureType===h.renderTargetTextureType&&L.generateMipmaps===h.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=L.samples,this._opaqueRenderTarget.lodGenerationScale=L.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=L.lodGenerationOffset):this._setupRenderTargets()}},W.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},W.prototype._shouldRenderAsTransmission=function(W){return!!W&&!!(W instanceof T&&W.subSurface.isRefractionEnabled)},W.prototype._addMesh=function(W){var i=this;this._materialObservers[W.uniqueId]=W.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),p.h.SetImmediate((function(){i._shouldRenderAsTransmission(W.material)?(W.material.refractionTexture=i._opaqueRenderTarget,i._transparentMeshesCache.push(W)):i._opaqueMeshesCache.push(W)}))},W.prototype._removeMesh=function(W){W.onMaterialChangedObservable.remove(this._materialObservers[W.uniqueId]),delete this._materialObservers[W.uniqueId];var i=this._transparentMeshesCache.indexOf(W);-1!==i&&this._transparentMeshesCache.splice(i,1),-1!==(i=this._opaqueMeshesCache.indexOf(W))&&this._opaqueMeshesCache.splice(i,1)},W.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},W.prototype._onMeshMaterialChanged=function(W){var i=this._transparentMeshesCache.indexOf(W),L=this._opaqueMeshesCache.indexOf(W);this._shouldRenderAsTransmission(W.material)?(W.material instanceof T&&(W.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==L?(this._opaqueMeshesCache.splice(L,1),this._transparentMeshesCache.push(W)):-1===i&&this._transparentMeshesCache.push(W)):-1!==i?(this._transparentMeshesCache.splice(i,1),this._opaqueMeshesCache.push(W)):-1===L&&this._opaqueMeshesCache.push(W)},W.prototype._setupRenderTargets=function(){var W,i,L,h,l=this;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new uW.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(i=null===(W=this._options.clearColor)||void 0===W?void 0:W.clone())&&void 0!==i?i:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.onBeforeBindObservable.add((function(W){h=l._scene.environmentIntensity,l._scene.environmentIntensity=1,L=l._scene.imageProcessingConfiguration.applyByPostProcess,l._options.clearColor?W.clearColor.copyFrom(l._options.clearColor):l._scene.clearColor.toLinearSpaceToRef(W.clearColor),l._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((function(){l._scene.environmentIntensity=h,l._scene.imageProcessingConfiguration._applyByPostProcess=L})),this._transparentMeshesCache.forEach((function(W){l._shouldRenderAsTransmission(W.material)&&(W.material.refractionTexture=l._opaqueRenderTarget)}))},W.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},W}(),vW="KHR_materials_transmission",QW=function(){function W(W){this.name=vW,this.order=175,this._loader=W,this.enabled=this._loader.isExtensionUsed(vW),this.enabled&&(W.parent.transparencyAsCoverage=!0)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialBasePropertiesAsync(W,i,L)),p.push(h._loader.loadMaterialPropertiesAsync(W,i,L)),p.push(h._loadTransparentPropertiesAsync(l,i,L,t)),Promise.all(p).then((function(){}))}))},W.prototype._loadTransparentPropertiesAsync=function(W,i,L,h){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var l=L;if(l.subSurface.isRefractionEnabled=!0,l.subSurface.volumeIndexOfRefraction=1,l.subSurface.useAlbedoToTintRefraction=!0,void 0===h.transmissionFactor)return l.subSurface.refractionIntensity=0,l.subSurface.isRefractionEnabled=!1,Promise.resolve();l.subSurface.refractionIntensity=h.transmissionFactor;var t=l.getScene();return l.subSurface.refractionIntensity&&!t._transmissionHelper&&new AW({},l.getScene()),l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=0,h.transmissionTexture?(h.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(W,"/transmissionTexture"),h.transmissionTexture,void 0).then((function(W){l.subSurface.refractionIntensityTexture=W,l.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()},W}();J.RegisterExtension(vW,(function(W){return new QW(W)}));var OW="KHR_materials_translucency",YW=function(){function W(W){this.name=OW,this.order=174,this._loader=W,this.enabled=this._loader.isExtensionUsed(OW),this.enabled&&(W.parent.transparencyAsCoverage=!0)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialBasePropertiesAsync(W,i,L)),p.push(h._loader.loadMaterialPropertiesAsync(W,i,L)),p.push(h._loadTranslucentPropertiesAsync(l,i,L,t)),Promise.all(p).then((function(){}))}))},W.prototype._loadTranslucentPropertiesAsync=function(W,i,L,h){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));var l=L;return l.subSurface.isTranslucencyEnabled=!0,l.subSurface.volumeIndexOfRefraction=1,l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=0,l.subSurface.useAlbedoToTintTranslucency=!0,void 0===h.translucencyFactor?(l.subSurface.translucencyIntensity=0,l.subSurface.isTranslucencyEnabled=!1,Promise.resolve()):(l.subSurface.translucencyIntensity=h.translucencyFactor,h.translucencyTexture?(h.translucencyTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(W,"/translucencyTexture"),h.translucencyTexture).then((function(W){l.subSurface.translucencyIntensityTexture=W}))):Promise.resolve())},W}();J.RegisterExtension(OW,(function(W){return new YW(W)}));var Wi="KHR_materials_volume",ii=function(){function W(W){this.name=Wi,this.order=173,this._loader=W,this.enabled=this._loader.isExtensionUsed(Wi),this.enabled&&this._loader._disableInstancedMesh++}return W.prototype.dispose=function(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=new Array;return p.push(h._loader.loadMaterialBasePropertiesAsync(W,i,L)),p.push(h._loader.loadMaterialPropertiesAsync(W,i,L)),p.push(h._loadVolumePropertiesAsync(l,i,L,t)),Promise.all(p).then((function(){}))}))},W.prototype._loadVolumePropertiesAsync=function(W,i,L,h){if(!(L instanceof T))throw new Error("".concat(W,": Material type not supported"));if(!L.subSurface.isRefractionEnabled&&!L.subSurface.isTranslucencyEnabled||!h.thicknessFactor)return Promise.resolve();L.subSurface.volumeIndexOfRefraction=L.indexOfRefraction;var l=void 0!==h.attenuationDistance?h.attenuationDistance:Number.MAX_VALUE;return L.subSurface.tintColorAtDistance=l,void 0!==h.attenuationColor&&3==h.attenuationColor.length&&L.subSurface.tintColor.copyFromFloats(h.attenuationColor[0],h.attenuationColor[1],h.attenuationColor[2]),L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=h.thicknessFactor,L.subSurface.useThicknessAsDepth=!0,h.thicknessTexture?(h.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(W,"/thicknessTexture"),h.thicknessTexture).then((function(W){L.subSurface.thicknessTexture=W,L.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()},W}();J.RegisterExtension(Wi,(function(W){return new ii(W)}));var Li="KHR_mesh_quantization",hi=function(){function W(W){this.name=Li,this.enabled=W.isExtensionUsed(Li)}return W.prototype.dispose=function(){},W}();J.RegisterExtension(Li,(function(W){return new hi(W)}));var li="KHR_texture_basisu",ti=function(){function W(W){this.name=li,this._loader=W,this.enabled=W.isExtensionUsed(li)}return W.prototype.dispose=function(){this._loader=null},W.prototype._loadTextureAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){var p=void 0==i.sampler?J.DefaultSampler:G.Get("".concat(W,"/sampler"),h._loader.gltf.samplers,i.sampler),x=G.Get("".concat(l,"/source"),h._loader.gltf.images,t.source);return h._loader._createTextureAsync(W,p,x,(function(W){L(W)}),i._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!i._textureInfo.nonColorData)}))},W}();J.RegisterExtension(li,(function(W){return new ti(W)}));var pi="KHR_texture_transform",xi=function(){function W(W){this.name=pi,this._loader=W,this.enabled=this._loader.isExtensionUsed(pi)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadTextureInfoAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(l,t){return h._loader.loadTextureInfoAsync(W,i,(function(W){if(!(W instanceof F.e))throw new Error("".concat(l,": Texture type not supported"));t.offset&&(W.uOffset=t.offset[0],W.vOffset=t.offset[1]),W.uRotationCenter=0,W.vRotationCenter=0,t.rotation&&(W.wAng=-t.rotation),t.scale&&(W.uScale=t.scale[0],W.vScale=t.scale[1]),void 0!=t.texCoord&&(W.coordinatesIndex=t.texCoord),L(W)}))}))},W}();J.RegisterExtension(pi,(function(W){return new xi(W)}));var Ri="KHR_xmp_json_ld",zi=function(){function W(W){this.name=Ri,this.order=100,this._loader=W,this.enabled=this._loader.isExtensionUsed(Ri)}return W.prototype.dispose=function(){this._loader=null},W.prototype.onLoading=function(){var W,i,L;if(null!==this._loader.rootBabylonMesh){var h=null===(W=this._loader.gltf.extensions)||void 0===W?void 0:W.KHR_xmp_json_ld,l=null===(L=null===(i=this._loader.gltf.asset)||void 0===i?void 0:i.extensions)||void 0===L?void 0:L.KHR_xmp_json_ld;if(h&&l){var t=+l.packet;h.packets&&t<h.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=h.packets[t])}}},W}();J.RegisterExtension(Ri,(function(W){return new zi(W)}));var ri=function(){function W(W,i,L){this.frame=W,this.action=i,this.onlyOnce=L,this.isDone=!1}return W.prototype._clone=function(){return new W(this.frame,this.action,this.onlyOnce)},W}(),Ni=L(90690),Ii=L(50504),si=function(){function W(i,L,h,t,x){void 0===t&&(t=null);var R,z,I,s,o,D=this;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new r.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=l.m.Zero(),this._localDirection=new l.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=i,h=h||N.d.LastCreatedScene)if(this._scene=h,W._SceneComponentInitialization(h),this._readyToPlayCallback=t,this._customAttenuationFunction=function(W,i,L,h,l){return i<L?W*(1-i/L):0},x&&(this.autoplay=x.autoplay||!1,this._loop=x.loop||!1,void 0!==x.volume&&(this._volume=x.volume),this._spatialSound=null!==(R=x.spatialSound)&&void 0!==R&&R,this.maxDistance=null!==(z=x.maxDistance)&&void 0!==z?z:100,this.useCustomAttenuation=null!==(I=x.useCustomAttenuation)&&void 0!==I&&I,this.rolloffFactor=x.rolloffFactor||1,this.refDistance=x.refDistance||1,this.distanceModel=x.distanceModel||"linear",this._playbackRate=x.playbackRate||1,this._streaming=null!==(s=x.streaming)&&void 0!==s&&s,this._length=x.length,this._offset=x.offset),(null===(o=Ni.c.audioEngine)||void 0===o?void 0:o.canUseWebAudio)&&Ni.c.audioEngine.audioContext){this._soundGain=Ni.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);var S=!0;if(L)try{"string"===typeof L?this._urlType="String":L instanceof ArrayBuffer?this._urlType="ArrayBuffer":L instanceof HTMLMediaElement?this._urlType="MediaElement":L instanceof MediaStream?this._urlType="MediaStream":Array.isArray(L)&&(this._urlType="Array");var C=[],e=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ni.c.audioEngine.audioContext.createMediaElementSource(L),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ni.c.audioEngine.audioContext.createMediaStreamSource(L),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":L.byteLength>0&&(e=!0,this._soundLoaded(L));break;case"String":C.push(L);case"Array":0===C.length&&(C=L);for(var V=function(W){var i=C[W];if(e=x&&x.skipCodecCheck||-1!==i.indexOf(".mp3",i.length-4)&&Ni.c.audioEngine.isMP3supported||-1!==i.indexOf(".ogg",i.length-4)&&Ni.c.audioEngine.isOGGsupported||-1!==i.indexOf(".wav",i.length-4)||-1!==i.indexOf(".m4a",i.length-4)||-1!==i.indexOf(".mp4",i.length-4)||-1!==i.indexOf("blob:"))return c._streaming?(c._htmlAudioElement=new Audio(i),c._htmlAudioElement.controls=!1,c._htmlAudioElement.loop=c.loop,p.h.SetCorsBehavior(i,c._htmlAudioElement),c._htmlAudioElement.preload="auto",c._htmlAudioElement.addEventListener("canplaythrough",(function(){D._isReadyToPlay=!0,D.autoplay&&D.play(0,D._offset,D._length),D._readyToPlayCallback&&D._readyToPlayCallback()})),document.body.appendChild(c._htmlAudioElement),c._htmlAudioElement.load()):c._scene._loadFile(i,(function(W){D._soundLoaded(W)}),void 0,!0,!0,(function(W){W&&a.e.Error("XHR "+W.status+" error on: "+i+"."),a.e.Error("Sound creation aborted."),D._scene.mainSoundTrack.removeSound(D)})),"break"},c=this,f=0;f<C.length;f++){if("break"===V(f))break}break;default:S=!1}S?e||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout((function(){D._readyToPlayCallback&&D._readyToPlayCallback()}),1e3)):a.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(W){a.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Ni.c.audioEngine&&!Ni.c.audioEngine.WarnedWebAudioUnsupported&&(a.e.Error("Web Audio is not supported by your browser."),Ni.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout((function(){D._readyToPlayCallback&&D._readyToPlayCallback()}),1e3)}return Object.defineProperty(W.prototype,"loop",{get:function(){return this._loop},set:function(W){W!==this._loop&&(this._loop=W,this.updateOptions({loop:W}))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"currentTime",{get:function(){var W;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;var i=this._startOffset;return this.isPlaying&&(null===(W=Ni.c.audioEngine)||void 0===W?void 0:W.audioContext)&&(i+=Ni.c.audioEngine.audioContext.currentTime-this._startTime),i},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"spatialSound",{get:function(){return this._spatialSound},set:function(W){var i;this._spatialSound=W,this._spatialSound&&(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.canUseWebAudio)&&Ni.c.audioEngine.audioContext&&this._createSpatialParameters()},enumerable:!1,configurable:!0}),W.prototype.dispose=function(){var W;(null===(W=Ni.c.audioEngine)||void 0===W?void 0:W.canUseWebAudio)&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},W.prototype.isReady=function(){return this._isReadyToPlay},W.prototype.getClassName=function(){return"Sound"},W.prototype._soundLoaded=function(W){var i,L=this;(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.audioContext)&&Ni.c.audioEngine.audioContext.decodeAudioData(W,(function(W){L._audioBuffer=W,L._isReadyToPlay=!0,L.autoplay&&L.play(0,L._offset,L._length),L._readyToPlayCallback&&L._readyToPlayCallback()}),(function(W){a.e.Error("Error while decoding audio data for: "+L.name+" / Error: "+W)}))},W.prototype.setAudioBuffer=function(W){var i;(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.canUseWebAudio)&&(this._audioBuffer=W,this._isReadyToPlay=!0)},W.prototype.updateOptions=function(W){var i,L,h,l,t,p,x,R,z,r;W&&(this.loop=null!==(i=W.loop)&&void 0!==i?i:this.loop,this.maxDistance=null!==(L=W.maxDistance)&&void 0!==L?L:this.maxDistance,this.useCustomAttenuation=null!==(h=W.useCustomAttenuation)&&void 0!==h?h:this.useCustomAttenuation,this.rolloffFactor=null!==(l=W.rolloffFactor)&&void 0!==l?l:this.rolloffFactor,this.refDistance=null!==(t=W.refDistance)&&void 0!==t?t:this.refDistance,this.distanceModel=null!==(p=W.distanceModel)&&void 0!==p?p:this.distanceModel,this._playbackRate=null!==(x=W.playbackRate)&&void 0!==x?x:this._playbackRate,this._length=null!==(R=W.length)&&void 0!==R?R:void 0,this._offset=null!==(z=W.offset)&&void 0!==z?z:void 0,this.setVolume(null!==(r=W.volume)&&void 0!==r?r:this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))},W.prototype._createSpatialParameters=function(){var W,i;(null===(W=Ni.c.audioEngine)||void 0===W?void 0:W.canUseWebAudio)&&Ni.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=null!==(i=this._soundPanner)&&void 0!==i?i:Ni.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))},W.prototype._updateSpatialParameters=function(){this._spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},W.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},W.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},W.prototype._switchPanningModel=function(){var W;(null===(W=Ni.c.audioEngine)||void 0===W?void 0:W.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},W.prototype.connectToSoundTrackAudioNode=function(W){var i;(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.canUseWebAudio)&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(W),this._isOutputConnected=!0)},W.prototype.setDirectionalCone=function(W,i,L){i<W?a.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=W,this._coneOuterAngle=i,this._coneOuterGain=L,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))},Object.defineProperty(W.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(W){var i;if(W!=this._coneInnerAngle){if(this._coneOuterAngle<W)return void a.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=W,(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(W){var i;if(W!=this._coneOuterAngle){if(W<this._coneInnerAngle)return void a.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=W,(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!1,configurable:!0}),W.prototype.setPosition=function(W){var i;W.equals(this._position)||(this._position.copyFrom(W),(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))},W.prototype.setLocalDirectionToMesh=function(W){var i;this._localDirection=W,(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.canUseWebAudio)&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},W.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var W=this._connectedTransformNode.getWorldMatrix(),i=l.m.TransformNormal(this._localDirection,W);i.normalize(),this._soundPanner.orientationX.value=i.x,this._soundPanner.orientationY.value=i.y,this._soundPanner.orientationZ.value=i.z}},W.prototype.updateDistanceFromListener=function(){var W;if((null===(W=Ni.c.audioEngine)||void 0===W?void 0:W.canUseWebAudio)&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var i=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,i,this.maxDistance,this.refDistance,this.rolloffFactor)}},W.prototype.setAttenuationFunction=function(W){this._customAttenuationFunction=W},W.prototype.play=function(W,i,L){var h,l,t,p,x=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&(null===(h=Ni.c.audioEngine)||void 0===h?void 0:h.audioContext))try{this._startOffset<0&&(W=-this._startOffset,this._startOffset=0);var R=W?(null===(l=Ni.c.audioEngine)||void 0===l?void 0:l.audioContext.currentTime)+W:null===(t=Ni.c.audioEngine)||void 0===t?void 0:t.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=Ni.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){x._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){!function W(){var i,L;if(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.unlocked){var h=x._htmlAudioElement.play();void 0!==h&&h.catch((function(){var i,L;null===(i=Ni.c.audioEngine)||void 0===i||i.lock(),(x.loop||x.autoplay)&&(null===(L=Ni.c.audioEngine)||void 0===L||L.onAudioUnlockedObservable.addOnce((function(){W()})))}))}else(x.loop||x.autoplay)&&(null===(L=Ni.c.audioEngine)||void 0===L||L.onAudioUnlockedObservable.addOnce((function(){W()})))}()}}else{var z=function(){var h,l,t;if(null===(h=Ni.c.audioEngine)||void 0===h?void 0:h.audioContext){if(L=L||x._length,i=i||x._offset,x._soundSource){var p=x._soundSource;p.onended=function(){p.disconnect()}}if(x._soundSource=null===(l=Ni.c.audioEngine)||void 0===l?void 0:l.audioContext.createBufferSource(),x._soundSource&&x._inputAudioNode){x._soundSource.buffer=x._audioBuffer,x._soundSource.connect(x._inputAudioNode),x._soundSource.loop=x.loop,void 0!==i&&(x._soundSource.loopStart=i),void 0!==L&&(x._soundSource.loopEnd=(0|i)+L),x._soundSource.playbackRate.value=x._playbackRate,x._soundSource.onended=function(){x._onended()},R=W?(null===(t=Ni.c.audioEngine)||void 0===t?void 0:t.audioContext.currentTime)+W:Ni.c.audioEngine.audioContext.currentTime;var z=x.isPaused?x._startOffset%x._soundSource.buffer.duration:i||0;x._soundSource.start(R,z,x.loop?void 0:L)}}};"suspended"===(null===(p=Ni.c.audioEngine)||void 0===p?void 0:p.audioContext.state)?setTimeout((function(){var W;"suspended"===(null===(W=Ni.c.audioEngine)||void 0===W?void 0:W.audioContext.state)?(Ni.c.audioEngine.lock(),(x.loop||x.autoplay)&&Ni.c.audioEngine.onAudioUnlockedObservable.addOnce((function(){z()}))):z()}),500):z()}this._startTime=R,this.isPlaying=!0,this.isPaused=!1}catch(W){a.e.Error("Error while trying to play audio: "+this.name+", "+W.message)}},W.prototype._onended=function(){this.isPlaying=!1,this._startOffset=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},W.prototype.stop=function(W){var i,L=this;if(this.isPlaying)if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if((null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.audioContext)&&this._soundSource){var h=W?Ni.c.audioEngine.audioContext.currentTime+W:void 0;this._soundSource.stop(h),void 0===h?(this.isPlaying=!1,this._soundSource.onended=function(){}):this._soundSource.onended=function(){L.isPlaying=!1},this.isPaused||(this._startOffset=0)}},W.prototype.pause=function(){var W;this.isPlaying&&(this.isPaused=!0,this._streaming?(this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect(),this.isPlaying=!1):(null===(W=Ni.c.audioEngine)||void 0===W?void 0:W.audioContext)&&(this.stop(0),this._startOffset+=Ni.c.audioEngine.audioContext.currentTime-this._startTime))},W.prototype.setVolume=function(W,i){var L;(null===(L=Ni.c.audioEngine)||void 0===L?void 0:L.canUseWebAudio)&&this._soundGain&&(i&&Ni.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ni.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ni.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(W,Ni.c.audioEngine.audioContext.currentTime+i)):this._soundGain.gain.value=W),this._volume=W},W.prototype.setPlaybackRate=function(W){this._playbackRate=W,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},W.prototype.getVolume=function(){return this._volume},W.prototype.attachToMesh=function(W){var i=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=W,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(W){return i._onRegisterAfterWorldMatrixUpdate(W)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},W.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},W.prototype._onRegisterAfterWorldMatrixUpdate=function(W){var i;if(W.getBoundingInfo){var L=W.getBoundingInfo();this.setPosition(L.boundingSphere.centerWorld)}else this.setPosition(W.absolutePosition);(null===(i=Ni.c.audioEngine)||void 0===i?void 0:i.canUseWebAudio)&&this._isDirectional&&this.isPlaying&&this._updateDirection()},W.prototype.clone=function(){var i=this;if(this._streaming)return null;var L={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},h=new W(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,L);return this.useCustomAttenuation&&h.setAttenuationFunction(this._customAttenuationFunction),h.setPosition(this._position),h.setPlaybackRate(this._playbackRate),function W(){i._isReadyToPlay?(h._audioBuffer=i.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play(0,i._offset,i._length)):window.setTimeout(W,300)}(),h},W.prototype.getAudioBuffer=function(){return this._audioBuffer},W.prototype.getSoundSource=function(){return this._soundSource},W.prototype.getSoundGain=function(){return this._soundGain},W.prototype.serialize=function(){var W={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(W.connectedMeshId=this._connectedTransformNode.id),W.position=this._position.asArray(),W.refDistance=this.refDistance,W.distanceModel=this.distanceModel,W.isDirectional=this._isDirectional,W.localDirectionToMesh=this._localDirection.asArray(),W.coneInnerAngle=this._coneInnerAngle,W.coneOuterAngle=this._coneOuterAngle,W.coneOuterGain=this._coneOuterGain),W},W.Parse=function(i,L,h,t){var p,x=i.name;p=i.url?h+i.url:h+x;var R,z={autoplay:i.autoplay,loop:i.loop,volume:i.volume,spatialSound:i.spatialSound,maxDistance:i.maxDistance,rolloffFactor:i.rolloffFactor,refDistance:i.refDistance,distanceModel:i.distanceModel,playbackRate:i.playbackRate};if(t){R=new W(x,new ArrayBuffer(0),L,null,z),function W(){t._isReadyToPlay?(R._audioBuffer=t.getAudioBuffer(),R._isReadyToPlay=!0,R.autoplay&&R.play(0,R._offset,R._length)):window.setTimeout(W,300)}()}else R=new W(x,p,L,(function(){L._removePendingData(R)}),z),L._addPendingData(R);if(i.position){var r=l.m.FromArray(i.position);R.setPosition(r)}if(i.isDirectional&&(R.setDirectionalCone(i.coneInnerAngle||360,i.coneOuterAngle||360,i.coneOuterGain||0),i.localDirectionToMesh)){var N=l.m.FromArray(i.localDirectionToMesh);R.setLocalDirectionToMesh(N)}if(i.connectedMeshId){var I=L.getMeshById(i.connectedMeshId);I&&R.attachToMesh(I)}return i.metadata&&(R.metadata=i.metadata),R},W._SceneComponentInitialization=function(W){throw(0,Ii.b)("AudioSceneComponent")},W}(),oi=function(){function W(W,i,L){var h=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],i.length!==L.length)throw new Error("Sounds length does not equal weights length");this.loop=W,this._weights=L;for(var l=0,t=0,p=L;t<p.length;t++){l+=p[t]}for(var x=l>0?1/l:0,R=0;R<this._weights.length;R++)this._weights[R]*=x;this._sounds=i;for(var z=0,r=this._sounds;z<r.length;z++){r[z].onEndedObservable.add((function(){h._onended()}))}}return Object.defineProperty(W.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(W){if(W!==this._coneInnerAngle){if(this._coneOuterAngle<W)return void a.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=W;for(var i=0,L=this._sounds;i<L.length;i++){L[i].directionalConeInnerAngle=W}}},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(W){if(W!==this._coneOuterAngle){if(W<this._coneInnerAngle)return void a.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=W;for(var i=0,L=this._sounds;i<L.length;i++){L[i].directionalConeOuterAngle=W}}},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"volume",{get:function(){return this._volume},set:function(W){if(W!==this._volume)for(var i=0,L=this._sounds;i<L.length;i++){L[i].setVolume(W)}},enumerable:!1,configurable:!0}),W.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},W.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},W.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},W.prototype.play=function(W){if(!this.isPaused){this.stop();for(var i=Math.random(),L=0,h=0;h<this._weights.length;h++)if(i<=(L+=this._weights[h])){this._currentIndex=h;break}}var l=this._sounds[this._currentIndex];l.isReady()?l.play(0,this.isPaused?void 0:W):l.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},W}(),Di="MSFT_audio_emitter",Si=function(){function W(W){this.name=Di,this._loader=W,this.enabled=this._loader.isExtensionUsed(Di)}return W.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},W.prototype.onLoading=function(){var W=this._loader.gltf.extensions;if(W&&W[this.name]){var i=W[this.name];this._clips=i.clips,this._emitters=i.emitters,G.Assign(this._clips),G.Assign(this._emitters)}},W.prototype.loadSceneAsync=function(W,i){var L=this;return J.LoadExtensionAsync(W,i,this.name,(function(h,l){var t=new Array;t.push(L._loader.loadSceneAsync(W,i));for(var p=0,x=l.emitters;p<x.length;p++){var R=x[p],z=G.Get("".concat(h,"/emitters"),L._emitters,R);if(void 0!=z.refDistance||void 0!=z.maxDistance||void 0!=z.rolloffFactor||void 0!=z.distanceModel||void 0!=z.innerAngle||void 0!=z.outerAngle)throw new Error("".concat(h,": Direction or Distance properties are not allowed on emitters attached to a scene"));t.push(L._loadEmitterAsync("".concat(h,"/emitters/").concat(z.index),z))}return Promise.all(t).then((function(){}))}))},W.prototype.loadNodeAsync=function(W,i,L){var h=this;return J.LoadExtensionAsync(W,i,this.name,(function(W,t){var x=new Array;return h._loader.loadNodeAsync(W,i,(function(i){for(var R=function(L){var t=G.Get("".concat(W,"/emitters"),h._emitters,L);x.push(h._loadEmitterAsync("".concat(W,"/emitters/").concat(t.index),t).then((function(){for(var W=0,L=t._babylonSounds;W<L.length;W++){var h=L[W];h.attachToMesh(i),void 0==t.innerAngle&&void 0==t.outerAngle||(h.setLocalDirectionToMesh(l.m.Forward()),h.setDirectionalCone(2*p.h.ToDegrees(void 0==t.innerAngle?Math.PI:t.innerAngle),2*p.h.ToDegrees(void 0==t.outerAngle?Math.PI:t.outerAngle),0))}})))},z=0,r=t.emitters;z<r.length;z++){R(r[z])}L(i)})).then((function(W){return Promise.all(x).then((function(){return W}))}))}))},W.prototype.loadAnimationAsync=function(W,i){var L=this;return J.LoadExtensionAsync(W,i,this.name,(function(h,l){return L._loader.loadAnimationAsync(W,i).then((function(t){var p=new Array;G.Assign(l.events);for(var x=0,R=l.events;x<R.length;x++){var z=R[x];p.push(L._loadAnimationEventAsync("".concat(h,"/events/").concat(z.index),W,i,z,t))}return Promise.all(p).then((function(){return t}))}))}))},W.prototype._loadClipAsync=function(W,i){if(i._objectURL)return i._objectURL;var L;if(i.uri)L=this._loader.loadUriAsync(W,i,i.uri);else{var h=G.Get("".concat(W,"/bufferView"),this._loader.gltf.bufferViews,i.bufferView);L=this._loader.loadBufferViewAsync("/bufferViews/".concat(h.index),h)}return i._objectURL=L.then((function(W){return URL.createObjectURL(new Blob([W],{type:i.mimeType}))})),i._objectURL},W.prototype._loadEmitterAsync=function(W,i){var L=this;if(i._babylonSounds=i._babylonSounds||[],!i._babylonData){for(var h=new Array,l=i.name||"emitter".concat(i.index),t={loop:!1,autoplay:!1,volume:void 0==i.volume?1:i.volume},x=function(W){var p="/extensions/".concat(R.name,"/clips"),x=G.Get(p,R._clips,i.clips[W].clip);h.push(R._loadClipAsync("".concat(p,"/").concat(i.clips[W].clip),x).then((function(h){var p=i._babylonSounds[W]=new si(l,h,L._loader.babylonScene,null,t);p.refDistance=i.refDistance||1,p.maxDistance=i.maxDistance||256,p.rolloffFactor=i.rolloffFactor||1,p.distanceModel=i.distanceModel||"exponential"})))},R=this,z=0;z<i.clips.length;z++)x(z);var r=Promise.all(h).then((function(){var W=i.clips.map((function(W){return W.weight||1})),L=new oi(i.loop||!1,i._babylonSounds,W);i.innerAngle&&(L.directionalConeInnerAngle=2*p.h.ToDegrees(i.innerAngle)),i.outerAngle&&(L.directionalConeOuterAngle=2*p.h.ToDegrees(i.outerAngle)),i.volume&&(L.volume=i.volume),i._babylonData.sound=L}));i._babylonData={loaded:r}}return i._babylonData.loaded},W.prototype._getEventAction=function(W,i,L,h,l){switch(L){case"play":return function(W){var L=(l||0)+(W-h);i.play(L)};case"stop":return function(){i.stop()};case"pause":return function(){i.pause()};default:throw new Error("".concat(W,": Unsupported action ").concat(L))}},W.prototype._loadAnimationEventAsync=function(W,i,L,h,l){var t=this;if(0==l.targetedAnimations.length)return Promise.resolve();var p=l.targetedAnimations[0],x=h.emitter,R=G.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,x);return this._loadEmitterAsync(W,R).then((function(){var i=R._babylonData.sound;if(i){var L=new ri(h.time,t._getEventAction(W,i,h.action,h.time,h.startOffset));p.animation.addEvent(L),l.onAnimationGroupEndObservable.add((function(){i.stop()})),l.onAnimationGroupPauseObservable.add((function(){i.pause()}))}}))},W}();J.RegisterExtension(Di,(function(W){return new Si(W)}));var Ci="MSFT_lod",ei=function(){function W(W){this.name=Ci,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new r.c,this.onMaterialLODsLoadedObservable=new r.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=W,this.enabled=this._loader.isExtensionUsed(Ci)}return W.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},W.prototype.onReady=function(){for(var W=this,i=function(i){var h=Promise.all(L._nodePromiseLODs[i]).then((function(){0!==i&&(W._loader.endPerformanceCounter("Node LOD ".concat(i)),W._loader.log("Loaded node LOD ".concat(i))),W.onNodeLODsLoadedObservable.notifyObservers(i),i!==W._nodePromiseLODs.length-1&&(W._loader.startPerformanceCounter("Node LOD ".concat(i+1)),W._loadBufferLOD(W._nodeBufferLODs,i+1),W._nodeSignalLODs[i]&&W._nodeSignalLODs[i].resolve())}));L._loader._completePromises.push(h)},L=this,h=0;h<this._nodePromiseLODs.length;h++)i(h);var l=function(i){var L=Promise.all(t._materialPromiseLODs[i]).then((function(){0!==i&&(W._loader.endPerformanceCounter("Material LOD ".concat(i)),W._loader.log("Loaded material LOD ".concat(i))),W.onMaterialLODsLoadedObservable.notifyObservers(i),i!==W._materialPromiseLODs.length-1&&(W._loader.startPerformanceCounter("Material LOD ".concat(i+1)),W._loadBufferLOD(W._materialBufferLODs,i+1),W._materialSignalLODs[i]&&W._materialSignalLODs[i].resolve())}));t._loader._completePromises.push(L)},t=this;for(h=0;h<this._materialPromiseLODs.length;h++)l(h)},W.prototype.loadSceneAsync=function(W,i){var L=this._loader.loadSceneAsync(W,i);return this._loadBufferLOD(this._bufferLODs,0),L},W.prototype.loadNodeAsync=function(W,i,L){var l=this;return J.LoadExtensionAsync(W,i,this.name,(function(W,t){var p,x=l._getLODs(W,i,l._loader.gltf.nodes,t.ids);l._loader.logOpen("".concat(W));for(var R=function(W){var i=x[W];0!==W&&(l._nodeIndexLOD=W,l._nodeSignalLODs[W]=l._nodeSignalLODs[W]||new h);var t=l._loader.loadNodeAsync("/nodes/".concat(i.index),i,(function(W){L(W),W.setEnabled(!1)})).then((function(i){if(0!==W){var L=x[W-1];L._babylonTransformNode&&(l._disposeTransformNode(L._babylonTransformNode),delete L._babylonTransformNode)}return i.setEnabled(!0),i}));l._nodePromiseLODs[W]=l._nodePromiseLODs[W]||[],0===W?p=t:(l._nodeIndexLOD=null,l._nodePromiseLODs[W].push(t))},z=0;z<x.length;z++)R(z);return l._loader.logClose(),p}))},W.prototype._loadMaterialAsync=function(W,i,L,h,l){var t=this;return this._nodeIndexLOD?null:J.LoadExtensionAsync(W,i,this.name,(function(W,p){var x,R=t._getLODs(W,i,t._loader.gltf.materials,p.ids);t._loader.logOpen("".concat(W));for(var z=function(W){var i=R[W];0!==W&&(t._materialIndexLOD=W);var p=t._loader._loadMaterialAsync("/materials/".concat(i.index),i,L,h,(function(i){0===W&&l(i)})).then((function(i){if(0!==W){l(i);var L=R[W-1]._data;L[h]&&(t._disposeMaterials([L[h].babylonMaterial]),delete L[h])}return i}));t._materialPromiseLODs[W]=t._materialPromiseLODs[W]||[],0===W?x=p:(t._materialIndexLOD=null,t._materialPromiseLODs[W].push(p))},r=0;r<R.length;r++)z(r);return t._loader.logClose(),x}))},W.prototype._loadUriAsync=function(W,i,L){var l=this;if(null!==this._nodeIndexLOD){this._loader.log("deferred");var t=this._nodeIndexLOD-1;return this._nodeSignalLODs[t]=this._nodeSignalLODs[t]||new h,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((function(){return l._loader.loadUriAsync(W,i,L)}))}if(null!==this._materialIndexLOD){this._loader.log("deferred");t=this._materialIndexLOD-1;return this._materialSignalLODs[t]=this._materialSignalLODs[t]||new h,this._materialSignalLODs[t].promise.then((function(){return l._loader.loadUriAsync(W,i,L)}))}return null},W.prototype.loadBufferAsync=function(W,i,L,l){if(this._loader.parent.useRangeRequests&&!i.uri){if(!this._loader.bin)throw new Error("".concat(W,": Uri is missing or the binary glTF is missing its binary chunk"));var t=function(W,i){var t=L,p=t+l-1,x=W[i];return x?(x.start=Math.min(x.start,t),x.end=Math.max(x.end,p)):(x={start:t,end:p,loaded:new h},W[i]=x),x.loaded.promise.then((function(W){return new Uint8Array(W.buffer,W.byteOffset+L-x.start,l)}))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null},W.prototype._loadBufferLOD=function(W,i){var L=W[i];L&&(this._loader.log("Loading buffer range [".concat(L.start,"-").concat(L.end,"]")),this._loader.bin.readAsync(L.start,L.end-L.start+1).then((function(W){L.loaded.resolve(W)}),(function(W){L.loaded.reject(W)})))},W.prototype._getLODs=function(W,i,L,h){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var l=new Array,t=h.length-1;t>=0;t--)if(l.push(G.Get("".concat(W,"/ids/").concat(h[t]),L,h[t])),l.length===this.maxLODsToLoad)return l;return l.push(i),l},W.prototype._disposeTransformNode=function(W){var i=this,L=new Array,h=W.material;h&&L.push(h);for(var l=0,t=W.getChildMeshes();l<t.length;l++){var p=t[l];p.material&&L.push(p.material)}W.dispose();var x=L.filter((function(W){return i._loader.babylonScene.meshes.every((function(i){return i.material!=W}))}));this._disposeMaterials(x)},W.prototype._disposeMaterials=function(W){for(var i={},L=0,h=W;L<h.length;L++){for(var l=0,t=(r=h[L]).getActiveTextures();l<t.length;l++){var p=t[l];i[p.uniqueId]=p}r.dispose()}for(var x in i)for(var R=0,z=this._loader.babylonScene.materials;R<z.length;R++){var r;(r=z[R]).hasTexture(i[x])&&delete i[x]}for(var x in i)i[x].dispose()},W}();J.RegisterExtension(Ci,(function(W){return new ei(W)}));var Vi="MSFT_minecraftMesh",ci=function(){function W(W){this.name=Vi,this._loader=W,this.enabled=this._loader.isExtensionUsed(Vi)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtraAsync(W,i,this.name,(function(l,t){if(t){if(!(L instanceof T))throw new Error("".concat(l,": Material type not supported"));var p=h._loader.loadMaterialPropertiesAsync(W,i,L);return L.needAlphaBlending()&&(L.forceDepthWrite=!0,L.separateCullingPass=!0),L.backFaceCulling=L.forceDepthWrite,L.twoSidedLighting=!0,p}return null}))},W}();J.RegisterExtension(Vi,(function(W){return new ci(W)}));var fi="MSFT_sRGBFactors",ai=function(){function W(W){this.name=fi,this._loader=W,this.enabled=this._loader.isExtensionUsed(fi)}return W.prototype.dispose=function(){this._loader=null},W.prototype.loadMaterialPropertiesAsync=function(W,i,L){var h=this;return J.LoadExtraAsync(W,i,this.name,(function(l,t){if(t){if(!(L instanceof T))throw new Error("".concat(l,": Material type not supported"));var p=h._loader.loadMaterialPropertiesAsync(W,i,L);return L.albedoTexture||L.albedoColor.toLinearSpaceToRef(L.albedoColor),L.reflectivityTexture||L.reflectivityColor.toLinearSpaceToRef(L.reflectivityColor),p}return null}))},W}();J.RegisterExtension(fi,(function(W){return new ai(W)}));var Pi="ExtrasAsMetadata",yi=function(){function W(W){this.name=Pi,this.enabled=!0,this._loader=W}return W.prototype._assignExtras=function(W,i){if(i.extras&&Object.keys(i.extras).length>0){var L=W.metadata=W.metadata||{};(L.gltf=L.gltf||{}).extras=i.extras}},W.prototype.dispose=function(){this._loader=null},W.prototype.loadNodeAsync=function(W,i,L){var h=this;return this._loader.loadNodeAsync(W,i,(function(W){h._assignExtras(W,i),L(W)}))},W.prototype.loadCameraAsync=function(W,i,L){var h=this;return this._loader.loadCameraAsync(W,i,(function(W){h._assignExtras(W,i),L(W)}))},W.prototype.createMaterial=function(W,i,L){var h=this._loader.createMaterial(W,i,L);return this._assignExtras(h,i),h},W}();J.RegisterExtension(Pi,(function(W){return new yi(W)}))},47984:function(W,i,L){"use strict";L.d(i,{b:function(){return P},d:function(){return l},h:function(){return h},k:function(){return t}});var h,l,t,p=L(9271),x=L(9217),R=L(67269),z=L(40061),r=L(60569),N=L(65847),I=L(9127),s=L(78588),o=function(W){function i(){return null!==W&&W.apply(this,arguments)||this}return(0,z.n)(i,W),i}(r.d),D=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},S=function(W){function i(i){var L=W.call(this)||this;return L._wasAddedToScene=!1,(i=i||s.d.LastCreatedScene)?(L.scene=i,L.sounds=[],L.effectLayers=[],L.layers=[],L.lensFlareSystems=[],L.proceduralTextures=[],L.reflectionProbes=[],i.onDisposeObservable.add((function(){L._wasAddedToScene||L.dispose()})),L._onContextRestoredObserver=i.getEngine().onContextRestoredObservable.add((function(){for(var W=0,i=L.geometries;W<i.length;W++){i[W]._rebuild()}for(var h=0,l=L.meshes;h<l.length;h++){l[h]._rebuild()}for(var t=0,p=L.particleSystems;t<p.length;t++){p[t].rebuild()}for(var x=0,R=L.textures;x<R.length;x++){R[x]._rebuild()}})),L):L}return(0,z.n)(i,W),i.prototype.instantiateModelsToScene=function(W,i,L){var h=this;void 0===i&&(i=!1);var l={},t={},p=new D,x=[],R=[];L||(L={doNotInstantiate:!0});var z=function(i,L){if(l[i.uniqueId]=L.uniqueId,t[L.uniqueId]=L,W&&(L.name=W(i.name)),L instanceof N.e){var h=L;if(h.morphTargetManager){var p=i.morphTargetManager;h.morphTargetManager=p.clone();for(var x=0;x<p.numTargets;x++){var R=p.getTarget(x),z=h.morphTargetManager.getTarget(x);l[R.uniqueId]=z.uniqueId,t[z.uniqueId]=z}}}};return this.transformNodes.forEach((function(W){if((!L||!L.predicate||L.predicate(W))&&!W.parent){var i=W.instantiateHierarchy(null,L,(function(W,i){z(W,i)}));i&&p.rootNodes.push(i)}})),this.meshes.forEach((function(x){if((!L||!L.predicate||L.predicate(x))&&!x.parent){var r=x.instantiateHierarchy(null,L,(function(L,p){if(z(L,p),p.material){var x=p;if(x.material)if(i){var r=L.material;if(-1===R.indexOf(r)){var N=r.clone(W?W(r.name):"Clone of "+r.name);if(R.push(r),l[r.uniqueId]=N.uniqueId,t[N.uniqueId]=N,"MultiMaterial"===r.getClassName()){for(var I=r,s=0,o=I.subMaterials;s<o.length;s++){var D=o[s];D&&(N=D.clone(W?W(D.name):"Clone of "+D.name),R.push(D),l[D.uniqueId]=N.uniqueId,t[N.uniqueId]=N)}I.subMaterials=I.subMaterials.map((function(W){return W&&t[l[W.uniqueId]]}))}}"InstancedMesh"!==x.getClassName()&&(x.material=t[l[r.uniqueId]])}else"MultiMaterial"===x.material.getClassName()?-1===h.scene.multiMaterials.indexOf(x.material)&&h.scene.addMultiMaterial(x.material):-1===h.scene.materials.indexOf(x.material)&&h.scene.addMaterial(x.material)}}));r&&p.rootNodes.push(r)}})),this.skeletons.forEach((function(i){if(!L||!L.predicate||L.predicate(i)){for(var R=i.clone(W?W(i.name):"Clone of "+i.name),z=0,r=h.meshes;z<r.length;z++){var N=r[z];if(N.skeleton===i&&!N.isAnInstance){var I=t[l[N.uniqueId]];if(I.isAnInstance)continue;if(I.skeleton=R,-1!==x.indexOf(R))continue;x.push(R);for(var s=0,o=R.bones;s<o.length;s++){var D=o[s];D._linkedTransformNode&&(D._linkedTransformNode=t[l[D._linkedTransformNode.uniqueId]])}}}p.skeletons.push(R)}})),this.animationGroups.forEach((function(i){if(!L||!L.predicate||L.predicate(i)){var h=i.clone(W?W(i.name):"Clone of "+i.name,(function(W){return t[l[W.uniqueId]]||W}));p.animationGroups.push(h)}})),p},i.prototype.addAllToScene=function(){if(!this._wasAddedToScene){this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var W=0,i=this.scene._serializableComponents;W<i.length;W++){i[W].addFromContainer(this)}this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}},i.prototype.addToScene=function(W){var i=this;void 0===W&&(W=null),this.cameras.forEach((function(L){W&&!W(L)||i.scene.addCamera(L)})),this.lights.forEach((function(L){W&&!W(L)||i.scene.addLight(L)})),this.meshes.forEach((function(L){W&&!W(L)||i.scene.addMesh(L)})),this.skeletons.forEach((function(L){W&&!W(L)||i.scene.addSkeleton(L)})),this.animations.forEach((function(L){W&&!W(L)||i.scene.addAnimation(L)})),this.animationGroups.forEach((function(L){W&&!W(L)||i.scene.addAnimationGroup(L)})),this.multiMaterials.forEach((function(L){W&&!W(L)||i.scene.addMultiMaterial(L)})),this.materials.forEach((function(L){W&&!W(L)||i.scene.addMaterial(L)})),this.morphTargetManagers.forEach((function(L){W&&!W(L)||i.scene.addMorphTargetManager(L)})),this.geometries.forEach((function(L){W&&!W(L)||i.scene.addGeometry(L)})),this.transformNodes.forEach((function(L){W&&!W(L)||i.scene.addTransformNode(L)})),this.actionManagers.forEach((function(L){W&&!W(L)||i.scene.addActionManager(L)})),this.textures.forEach((function(L){W&&!W(L)||i.scene.addTexture(L)})),this.reflectionProbes.forEach((function(L){W&&!W(L)||i.scene.addReflectionProbe(L)}))},i.prototype.removeAllFromScene=function(){this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var W=0,i=this.scene._serializableComponents;W<i.length;W++){i[W].removeFromContainer(this)}},i.prototype.removeFromScene=function(W){var i=this;void 0===W&&(W=null),this.cameras.forEach((function(L){W&&!W(L)||i.scene.removeCamera(L)})),this.lights.forEach((function(L){W&&!W(L)||i.scene.removeLight(L)})),this.meshes.forEach((function(L){W&&!W(L)||i.scene.removeMesh(L)})),this.skeletons.forEach((function(L){W&&!W(L)||i.scene.removeSkeleton(L)})),this.animations.forEach((function(L){W&&!W(L)||i.scene.removeAnimation(L)})),this.animationGroups.forEach((function(L){W&&!W(L)||i.scene.removeAnimationGroup(L)})),this.multiMaterials.forEach((function(L){W&&!W(L)||i.scene.removeMultiMaterial(L)})),this.materials.forEach((function(L){W&&!W(L)||i.scene.removeMaterial(L)})),this.morphTargetManagers.forEach((function(L){W&&!W(L)||i.scene.removeMorphTargetManager(L)})),this.geometries.forEach((function(L){W&&!W(L)||i.scene.removeGeometry(L)})),this.transformNodes.forEach((function(L){W&&!W(L)||i.scene.removeTransformNode(L)})),this.actionManagers.forEach((function(L){W&&!W(L)||i.scene.removeActionManager(L)})),this.textures.forEach((function(L){W&&!W(L)||i.scene.removeTexture(L)})),this.reflectionProbes.forEach((function(L){W&&!W(L)||i.scene.removeReflectionProbe(L)}))},i.prototype.dispose=function(){this.cameras.slice(0).forEach((function(W){W.dispose()})),this.cameras=[],this.lights.slice(0).forEach((function(W){W.dispose()})),this.lights=[],this.meshes.slice(0).forEach((function(W){W.dispose()})),this.meshes=[],this.skeletons.slice(0).forEach((function(W){W.dispose()})),this.skeletons=[],this.animationGroups.slice(0).forEach((function(W){W.dispose()})),this.animationGroups=[],this.multiMaterials.slice(0).forEach((function(W){W.dispose()})),this.multiMaterials=[],this.materials.slice(0).forEach((function(W){W.dispose()})),this.materials=[],this.geometries.slice(0).forEach((function(W){W.dispose()})),this.geometries=[],this.transformNodes.slice(0).forEach((function(W){W.dispose()})),this.transformNodes=[],this.actionManagers.slice(0).forEach((function(W){W.dispose()})),this.actionManagers=[],this.textures.slice(0).forEach((function(W){W.dispose()})),this.textures=[],this.reflectionProbes.slice(0).forEach((function(W){W.dispose()})),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var W=0,i=this.scene._serializableComponents;W<i.length;W++){i[W].removeFromContainer(this,!0)}this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)},i.prototype._moveAssets=function(W,i,L){if(W)for(var h=0,l=W;h<l.length;h++){var t=l[h],p=!0;if(L)for(var x=0,R=L;x<R.length;x++){if(t===R[x]){p=!1;break}}p&&(i.push(t),t._parentContainer=this)}},i.prototype.moveAllFromScene=function(W){for(var i in this._wasAddedToScene=!1,void 0===W&&(W=new o),this)Object.prototype.hasOwnProperty.call(this,i)&&(this[i]=this[i]||("environmentTexture"===i?null:[]),this._moveAssets(this.scene[i],this[i],W[i]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},i.prototype.createRootMesh=function(){var W=new N.e("assetContainerRootMesh",this.scene);return this.meshes.forEach((function(i){i.parent||W.addChild(i)})),this.meshes.unshift(W),W},i.prototype.mergeAnimationsTo=function(W,i,L){if(void 0===W&&(W=s.d.LastCreatedScene),void 0===L&&(L=null),!W)return I.e.Error("No scene available to merge animations to"),[];var h=L||function(i){var L=null,h=i.animations.length?i.animations[0].targetProperty:"",l=i.name.split(".").join("").split("_primitive")[0];switch(h){case"position":case"rotationQuaternion":L=W.getTransformNodeByName(i.name)||W.getTransformNodeByName(l);break;case"influence":L=W.getMorphTargetByName(i.name)||W.getMorphTargetByName(l);break;default:L=W.getNodeByName(i.name)||W.getNodeByName(l)}return L};this.getNodes().forEach((function(W){var i=h(W);if(null!==i){for(var L=function(W){for(var L=0,h=i.animations.filter((function(i){return i.targetProperty===W.targetProperty}));L<h.length;L++){var l=h[L],t=i.animations.indexOf(l,0);t>-1&&i.animations.splice(t,1)}},l=0,t=W.animations;l<t.length;l++){L(t[l])}i.animations=i.animations.concat(W.animations)}}));var l=new Array;return this.animationGroups.slice().forEach((function(W){l.push(W.clone(W.name,h)),W.animatables.forEach((function(W){W.stop()}))})),i.forEach((function(i){var L=h(i.target);L&&(W.beginAnimation(L,i.fromFrame,i.toFrame,i.loopAnimation,i.speedRatio,i.onAnimationEnd?i.onAnimationEnd:void 0,void 0,!0,void 0,i.onAnimationLoop?i.onAnimationLoop:void 0),W.stopAnimation(i.target))})),l},i}(r.d),C=L(50459),e=function(){function W(W){this.byteOffset=0,this.buffer=W}return W.prototype.loadAsync=function(W){var i=this;return this.buffer.readAsync(this.byteOffset,W).then((function(W){i._dataView=new DataView(W.buffer,W.byteOffset,W.byteLength),i._dataByteOffset=0}))},W.prototype.readUint32=function(){var W=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,W},W.prototype.readUint8Array=function(W){var i=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,W);return this._dataByteOffset+=W,this.byteOffset+=W,i},W.prototype.readString=function(W){return(0,C.e)(this.readUint8Array(W))},W.prototype.skipBytes=function(W){this._dataByteOffset+=W,this.byteOffset+=W},W}(),V=L(36470),c=L(82790),f=L(33224);function a(W,i,L){try{return Promise.resolve(new Uint8Array(W,i,L))}catch(W){return Promise.reject(W)}}!function(W){W[W.AUTO=0]="AUTO",W[W.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(h||(h={})),function(W){W[W.NONE=0]="NONE",W[W.FIRST=1]="FIRST",W[W.ALL=2]="ALL"}(l||(l={})),function(W){W[W.LOADING=0]="LOADING",W[W.READY=1]="READY",W[W.COMPLETE=2]="COMPLETE"}(t||(t={}));var P=function(){function W(){this.onParsedObservable=new p.c,this.coordinateSystemMode=h.AUTO,this.animationStartMode=l.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.preprocessUrlAsync=function(W){return Promise.resolve(W)},this.onMeshLoadedObservable=new p.c,this.onSkinLoadedObservable=new p.c,this.onTextureLoadedObservable=new p.c,this.onMaterialLoadedObservable=new p.c,this.onCameraLoadedObservable=new p.c,this.onCompleteObservable=new p.c,this.onErrorObservable=new p.c,this.onDisposeObservable=new p.c,this.onExtensionLoadedObservable=new p.c,this.validate=!1,this.onValidatedObservable=new p.c,this._loader=null,this._state=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this.onLoaderStateChangedObservable=new p.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(W.prototype,"onParsed",{set:function(W){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onMeshLoaded",{set:function(W){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onTextureLoaded",{set:function(W){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onMaterialLoaded",{set:function(W){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onCameraLoaded",{set:function(W){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onComplete",{set:function(W){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onError",{set:function(W){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onDispose",{set:function(W){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onExtensionLoaded",{set:function(W){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(W){this._loggingEnabled!==W&&(this._loggingEnabled=W,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(W){this._capturePerformanceCounters!==W&&(this._capturePerformanceCounters=W,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"onValidated",{set:function(W){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(W)},enumerable:!1,configurable:!0}),W.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var W=0,i=this._requests;W<i.length;W++){i[W].abort()}this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(W){return Promise.resolve(W)},this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},W.prototype.loadFile=function(W,i,L,h,l,t){var R=this;this._progressCallback=h;var z=i.name?"file:":x.h.GetFolderPath(i),r=i.name||x.h.GetFilename(i);if(l){if(this.useRangeRequests){this.validate&&I.e.Warn("glTF validation is not supported when range requests are enabled");var N={abort:function(){},onCompleteObservable:new p.c},s={readAsync:function(L,h){return new Promise((function(l,t){R._loadFile(W,i,(function(W){l(new Uint8Array(W))}),!0,(function(W){t(W)}),(function(W){W.setRequestHeader("Range","bytes=".concat(L,"-").concat(L+h-1))}))}))},byteLength:0};return this._unpackBinaryAsync(new e(s)).then((function(W){N.onCompleteObservable.notifyObservers(N),L(W)}),t?function(W){return t(void 0,W)}:void 0),N}return this._loadFile(W,i,(function(i){R._validate(W,i,z,r),R._unpackBinaryAsync(new e({readAsync:function(W,L){return a(i,W,L)},byteLength:i.byteLength})).then((function(W){L(W)}),t?function(W){return t(void 0,W)}:void 0)}),!0,t)}return this._loadFile(W,i,(function(i){R._validate(W,i,z,r),L({json:R._parseJson(i)})}),l,t)},W.prototype.importMeshAsync=function(W,i,L,h,l,t){var p=this;return Promise.resolve().then((function(){return p.onParsedObservable.notifyObservers(L),p.onParsedObservable.clear(),p._log("Loading ".concat(t||"")),p._loader=p._getLoader(L),p._loader.importMeshAsync(W,i,null,L,h,l,t)}))},W.prototype.loadAsync=function(W,i,L,h,l){var t=this;return Promise.resolve().then((function(){return t.onParsedObservable.notifyObservers(i),t.onParsedObservable.clear(),t._log("Loading ".concat(l||"")),t._loader=t._getLoader(i),t._loader.loadAsync(W,i,L,h,l)}))},W.prototype.loadAssetContainerAsync=function(W,i,L,h,l){var t=this;return Promise.resolve().then((function(){t.onParsedObservable.notifyObservers(i),t.onParsedObservable.clear(),t._log("Loading ".concat(l||"")),t._loader=t._getLoader(i);var p=new S(W),x=[];t.onMaterialLoadedObservable.add((function(W){x.push(W)}));var R=[];t.onTextureLoadedObservable.add((function(W){R.push(W)}));var z=[];return t.onCameraLoadedObservable.add((function(W){z.push(W)})),t._loader.importMeshAsync(null,W,p,i,L,h,l).then((function(W){return Array.prototype.push.apply(p.geometries,W.geometries),Array.prototype.push.apply(p.meshes,W.meshes),Array.prototype.push.apply(p.particleSystems,W.particleSystems),Array.prototype.push.apply(p.skeletons,W.skeletons),Array.prototype.push.apply(p.animationGroups,W.animationGroups),Array.prototype.push.apply(p.materials,x),Array.prototype.push.apply(p.textures,R),Array.prototype.push.apply(p.lights,W.lights),Array.prototype.push.apply(p.transformNodes,W.transformNodes),Array.prototype.push.apply(p.cameras,z),p}))}))},W.prototype.canDirectLoad=function(i){return-1!==i.indexOf("asset")&&-1!==i.indexOf("version")||i.startsWith("data:base64,"+W._MagicBase64Encoded)||i.startsWith("data:;base64,"+W._MagicBase64Encoded)||i.startsWith("data:application/octet-stream;base64,"+W._MagicBase64Encoded)||i.startsWith("data:model/gltf-binary;base64,"+W._MagicBase64Encoded)},W.prototype.directLoad=function(i,L){if(L.startsWith("base64,"+W._MagicBase64Encoded)||L.startsWith(";base64,"+W._MagicBase64Encoded)||L.startsWith("application/octet-stream;base64,"+W._MagicBase64Encoded)||L.startsWith("model/gltf-binary;base64,"+W._MagicBase64Encoded)){var h=(0,c.c)(L);return this._validate(i,h),this._unpackBinaryAsync(new e({readAsync:function(W,i){return a(h,W,i)},byteLength:h.byteLength}))}return this._validate(i,L),Promise.resolve({json:this._parseJson(L)})},W.prototype.createPlugin=function(){return new W},Object.defineProperty(W.prototype,"loaderState",{get:function(){return this._state},enumerable:!1,configurable:!0}),W.prototype.whenCompleteAsync=function(){var W=this;return new Promise((function(i,L){W.onCompleteObservable.addOnce((function(){i()})),W.onErrorObservable.addOnce((function(W){L(W)}))}))},W.prototype._setState=function(W){this._state!==W&&(this._state=W,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(t[this._state]))},W.prototype._loadFile=function(W,i,L,h,l,t){var p=this,x=W._loadFile(i,L,(function(W){p._onProgress(W,x)}),!0,h,l,t);return x.onCompleteObservable.add((function(W){p._requests.splice(p._requests.indexOf(W),1)})),this._requests.push(x),x},W.prototype._onProgress=function(W,i){if(this._progressCallback){i._lengthComputable=W.lengthComputable,i._loaded=W.loaded,i._total=W.total;for(var L=!0,h=0,l=0,t=0,p=this._requests;t<p.length;t++){var x=p[t];if(void 0===x._lengthComputable||void 0===x._loaded||void 0===x._total)return;L=L&&x._lengthComputable,h+=x._loaded,l+=x._total}this._progressCallback({lengthComputable:L,loaded:h,total:L?l:0})}},W.prototype._validate=function(W,i,L,h){var l=this;void 0===L&&(L=""),void 0===h&&(h=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),V.e.ValidateAsync(i,L,h,(function(i){return l.preprocessUrlAsync(L+i).then((function(i){return W._loadFileAsync(i,void 0,!0,!0)}))})).then((function(W){l._endPerformanceCounter("Validate JSON"),l.onValidatedObservable.notifyObservers(W),l.onValidatedObservable.clear()}),(function(W){l._endPerformanceCounter("Validate JSON"),x.h.Warn("Failed to validate: ".concat(W.message)),l.onValidatedObservable.clear()})))},W.prototype._getLoader=function(i){var L=i.json.asset||{};this._log("Asset version: ".concat(L.version)),L.minVersion&&this._log("Asset minimum version: ".concat(L.minVersion)),L.generator&&this._log("Asset generator: ".concat(L.generator));var h=W._parseVersion(L.version);if(!h)throw new Error("Invalid version: "+L.version);if(void 0!==L.minVersion){var l=W._parseVersion(L.minVersion);if(!l)throw new Error("Invalid minimum version: "+L.minVersion);if(W._compareVersion(l,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+L.minVersion)}var t={1:W._CreateGLTF1Loader,2:W._CreateGLTF2Loader}[h.major];if(!t)throw new Error("Unsupported version: "+L.version);return t(this)},W.prototype._parseJson=function(W){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(W.length));var i=JSON.parse(W);return this._endPerformanceCounter("Parse JSON"),i},W.prototype._unpackBinaryAsync=function(W){var i=this;return this._startPerformanceCounter("Unpack Binary"),W.loadAsync(20).then((function(){var L=W.readUint32();if(1179937895!==L)throw new f.j("Unexpected magic: "+L,f.f.GLTFLoaderUnexpectedMagicError);var h=W.readUint32();i.loggingEnabled&&i._log("Binary version: ".concat(h));var l,t=W.readUint32();if(0!==W.buffer.byteLength&&t!==W.buffer.byteLength)throw new Error("Length in header does not match actual data length: ".concat(t," != ").concat(W.buffer.byteLength));switch(h){case 1:l=i._unpackBinaryV1Async(W,t);break;case 2:l=i._unpackBinaryV2Async(W,t);break;default:throw new Error("Unsupported version: "+h)}return i._endPerformanceCounter("Unpack Binary"),l}))},W.prototype._unpackBinaryV1Async=function(W,i){var L=W.readUint32(),h=W.readUint32();if(0!==h)throw new Error("Unexpected content format: ".concat(h));var l=i-W.byteOffset,t={json:this._parseJson(W.readString(L)),bin:null};if(0!==l){var p=W.byteOffset;t.bin={readAsync:function(i,L){return W.buffer.readAsync(p+i,L)},byteLength:l}}return Promise.resolve(t)},W.prototype._unpackBinaryV2Async=function(W,i){var L=this,h=1313821514,l=5130562,t=W.readUint32();if(W.readUint32()!==h)throw new Error("First chunk format is not JSON");return W.byteOffset+t===i?W.loadAsync(t).then((function(){return{json:L._parseJson(W.readString(t)),bin:null}})):W.loadAsync(t+8).then((function(){var p={json:L._parseJson(W.readString(t)),bin:null};return function L(){var t=W.readUint32();switch(W.readUint32()){case h:throw new Error("Unexpected JSON chunk");case l:var x=W.byteOffset;p.bin={readAsync:function(i,L){return W.buffer.readAsync(x+i,L)},byteLength:t},W.skipBytes(t);break;default:W.skipBytes(t)}return W.byteOffset!==i?W.loadAsync(8).then(L):Promise.resolve(p)}()}))},W._parseVersion=function(W){if("1.0"===W||"1.0.1"===W)return{major:1,minor:0};var i=(W+"").match(/^(\d+)\.(\d+)/);return i?{major:parseInt(i[1]),minor:parseInt(i[2])}:null},W._compareVersion=function(W,i){return W.major>i.major?1:W.major<i.major?-1:W.minor>i.minor?1:W.minor<i.minor?-1:0},W.prototype._logOpen=function(W){this._log(W),this._logIndentLevel++},W.prototype._logClose=function(){--this._logIndentLevel},W.prototype._logEnabled=function(i){var L=W._logSpaces.substr(0,2*this._logIndentLevel);I.e.Log("".concat(L).concat(i))},W.prototype._logDisabled=function(W){},W.prototype._startPerformanceCounterEnabled=function(W){x.h.StartPerformanceCounter(W)},W.prototype._startPerformanceCounterDisabled=function(W){},W.prototype._endPerformanceCounterEnabled=function(W){x.h.EndPerformanceCounter(W)},W.prototype._endPerformanceCounterDisabled=function(W){},W.IncrementalLoading=!0,W.HomogeneousCoordinates=!1,W._MagicBase64Encoded="Z2xURg",W._logSpaces="                                ",W}();R.e&&R.e.RegisterPlugin(new P)},36470:function(W,i,L){"use strict";L.d(i,{e:function(){return p}});var h=L(9217);function l(W,i,L,h){var l={externalResourceFunction:function(W){return h(W).then((function(W){return new Uint8Array(W)}))}};return L&&(l.uri="file:"===i?L:i+L),W instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(W),l):GLTFValidator.validateString(W,l)}function t(){var W=[];onmessage=function(i){var L=i.data;switch(L.id){case"init":importScripts(L.url);break;case"validate":l(L.data,L.rootUrl,L.fileName,(function(i){return new Promise((function(L,h){var l=W.length;W.push({resolve:L,reject:h}),postMessage({id:"getExternalResource",index:l,uri:i})}))})).then((function(W){postMessage({id:"validate.resolve",value:W})}),(function(W){postMessage({id:"validate.reject",reason:W})}));break;case"getExternalResource.resolve":W[L.index].resolve(L.value);break;case"getExternalResource.reject":W[L.index].reject(L.reason)}}}var p=function(){function W(){}return W.ValidateAsync=function(W,i,L,p){var x=this;return"function"===typeof Worker?new Promise((function(h,R){var z="".concat(l,"(").concat(t,")()"),r=URL.createObjectURL(new Blob([z],{type:"application/javascript"})),N=new Worker(r),I=function W(i){N.removeEventListener("error",W),N.removeEventListener("message",s),R(i)},s=function W(i){var L=i.data;switch(L.id){case"getExternalResource":p(L.uri).then((function(W){N.postMessage({id:"getExternalResource.resolve",index:L.index,value:W},[W])}),(function(W){N.postMessage({id:"getExternalResource.reject",index:L.index,reason:W})}));break;case"validate.resolve":N.removeEventListener("error",I),N.removeEventListener("message",W),h(L.value),N.terminate();break;case"validate.reject":N.removeEventListener("error",I),N.removeEventListener("message",W),R(L.reason),N.terminate()}};N.addEventListener("error",I),N.addEventListener("message",s),N.postMessage({id:"init",url:x.Configuration.url}),N.postMessage({id:"validate",data:W,rootUrl:i,fileName:L})})):(this._LoadScriptPromise||(this._LoadScriptPromise=h.h.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((function(){return l(W,i,L,p)})))},W.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},W}()},66285:function(W,i,L){"use strict";L.d(i,{b:function(){return c}});var h=function(W,i){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,i){W.__proto__=i}||function(W,i){for(var L in i)Object.prototype.hasOwnProperty.call(i,L)&&(W[L]=i[L])},h(W,i)};function l(W,i){if("function"!==typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function L(){this.constructor=W}h(W,i),W.prototype=null===i?Object.create(i):(L.prototype=i.prototype,new L)}function t(W,i,L,h){var l,t=arguments.length,p=t<3?i:null===h?h=Object.getOwnPropertyDescriptor(i,L):h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(W,i,L,h);else for(var x=W.length-1;x>=0;x--)(l=W[x])&&(p=(t<3?l(p):t>3?l(i,L,p):l(i,L))||p);return t>3&&p&&Object.defineProperty(i,L,p),p}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var p=L(9892),x=L(80105),R=L(4241),z=L(33048),r=L(29553),N=L(43251),I=L(37105),s=L(31709),o=L(16179),D=(L(76578),L(35850),L(84098),L(80345),"#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n");o.e.IncludesShadersStore.imageProcessingCompatibility=D;var S="precision highp float;\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;\nuniform vec3 cameraOffset;\nuniform vec3 up;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0);\ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\nvec3 retColor=curr*whiteScale;\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";o.e.ShadersStore.skyPixelShader=S;L(49329),L(23654),L(61906),L(32560);var C="precision highp float;\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";o.e.ShadersStore.skyVertexShader=C;var e=L(54497),V=function(W){function i(){var i=W.call(this)||this;return i.CLIPPLANE=!1,i.CLIPPLANE2=!1,i.CLIPPLANE3=!1,i.CLIPPLANE4=!1,i.CLIPPLANE5=!1,i.CLIPPLANE6=!1,i.POINTSIZE=!1,i.FOG=!1,i.VERTEXCOLOR=!1,i.VERTEXALPHA=!1,i.IMAGEPROCESSINGPOSTPROCESS=!1,i.SKIPFINALCOLORCLAMP=!1,i.rebuild(),i}return l(i,W),i}(R.b),c=function(W){function i(i,L){var h=W.call(this,i,L)||this;return h.luminance=1,h.turbidity=10,h.rayleigh=2,h.mieCoefficient=.005,h.mieDirectionalG=.8,h.distance=500,h.inclination=.49,h.azimuth=.25,h.sunPosition=new x.m(0,100,0),h.useSunPosition=!1,h.cameraOffset=x.m.Zero(),h.up=x.m.Up(),h._cameraPosition=x.m.Zero(),h._skyOrientation=new x.g,h}return l(i,W),i.prototype.needAlphaBlending=function(){return this.alpha<1},i.prototype.needAlphaTesting=function(){return!1},i.prototype.getAlphaTestTexture=function(){return null},i.prototype.isReadyForSubMesh=function(W,i){if(this.isFrozen&&i.effect&&i.effect._wasPreviouslyReady)return!0;i.materialDefines||(i.materialDefines=new V);var L=i.materialDefines,h=this.getScene();if(this._isReadyForSubMesh(i))return!0;if(z.e.PrepareDefinesForMisc(W,h,!1,this.pointsCloud,this.fogEnabled,!1,L),z.e.PrepareDefinesForAttributes(W,L,!0,!1),L.IMAGEPROCESSINGPOSTPROCESS!==h.imageProcessingConfiguration.applyByPostProcess&&L.markAsMiscDirty(),L.isDirty){L.markAsProcessed(),h.resetCachedMaterial();var l=new e.b;L.FOG&&l.addFallback(1,"FOG"),L.IMAGEPROCESSINGPOSTPROCESS=h.imageProcessingConfiguration.applyByPostProcess;var t=[N.d.PositionKind];L.VERTEXCOLOR&&t.push(N.d.ColorKind);var p=L.toString();i.setEffect(h.getEngine().createEffect("sky",t,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"],[],p,l,this.onCompiled,this.onError),L,this._materialContext)}return!(!i.effect||!i.effect.isReady())&&(L._renderId=h.getRenderId(),i.effect._wasPreviouslyReady=!0,!0)},i.prototype.bindForSubMesh=function(W,i,L){var h=this.getScene();if(L.materialDefines){var l=L.effect;if(l){this._activeEffect=l,this.bindOnlyWorldMatrix(W),this._activeEffect.setMatrix("viewProjection",h.getTransformMatrix()),this._mustRebind(h,l)&&(z.e.BindClipPlane(this._activeEffect,h),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),h.fogEnabled&&i.applyFog&&h.fogMode!==I.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",h.getViewMatrix()),z.e.BindFogParameters(h,i,this._activeEffect);var t=h.activeCamera;if(t){var p=t.getWorldMatrix();this._cameraPosition.x=p.m[12],this._cameraPosition.y=p.m[13],this._cameraPosition.z=p.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var R=Math.PI*(this.inclination-.5),r=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(r)*Math.cos(R),this.sunPosition.y=this.distance*Math.sin(-R),this.sunPosition.z=this.distance*Math.sin(r)*Math.cos(R),x.g.FromUnitVectorsToRef(x.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(i,this._activeEffect)}}},i.prototype.getAnimatables=function(){return[]},i.prototype.dispose=function(i){W.prototype.dispose.call(this,i)},i.prototype.clone=function(W){var L=this;return p.d.Clone((function(){return new i(W,L.getScene())}),this)},i.prototype.serialize=function(){var i=W.prototype.serialize.call(this);return i.customType="BABYLON.SkyMaterial",i},i.prototype.getClassName=function(){return"SkyMaterial"},i.Parse=function(W,L,h){return p.d.Parse((function(){return new i(W.name,L)}),W,L,h)},t([(0,p.H)()],i.prototype,"luminance",void 0),t([(0,p.H)()],i.prototype,"turbidity",void 0),t([(0,p.H)()],i.prototype,"rayleigh",void 0),t([(0,p.H)()],i.prototype,"mieCoefficient",void 0),t([(0,p.H)()],i.prototype,"mieDirectionalG",void 0),t([(0,p.H)()],i.prototype,"distance",void 0),t([(0,p.H)()],i.prototype,"inclination",void 0),t([(0,p.H)()],i.prototype,"azimuth",void 0),t([(0,p.G)()],i.prototype,"sunPosition",void 0),t([(0,p.H)()],i.prototype,"useSunPosition",void 0),t([(0,p.G)()],i.prototype,"cameraOffset",void 0),t([(0,p.G)()],i.prototype,"up",void 0),i}(r.d);(0,s.c)("BABYLON.SkyMaterial",c)},22494:function(W,i,L){"use strict";function h(W,i){i.headers=W.headers||{},i.statusMessage=W.statusText,i.statusCode=W.status,i.data=W.response}function l(W,i,L){return new Promise((function(l,t){L=L||{};var p,x,R,z=new XMLHttpRequest,r=L.body,N=L.headers||{};for(p in L.timeout&&(z.timeout=L.timeout),z.ontimeout=z.onerror=function(W){W.timeout="timeout"==W.type,t(W)},z.open(W,i.href||i),z.onload=function(){for(R=z.getAllResponseHeaders().trim().split(/[\r\n]+/),h(z,z);x=R.shift();)x=x.split(": "),z.headers[x.shift().toLowerCase()]=x.join(": ");if((x=z.headers["content-type"])&&~x.indexOf("application/json"))try{z.data=JSON.parse(z.data,L.reviver)}catch(W){return h(z,W),t(W)}(z.status>=400?t:l)(z)},typeof FormData<"u"&&r instanceof FormData||r&&"object"==typeof r&&(N["content-type"]="application/json",r=JSON.stringify(r)),z.withCredentials=!!L.withCredentials,N)z.setRequestHeader(p,N[p]);z.send(r)}))}L.r(i),L.d(i,{del:function(){return R},get:function(){return t},patch:function(){return x},post:function(){return p},put:function(){return z},send:function(){return l}});var t=l.bind(l,"GET"),p=l.bind(l,"POST"),x=l.bind(l,"PATCH"),R=l.bind(l,"DELETE"),z=l.bind(l,"PUT")},4088:function(W,i,L){"use strict";Math.sqrt(3),Math.sqrt(3),Math.sqrt(5),Math.sqrt(5),new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0])}}]);